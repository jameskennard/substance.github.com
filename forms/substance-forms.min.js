!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(this,function(){function t(t,e){t&&(t.constructor.prototype.forEach?t.forEach(e):Object.keys(t).forEach(function(n){return e(t[n],n)}))}function e(t){var e=typeof t;return Boolean(t)&&("object"===e||"function"===e)}function n(t,e){return e.priority-t.priority}function o(t,e,n,o){var r;return s(e,n),r=this.__events__.hasOwnProperty(t)?this.__events__[t]:this.__events__[t]=[],r.push({method:e,context:n||null,priority:o}),this}function r(t,e,n){var o,r;if(1===arguments.length)return delete this.__events__[t],this;if(s(e,n),!(t in this.__events__&&this.__events__[t].length))return this;for(arguments.length<3&&(n=null),r=this.__events__[t],o=r.length;o--;)r[o].method===e&&r[o].context===n&&r.splice(o,1);return 0===r.length&&delete this.__events__[t],this}function i(e){return t(this.__events__,function(t,n){for(var o=this,i=t.length-1;i>=0;i--)t[i]&&t[i].context===e&&r.call(o,n,t[i].method,e)}.bind(this)),this}function s(t,e){if("string"==typeof t){if(void 0===e||null===e)throw new Error('Method name "'+t+'" has no context.');if(!(t in e))throw new Error('Method not found: "'+t+'"');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function a(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Object.assign.apply(Object,t)}function p(t,e){if(!t)return[];if(e||(e=function(t){return t}),Array.isArray(t))return t.map(e);if("undefined"!=typeof t.length){for(var n=t.length,o=[],r=0;n>r;r++)o.push(e(t[r],r));return o}return Object.keys(t).map(function(n){return e(t[n],n)})}function c(t){return Boolean(t)&&t.constructor==={}.constructor}function u(t){return Array.isArray(t)}function h(t,e){if(t===e)return!0;if(u(t)&&u(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!h(t[n],e[n]))return!1;return!0}if(c(t)&&c(e)){var o=Object.keys(t).sort(),r=Object.keys(e).sort();if(!h(o,r))return!1;for(var i=0;i<o.length;i++){var s=o[i];if(!h(t[s],e[s]))return!1}return!0}return!1}function l(t){return u(t)?t.slice(0):e(t)?Object.assign({},t):t}function f(t){return u(t)?g(t):wu&&t instanceof window.File?t:e(t)?d(t):t}function d(e){var n={};return t(e,function(t,e){n[e]=f(t)}),n}function g(t){return t.map(f)}function y(t,e){t&&"-"!==t[t.length-1]&&(t=t.concat("-"));var n,o="0123456789abcdefghijklmnopqrstuvwxyz".split(""),r=[],i=16;if(e=e||32)for(n=0;e>n;n++)r[n]=o[0|Math.random()*i];else{var s;for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",n=0;36>n;n++)r[n]||(s=0|16*Math.random(),r[n]=o[19===n?3&s|8:s])}return(t?t:"")+r.join("")}function v(t){return"number"==typeof t}function m(t){return null===t||void 0===t}function _(t){return"string"==typeof t}function w(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function b(t){var e=w(t)?Eu.call(t):"";return e==Cu||e==Su}function C(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}function S(t){return t&&t.Object===Object?t:null}function x(t){return!!Du&&Du in t}function E(t){if(null!=t){try{return Au.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function N(t){if(!w(t)||x(t))return!1;var e=b(t)||C(t)?Fu:ku;return e.test(E(t))}function I(t,e){return null==t?void 0:t[e]}function O(t,e){var n=I(t,e);return N(n)?n:void 0}function T(){this.__data__=Bu?Bu(null):{}}function P(t){return this.has(t)&&delete this.__data__[t]}function D(t){var e=this.__data__;if(Bu){var n=e[t];return n===Hu?void 0:n}return zu.call(e,t)?e[t]:void 0}function A(t){var e=this.__data__;return Bu?void 0!==e[t]:Ju.call(e,t)}function M(t,e){var n=this.__data__;return n[t]=Bu&&void 0===e?qu:e,this}function k(t){var e=this,n=-1,o=t?t.length:0;for(this.clear();++n<o;){var r=t[n];e.set(r[0],r[1])}}function j(){this.__data__=[]}function R(t,e){return t===e||t!==t&&e!==e}function L(t,e){for(var n=t.length;n--;)if(R(t[n][0],e))return n;return-1}function F(t){var e=this.__data__,n=L(e,t);if(0>n)return!1;var o=e.length-1;return n==o?e.pop():Gu.call(e,n,1),!0}function B(t){var e=this.__data__,n=L(e,t);return 0>n?void 0:e[n][1]}function H(t){return L(this.__data__,t)>-1}function U(t,e){var n=this.__data__,o=L(n,t);return 0>o?n.push([t,e]):n[o][1]=e,this}function z(t){var e=this,n=-1,o=t?t.length:0;for(this.clear();++n<o;){var r=t[n];e.set(r[0],r[1])}}function W(){this.__data__={hash:new k,map:new($u||z),string:new k}}function J(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function q(t,e){var n=t.__data__;return J(e)?n["string"==typeof e?"string":"hash"]:n.map}function V(t){return q(this,t)["delete"](t)}function G(t){return q(this,t).get(t)}function $(t){return q(this,t).has(t)}function K(t,e){return q(this,t).set(t,e),this}function X(t){var e=this,n=-1,o=t?t.length:0;for(this.clear();++n<o;){var r=t[n];e.set(r[0],r[1])}}function Y(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(Ku);var n=function(){var o=arguments,r=e?e.apply(this,o):o[0],i=n.cache;if(i.has(r))return i.get(r);var s=t.apply(this,o);return n.cache=i.set(r,s),s};return n.cache=new(Y.Cache||X),n}function Q(t){return!!t&&"object"==typeof t}function Z(t){return"symbol"==typeof t||Q(t)&&Zu.call(t)==Yu}function tt(t){if("string"==typeof t)return t;if(Z(t))return nh?nh.call(t):"";var e=t+"";return"0"==e&&1/t==-th?"-0":e}function et(t){return null==t?"":tt(t)}function nt(t){return bu(t)?t:ih(t)}function ot(t,e){if(bu(t))return!1;var n=typeof t;return"number"==n||"symbol"==n||"boolean"==n||null==t||Z(t)?!0:ah.test(t)||!sh.test(t)||null!=e&&t in Object(e)}function rt(t){if("string"==typeof t||Z(t))return t;var e=t+"";return"0"==e&&1/t==-ph?"-0":e}function it(t,e){e=ot(e,t)?[e]:nt(e);for(var n=0,o=e.length;null!=t&&o>n;)t=t[rt(e[n++])];return n&&n==o?t:void 0}function st(t,e,n){var o=null==t?void 0:it(t,e);return void 0===o?n:o}function at(t,e,n){var o=t[e];uh.call(t,e)&&R(o,n)&&(void 0!==n||e in t)||(t[e]=n)}function pt(t,e){return e=null==e?hh:e,!!e&&("number"==typeof t||lh.test(t))&&t>-1&&t%1==0&&e>t}function ct(t,e,n,o){e=ot(e,t)?[e]:nt(e);for(var r=-1,i=e.length,s=i-1,a=t;null!=a&&++r<i;){var p=rt(e[r]);if(w(a)){var c=n;if(r!=s){var u=a[p];c=o?o(u,p,a):void 0,void 0===c&&(c=null==u?pt(e[r+1])?[]:{}:u)}at(a,p,c)}a=a[p]}return t}function ut(t,e,n,o){return o="function"==typeof o?o:void 0,null==t?t:ct(t,e,n,o)}function ht(t){return fh(Object(t))}function lt(t,e){return null!=t&&(gh.call(t,e)||"object"==typeof t&&e in t&&null===ht(t))}function ft(t){var e=t?t.length:0;return e?t[e-1]:void 0}function dt(t,e,n){var o=-1,r=t.length;0>e&&(e=-e>r?0:r+e),n=n>r?r:n,0>n&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(r);++o<r;)i[o]=t[o+e];return i}function gt(t,e){return 1==e.length?t:it(t,dt(e,0,-1))}function yt(t,e){e=ot(e,t)?[e]:nt(e),t=gt(t,e);var n=rt(ft(e));return!(null!=t&&lt(t,n))||delete t[n]}function vt(t,e){return null==t?!0:yt(t,e)}function mt(t,e){if(t.type===mh&&e.type===mh)return t.pos===e.pos;if(t.type===_h&&e.type===_h)return!(t.pos>=e.pos+e.str.length||e.pos>=t.pos+t.str.length);var n,o;return t.type===_h?(n=t,o=e):(n=e,o=t),o.pos>=n.pos&&o.pos<n.pos+n.str.length}function _t(t,e){t.pos===e.pos?e.pos+=t.str.length:t.pos<e.pos?e.pos+=t.str.length:t.pos+=e.str.length}function wt(t,e,n){if(t.pos>e.pos)return wt(e,t,!n);if(t.pos===e.pos&&t.str.length>e.str.length)return wt(e,t,!n);if(e.pos<t.pos+t.str.length){var o=e.pos-t.pos,r=t.str.length-o,i=o+e.str.length;t.str=t.str.slice(0,o)+t.str.slice(i),e.str=e.str.slice(r),e.pos-=o}else e.pos-=t.str.length}function bt(t,e){if(t.type===_h)return bt(e,t);if(t.pos<=e.pos)e.pos+=t.str.length;else if(t.pos>=e.pos+e.str.length)t.pos-=e.str.length;else{var n=t.pos-e.pos;e.str=e.str.slice(0,n)+t.str+e.str.slice(n),t.str=""}}function Ct(t,e,n){if(n=n||{},n["no-conflict"]&&mt(t,e))throw new vh(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===mh&&e.type===mh?_t(t,e):t.type===_h&&e.type===_h?wt(t,e,!0):bt(t,e),[t,e]}function St(t,e){return t.type===bh||e.type===bh?!1:t.type===Sh&&e.type===Sh?t.pos===e.pos:!1}function xt(t,e){t.pos===e.pos?e.pos+=1:t.pos<e.pos?e.pos+=1:t.pos+=1}function Et(t,e){return t.pos===e.pos?(e.type=bh,void(t.type=bh)):void(t.pos<e.pos?e.pos-=1:t.pos-=1)}function Nt(t,e){if(t.type===Ch){var n=t;t=e,e=n}t.pos<=e.pos?e.pos+=1:t.pos-=1}function It(t,e){t.val+=e.val,e.val+=t.val}function Ot(t,e,n){if(n=n||{},n.inplace||(t=t.clone(),e=e.clone()),t.type!==Nh||e.type!==Nh)throw new Error("Illegal type");return It(t,e),[t,e]}function Tt(t,e){return t.type===Oh||e.type===Oh?!1:h(t.path,e.path)}function Pt(t,e){t.type=Oh,e.type=Oh}function Dt(){throw new Error("Can not transform two concurring creates of the same property")}function At(){throw new Error("Illegal state: can not create and delete a value at the same time.")}function Mt(t,e,n){if(t.type!==Ph)return Mt(e,t,!0);var o;switch(e.propertyType){case"string":o=wh.fromJSON(e.diff);break;case"array":o=xh.fromJSON(e.diff);break;case"coordinate":o=Ih.fromJSON(e.diff);break;default:throw new Error("Illegal type")}n?(t.val=o.apply(t.val),e.type=Oh):(t.type=Oh,e.type=Th,e.val=o.apply(t.val))}function kt(){throw new Error("Can not transform a concurring create and update of the same property")}function jt(t,e){var n,o,r;switch(e.propertyType){case"string":n=wh.fromJSON(t.diff),o=wh.fromJSON(e.diff),r=wh.transform(n,o,{inplace:!0});break;case"array":n=xh.fromJSON(t.diff),o=xh.fromJSON(e.diff),r=xh.transform(n,o,{inplace:!0});break;case"coordinate":n=Ih.fromJSON(t.diff),o=Ih.fromJSON(e.diff),r=Ih.transform(n,o,{inplace:!0});break;default:throw new Error("Illegal type")}t.diff=r[0],e.diff=r[1]}function Rt(){throw new Error("Illegal state: can not create and set a value at the same time.")}function Lt(t,e,n){return t.type!==Ph?Lt(e,t,!0):void(n?(t.val=e.val,e.type=Oh):(t.type=Oh,e.type=Th,e.original=void 0))}function Ft(){throw new Error("Unresolvable conflict: update + set.")}function Bt(t,e){t.type=Oh,e.original=t.val}function Ht(t,e,n){if(n=n||{},n["no-conflict"]&&Tt(t,e))throw new vh(t,e);if(n.inplace||(t=t.clone(),e=e.clone()),t.isNOP()||e.isNOP())return[t,e];var o=h(t.path,e.path);return o&&Hh[Bh[t.type]|Bh[e.type]](t,e),[t,e]}function Ut(t,e){if(t===e)return!0;if(!u(t)||!u(e))return!1;if(t.length!==e.length)return!1;for(var n=t.length,o=0;n>o;o++)if(t[o]!==e[o])return!1;return!0}function zt(t,e,n){var o=new Qh(t.containerId,e.path,e.offset,n.path,n.offset,!1,t.surfaceId),r=t._internal.doc;return r&&o.attach(r),o}function Wt(t){return t[t.length-1]}function Jt(t){if(!t)return qh.nullSelection;var e=t.type;switch(e){case"property":return Yh.fromJSON(t);case"container":return Qh.fromJSON(t);case"node":return Zh.fromJSON(t);case"custom":return tl.fromJSON(t);default:return qh.nullSelection}}function qt(t,e){if(e.isNodeCoordinate()&&0===e.offset)return!0;var n=t.get(e.path[0]).getRoot();if(n.isText()&&0===e.offset)return!0;if(n.isList()){var o=e.path[0];if(n.items[0]===o&&0===e.offset)return!0}}function Vt(t,e){if(e.isNodeCoordinate()&&e.offset>0)return!0;var n=t.get(e.path[0]).getRoot();if(n.isText()&&e.offset>=n.getLength())return!0;if(n.isList()){var o=e.path[0],r=t.get(o);if(Wt(n.items)===o&&e.offset===r.getLength())return!0}}function Gt(t,e,n,o){var r=$t(t,e,n,o),i=r.isEntirelySelected;return i}function $t(t,e,n,o){var r=!0,i=!0;if(e.isText())n&&0!==n.offset&&(r=!1),o&&o.offset<e.getLength()&&(i=!1);else if(e.isList()){if(n){var s=n.path[0],a=e.getItemPosition(s);(a>0||0!==n.offset)&&(r=!1)}if(o){var p=o.path[0],c=e.getItemPosition(p),u=t.get(p);(c<e.items.length-1||o.offset<u.getLength())&&(i=!1)}}var h=r&&i;return{isFirst:r,isLast:i,isEntirelySelected:h}}function Kt(t,e,n,o){if(e.isText()){var r=0;if("after"===o){var i=e.getText();r=i.length}t.setSelection({type:"property",path:e.getTextPath(),startOffset:r,containerId:n})}else if(e.isList()){var s,a;"after"===o?(s=e.getLastItem(),a=s.getLength()):(s=e.getFirstItem(),a=0),t.setSelection({type:"property",path:s.getTextPath(),startOffset:a,containerId:n})}else t.setSelection({type:"node",containerId:n,nodeId:e.id})}function Xt(t,e,n){t.setSelection(Yt({doc:t,nodeId:e,containerId:n}))}function Yt(t){var e=t.doc,n=t.nodeId,o=t.containerId,r=t.mode,i=t.reverse,s=t.surfaceId,a=e.get(n);if(!a)return qh.nullSelection;if(a=a.getRoot(),a.isText())return new Yh({path:a.getTextPath(),startOffset:"after"===r?a.getLength():0,endOffset:"before"===r?0:a.getLength(),reverse:i,containerId:o,surfaceId:s});if(a.isList()&&a.getLength()>0){var p=a.getFirstItem(),c=a.getLastItem(),u={path:p.getTextPath(),offset:0},h={path:c.getTextPath(),offset:c.getLength()};return"after"===r?u=h:"before"===r&&(h=u),new Qh({startPath:u.path,startOffset:u.offset,endPath:h.path,endOffset:h.offset,reverse:i,containerId:o,surfaceId:s})}return new Zh({nodeId:n,mode:r,reverse:i,containerId:o,surfaceId:s})}function Qt(t,e){if(e.grabFocus())return!0;var n=e.find(".sc-surface");if(n){if(n._isTextPropertyEditor){var o=t.getDocument(),r=n.getPath(),i=o.get(r,"strict");return t.setSelection({type:"property",path:r,startOffset:i.length,surfaceId:n.id}),!0}if(n._isContainerEditor){var s=n.getContainer();if(s.length>0){var a=s.getChildAt(0);Kt(t,a,s.id,"after")}return!0}}return!1}function Zt(t,e){for(var n=0;n<t.ops.length;n++)for(var o=t.ops[n],r=0;r<e.ops.length;r++){var i=e.ops[r];Mh.transform(o,i,{inplace:!0})}t.before&&ee(t.before.selection,e),t.after&&ee(t.after.selection,e),e.before&&ee(e.before.selection,t),e.after&&ee(e.after.selection,t)}function te(t,e){u(t)||(t=[t]),u(e)||(e=[e]);for(var n=0;n<t.length;n++)for(var o=t[n],r=0;r<e.length;r++){var i=e[r];Zt(o,i)}}function ee(t,e){if(!t||!t.isPropertySelection()&&!t.isContainerSelection())return!1;for(var n=e.ops,o=!1,r=t.isCollapsed(),i=0;i<n.length;i++){var s=n[i];o|=ne(t.start,s),r?(t.isContainerSelection()&&(t.end.path=t.start.path),t.end.offset=t.start.offset):o|=ne(t.end,s)}return o}function ne(t,e){if(!h(e.path,t.path))return!1;var n=!1;if("update"===e.type&&"string"===e.propertyType){var o,r=e.diff;r.isInsert()&&r.pos<=t.offset?(o=t.offset+r.str.length,t.offset=o,n=!0):r.isDelete()&&r.pos<=t.offset&&(o=Math.max(r.pos,t.offset-r.str.length),t.offset=o,n=!0)}return n}function oe(t,e){if(t)for(var n=0;n<t.length;n++)t[n]===e&&(t.splice(n,1),n--)}function re(t){return"function"==typeof t}function ie(e,n){if(!e)return[];if(e.constructor.prototype.filter&&re(e.constructor.prototype.filter))return e.filter(n);var o=[];return t(e,function(t,e){n(t,e)&&o.push(t)}),o}function se(t){return Array.prototype.concat.apply([],t)}function ae(t,e,n){if(n)for(var o=t.getIndex("annotations"),r=o.get(e.path),i=0;i<r.length;i++){var s=r[i],a=e.offset,p=s.start.offset,c=s.end.offset,u=p,h=c;(p>a||a===p)&&(u+=n),(c>a||a===c&&!s.isInline())&&(h+=n),u!==p&&t.set([s.id,"start","offset"],u),h!==c&&t.set([s.id,"end","offset"],h)}}function pe(t,e,n,o){if(n!==o)for(var r=t.getIndex("annotations"),i=r.get(e),s=o-n,a=0;a<i.length;a++){var p=i[a],c=n,u=o,h=p.start.offset,l=p.end.offset,f=h,d=l;h>=u?(f-=s,d-=s,t.set([p.id,"start","offset"],f),t.set([p.id,"end","offset"],d)):(h>=c&&(f=h-Math.min(u-c,h-c)),l>=c&&(d=l-Math.min(u-c,l-c)),h!==l&&f===d?t["delete"](p.id):(h!==f&&t.set([p.id,"start","offset"],f),l!==d&&t.set([p.id,"end","offset"],d)))}}function ce(t,e,n,o,r){for(var i=t.getIndex("annotations"),s=i.get(e,n),a=0;a<s.length;a++){var p=s[a],c=n>p.start.offset&&n<p.end.offset,u=p.start.offset,h=p.end.offset;if(c){if(p.canSplit()){var l=p.toJSON();l.id=y(p.type+"_"),l.start.path=o,l.start.offset=r,l.end.path=o,l.end.offset=r+p.end.offset-n,t.create(l)}var f=p.start.offset,d=n;d===f?t["delete"](p.id):(f!==u&&t.set([p.id,"start","offset"],f),d!==h&&t.set([p.id,"end","offset"],d))}else p.start.offset>=n&&(t.set([p.id,"start","path"],o),t.set([p.id,"start","offset"],r+p.start.offset-n),t.set([p.id,"end","path"],o),t.set([p.id,"end","offset"],r+p.end.offset-n))}}function ue(t,e,n){if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!e||!e._isAnnotation)throw new Error('Argument "anno" is required.');var o=e.getSelection(),r=o.truncateWith(n);return e._updateRange(t,r),e}function he(t,e,n){if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!e||!e._isAnnotation)throw new Error('Argument "anno" is required.');var o=e.getSelection(),r=o.expand(n);return e._updateRange(t,r),e}function le(t,e){if(!u(e)||e.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");var n,o;e.forEach(function(t,e){if(0===e)n=t.getSelection(),o=t.type;else{if(t.type!==o)throw new Error("fuseAnnotation(): all annotations must be of the same type.");n=n.expand(t.getSelection())}});for(var r=1;r<e.length;r++)t["delete"](e[r].id);he(t,e[0],n),t.setSelection(n)}function fe(t,e){var n=t.getSchema();return n.isInstanceOf(e,"container-annotation")}function de(t,e,n){if(n=n||{},!e.isPropertySelection())return[];var o=e.getPath(),r=t.getIndex("annotations").get(o,e.start.offset,e.end.offset);return n.type&&(r=ie(r,hl.filterByType(n.type))),r}function ge(t,e,n,o){if(!n)throw new Error("'containerId' is required.");o=o||{};var r=t.getIndex("container-annotations"),i=r.get(n,o.type);return i=ie(i,function(t){return e.overlaps(t.getSelection())})}function ye(t,e,n,o){var r,i=fe(t,n);if(i){var s=t.get(o,"strict");r=ge(t,e,s,{type:n})}else r=de(t,e,{type:n});return r}function ve(t,e){if(!e||e.isNull())return"";if(e.isPropertySelection()){var n=t.get(e.start.path);return n.substring(e.start.offset,e.end.offset)}if(e.isContainerSelection()){for(var o=[],r=e.getNodeIds(),i=r.length,s=0;i>s;s++){var a=r[s],p=t.get(a);if(p.isText()){var c=p.getText();s===i-1&&(c=c.slice(0,e.end.offset)),0===s&&(c=c.slice(e.start.offset)),o.push(c)}}return o.join("\n")}}function me(t,e){if(!e||!e.isPropertySelection())return[];var n=e.getPath(),o=t.getIndex("markers").get(n),r=ie(o,function(t){return t.containsSelection(e)});return r}function _e(e){var n=e.getNodes(),o=[],r=[],i=[];t(n,function(t){t._isAnnotation?o.push(t):t._isContainer?i.push(t):r.push(t)});var s=r.concat(i).concat(o).map(function(t){return Mh.Create([t.id],t.toJSON())});return new el({ops:s})}function we(e,n){if(!n)return void console.warn("Invalid arguments");if(n.isText())for(var o=e.getIndex("annotations").get(n.id),r=0;r<o.length;r++)e["delete"](o[r].id);var i=n.getSchema();t(i,function(t){if(t.isReference()&&t.isOwned()||"file"===t.type)if(t.isArray()){var o=n[t.name];o.forEach(function(t){we(e,e.get(t))})}else we(e,e.get(n[t.name]))}),e["delete"](n.id)}function be(e){function n(t){if(!t)return null;if(u(t))return se(t.map(n));var e=t;if(!e)return null;var o=i.get(e);if(o)return be(o)}var o=[],r=e.getSchema(),i=e.getDocument();t(r,function(t){if(t.isReference()&&t.isOwned()||"file"===t.type){var r=e[t.name];o.push(n(r))}}),o.push(e.toJSON());var s=e.getDocument().getIndex("annotations"),a=s.get([e.id]);t(a,function(t){o.push(t.toJSON())});var p=se(o).filter(Boolean);return p}function Ce(t,e,n){e||(e={path:n.path,offset:0});var o=e.path,r=t.get(o);if(n||(n={path:e.path,offset:r.length}),!Ut(e.path,n.path))throw new Error("Unsupported state: selection should be on one property");var i=e.offset,s=n.offset;t.update(o,{type:"delete",start:i,end:s});var a=t.getAnnotations(o);a.forEach(function(e){var n=e.start.offset,o=e.end.offset;i>=o||(n>=s?(t.update([e.id,"start"],{type:"shift",value:i-s}),t.update([e.id,"end"],{type:"shift",value:i-s})):n>=i&&s>=o?t["delete"](e.id):n>=i&&o>=s?(n>i&&t.update([e.id,"start"],{type:"shift",value:i-n}),t.update([e.id,"end"],{type:"shift",value:i-s})):i>=n&&s>=o?t.update([e.id,"end"],{type:"shift",value:i-o}):i>n&&o>=s?t.update([e.id,"end"],{type:"shift",value:i-s}):console.warn("TODO: handle annotation update case."))})}function Se(t,e,n,o){if(t!==e.getDocument()&&(e=t.get(e.id)),n||(n={path:e.getItemAt(0).getTextPath(),offset:0}),!o){var r=e.getLastItem();o={path:r.getTextPath(),offset:r.getLength()}}var i=n.path[0],s=e.getItemPosition(i),a=o.path[0],p=e.getItemPosition(a);if(s===p)return void Ce(t,n,o);if(s>p){var c;c=[o,n],n=c[0],o=c[1];var u;u=[p,s],s=u[0],p=u[1];var h;h=[a,i],i=h[0],a=h[1]}var l=t.get(i),f=t.get(a),d=Gt(t,l,n,null),g=Gt(t,f,null,o);g?(e.removeItemAt(p),we(t,f)):Ce(t,null,o);for(var y=p-1;y>s;y--){var v=e.items[y];e.removeItemAt(y),we(t,t.get(v))}d?(e.removeItemAt(s),we(t,l)):Ce(t,n,null),d||g||xe(t,e.id,s)}function xe(t,e,n){var o=t.get(e),r=o.getItemAt(n),i=r.getTextPath(),s=r.getLength(),a=o.getItemAt(n+1),p=a.getTextPath();o.removeItemAt(n+1),t.update(i,{type:"insert",start:s,text:a.getText()}),ll.transferAnnotations(t,p,0,i,s),t["delete"](a.id)}function Ee(t,e){if(console.warn("DEPRECATED: use document.createSelection({ type: ... }) instead"),e[0]instanceof Wh){var n=e[0];return n.isNodeCoordinate()?Zh._createFromCoordinate(n):t.createSelection({type:"property",path:n.path,startOffset:n.offset})}return e[0]instanceof El?t._createSelectionFromRange(e[0]):2===e.length&&u(e[0])?t.createSelection({type:"property",path:e[0],startOffset:e[1]}):3===e.length&&u(e[0])?t.createSelection({type:"property",path:e[0],startOffset:e[1],endOffset:e[2]}):5===e.length&&_(e[0])?t.createSelection({type:"container",containerId:e[0],startPath:e[1],startOffset:e[2],endPath:e[3],endOffset:e[4]}):(console.error("Illegal arguments for document.createSelection().",e),t.createSelection(null))}function Ne(t,e){if(!e)throw new Error("'selection' is mandatory.");var n=null;return e.isNull()||e.isCollapsed()||(e.isPropertySelection()?n=Ie(t,e):e.isContainerSelection()?n=Oe(t,e):e.isNodeSelection()?n=Te(t,e):console.error("Copy is not yet supported for selection type.")),n}function Ie(e,n){var o=n.start.path,r=n.start.offset,i=n.end.offset,s=e.get(o),a=e.createSnippet(),p=a.getContainer();a.create({type:e.schema.getDefaultTextType(),id:Tl.TEXT_SNIPPET_ID,content:s.substring(r,i)}),p.show(Tl.TEXT_SNIPPET_ID);var c=e.getIndex("annotations").get(o,r,i);return t(c,function(t){var e=f(t.toJSON()),n=[Tl.TEXT_SNIPPET_ID,"content"];e.start={path:n,offset:Math.max(r,t.start.offset)-r},e.end={path:n,offset:Math.min(i,t.end.offset)-r},a.create(e)}),a}function Oe(t,e){var n=t.createSnippet(),o=n.getContainer(),r=e.getNodeIds(),i=r.length;if(0===i)return n;for(var s=e.start,a=e.end,p=!1,c=!1,u={},h=0;i>h;h++){var l=r[h],f=t.get(l);0===h&&Vt(t,s)?p=!0:h===i-1&&qt(t,a)?c=!0:u[l]||(fl.copyNode(f).forEach(function(t){var e=n.create(t);u[e.id]=!0}),o.show(l))}if(!p){var d=n.get(s.getNodeId()).getRoot();d.isText()?fl.deleteTextRange(n,null,s):d.isList()&&fl.deleteListRange(n,d,null,s)}if(!c){var g=n.get(a.getNodeId()).getRoot();g.isText()?fl.deleteTextRange(n,a,null):g.isList()&&fl.deleteListRange(n,g,a,null)}return n}function Te(t,e){var n=t.createSnippet(),o=n.getContainer(),r=e.getNodeId(),i=t.get(r);return fl.copyNode(i).forEach(function(t){n.create(t)}),o.show(i.id),n}function Pe(t,e){var n=t.selection;if(!n||n.isNull())throw new Error("Can not paste, without selection.");e=e||{},e.text=e.text||"";var o=e.doc,r=Boolean(n.containerId);if(!o&&!r)return void t.insertText(e.text);o||(o=De(t,e)),n.isCollapsed()||t.deleteSelection();var i=o.get(Tl.SNIPPET_ID).nodes,s=t.getSchema();if(i.length>0){var a=o.get(i[0]);s.isInstanceOf(a.type,"text")&&(Ae(t,o),i.shift()),i.length>0&&Me(t,o)}return e}function De(t,e){var n,o=e.text.split(/\s*\n\s*\n/),r=t.getDocument().newInstance(),i=r.getSchema().getDefaultTextType(),s=r.create({type:"container",id:Tl.SNIPPET_ID,nodes:[]});if(1===o.length)n=r.create({id:Tl.TEXT_SNIPPET_ID,type:i,content:o[0]}),s.show(n.id);else for(var a=0;a<o.length;a++)n=r.create({id:y(i),type:i,content:o[a]}),s.show(n.id);return r}function Ae(e,n){var o=e.selection,r=n.get(Tl.SNIPPET_ID).nodes,i=[r[0],"content"],s=n.get(i),a=n.getIndex("annotations").get(i),p=o.start.path,c=o.start.offset;e.insertText(s),t(a,function(t){var n=t.toJSON();n.start.path=p.slice(0),n.start.offset+=c,n.end.offset+=c,e.get(n.id)&&(n.id=y(n.type)),e.create(n)})}function Me(t,e){var n,o=t.selection,r=o.containerId,i=t.get(r);if(o.isPropertySelection()){var s=o.start.path,a=o.start.getNodeId(),p=i.getPosition(a,"strict"),c=t.get(s);0===c.length?(n=p,i.hide(a),fl.deleteNode(t,t.get(a))):c.length===o.start.offset?n=p+1:(t["break"](),n=p+1)}else if(o.isNodeSelection()){var u=i.getPosition(o.getNodeId(),"strict");if(o.isBefore())n=u;else{if(!o.isAfter())throw new Error("Illegal state: the selection should be collapsed.");n=u+1}}for(var h=e.get(Tl.SNIPPET_ID).nodes,l=[],f={},d=0;d<h.length;d++){var g=e.get(h[d]),y=ke(g.getDocument(),t,g.id,f);g=t.get(y),i.show(y,n++),l.push(g)}if(l.length>0){var v=Wt(l);Kt(t,v,r,"after")}}function ke(t,e,n,o){if(o[n])throw new Error("FIXME: dont call me twice");var r,i=t.get(n,"strict"),s=i.id;e.contains(i.id)&&(r=y(i.type),i.id=r),o[n]=i.id;var a=t.getIndex("annotations"),p=i.getSchema(),c=[];for(var u in p)if("id"!==u&&"type"!==u&&p.hasOwnProperty(u)){var h=p[u],l=h.name;if(h.isReference()&&h.isOwned()||"file"===h.type){var f=i[h.name];if(h.isArray())je(t,e,f,o);else{var d=f;o[d]||(i[l]=ke(t,e,d,o))}}else if(h.isText())for(var g=a.get([i.id]),v=0;v<g.length;v++){var m=g[v];m.start.path[0]===s&&(m.start.path[0]=r),m.end.path[0]===s&&(m.end.path[0]=r),c.push(m)}}e.create(i);for(var _=0;_<c.length;_++)ke(t,e,c[_].id,o);return i.id}function je(t,e,n,o){for(var r=0;r<n.length;r++){var i=n[r];if(u(i))je(t,e,i,o);else{var s=i;s&&!o[s]&&(n[r]=ke(t,e,s,o))}}}function Re(t,e){if(!(e>0))throw new Error("'max' must be a positive number");var n=t.length;t=se(t);for(var o=1;e>o&&n<t.length;)n=t.length,t=se(t),o++;return t}function Le(t){return this.__data__.set(t,Ul),this}function Fe(t){return this.__data__.has(t)}function Be(t){var e=this,n=-1,o=t?t.length:0;for(this.__data__=new X;++n<o;)e.add(t[n])}function He(t,e,n){for(var o=t.length,r=e+(n?1:-1);n?r--:++r<o;){var i=t[r];if(i!==i)return r}return-1}function Ue(t,e,n){if(e!==e)return He(t,n);for(var o=n-1,r=t.length;++o<r;)if(t[o]===e)return o;return-1}function ze(t,e){var n=t?t.length:0;return!!n&&Ue(t,e,0)>-1}function We(t,e,n){for(var o=-1,r=t?t.length:0;++o<r;)if(n(e,t[o]))return!0;return!1}function Je(t,e){for(var n=-1,o=t?t.length:0,r=Array(o);++n<o;)r[n]=e(t[n],n,t);return r}function qe(t){return function(e){return t(e)}}function Ve(t,e){return t.has(e)}function Ge(t,e,n,o){var r=-1,i=ze,s=!0,a=t.length,p=[],c=e.length;if(!a)return p;n&&(e=Je(e,qe(n))),o?(i=We,s=!1):e.length>=zl&&(i=Ve,s=!1,e=new Be(e));t:for(;++r<a;){var u=t[r],h=n?n(u):u;if(u=o||0!==u?u:0,s&&h===h){for(var l=c;l--;)if(e[l]===h)continue t;p.push(u)}else i(e,h,o)||p.push(u)}return p}function $e(t){return function(e){return null==e?void 0:e[t]}}function Ke(t){return"number"==typeof t&&t>-1&&t%1==0&&Jl>=t}function Xe(t){return null!=t&&Ke(Wl(t))&&!b(t)}function Ye(t){return Q(t)&&Xe(t)}function Qe(t,e,n){var o=n.length;switch(o){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ze(t){if("number"==typeof t)return t;if(Z(t))return ql;if(w(t)){var e=b(t.valueOf)?t.valueOf():t;t=w(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Vl,"");var n=$l.test(t);return n||Kl.test(t)?Xl(t.slice(2),n?2:8):Gl.test(t)?ql:+t}function tn(t){if(!t)return 0===t?t:0;if(t=Ze(t),t===Yl||t===-Yl){var e=0>t?-1:1;return e*Ql}return t===t?t:0}function en(t){var e=tn(t),n=e%1;return e===e?n?e-n:e:0}function nn(t,e){if("function"!=typeof t)throw new TypeError(Zl);return e=tf(void 0===e?t.length-1:en(e),0),function(){for(var n=arguments,o=-1,r=tf(n.length-e,0),i=Array(r);++o<r;)i[o]=n[e+o];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,n[0],i);case 2:return t.call(this,n[0],n[1],i)}var s=Array(e+1);for(o=-1;++o<e;)s[o]=n[o];return s[e]=i,Qe(t,this,s)}}function on(t,e){if(!re(e))return t.indexOf(e);for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function rn(t,e){return t.eventName===e.eventName&&t.originalHandler===e.originalHandler}function sn(t,e){return function(n){e(n),t._el.removeEventListener(t)}}function an(t,e){var n=window.Element.prototype,o=n.matches||n.matchesSelector||n.msMatchesSelector||n.webkitMatchesSelector;return o.call(t,e)}function pn(t,e){var n=e._comp;console.assert(!n,"Component instance should not exist when this method is used.");var o=e.parent._comp;return o||(o=pn(t,e.parent)),e._isVirtualComponent?(console.assert(o,"A Component should have a parent."),n=new e.ComponentClass(o,e.props),e.props=n.props,n.__htmlConfig__=e._copyHTMLConfig()):e._isVirtualHTMLElement?n=new Ef.Element(o,e):e._isVirtualTextNode&&(n=new Ef.TextNode(o,e)),e._ref&&(n._ref=e._ref),e._owner&&(n._owner=e._owner._comp),e._comp=n,n}function cn(t,e,n){if(t.isCaptured(e))return e;var o=e._comp;if(o||(o=pn(t,e),t.setNew(e)),e._isVirtualComponent){var r;if(n?r=!0:(r=!o.el||o.shouldRerender(e.props,o.state),o.__htmlConfig__=e._copyHTMLConfig(),t.setOldProps(e,o.props),t.setOldState(e,o.state),o._setProps(e.props),t.isNew(e)||t.setUpdated(e)),r){var i=new Sf(e),s=o.render(i.$$);if(!s||!s._isVirtualHTMLElement)throw new Error("Component.render must return VirtualHTMLElement");if(o.__htmlConfig__&&s._mergeHTMLConfig(o.__htmlConfig__),s._comp=o,e._content=s,!t.isNew(e)&&o.isMounted()&&t.setUpdated(e),vn(t,o,s),Hl.DEBUG_RENDERING){for(var a=s.children.slice(0);a.length;){var p=a.shift();t.isCaptured(p)||p._isVirtualComponent||(p._comp||pn(t,p),p._isVirtualHTMLElement&&p.children.length>0&&(a=a.concat(p.children)),t.setCaptured(p))}t.setCaptured(s);for(var c=new Cf(t,i);c.hasPendingCaptures();)c.reset(),o.render(c.$$)}else cn(t,e._content)}else t.setSkipped(e)}else if(e._isVirtualHTMLElement)for(var u=0;u<e.children.length;u++)cn(t,e.children[u]);return t.setCaptured(e),e}function un(e,n){if(!e.isSkipped(n)){var o=n._comp;if(console.assert(o&&o._isComponent,"A captured VirtualElement must have a component instance attached."),n._isVirtualComponent)return void un(e,n._content);if(o.el||(o.el=wn(e,n),o.el._comp=o),bn(o,n),n._isVirtualHTMLElement&&!n.hasInnerHTML()){var r,i,s,a=n.children,p=0,c=0,u=[];for(o.el.getChildNodes().forEach(function(t){var n=t._comp;!n||e.isRelocated(n)?o.el.removeChild(t):u.push(n)});p<u.length||c<a.length;){do r=u[p++];while(r&&e.isDetached(r));if(i=a[c++],r&&!i){for(;r;)gn(e,o,r),r=u[p++];break}r&&r.el.isTextNode()&&i&&i._isVirtualTextNode&&r.el.textContent===i.text||(e.isRendered(i)||un(e,i),s=i._comp,e.isRelocated(s)&&s._setParent(o),console.assert(s,"Component instance should now be available."),!i||r?e.isMapped(i)?s===r||(e.setDetached(r),gn(e,o,r),c--):e.isMapped(r)?(dn(e,o,s,r),p--):fn(e,o,r,s):ln(e,o,s))}}var h={},l={};n._context&&(t(n._context.refs,function(t,e){h[e]=t._comp}),t(n._context.foreignRefs,function(t,e){l[e]=t._comp})),o.refs=h,o.__foreignRefs__=l,e.setRendered(n)}}function hn(t,e){e._isVirtualComponent?(t.isSkipped(e)||e._content.children.forEach(hn.bind(null,t)),t.isUpdated(e)&&e._comp.didUpdate(t.getOldProps(e),t.getOldState(e))):e._isVirtualHTMLElement&&e.children.forEach(hn.bind(null,t))}function ln(t,e,n){e.el.appendChild(n.el),yn(t,e,n)}function fn(t,e,n,o){e.el.replaceChild(n.el,o.el),t.isDetached(n)||n.triggerDispose(),yn(t,e,o)}function dn(t,e,n,o){e.el.insertBefore(n.el,o.el),yn(t,e,n)}function gn(t,e,n){e.el.removeChild(n.el),t.isDetached(n)||n.triggerDispose()}function yn(t,e,n){t.isDetached(n)||!e.isMounted()||n.isMounted()||n.triggerDidMount(!0)}function vn(e,n,o){var r={},i={};o._context&&(r=o._context.refs,i=o._context.foreignRefs);var s=n.refs,a=n.__foreignRefs__;t(r,function(t,n){var o=s[n];o&&mn(e,o,t)}),t(i,function(t,n){var o=a[n];o&&mn(e,o,t)})}function mn(t,e,n){if(!e&&!n)return!0;if(!e||!n)return!1;if(t.isMapped(n)||t.isMapped(e))return n._comp===e;if(n._comp)return n._comp===e?(t.setMapped(n),t.setMapped(e),!0):!1;if(!_n(e,n))return!1;n._comp=e,t.setMapped(n),t.setMapped(e);var o,r=e.getParent();if(n.parent)o=mn(t,r,n.parent);else if(n._preliminaryParent){for(;r&&r._isElementComponent;)r=r.getParent();o=mn(t,r,n._preliminaryParent);
}return o||(t.setRelocated(n),t.setRelocated(e)),o}function _n(t,e){return t._isElementComponent&&e._isVirtualHTMLElement||t._isComponent&&e._isVirtualComponent&&t.constructor===e.ComponentClass||t._isTextNodeComponent&&e._isVirtualTextNode}function wn(t,e){var n;return n=e._isVirtualTextNode?t.elementFactory.createTextNode(e.text):t.elementFactory.createElement(e.tagName)}function bn(t,e){if(t._isTextNodeComponent)return void t.setTextContent(e.text);var n=t.el;console.assert(n,"Component's element should exist at this point.");var o=n.getTagName();if(e.tagName.toLowerCase()!==o&&n.setTagName(e.tagName),Cn({oldHash:n.getAttributes(),newHash:e.getAttributes(),update:function(t,e){n.setAttribute(t,e)},remove:function(t){n.removeAttribute(t)}}),Cn({oldHash:n.htmlProps,newHash:e.htmlProps,update:function(t,e){n.setProperty(t,e)},remove:function(t){n.removeProperty(t)}}),Sn({el:n,oldListeners:n.getEventListeners(),newListeners:e.getEventListeners()}),e.hasInnerHTML()){if(n._hasInnerHTML){var r=n.getInnerHTML(),i=e.getInnerHTML();r!==i&&n.setInnerHTML(i)}else n.empty(),n.setInnerHTML(e.getInnerHTML());n._hasInnerHTML=!0}}function Cn(t){var e,n=t.newHash,o=t.oldHash||{},r={},i=t.update,s=t.remove;for(e in n)if(n.hasOwnProperty(e)){var a=o[e],p=n[e];r[e]=!0,a!==p&&i(e,p)}for(e in o)o.hasOwnProperty(e)&&!r[e]&&s(e)}function Sn(t){var e=t.el,n=t.newListeners||[];e.removeAllEventListeners();for(var o=0;o<n.length;o++)e.addEventListener(n[o])}function xn(t){var e=new cf.Component(t.constructor);return e._comp=t,t.__htmlConfig__&&e._mergeHTMLConfig(t.__htmlConfig__),e}function En(t){t.triggerDispose(),t._owner&&t._ref&&(console.assert(t._owner.refs[t._ref]===t,"Owner's ref should point to this child instance."),delete t._owner.refs[t._ref])}function Nn(t,e){t.isMounted()&&e.triggerDidMount(!0),e._owner&&e._ref&&(e._owner.refs[e._ref]=e)}function In(t){return t&&(t._isDOMElement||(t=t._wrapper),t)?t._comp:void 0}function On(t){var e=In(t);if(!e)throw new Error("Expecting a back-link to the component instance.");return e}function Tn(t){var e,n=t.clientX,o=t.clientY;if(document.body.createTextRange)e=document.body.createTextRange(),e.moveToPoint(n,o);else if(!m(document.createRange))if(m(t.rangeParent))if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(n,o);e=document.createRange(),e.setStart(r.offsetNode,r.offset),e.collapse(!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(n,o));else e=document.createRange(),e.setStart(t.rangeParent,t.rangeOffset),e.collapse(!0);return e}function Pn(t){if(wu){var e=window.getSelection();if(0===e.rangeCount)return;var n=e.getRangeAt(0),o=t,r=n.getBoundingClientRect();return 0===r.top&&0===r.bottom&&(r=Dn()),An(o,r)}}function Dn(){var t=window.getSelection(),e=t.anchorNode.parentElement.getClientRects();return e[0]}function An(t,e){var n=e.left-t.left,o=e.top-t.top;return{left:n,top:o,right:t.width-n-e.width,bottom:t.height-o-e.height,width:e.width,height:e.height}}function Mn(t){var e=window.getSelection();if(0===e.rangeCount)return!1;var n=e.getRangeAt(0),o=n.getBoundingClientRect();return t.clientX>=o.left&&t.clientX<=o.right&&t.clientY>=o.top&&t.clientY<=o.bottom}function kn(t){var e=[];return t.altKey&&("AltRight"===t.code?e.push("ALTGR"):e.push("ALT")),t.ctrlKey&&e.push("CTRL"),t.metaKey&&e.push("META"),t.shiftKey&&e.push("SHIFT"),e.push(t.keyCode),e.join("+")}function jn(t){for(var e=t.split("+"),n={keyCode:-1},o=0;o<e.length;o++){var r=e[o].toUpperCase();switch(r){case"ALT":n.altKey=!0;break;case"ALTGR":n.altKey=!0,n.code="AltRight";break;case"CMD":n.metaKey=!0;break;case"CTRL":n.ctrlKey=!0;break;case"SHIFT":n.shiftKey=!0;break;default:if(1===r.length)n.keyCode=r.charCodeAt(0);else{if(!Wf.hasOwnProperty(r))throw new Error("Unsupported keyboard command: "+t);n.keyCode=Wf[r]}}}return kn(n)}function Rn(t,e,n,o){var r=new XMLHttpRequest;r.open(t,e,!0),r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r.onload=function(){if(!(r.status>=200&&r.status<400))return o(new Error("Request failed. Returned status: "+r.status));var t=r.responseText;Ln(t)&&(t=JSON.parse(t)),o(null,t)},n?r.send(JSON.stringify(n)):r.send()}function Ln(t){try{JSON.parse(t)}catch(e){return!1}return!0}function Fn(t){return"number"==typeof t?t:Z(t)?Kf:+t}function Bn(t){return function(e,n){var o;if(void 0===e&&void 0===n)return 0;if(void 0!==e&&(o=e),void 0!==n){if(void 0===o)return n;"string"==typeof e||"string"==typeof n?(e=tt(e),n=tt(n)):(e=Fn(e),n=Fn(n)),o=t(e,n)}return o}}function Hn(t,e){if("function"!=typeof e)throw new TypeError(Yf);return t=en(t),function(){return--t<1?e.apply(this,arguments):void 0}}function Un(t){return t}function zn(t){return w(t)?ed(t):{}}function Wn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=zn(t.prototype),o=t.apply(n,e);return w(o)?o:n}}function Jn(t,e,n){function o(){var e=this&&this!==Tu&&this instanceof o?i:t;return e.apply(r?n:this,arguments)}var r=e&nd,i=Wn(t);return o}function qn(t,e,n,o){for(var r=-1,i=t.length,s=n.length,a=-1,p=e.length,c=od(i-s,0),u=Array(p+c),h=!o;++a<p;)u[a]=e[a];for(;++r<s;)(h||i>r)&&(u[n[r]]=t[r]);for(;c--;)u[a++]=t[r++];return u}function Vn(t,e,n,o){for(var r=-1,i=t.length,s=-1,a=n.length,p=-1,c=e.length,u=rd(i-a,0),h=Array(u+c),l=!o;++r<u;)h[r]=t[r];for(var f=r;++p<c;)h[f+p]=e[p];for(;++s<a;)(l||i>r)&&(h[f+n[s]]=t[r++]);return h}function Gn(t,e){for(var n=t.length,o=0;n--;)t[n]===e&&o++;return o}function $n(){}function Kn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=id,this.__views__=[]}function Xn(){}function Yn(t){for(var e=t.name+"",n=ad[e],o=cd.call(ad,e)?n.length:0;o--;){var r=n[o],i=r.func;if(null==i||i==t)return r.name}return e}function Qn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}function Zn(t,e){var n=-1,o=t.length;for(e||(e=Array(o));++n<o;)e[n]=t[n];return e}function to(t){if(t instanceof Kn)return t.clone();var e=new Qn(t.__wrapped__,t.__chain__);return e.__actions__=Zn(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function eo(t){if(Q(t)&&!bu(t)&&!(t instanceof Kn)){if(t instanceof Qn)return t;if(hd.call(t,"__wrapped__"))return to(t)}return new Qn(t)}function no(t){var e=Yn(t),n=eo[e];if("function"!=typeof n||!(e in Kn.prototype))return!1;if(t===n)return!0;var o=sd(n);return!!o&&t===o[0]}function oo(){return Date.now()}function ro(t,e,n,o,r,i,s,a,p,c){var u=e&md,h=u?s:void 0,l=u?void 0:s,f=u?i:void 0,d=u?void 0:i;e|=u?_d:wd,e&=~(u?wd:_d),e&vd||(e&=~(gd|yd));var g=[t,e,r,f,h,d,l,a,p,c],y=n.apply(void 0,g);return no(t)&&dd(y,g),y.placeholder=o,y}function io(t){var e=t;return e.placeholder}function so(t,e){for(var n=t.length,o=bd(e.length,n),r=Zn(t);o--;){var i=e[o];t[o]=pt(i,n)?r[i]:void 0}return t}function ao(t,e){for(var n=-1,o=t.length,r=0,i=[];++n<o;){var s=t[n];(s===e||s===Cd)&&(t[n]=Cd,i[r++]=n)}return i}function po(t,e,n,o,r,i,s,a,p,c){function u(){for(var v=arguments,m=arguments.length,_=Array(m),w=m;w--;)_[w]=v[w];if(d)var b=io(u),C=Gn(_,b);if(o&&(_=qn(_,o,r,d)),i&&(_=Vn(_,i,s,d)),m-=C,d&&c>m){var S=ao(_,b);return ro(t,e,po,u.placeholder,n,_,S,a,p,c-m)}var x=l?n:this,E=f?x[t]:t;return m=_.length,a?_=so(_,a):g&&m>1&&_.reverse(),h&&m>p&&(_.length=p),this&&this!==Tu&&this instanceof u&&(E=y||Wn(E)),E.apply(x,_)}var h=e&Id,l=e&Sd,f=e&xd,d=e&(Ed|Nd),g=e&Od,y=f?void 0:Wn(t);return u}function co(t,e,n){function o(){for(var i=arguments,s=arguments.length,a=Array(s),p=s,c=io(o);p--;)a[p]=i[p];var u=3>s&&a[0]!==c&&a[s-1]!==c?[]:ao(a,c);if(s-=u.length,n>s)return ro(t,e,po,o.placeholder,void 0,a,u,void 0,void 0,n-s);var h=this&&this!==Tu&&this instanceof o?r:t;return Qe(h,this,a)}var r=Wn(t);return o}function uo(t,e,n,o){function r(){for(var e=arguments,a=-1,p=arguments.length,c=-1,u=o.length,h=Array(u+p),l=this&&this!==Tu&&this instanceof r?s:t;++c<u;)h[c]=o[c];for(;p--;)h[c++]=e[++a];return Qe(l,i?n:this,h)}var i=e&Td,s=Wn(t);return r}function ho(t,e){var n=t[1],o=e[1],r=n|o,i=(Dd|Ad|jd)>r,s=o==jd&&n==kd||o==jd&&n==Rd&&t[7].length<=e[8]||o==(jd|Rd)&&e[7].length<=e[8]&&n==kd;if(!i&&!s)return t;o&Dd&&(t[2]=e[2],r|=n&Dd?0:Md);var a=e[3];if(a){var p=t[3];t[3]=p?qn(p,a,e[4]):a,t[4]=p?ao(t[3],Pd):e[4]}return a=e[5],a&&(p=t[5],t[5]=p?Vn(p,a,e[6]):a,t[6]=p?ao(t[5],Pd):e[6]),a=e[7],a&&(t[7]=a),o&jd&&(t[8]=null==t[8]?e[8]:Ld(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r,t}function lo(t,e,n,o,r,i,s,a){var p=e&Hd;if(!p&&"function"!=typeof t)throw new TypeError(Fd);var c=o?o.length:0;if(c||(e&=~(Wd|Jd),o=r=void 0),s=void 0===s?s:qd(en(s),0),a=void 0===a?a:en(a),c-=r?r.length:0,e&Jd){var u=o,h=r;o=r=void 0}var l=p?void 0:sd(t),f=[t,e,n,o,r,u,h,i,s,a];if(l&&ho(f,l),t=f[0],e=f[1],n=f[2],o=f[3],r=f[4],a=f[9]=null==f[9]?p?0:t.length:qd(f[9]-c,0),!a&&e&(Ud|zd)&&(e&=~(Ud|zd)),e&&e!=Bd)d=e==Ud||e==zd?co(t,e,a):e!=Wd&&e!=(Bd|Wd)||r.length?po.apply(void 0,f):uo(t,e,n,o);else var d=Jn(t,e,n);var g=l?td:dd;return g(d,f)}function fo(t,e,n){return e=n?void 0:e,e=t&&null==e?t.length:e,lo(t,Vd,void 0,void 0,void 0,void 0,e)}function go(t,e,n,o){n||(n={});for(var r=-1,i=e.length;++r<i;){var s=e[r],a=o?o(n[s],t[s],s,n,t):t[s];at(n,s,a)}return n}function yo(t,e,n){if(!w(n))return!1;var o=typeof e;return("number"==o?Xe(n)&&pt(e,n.length):"string"==o&&e in n)?R(n[e],t):!1}function vo(t){return nn(function(e,n){var o=-1,r=n.length,i=r>1?n[r-1]:void 0,s=r>2?n[2]:void 0;for(i=t.length>3&&"function"==typeof i?(r--,i):void 0,s&&yo(n[0],n[1],s)&&(i=3>r?void 0:i,r=1),e=Object(e);++o<r;){var a=n[o];a&&t(e,a,o,i)}return e})}function mo(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||Gd;return t===n}function _o(t){return $d(Object(t))}function wo(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}function bo(t){return Ye(t)&&Yd.call(t,"callee")&&(!Zd.call(t,"callee")||Qd.call(t)==Kd)}function Co(t){return"string"==typeof t||!bu(t)&&Q(t)&&ng.call(t)==tg}function So(t){var e=t?t.length:void 0;return Ke(e)&&(bu(t)||Co(t)||bo(t))?wo(e,String):null}function xo(t){var e=mo(t);if(!e&&!Xe(t))return _o(t);var n=So(t),o=!!n,r=n||[],i=r.length;for(var s in t)!lt(t,s)||o&&("length"==s||pt(s,i))||e&&"constructor"==s||r.push(s);return r}function Eo(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}function No(t){t=null==t?t:Object(t);var e=[];for(var n in t)e.push(n);return e}function Io(t){for(var e=-1,n=mo(t),o=lg(t),r=o.length,i=So(t),s=!!i,a=i||[],p=a.length;++e<r;){var c=o[e];s&&("length"==c||pt(c,p))||"constructor"==c&&(n||!dg.call(t,c))||a.push(c)}return a}function Oo(t,e){for(var n=-1,o=null==t,r=e.length,i=Array(r);++n<r;)i[n]=o?void 0:st(t,e[n]);return i}function To(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}function Po(t){return bu(t)||bo(t)}function Do(t,e,n,o,r){var i=-1,s=t.length;for(n||(n=Po),r||(r=[]);++i<s;){var a=t[i];e>0&&n(a)?e>1?Do(a,e-1,n,o,r):To(r,a):o||(r[r.length]=a)}return r}function Ao(t){return Q(t)?xg.call(t)==Cg||"string"==typeof t.message&&"string"==typeof t.name:!1}function Mo(t,e){var n;if("function"!=typeof e)throw new TypeError(Ng);return t=en(t),function(){return--t>0&&(n=e.apply(this,arguments)),1>=t&&(e=void 0),n}}function ko(t,e){for(var n=-1,o=t?t.length:0;++n<o&&e(t[n],n,t)!==!1;);return t}function jo(t,e,n){var o=t.length;return n=void 0===n?o:n,!e&&n>=o?t:dt(t,e,n)}function Ro(t){return t.match(ry)}function Lo(t){return function(e){e=et(e);var n=Hg.test(e)?Ro(e):void 0,o=n?n[0]:e.charAt(0),r=n?jo(n,1).join(""):e.slice(1);return o[t]()+r}}function Fo(t){return iy(et(t).toLowerCase())}function Bo(t,e,n,o){var r=-1,i=t?t.length:0;for(o&&i&&(n=t[++r]);++r<i;)n=e(n,t[r],r,t);return n}function Ho(t){return sy[t]}function Uo(t){return t=et(t),t&&t.replace(ay,Ho).replace(hy,"")}function zo(t,e,n){return t=et(t),e=n?void 0:e,void 0===e&&(e=Ky.test(t)?$y:ly),t.match(e)||[]}function Wo(t){return function(e){return Bo(zo(Uo(e).replace(Yy,"")),t,"")}}function Jo(){if(!arguments.length)return[];var t=arguments[0];return bu(t)?t:[t]}function qo(t){var e=Math[t];return function(t,n){if(t=Ze(t),n=Zy(en(n),292)){var o=(et(t)+"e").split("e"),r=e(o[0]+"e"+(+o[1]+n));return o=(et(r)+"e").split("e"),+(o[0]+"e"+(+o[1]-n))}return e(t)}}function Vo(t){var e=eo(t);return e.__chain__=!0,e}function Go(t,e,n){e=(n?yo(t,e,n):void 0===e)?1:nv(en(e),0);var o=t?t.length:0;if(!o||1>e)return[];for(var r=0,i=0,s=Array(ev(o/e));o>r;)s[i++]=dt(t,r,r+=e);return s}function $o(t,e,n){return t===t&&(void 0!==n&&(t=n>=t?t:n),void 0!==e&&(t=t>=e?t:e)),t}function Ko(t,e,n){return void 0===n&&(n=e,e=void 0),void 0!==n&&(n=Ze(n),n=n===n?n:0),void 0!==e&&(e=Ze(e),e=e===e?e:0),$o(Ze(t),e,n)}function Xo(){this.__data__=new z}function Yo(t){return this.__data__["delete"](t)}function Qo(t){return this.__data__.get(t)}function Zo(t){return this.__data__.has(t)}function tr(t,e){var n=this.__data__;return n instanceof z&&n.__data__.length==ov&&(n=this.__data__=new X(n.__data__)),n.set(t,e),this}function er(t){this.__data__=new z(t)}function nr(t,e){return t&&go(e,xo(e),t)}function or(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}function rr(){return[]}function ir(t){return rv(Object(t))}function sr(t,e){return go(t,iv(t),e)}function ar(t,e,n){var o=e(t);return bu(t)?o:To(o,n(t))}function pr(t){return ar(t,xo,iv)}function cr(t){return yv.call(t)}function ur(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&xv.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function hr(t){var e=new t.constructor(t.byteLength);return new Ev(e).set(new Ev(t)),e}function lr(t,e){var n=e?hr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function fr(t,e){return t.set(e[0],e[1]),t}function dr(t){var e=-1,n=Array(t.size);return t.forEach(function(t,o){n[++e]=[o,t]}),n}function gr(t,e,n){var o=e?n(dr(t),!0):dr(t);return Bo(o,fr,new t.constructor)}function yr(t){var e=new t.constructor(t.source,Nv.exec(t));return e.lastIndex=t.lastIndex,e}function vr(t,e){return t.add(e),t}function mr(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function _r(t,e,n){var o=e?n(mr(t),!0):mr(t);return Bo(o,vr,new t.constructor)}function wr(t){return Ov?Object(Ov.call(t)):{}}function br(t,e){var n=e?hr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Cr(t,e,n,o){var r=t.constructor;switch(e){case Lv:return hr(t);case Tv:case Pv:return new r(+t);case Fv:return lr(t,o);case Bv:case Hv:case Uv:case zv:case Wv:case Jv:case qv:case Vv:case Gv:return br(t,o);case Dv:return gr(t,o,n);case Av:case jv:return new r(t);case Mv:return yr(t);case kv:return _r(t,o,n);case Rv:return wr(t)}}function Sr(t){return"function"!=typeof t.constructor||mo(t)?{}:zn(ht(t))}function xr(){return!1}function Er(t,e,n,o,r,i,s){var a;if(o&&(a=i?o(t,r,i,s):o(t)),void 0!==a)return a;if(!w(t))return t;var p=bu(t);if(p){if(a=ur(t),!e)return Zn(t,a)}else{var c=Cv(t),u=c==rm||c==im;if(Qv(t))return or(t,e);if(c==pm||c==Zv||u&&!i){if(C(t))return i?t:{};if(a=Sr(u?{}:t),!e)return sr(t,nr(a,t))}else{if(!Em[c])return i?t:{};a=Cr(t,c,Er,e)}}s||(s=new er);var h=s.get(t);if(h)return h;if(s.set(t,a),!p)var l=n?pr(t):xo(t);return ko(l||t,function(r,i){l&&(i=r,r=t[i]),at(a,i,Er(r,e,n,o,i,t,s))}),a}function Nr(t){return Er(t,!1,!0)}function Ir(t){return Er(t,!0,!0)}function Or(t,e){return Er(t,!0,!0,e)}function Tr(t,e){return Er(t,!1,!0,e)}function Pr(){return new Qn(this.value(),this.__chain__)}function Dr(t){for(var e=-1,n=t?t.length:0,o=0,r=[];++e<n;){var i=t[e];i&&(r[o++]=i)}return r}function Ar(){for(var t=arguments,e=arguments.length,n=Array(e?e-1:0),o=arguments[0],r=e;r--;)n[r-1]=t[r];return e?To(bu(o)?Zn(o):[o],Do(n,1)):[]}function Mr(t,e){for(var n=-1,o=t?t.length:0;++n<o;)if(e(t[n],n,t))return!0;return!1}function kr(t,e,n,o,r,i){var s=r&Im,a=t.length,p=e.length;if(a!=p&&!(s&&p>a))return!1;var c=i.get(t);if(c)return c==e;var u=-1,h=!0,l=r&Nm?new Be:void 0;for(i.set(t,e);++u<a;){var f=t[u],d=e[u];if(o)var g=s?o(d,f,u,e,t,i):o(f,d,u,t,e,i);if(void 0!==g){if(g)continue;h=!1;break}if(l){if(!Mr(e,function(t,e){return l.has(e)||f!==t&&!n(f,t,o,r,i)?void 0:l.add(e)})){h=!1;break}}else if(f!==d&&!n(f,d,o,r,i)){h=!1;break}}return i["delete"](t),h}function jr(t,e,n,o,r,i,s){switch(n){case Hm:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Bm:return!(t.byteLength!=e.byteLength||!o(new Ev(t),new Ev(e)));case Pm:case Dm:return+t==+e;case Am:return t.name==e.name&&t.message==e.message;case km:return t!=+t?e!=+e:t==+e;case jm:case Lm:return t==e+"";case Mm:var a=dr;case Rm:var p=i&Tm;if(a||(a=mr),t.size!=e.size&&!p)return!1;var c=s.get(t);return c?c==e:(i|=Om,s.set(t,e),kr(a(t),a(e),o,r,i,s));case Fm:if(zm)return zm.call(t)==zm.call(e)}return!1}function Rr(t,e,n,o,r,i){var s=r&Wm,a=xo(t),p=a.length,c=xo(e),u=c.length;if(p!=u&&!s)return!1;for(var h=p;h--;){var l=a[h];if(!(s?l in e:lt(e,l)))return!1}var f=i.get(t);if(f)return f==e;var d=!0;i.set(t,e);for(var g=s;++h<p;){l=a[h];var y=t[l],v=e[l];if(o)var m=s?o(v,y,l,e,t,i):o(y,v,l,t,e,i);if(!(void 0===m?y===v||n(y,v,o,r,i):m)){d=!1;break}g||(g="constructor"==l)}if(d&&!g){var _=t.constructor,w=e.constructor;_!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof w&&w instanceof w)&&(d=!1)}return i["delete"](t),d}function Lr(t){return Q(t)&&Ke(t.length)&&!!d_[y_.call(t)]}function Fr(t,e,n,o,r,i){var s=bu(t),a=bu(e),p=__,c=__;s||(p=Cv(t),p=p==m_?w_:p),a||(c=Cv(e),c=c==m_?w_:c);var u=p==w_&&!C(t),h=c==w_&&!C(e),l=p==c;if(l&&!u)return i||(i=new er),s||Lr(t)?kr(t,e,n,o,r,i):jr(t,e,p,n,o,r,i);if(!(r&v_)){var f=u&&C_.call(t,"__wrapped__"),d=h&&C_.call(e,"__wrapped__");if(f||d){var g=f?t.value():t,y=d?e.value():e;return i||(i=new er),n(g,y,o,r,i)}}return l?(i||(i=new er),Rr(t,e,n,o,r,i)):!1}function Br(t,e,n,o,r){return t===e?!0:null==t||null==e||!w(t)&&!Q(e)?t!==t&&e!==e:Fr(t,e,Br,n,o,r)}function Hr(t,e,n,o){var r=n.length,i=r,s=!o;if(null==t)return!i;for(t=Object(t);r--;){var a=n[r];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++r<i;){a=n[r];var p=a[0],c=t[p],u=a[1];if(s&&a[2]){if(void 0===c&&!(p in t))return!1}else{var h=new er;if(o)var l=o(c,u,p,t,e,h);if(!(void 0===l?Br(u,c,o,S_|x_,h):l))return!1}}return!0}function Ur(t){return t===t&&!w(t)}function zr(t){for(var e=xo(t),n=e.length;n--;){var o=e[n],r=t[o];e[n]=[o,r,Ur(r)]}return e}function Wr(t,e){return function(n){return null==n?!1:n[t]===e&&(void 0!==e||t in Object(n))}}function Jr(t){var e=zr(t);return 1==e.length&&e[0][2]?Wr(e[0][0],e[0][1]):function(n){return n===t||Hr(n,t,e)}}function qr(t,e){return null!=t&&e in Object(t)}function Vr(t,e,n){e=ot(e,t)?[e]:nt(e);for(var o,r=-1,i=e.length;++r<i;){var s=rt(e[r]);if(!(o=null!=t&&n(t,s)))break;t=t[s]}if(o)return o;var i=t?t.length:0;return!!i&&Ke(i)&&pt(s,i)&&(bu(t)||Co(t)||bo(t))}function Gr(t,e){return null!=t&&Vr(t,e,qr)}function $r(t,e){return ot(t)&&Ur(e)?Wr(rt(t),e):function(n){var o=st(n,t);return void 0===o&&o===e?Gr(n,t):Br(e,o,void 0,E_|N_)}}function Kr(t){return function(e){return it(e,t)}}function Xr(t){return ot(t)?$e(rt(t)):Kr(t)}function Yr(t){return"function"==typeof t?t:null==t?Un:"object"==typeof t?bu(t)?$r(t[0],t[1]):Jr(t):Xr(t)}function Qr(t){var e=t?t.length:0,n=Yr;return t=e?Je(t,function(t){if("function"!=typeof t[1])throw new TypeError(I_);return[n(t[0]),t[1]]}):[],nn(function(n){for(var o=this,r=-1;++r<e;){var i=t[r];if(Qe(i[0],o,n))return Qe(i[1],o,n)}})}function Zr(t){var e=xo(t),n=e.length;return function(o){if(null==o)return!n;for(var r=n;r--;){var i=e[r],s=t[i],a=o[i];if(void 0===a&&!(i in Object(o))||!s(a))return!1}return!0}}function ti(t){return Zr(Er(t,!0))}function ei(t){return function(){return t}}function ni(t,e,n,o){for(var r=-1,i=t?t.length:0;++r<i;){var s=t[r];e(o,s,n(s),t)}return o}function oi(t){return function(e,n,o){for(var r=-1,i=Object(e),s=o(e),a=s.length;a--;){var p=s[t?a:++r];if(n(i[p],p,i)===!1)break}return e}}function ri(t,e){return t&&O_(t,e,xo)}function ii(t,e){return function(n,o){if(null==n)return n;if(!Xe(n))return t(n,o);for(var r=n.length,i=e?r:-1,s=Object(n);(e?i--:++i<r)&&o(s[i],i,s)!==!1;);return n}}function si(t,e,n,o){return T_(t,function(t,r,i){e(o,t,n(t),i)}),o}function ai(t,e){return function(n,o){var r=bu(n)?ni:si,i=e?e():{};return r(n,t,Yr(o),i)}}function pi(t,e){var n=zn(t);return e?nr(n,e):n}function ci(t,e,n){e=n?void 0:e;var o=lo(t,M_,void 0,void 0,void 0,void 0,void 0,e);return o.placeholder=ci.placeholder,o}function ui(t,e,n){e=n?void 0:e;var o=lo(t,k_,void 0,void 0,void 0,void 0,void 0,e);return o.placeholder=ui.placeholder,o}function hi(t,e,n){function o(e){var n=l,o=f;return l=f=void 0,m=e,g=t.apply(o,n)}function r(t){return m=t,y=setTimeout(a,e),_?o(t):g}function i(t){var n=t-v,o=t-m,r=e-n;return b?L_(r,d-o):r}function s(t){var n=t-v,o=t-m;return void 0===v||n>=e||0>n||b&&o>=d}function a(){var t=oo();return s(t)?p(t):void(y=setTimeout(a,i(t)))}function p(t){return y=void 0,C&&l?o(t):(l=f=void 0,g)}function c(){m=0,l=v=f=y=void 0}function u(){return void 0===y?g:p(oo())}function h(){var t=oo(),n=s(t);if(l=arguments,f=this,v=t,n){if(void 0===y)return r(v);if(b)return y=setTimeout(a,e),o(v)}return void 0===y&&(y=setTimeout(a,e)),g}var l,f,d,g,y,v,m=0,_=!1,b=!1,C=!0;if("function"!=typeof t)throw new TypeError(j_);return e=Ze(e)||0,w(n)&&(_=!!n.leading,b="maxWait"in n,d=b?R_(Ze(n.maxWait)||0,e):d,C="trailing"in n?!!n.trailing:C),h.cancel=c,h.flush=u,h}function li(t,e,n,o){return void 0===t||R(t,F_[n])&&!B_.call(o,n)?e:t}function fi(t,e,n){(void 0!==n&&!R(t[e],n)||"number"==typeof e&&void 0===n&&!(e in t))&&(t[e]=n)}function di(t){if(!Q(t)||V_.call(t)!=U_||C(t))return!1;var e=ht(t);if(null===e)return!0;var n=J_.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&W_.call(n)==q_}function gi(t){return go(t,Io(t))}function yi(t,e,n,o,r,i,s){var a=t[n],p=e[n],c=s.get(p);if(c)return void fi(t,n,c);var u=i?i(a,p,n+"",t,e,s):void 0,h=void 0===u;h&&(u=p,bu(p)||Lr(p)?bu(a)?u=a:Ye(a)?u=Zn(a):(h=!1,u=Er(p,!0)):di(p)||bo(p)?bo(a)?u=gi(a):!w(a)||o&&b(a)?(h=!1,u=Er(p,!0)):u=a:h=!1),s.set(p,u),h&&r(u,p,o,i,s),s["delete"](p),fi(t,n,u)}function vi(t,e,n,o,r){if(t!==e){if(!bu(e)&&!Lr(e))var i=Io(e);ko(i||e,function(s,a){if(i&&(a=s,s=e[a]),w(s))r||(r=new er),yi(t,e,a,n,vi,o,r);else{var p=o?o(t[a],s,a+"",t,e,r):void 0;void 0===p&&(p=s),fi(t,a,p)}})}}function mi(t,e,n,o,r,i){return w(t)&&w(e)&&vi(t,e,void 0,mi,i.set(e,t)),t}function _i(t,e,n){if("function"!=typeof t)throw new TypeError(K_);return setTimeout(function(){t.apply(void 0,n)},e)}function wi(t,e,n){var o=t?t.length:0;return o?(e=n||void 0===e?1:en(e),dt(t,0>e?0:e,o)):[]}function bi(t,e,n){var o=t?t.length:0;return o?(e=n||void 0===e?1:en(e),e=o-e,dt(t,0,0>e?0:e)):[]}function Ci(t,e,n,o){for(var r=t.length,i=o?r:-1;(o?i--:++i<r)&&e(t[i],i,t););return n?dt(t,o?0:i,o?i+1:r):dt(t,o?i+1:0,o?r:i)}function Si(t,e){return t&&t.length?Ci(t,Yr(e,3),!0,!0):[]}function xi(t,e){return t&&t.length?Ci(t,Yr(e,3),!0):[]}function Ei(t,e){var n=bu(t)?ko:T_;return n(t,Yr(e,3))}function Ni(t,e){for(var n=t?t.length:0;n--&&e(t[n],n,t)!==!1;);return t}function Ii(t,e){return t&&nw(t,e,xo)}function Oi(t,e){var n=bu(t)?Ni:ow;return n(t,Yr(e,3))}function Ti(t,e,n){t=et(t),e=tt(e);var o=t.length;return n=void 0===n?o:$o(en(n),0,o),n-=e.length,n>=0&&t.indexOf(e,n)==n}function Pi(t,e){return Je(e,function(e){return[e,t[e]]})}function Di(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function Ai(t){return function(e){var n=Cv(e);return n==rw?dr(e):n==iw?Di(e):Pi(e,t(e))}}function Mi(t){return pw[t]}function ki(t){return t=et(t),t&&uw.test(t)?t.replace(cw,Mi):t}function ji(t){return t=et(t),t&&lw.test(t)?t.replace(hw,"\\$&"):t}function Ri(t,e){for(var n=-1,o=t?t.length:0;++n<o;)if(!e(t[n],n,t))return!1;return!0}function Li(t,e){var n=!0;return T_(t,function(t,o,r){return n=!!e(t,o,r)}),n}function Fi(t,e,n){var o=bu(t)?Ri:Li;return n&&yo(t,e,n)&&(e=void 0),o(t,Yr(e,3))}function Bi(t){return t?$o(en(t),0,fw):0}function Hi(t,e,n,o){var r=t.length;for(n=en(n),0>n&&(n=-n>r?0:r+n),o=void 0===o||o>r?r:en(o),0>o&&(o+=r),o=n>o?0:Bi(o);o>n;)t[n++]=e;return t}function Ui(t,e,n,o){var r=t?t.length:0;return r?(n&&"number"!=typeof n&&yo(t,e,n)&&(n=0,o=r),Hi(t,e,n,o)):[]}function zi(t,e){for(var n=-1,o=t?t.length:0,r=0,i=[];++n<o;){var s=t[n];e(s,n,t)&&(i[r++]=s)}return i}function Wi(t,e){var n=[];return T_(t,function(t,o,r){e(t,o,r)&&n.push(t)}),n}function Ji(t,e){var n=bu(t)?zi:Wi;return n(t,Yr(e,3))}function qi(t){return function(e,n,o){var r=Object(e);if(n=Yr(n,3),!Xe(e))var i=xo(e);var s=t(i||e,function(t,e){return i&&(e=t,t=r[e]),n(t,e,r)},o);return s>-1?e[i?i[s]:s]:void 0}}function Vi(t,e,n,o){for(var r=t.length,i=n+(o?1:-1);o?i--:++i<r;)if(e(t[i],i,t))return i;return-1}function Gi(t,e,n){var o=t?t.length:0;if(!o)return-1;var r=null==n?0:en(n);return 0>r&&(r=dw(o+r,0)),Vi(t,Yr(e,3),r)}function $i(t,e,n){var o;return n(t,function(t,n,r){return e(t,n,r)?(o=n,!1):void 0}),o}function Ki(t,e){return $i(t,Yr(e,3),ri)}function Xi(t,e,n){var o=t?t.length:0;if(!o)return-1;var r=o-1;return void 0!==n&&(r=en(n),r=0>n?yw(o+r,0):vw(r,o-1)),Vi(t,Yr(e,3),r,!0)}function Yi(t,e){return $i(t,Yr(e,3),Ii)}function Qi(t){return t&&t.length?t[0]:void 0}function Zi(t,e){var n=-1,o=Xe(t)?Array(t.length):[];return T_(t,function(t,r,i){o[++n]=e(t,r,i)}),o}function ts(t,e){var n=bu(t)?Je:Zi;return n(t,Yr(e,3))}function es(t,e){return Do(ts(t,e),1)}function ns(t,e){return Do(ts(t,e),_w)}function os(t,e,n){return n=void 0===n?1:en(n),Do(ts(t,e),n)}function rs(t){var e=t?t.length:0;return e?Do(t,1):[]}function is(t){var e=t?t.length:0;return e?Do(t,ww):[]}function ss(t,e){var n=t?t.length:0;return n?(e=void 0===e?1:en(e),Do(t,e)):[]}function as(t){return lo(t,bw)}function ps(t){return nn(function(e){e=Do(e,1);var n=e.length,o=n,r=Qn.prototype.thru;for(t&&e.reverse();o--;){var i=e[o];if("function"!=typeof i)throw new TypeError(xw);if(r&&!s&&"wrapper"==Yn(i))var s=new Qn([],!0)}for(o=s?o:n;++o<n;){i=e[o];var a=Yn(i),p="wrapper"==a?sd(i):void 0;s=p&&no(p[0])&&p[1]==(Iw|Ew|Nw|Ow)&&!p[4].length&&1==p[9]?s[Yn(p[0])].apply(s,p[3]):1==i.length&&no(i)?s[a]():s.thru(i)}return function(){var t=this,o=arguments,r=o[0];if(s&&1==o.length&&bu(r)&&r.length>=Sw)return s.plant(r).value();for(var i=0,a=n?e[i].apply(this,o):r;++i<n;)a=e[i].call(t,a);return a}})}function cs(t,e){return null==t?t:O_(t,Yr(e,3),Io)}function us(t,e){return null==t?t:nw(t,Yr(e,3),Io)}function hs(t,e){return t&&ri(t,Yr(e,3))}function ls(t,e){return t&&Ii(t,Yr(e,3))}function fs(t){for(var e=-1,n=t?t.length:0,o={};++e<n;){var r=t[e];o[r[0]]=r[1]}return o}function ds(t,e){return zi(e,function(e){return b(t[e])})}function gs(t){return null==t?[]:ds(t,xo(t))}function ys(t){return null==t?[]:ds(t,Io(t))}function vs(t,e){return t>e}function ms(t){return function(e,n){return("string"!=typeof e||"string"!=typeof n)&&(e=Ze(e),n=Ze(n)),t(e,n)}}function _s(t,e){return null!=t&&Vr(t,e,lt)}function ws(t,e,n){return t>=Lw(e,n)&&t<Rw(e,n)}function bs(t,e,n){return e=Ze(e)||0,void 0===n?(n=e,e=0):n=Ze(n)||0,t=Ze(t),ws(t,e,n)}function Cs(t,e){return Je(e,function(e){return t[e]})}function Ss(t){return t?Cs(t,xo(t)):[]}function xs(t,e,n,o){t=Xe(t)?t:Ss(t),n=n&&!o?en(n):0;var r=t.length;return 0>n&&(n=Fw(r+n,0)),Co(t)?r>=n&&t.indexOf(e,n)>-1:!!r&&Ue(t,e,n)>-1}function Es(t,e,n){var o=t?t.length:0;if(!o)return-1;var r=null==n?0:en(n);return 0>r&&(r=Bw(o+r,0)),Ue(t,e,r)}function Ns(t){return bi(t,1)}function Is(t,e,n){for(var o=n?We:ze,r=t[0].length,i=t.length,s=i,a=Array(i),p=1/0,c=[];s--;){var u=t[s];s&&e&&(u=Je(u,qe(e))),p=Hw(u.length,p),a[s]=!n&&(e||r>=120&&u.length>=120)?new Be(s&&u):void 0}u=t[0];var h=-1,l=a[0];t:for(;++h<r&&c.length<p;){var f=u[h],d=e?e(f):f;if(f=n||0!==f?f:0,!(l?Ve(l,d):o(c,d,n))){for(s=i;--s;){var g=a[s];if(!(g?Ve(g,d):o(t[s],d,n)))continue t}l&&l.push(d),c.push(f)}}return c}function Os(t){return Ye(t)?t:[]}function Ts(t,e,n,o){return ri(t,function(t,r,i){e(o,n(t),r,i)}),o}function Ps(t,e){return function(n,o){return Ts(n,t,e(o),{})}}function Ds(t,e,n){ot(e,t)||(e=nt(e),t=gt(t,e),e=ft(e));var o=null==t?t:t[rt(e)];return null==o?void 0:Qe(o,t,n)}function As(t){return Q(t)&&Qw.call(t)==Xw}function Ms(t){return t===!0||t===!1||Q(t)&&eb.call(t)==Zw}function ks(t){return Q(t)&&rb.call(t)==nb}function js(t){return!!t&&1===t.nodeType&&Q(t)&&!di(t)}function Rs(t){if(Xe(t)&&(bu(t)||Co(t)||b(t.splice)||bo(t)||Qv(t)))return!t.length;if(Q(t)){var e=Cv(t);if(e==ib||e==sb)return!t.size}for(var n in t)if(pb.call(t,n))return!1;return!(ub&&xo(t).length)}function Ls(t,e){return Br(t,e)}function Fs(t,e,n){n="function"==typeof n?n:void 0;var o=n?n(t,e):void 0;return void 0===o?Br(t,e,n):!!o}function Bs(t){return"number"==typeof t&&hb(t)}function Hs(t){return"number"==typeof t&&t==en(t)}function Us(t){return Q(t)&&Cv(t)==lb}function zs(t,e){return t===e||Hr(t,e,zr(e))}function Ws(t,e,n){return n="function"==typeof n?n:void 0,Hr(t,e,zr(e),n)}function Js(t){return"number"==typeof t||Q(t)&&gb.call(t)==fb}function qs(t){return Js(t)&&t!=+t}function Vs(t){if(yb(t))throw new Error("This method is not supported with `core-js`. Try https://github.com/es-shims.");return N(t)}function Gs(t){return null==t}function $s(t){return null===t}function Ks(t){return w(t)&&_b.call(t)==vb}function Xs(t){return Hs(t)&&t>=-wb&&wb>=t}function Ys(t){return Q(t)&&Cv(t)==bb}function Qs(t){return void 0===t}function Zs(t){return Q(t)&&Cv(t)==Cb}function ta(t){return Q(t)&&Eb.call(t)==Sb}function ea(t){return Yr("function"==typeof t?t:Er(t,!0))}function na(t,e){return t?Ib.call(t,e):""}function oa(t,e,n){var o=t?t.length:0;if(!o)return-1;var r=o;if(void 0!==n&&(r=en(n),r=(0>r?Pb(o+r,0):Db(r,o-1))+1),e!==e)return He(t,r-1,!0);for(;r--;)if(t[r]===e)return r;return-1}function ra(t,e){return e>t}function ia(t,e){var n={};return e=Yr(e,3),ri(t,function(t,o,r){n[e(t,o,r)]=t}),n}function sa(t,e){var n={};return e=Yr(e,3),ri(t,function(t,o,r){n[o]=e(t,o,r)}),n}function aa(t){return Jr(Er(t,!0))}function pa(t,e){return $r(t,Er(e,!0))}function ca(t,e,n){for(var o=-1,r=t.length;++o<r;){var i=t[o],s=e(i);if(null!=s&&(void 0===a?s===s&&!Z(s):n(s,a)))var a=s,p=i}return p}function ua(t){return t&&t.length?ca(t,Un,vs):void 0}function ha(t,e){return t&&t.length?ca(t,Yr(e),vs):void 0}function la(t,e){for(var n,o=-1,r=t.length;++o<r;){var i=e(t[o]);void 0!==i&&(n=void 0===n?i:n+i)}return n}function fa(t,e){var n=t?t.length:0;return n?la(t,e)/n:Rb}function da(t){return fa(t,Un)}function ga(t,e){return fa(t,Yr(e))}function ya(t){return t&&t.length?ca(t,Un,ra):void 0}function va(t,e){return t&&t.length?ca(t,Yr(e),ra):void 0}function ma(t,e,n){var o=xo(e),r=ds(e,o),i=!(w(n)&&"chain"in n&&!n.chain),s=b(t);return ko(r,function(n){var o=e[n];t[n]=o,s&&(t.prototype[n]=function(){var e=this.__chain__;if(i||e){var n=t(this.__wrapped__),r=n.__actions__=Zn(this.__actions__);return r.push({func:o,args:arguments,thisArg:t}),n.__chain__=e,n}return o.apply(t,To([this.value()],arguments))})}),t}function _a(t){if("function"!=typeof t)throw new TypeError(Ub);return function(){return!t.apply(this,arguments)}}function wa(t){if(!t)return[];if(Xe(t))return Co(t)?Ro(t):Zn(t);if(Jb&&t[Jb])return Eo(t[Jb]());var e=Cv(t),n=e==zb?dr:e==Wb?mr:Ss;return n(t)}function ba(){void 0===this.__values__&&(this.__values__=wa(this.value()));var t=this.__index__>=this.__values__.length,e=t?void 0:this.__values__[this.__index__++];return{done:t,value:e}}function Ca(t,e){var n=t.length;if(n)return e+=0>e?n:0,pt(e,n)?t[e]:void 0}function Sa(t,e){return t&&t.length?Ca(t,en(e)):void 0}function xa(t){return t=en(t),nn(function(e){return Ca(e,t)})}function Ea(t,e){return t=Object(t),Bo(e,function(e,n){return n in t&&(e[n]=t[n]),e},{})}function Na(t){return ar(t,Io,Vb)}function Ia(t,e){
for(var n=-1,o=Na(t),r=o.length,i={};++n<r;){var s=o[n],a=t[s];e(a,s)&&(i[s]=a)}return i}function Oa(t,e){return e=Yr(e),Ia(t,function(t,n){return!e(t,n)})}function Ta(t){return Mo(2,t)}function Pa(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function Da(t,e){if(t!==e){var n=void 0!==t,o=null===t,r=t===t,i=Z(t),s=void 0!==e,a=null===e,p=e===e,c=Z(e);if(!a&&!c&&!i&&t>e||i&&s&&p&&!a&&!c||o&&s&&p||!n&&p||!r)return 1;if(!o&&!i&&!c&&e>t||c&&n&&r&&!o&&!i||a&&n&&r||!s&&r||!p)return-1}return 0}function Aa(t,e,n){for(var o=-1,r=t.criteria,i=e.criteria,s=r.length,a=n.length;++o<s;){var p=Da(r[o],i[o]);if(p){if(o>=a)return p;var c=n[o];return p*("desc"==c?-1:1)}}return t.index-e.index}function Ma(t,e,n){var o=-1;e=Je(e.length?e:[Un],qe(Yr));var r=Zi(t,function(t,n,r){var i=Je(e,function(e){return e(t)});return{criteria:i,index:++o,value:t}});return Pa(r,function(t,e){return Aa(t,e,n)})}function ka(t,e,n,o){return null==t?[]:(bu(e)||(e=null==e?[]:[e]),n=o?void 0:n,bu(n)||(n=null==n?[]:[n]),Ma(t,e,n))}function ja(t){return bu(t)&&!(2==t.length&&!b(t[0]))}function Ra(t){return nn(function(e){return e=1==e.length&&bu(e[0])?Je(e[0],qe(Yr)):Je(Do(e,1,ja),qe(Yr)),nn(function(n){var o=this;return t(e,function(t){return Qe(t,o,n)})})})}function La(t,e){var n="";if(!t||1>e||e>Zb)return n;do e%2&&(n+=t),e=tC(e/2),e&&(t+=t);while(e);return n}function Fa(t){if(!t||!Hg.test(t))return t.length;for(var e=mC.lastIndex=0;mC.test(t);)e++;return e}function Ba(t,e){e=void 0===e?" ":tt(e);var n=e.length;if(2>n)return n?La(e,t):e;var o=La(e,_C(t/Fa(e)));return Hg.test(e)?jo(Ro(o),0,t).join(""):o.slice(0,t)}function Ha(t,e,n){t=et(t),e=en(e);var o=e?Fa(t):0;if(!e||o>=e)return t;var r=(e-o)/2;return Ba(bC(r),n)+t+Ba(wC(r),n)}function Ua(t,e,n){t=et(t),e=en(e);var o=e?Fa(t):0;return e&&e>o?t+Ba(e-o,n):t}function za(t,e,n){t=et(t),e=en(e);var o=e?Fa(t):0;return e&&e>o?Ba(e-o,n)+t:t}function Wa(t,e,n){return n||null==e?e=0:e&&(e=+e),t=et(t).replace(CC,""),xC(t,e||(SC.test(t)?16:10))}function Ja(t,e){return null==t?{}:Ia(t,Yr(e))}function qa(t){for(var e,n=this;n instanceof $n;){var o=to(n);o.__index__=0,o.__values__=void 0,e?r.__wrapped__=o:e=o;var r=o;n=n.__wrapped__}return r.__wrapped__=t,e}function Va(t){return function(e){return null==t?void 0:it(t,e)}}function Ga(t,e,n,o){for(var r=n-1,i=t.length;++r<i;)if(o(t[r],e))return r;return-1}function $a(t,e,n,o){var r=o?Ga:Ue,i=-1,s=e.length,a=t;for(t===e&&(e=Zn(e)),n&&(a=Je(t,qe(n)));++i<s;)for(var p=0,c=e[i],u=n?n(c):c;(p=r(a,u,p,o))>-1;)a!==t&&AC.call(a,p,1),AC.call(t,p,1);return t}function Ka(t,e){return t&&t.length&&e&&e.length?$a(t,e):t}function Xa(t,e,n){return t&&t.length&&e&&e.length?$a(t,e,Yr(n)):t}function Ya(t,e,n){return t&&t.length&&e&&e.length?$a(t,e,void 0,n):t}function Qa(t,e){for(var n=t?e.length:0,o=n-1;n--;){var r=e[n];if(n==o||r!==i){var i=r;if(pt(r))jC.call(t,r,1);else if(ot(r,t))delete t[rt(r)];else{var s=nt(r),a=gt(t,s);null!=a&&delete a[rt(ft(s))]}}}return t}function Za(t,e){return t+LC(FC()*(e-t+1))}function tp(t,e,n){if(n&&"boolean"!=typeof n&&yo(t,e,n)&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=Ze(t)||0,void 0===e?(e=t,t=0):e=Ze(e)||0),t>e){var o=t;t=e,e=o}if(n||t%1||e%1){var r=UC();return HC(t+r*(e-t+BC("1e-"+((r+"").length-1))),e)}return Za(t,e)}function ep(t,e,n,o){for(var r=-1,i=WC(zC((e-t)/(n||1)),0),s=Array(i);i--;)s[o?i:++r]=t,t+=n;return s}function np(t){return function(e,n,o){return o&&"number"!=typeof o&&yo(e,n,o)&&(n=o=void 0),e=Ze(e),e=e===e?e:0,void 0===n?(n=e,e=0):n=Ze(n)||0,o=void 0===o?n>e?1:-1:Ze(o)||0,ep(e,n,o,t)}}function op(t,e,n,o,r){return r(t,function(t,r,i){n=o?(o=!1,t):e(n,t,r,i)}),n}function rp(t,e,n){var o=bu(t)?Bo:op,r=arguments.length<3;return o(t,Yr(e,4),n,r,T_)}function ip(t,e,n,o){var r=t?t.length:0;for(o&&r&&(n=t[--r]);r--;)n=e(n,t[r],r,t);return n}function sp(t,e,n){var o=bu(t)?ip:op,r=arguments.length<3;return o(t,Yr(e,4),n,r,ow)}function ap(t,e){var n=bu(t)?zi:Wi;return e=Yr(e,3),n(t,function(t,n,o){return!e(t,n,o)})}function pp(t,e){var n=[];if(!t||!t.length)return n;var o=-1,r=[],i=t.length;for(e=Yr(e,3);++o<i;){var s=t[o];e(s,o,t)&&(n.push(s),r.push(o))}return Qa(t,r),n}function cp(t,e,n){return e=(n?yo(t,e,n):void 0===e)?1:en(e),La(et(t),e)}function up(){var t=arguments,e=et(t[0]);return t.length<3?e:KC.call(e,t[1],t[2])}function hp(t,e,n){e=ot(e,t)?[e]:nt(e);var o=-1,r=e.length;for(r||(t=void 0,r=1);++o<r;){var i=null==t?void 0:t[rt(e[o])];void 0===i&&(o=r,i=n),t=b(i)?i.call(t):i}return t}function lp(t){return t?YC.call(t):t}function fp(t){var e=Xe(t)?t:Ss(t),n=e.length;return n>0?e[Za(0,n-1)]:void 0}function dp(t,e,n){var o=-1,r=wa(t),i=r.length,s=i-1;for(e=(n?yo(t,e,n):void 0===e)?1:$o(en(e),0,i);++o<e;){var a=Za(o,s),p=r[a];r[a]=r[o],r[o]=p}return r.length=e,r}function gp(t,e,n){return null==t?t:ct(t,e,n)}function yp(t){return dp(t,ZC)}function vp(t){if(null==t)return 0;if(Xe(t)){var e=t.length;return e&&Co(t)?Fa(t):e}if(Q(t)){var n=Cv(t);if(n==tS||n==eS)return t.size}return xo(t).length}function mp(t,e,n){var o=t?t.length:0;return o?(n&&"number"!=typeof n&&yo(t,e,n)?(e=0,n=o):(e=null==e?0:en(e),n=void 0===n?o:en(n)),dt(t,e,n)):[]}function _p(t,e){var n;return T_(t,function(t,o,r){return n=e(t,o,r),!n}),!!n}function wp(t,e,n){var o=bu(t)?Mr:_p;return n&&yo(t,e,n)&&(e=void 0),o(t,Yr(e,3))}function bp(t,e,n,o){e=n(e);for(var r=0,i=t?t.length:0,s=e!==e,a=null===e,p=Z(e),c=void 0===e;i>r;){var u=sS((r+i)/2),h=n(t[u]),l=void 0!==h,f=null===h,d=h===h,g=Z(h);if(s)var y=o||d;else y=c?d&&(o||l):a?d&&l&&(o||!f):p?d&&l&&!f&&(o||!g):f||g?!1:o?e>=h:e>h;y?r=u+1:i=u}return aS(i,iS)}function Cp(t,e,n){var o=0,r=t?t.length:o;if("number"==typeof e&&e===e&&cS>=r){for(;r>o;){var i=o+r>>>1,s=t[i];null!==s&&!Z(s)&&(n?e>=s:e>s)?o=i+1:r=i}return r}return bp(t,e,Un,n)}function Sp(t,e){return Cp(t,e)}function xp(t,e,n){return bp(t,e,Yr(n))}function Ep(t,e){var n=t?t.length:0;if(n){var o=Cp(t,e);if(n>o&&R(t[o],e))return o}return-1}function Np(t,e){return Cp(t,e,!0)}function Ip(t,e,n){return bp(t,e,Yr(n),!0)}function Op(t,e){var n=t?t.length:0;if(n){var o=Cp(t,e,!0)-1;if(R(t[o],e))return o}return-1}function Tp(t,e){for(var n=-1,o=t.length,r=0,i=[];++n<o;){var s=t[n],a=e?e(s):s;if(!n||!R(a,p)){var p=a;i[r++]=0===s?0:s}}return i}function Pp(t){return t&&t.length?Tp(t):[]}function Dp(t,e){return t&&t.length?Tp(t,Yr(e)):[]}function Ap(t,e,n){return n&&"number"!=typeof n&&yo(t,e,n)&&(e=n=void 0),(n=void 0===n?uS:n>>>0)?(t=et(t),t&&("string"==typeof e||null!=e&&!Ks(e))&&(e=tt(e),""==e&&Hg.test(t))?jo(Ro(t),0,n):lS.call(t,e,n)):[]}function Mp(t,e){if("function"!=typeof t)throw new TypeError(fS);return e=void 0===e?0:dS(en(e),0),nn(function(n){var o=n[e],r=jo(n,0,e);return o&&To(r,o),Qe(t,this,r)})}function kp(t,e,n){return t=et(t),n=$o(en(n),0,t.length),t.lastIndexOf(tt(e),n)==n}function jp(){return{}}function Rp(){return""}function Lp(){return!0}function Fp(t){return t&&t.length?la(t,Un):0}function Bp(t,e){return t&&t.length?la(t,Yr(e)):0}function Hp(t){return wi(t,1)}function Up(t,e,n){return t&&t.length?(e=n||void 0===e?1:en(e),dt(t,0,0>e?0:e)):[]}function zp(t,e,n){var o=t?t.length:0;return o?(e=n||void 0===e?1:en(e),e=o-e,dt(t,0>e?0:e,o)):[]}function Wp(t,e){return t&&t.length?Ci(t,Yr(e,3),!1,!0):[]}function Jp(t,e){return t&&t.length?Ci(t,Yr(e,3)):[]}function qp(t,e){return e(t),t}function Vp(t){return"\\"+vS[t]}function Gp(t,e,n){var o=bS.imports._.templateSettings||bS;n&&yo(t,e,n)&&(e=void 0),t=et(t),e=_g({},e,o,li);var r,i,s=_g({},e.imports,o.imports,li),a=xo(s),p=Cs(s,a),c=0,u=e.interpolate||NS,h="__p += '",l=RegExp((e.escape||NS).source+"|"+u.source+"|"+(u===mS?ES:NS).source+"|"+(e.evaluate||NS).source+"|$","g"),f="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";t.replace(l,function(e,n,o,s,a,p){return o||(o=s),h+=t.slice(c,p).replace(IS,Vp),n&&(r=!0,h+="' +\n__e("+n+") +\n'"),a&&(i=!0,h+="';\n"+a+";\n__p += '"),o&&(h+="' +\n((__t = ("+o+")) == null ? '' : __t) +\n'"),c=p+e.length,e}),h+="';\n";var d=e.variable;d||(h="with (obj) {\n"+h+"\n}\n"),h=(i?h.replace(CS,""):h).replace(SS,"$1").replace(xS,"$1;"),h="function("+(d||"obj")+") {\n"+(d?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=Eg(function(){return Function(a,f+"return "+h).apply(void 0,p)});if(g.source=h,Ao(g))throw g;return g}function $p(t,e,n){var o=!0,r=!0;if("function"!=typeof t)throw new TypeError(OS);return w(n)&&(o="leading"in n?!!n.leading:o,r="trailing"in n?!!n.trailing:r),hi(t,e,{leading:o,maxWait:e,trailing:r})}function Kp(t,e){return e(t)}function Xp(t,e){if(t=en(t),1>t||t>TS)return[];var n=PS,o=DS(t,PS);e=Yr(e),t-=PS;for(var r=wo(o,e);++n<t;)e(n);return r}function Yp(){return this}function Qp(t,e){var n=t;return n instanceof Kn&&(n=n.value()),Bo(e,function(t,e){return e.func.apply(e.thisArg,To([t],e.args))},n)}function Zp(){return Qp(this.__wrapped__,this.__actions__)}function tc(t){return et(t).toLowerCase()}function ec(t){return bu(t)?Je(t,rt):Z(t)?[t]:Zn(ih(t))}function nc(t){return $o(en(t),-AS,AS)}function oc(t){return et(t).toUpperCase()}function rc(t,e,n){var o=bu(t)||Lr(t);if(e=Yr(e,4),null==n)if(o||w(t)){var r=t.constructor;n=o?bu(t)?new r:[]:b(r)?zn(ht(t)):{}}else n={};return(o?ko:ri)(t,function(t,o,r){return e(n,t,o,r)}),n}function ic(t,e){for(var n=t.length;n--&&Ue(e,t[n],0)>-1;);return n}function sc(t,e){for(var n=-1,o=t.length;++n<o&&Ue(e,t[n],0)>-1;);return n}function ac(t,e,n){if(t=et(t),t&&(n||void 0===e))return t.replace(MS,"");if(!t||!(e=tt(e)))return t;var o=Ro(t),r=Ro(e),i=sc(o,r),s=ic(o,r)+1;return jo(o,i,s).join("")}function pc(t,e,n){if(t=et(t),t&&(n||void 0===e))return t.replace(kS,"");if(!t||!(e=tt(e)))return t;var o=Ro(t),r=ic(o,Ro(e))+1;return jo(o,0,r).join("")}function cc(t,e,n){if(t=et(t),t&&(n||void 0===e))return t.replace(jS,"");if(!t||!(e=tt(e)))return t;var o=Ro(t),r=sc(o,Ro(e));return jo(o,r).join("")}function uc(t,e){var n=RS,o=LS;if(w(e)){var r="separator"in e?e.separator:r;n="length"in e?en(e.length):n,o="omission"in e?tt(e.omission):o}t=et(t);var i=t.length;if(Hg.test(t)){var s=Ro(t);i=s.length}if(n>=i)return t;var a=n-Fa(o);if(1>a)return o;var p=s?jo(s,0,a).join(""):t.slice(0,a);if(void 0===r)return p+o;if(s&&(a+=p.length-a),Ks(r)){if(t.slice(a).search(r)){var c,u=p;for(r.global||(r=RegExp(r.source,et(FS.exec(r))+"g")),r.lastIndex=0;c=r.exec(u);)var h=c.index;p=p.slice(0,void 0===h?a:h)}}else if(t.indexOf(tt(r),a)!=a){var l=p.lastIndexOf(r);l>-1&&(p=p.slice(0,l))}return p+o}function hc(t){return fo(t,1)}function lc(t){return BS[t]}function fc(t){return t=et(t),t&&US.test(t)?t.replace(HS,lc):t}function dc(t,e,n){var o=-1,r=ze,i=t.length,s=!0,a=[],p=a;if(n)s=!1,r=We;else if(i>=JS){var c=e?null:WS(t);if(c)return mr(c);s=!1,r=Ve,p=new Be}else p=e?[]:a;t:for(;++o<i;){var u=t[o],h=e?e(u):u;if(u=n||0!==u?u:0,s&&h===h){for(var l=p.length;l--;)if(p[l]===h)continue t;e&&p.push(h),a.push(u)}else r(p,h,n)||(p!==a&&p.push(h),a.push(u))}return a}function gc(t){return t&&t.length?dc(t):[]}function yc(t,e){return t&&t.length?dc(t,Yr(e)):[]}function vc(t,e){return t&&t.length?dc(t,void 0,e):[]}function mc(t){var e=++$S;return et(t)+e}function _c(t){if(!t||!t.length)return[];var e=0;return t=zi(t,function(t){return Ye(t)?(e=KS(t.length,e),!0):void 0}),wo(e,function(e){return Je(t,$e(e))})}function wc(t,e){if(!t||!t.length)return[];var n=_c(t);return null==e?n:Je(n,function(t){return Qe(e,void 0,t)})}function bc(t,e,n,o){return ct(t,e,n(it(t,e)),o)}function Cc(t){return"function"==typeof t?t:Un}function Sc(t,e,n){return null==t?t:bc(t,e,Cc(n))}function xc(t,e,n,o){return o="function"==typeof o?o:void 0,null==t?t:bc(t,e,Cc(n),o)}function Ec(t){return null==t?[]:Cs(t,Io(t))}function Nc(t,e){return e=null==e?Un:e,NC(e,t)}function Ic(){return Vo(this)}function Oc(){var t=this.__wrapped__;if(t instanceof Kn){var e=t;return this.__actions__.length&&(e=new Kn(this)),e=e.reverse(),e.__actions__.push({func:Kp,args:[lp],thisArg:void 0}),new Qn(e,this.__chain__)}return this.thru(lp)}function Tc(t,e,n){for(var o=-1,r=t.length;++o<r;)var i=i?To(Ge(i,t[o],e,n),Ge(t[o],i,e,n)):t[o];return i&&i.length?dc(i,e,n):[]}function Pc(t,e,n){for(var o=-1,r=t.length,i=e.length,s={};++o<r;){var a=i>o?e[o]:void 0;n(s,t[o],a)}return s}function Dc(t,e){return Pc(t||[],e||[],at)}function Ac(t,e){return Pc(t||[],e||[],ct)}function Mc(){var t=new Kn(this.__wrapped__);return t.__actions__=Zn(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Zn(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Zn(this.__views__),t}function kc(){if(this.__filtered__){var t=new Kn(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function jc(t,e,n){for(var o=-1,r=n.length;++o<r;){var i=n[o],s=i.size;switch(i.type){case"drop":t+=s;break;case"dropRight":e-=s;break;case"take":e=gx(e,t+s);break;case"takeRight":t=dx(t,e-s)}}return{start:t,end:e}}function Rc(){var t=this.__wrapped__.value(),e=this.__dir__,n=bu(t),o=0>e,r=n?t.length:0,i=jc(0,r,this.__views__),s=i.start,a=i.end,p=a-s,c=o?a:s-1,u=this.__iteratees__,h=u.length,l=0,f=_x(p,this.__takeCount__);if(!n||yx>r||r==p&&f==p)return Qp(t,this.__actions__);var d=[];t:for(;p--&&f>l;){c+=e;for(var g=-1,y=t[c];++g<h;){var v=u[g],m=v.iteratee,_=v.type,w=m(y);if(_==mx)y=w;else if(!w){if(_==vx)continue t;break t}}d[l++]=y}return d}function Lc(t,e){t=Ir(t);var n=t.nodes;return e.forEach(function(t){t.ops.forEach(function(t){try{var e=Mh.fromJSON(t);e.apply(n)}catch(o){console.error(o,t)}})}),t}function Fc(t){return t===!0||t===!1||t&&t.constructor===Boolean}function Bc(t,e){for(var n=Hc(e),o=[n],r=t;r;){var i=Object.getPrototypeOf(r.prototype);if(!i)break;r=i.constructor,r&&r._schema&&o.unshift(r._schema)}return o.unshift({}),Object.assign.apply(null,o)}function Hc(e){var n={};return t(e,function(t,e){"type"!==e&&((_(t)||u(t))&&(t={type:t}),t=Uc(t),t.name=e,n[e]=new Fx(t))}),n}function Uc(t){var e=t;return u(t.type)&&"array"!==t.type[0]?t.type=["array",t.type[0]]:"text"===t.type&&(e={type:"string","default":"",_isText:!0}),e}function zc(t,n){var o,r=t.name;if(o=t.isArray()?"array":t.type,null===n){if(t.isNotNull())throw new Error("Value for property "+r+" is null.");return n}if(void 0===n)throw new Error("Value for property "+r+" is undefined.");if("string"===o&&!_(n)||"boolean"===o&&!Fc(n)||"number"===o&&!v(n)||"array"===o&&!u(n)||"id"===o&&!_(n)||"object"===o&&!e(n))throw new Error("Illegal value type for property "+r+": expected "+o+", was "+typeof n);return n}function Wc(t){return/([a-zA-Z_0-9]+):changed/.exec(t)}function Jc(t){return t.hasOwnProperty("start")?t.hasOwnProperty("end")&&!t.end.path&&(t.end.path=t.start.path):(console.warn('DEPRECATED: create Annotation with "start" and "end" coordinate instead.'),t=Object.assign({},t),t.start={path:t.startPath||t.path,offset:t.startOffset},t.end={},t.hasOwnProperty("endPath")?t.end.path=t.endPath:t.end.path=t.start.path,t.hasOwnProperty("endOffset")?t.end.offset=t.endOffset:t.end.offset=t.start.offset,delete t.path,delete t.startPath,delete t.endPath,delete t.startOffset,delete t.endOffset),t}function qc(e){var n=[],o=[];t(e,function(t){var e=t.isAnchor?t.isAnchor():!1;if(e)n.push({mode:Xx,pos:t.offset,id:t.id,level:Yx.ALWAYS_ON_TOP,type:"anchor",node:t,counter:-1,length:0});else{var r=Yx.NORMAL,i=t.isInline?t.isInline():!1;i?r=Number.MAX_VALUE:t.constructor.hasOwnProperty("fragmentation")?r=t.constructor.fragmentation:t.hasOwnProperty("fragmentationHint")&&(r=t.fragmentationHint);var s=Math.min(t.start.offset,t.end.offset),a=Math.max(t.start.offset,t.end.offset),p={pos:s,mode:$x,level:r,id:t.id,type:t.type,node:t,length:0,counter:-1};n.push(p),o.push({pos:a,mode:Kx,level:r,id:t.id,type:t.type,node:t,opener:p})}}),n.sort(Vc);for(var r=n.length-1;r>=0;r--)n[r].idx=r;o.sort(Gc);for(var i=new Array(n.length+o.length),s=0,a=0,p=0,c=n[a],u=o[p];c||u;)c&&u?u.pos<=c.pos&&u.opener!==c?(i[s]=u,p++):(i[s]=c,a++):c?(i[s]=c,a++):u&&(i[s]=u,p++),c=n[a],u=o[p],s++;return i}function Vc(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===e.mode){if(t.level<e.level)return-1;if(t.level>e.level)return 1}return 0}function Gc(t,e){return t.pos<e.pos?-1:t.pos>e.pos?1:t.pos===t.opener.pos&&e.pos===e.opener.pos?t.opener.idx<e.opener.idx?-1:1:t.opener.idx>e.opener.idx?-1:t.opener.idx<e.opener.idx?1:0}function $c(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Kc(){var t={};return function(e){t.hasOwnProperty(e)||(t[e]=1);var n=[e,"-",t[e]++].join("");return n}}function Xc(t,e){e.forEach(function(e){var n=t.get(e.id);n&&n!==e&&t["delete"](e.id),e.document!==t&&t.create(e)})}function Yc(t){return t=Object.assign({idAttribute:"data-id"},t),t.elementFactory||(t.elementFactory=wf.createDocument("html")),t}function Qc(t,e){void 0===t.length&&(t=[t]);var n=p(t,function(t){return tu(t,e)}),o=Zc(n),r=e.getBoundingClientRect();return{left:o.left,top:o.top,right:r.width-o.left-o.width,bottom:r.height-o.top-o.height,width:o.width,height:o.height}}function Zc(e){var n={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};return t(e,function(t){t.left<n.left&&(n.left=t.left),t.top<n.top&&(n.top=t.top),t.left+t.width>n.right&&(n.right=t.left+t.width),t.top+t.height>n.bottom&&(n.bottom=t.top+t.height)}),n.width=n.right-n.left,n.height=n.bottom-n.top,n}function tu(t,e){var n=e.getBoundingClientRect(),o=Zc(t.getClientRects()),r=o.left-n.left,i=o.top-n.top;return{left:r,top:i,right:n.width-r-o.width,bottom:n.height-i-o.height,width:o.width,height:o.height}}function eu(t,e){var n=e.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i={left:o,right:n.width-o,top:r,bottom:n.height-r};return i}function nu(t,e){for(var n=[],o=0;o<=e.length;o++)if(n[o]=[o],0!==o)for(var r=o-1,i=0;i<=t.length;i++)if(n[0][i]=i,0!==i){var s=i-1;n[o][i]=e.charAt(r)===t.charAt(s)?n[r][s]:Math.min(n[r][s]+1,n[o][s]+1,n[r][i]+1)}return n}function ou(t,e,n){if(!_(t)||!_(e))throw new Error("Illegal arguments.");n=n||0;var o=[];if(t||e)if(!t&&e)o.push({type:"insert",start:n,text:e});else if(t&&!e)o.push({type:"delete",start:n,end:n+t.length});else{var r=nu(t,e);o=ru(t,e,r,n)}return o}function ru(t,e,n,o){function r(){var t=n[a][p],o=a-1,r=p-1;n[o][r]<t?(s&&"replace"===s.type?(s.start--,s.text.unshift(e.charAt(o))):(i(),s={type:"replace",start:r,end:p,text:[e.charAt(o)]}),a--,p--):n[o][p]<t?(s&&"insert"===s.type?(s.start--,s.text.unshift(e.charAt(o))):(i(),s={type:"insert",start:r,text:[e.charAt(o)]}),a--):n[a][r]<t?(s&&"delete"===s.type?s.start--:(i(),s={type:"delete",start:r,end:p}),p--):(i(),a--,p--)}function i(){if(s){switch(s.type){case"insert":s.start+=o,s.text=s.text.join("");break;case"delete":s.start+=o,s.end+=o;break;case"replace":s.start+=o,s.end+=o,s.text=s.text.join("");break;default:throw new Error("Invalid state")}c.push(s),s=null}}for(var s,a=e.length,p=t.length,c=[];a>0&&p>0;)r();return i(),c}function iu(t,e,n){for(var o={comp:null,el:null,path:null,node:e,offset:n};e&&e!==t;){if(e.isElementNode()){var r=Ef.unwrap(e);if(r&&r._isTextPropertyComponent)return o.comp=r,o.el=e,o.path=r.getPath(),o;e.getAttribute("data-inline")&&(o.node=e,n>0&&(o.offset=1))}e=e.getParent()}return null}function su(t,e){var n,o,r=e;if(n=t.getParent(),t.isTextNode())if(t===n.firstChild){var i=n.getAttribute("data-path"),s=n.getAttribute("data-offset");r=i?e:s?parseInt(s,10)+e:su(n,0)+e}else o=n.getChildIndex(t),r=su(n,o)+e;else{if(!t.isElementNode())return null;var a=t.getAttribute("data-path"),p=t.getAttribute("data-offset");a?r=au(t,e):p?(o=n.getChildIndex(t),r=parseInt(p,10)+au(t,e)):(o=n.getChildIndex(t),r=su(n,o)+au(t,e))}return r}function au(t,e){var n=0;if(t.getAttribute("data-inline"))return 0===e?0:1;var o=t.getChildCount();1===arguments.length&&(e=o),e=Math.min(o,e);for(var r=0,i=t.getFirstChild();e>r;i=i.getNextSibling(),r++)if(i.isTextNode())n+=i.getTextContent().length;else if(i.isElementNode()){var s=i.getAttribute("data-length");n+=i.getAttribute("data-inline")?1:s?parseInt(s,10):au(i)}return n}function pu(t){return t.ordered?"ol":"ul"}function cu(t,e,n){for(var o=t.getItems(),r=[e],i=0;i<o.length;i++){var s=o[i];if(s.level<r.length)for(var a=r.length;a>s.level;a--)r.pop();else if(s.level>r.length)for(var p=r.length;p<s.level;p++){var c=n(pu(t));Wt(r).append(c),r.push(c)}console.assert(s.level===r.length,"item.level should now be the same as stack.length"),Wt(r).append(n(s))}for(var u=r.length;u>1;u--)r.pop()}function uu(t,e){return _(t)?t.startsWith?t.startsWith(e):(_(e)||(e=String(e)),t.slice(0,e.length)===e):!1}function hu(t){var e=t.context.isolatedNodeComponent;if(e){var n=e.context.surface;return t.isContainerEditor()?e._isInlineNodeComponent?n.id+"/"+e.props.node.id+"/"+t.name:n.id+"/"+t.name:n.id+"/"+e.props.node.id+"/"+t.name}return t.name}function lu(t,e,n){for(var o=0;t>o;o++)e.call(n)}function fu(t){var e=t.start,n=t.end,o=t.isReverse;if(o){var r;r=[n,e],e=r[0],n=r[1]}if(!e._comp||!n._comp)return console.error("FIXME: getCoordinate() should provide a component instance"),null;var i=e._comp.context.surface;return i?i!==n._comp.context.surface?(console.error("Coordinates are within two different surfaces. Can not create a selection."),null):new El(e,n,o,i.getContainerId(),i.id):(console.error("FIXME: Editable components should have their surface in the context"),null)}function du(e,n){return new Promise(function(o,r){function i(){if(200===p.status){var t=p.responseText;n&&n(null,t),o(t)}else console.error(p.statusText),n&&n(p.status),r(p.statusText,p.status)}var s=(e.method||"GET").toUpperCase(),a=e.url;if(["GET","POST","PUT","DELETE"].indexOf(s)<0)throw new Error("Parameter 'method' must be 'GET', 'POST', 'PUT', or 'DELETE'.");if(!a)throw new Error("Parameter 'url' is required.");var p=new XMLHttpRequest;p.onreadystatechange=function(){return 4===p.readyState?i():void 0},p.open(s,a,!0),e.header&&t(e.header,function(t,e){p.setRequestHeader(e,t)}),e.data?p.send(JSON.stringify(e.data)):p.send()})}function gu(t,e){return t?t.indexOf(e)>=0:!1}var yu=function(t){this._changes=t||{}};yu.prototype.getChanges=function(t,e,n,o){if("function"==typeof e?(o=e,e=0):"function"==typeof n&&(o=n,n=void 0),!(t&&e>=0&&o))throw new Error("Invalid arguments");var r=this._getVersion(t),i=this._getChanges(t);i=i.slice(e,n),o(null,i,r)},yu.prototype.addChange=function(t,e,n){if(!t||!e)throw new Error("Invalid arguments");this._addChange(t,e);var o=this._getVersion(t);n(null,o)},yu.prototype.deleteChanges=function(t,e){var n=this._deleteChanges(t);e(null,n.length)},yu.prototype.getVersion=function(t,e){e(null,this._getVersion(t))},yu.prototype._deleteChanges=function(t){var e=this._getChanges(t);return delete this._changes[t],e},yu.prototype._getVersion=function(t){var e=this._changes[t];return e?e.length:0},yu.prototype._getChanges=function(t){return this._changes[t]||[]},yu.prototype._addChange=function(t,e){this._changes[t]||(this._changes[t]=[]),this._changes[t].push(e)};var vu=function(){},mu={__events__:{}};vu.prototype.emit=function(t){if(t in this.__events__){for(var e=this.__events__[t].slice(),n=Array.prototype.slice.call(arguments,1),o=0,r=e.length;r>o;o++){var i=e[o];i.method.apply(i.context,n)}return!0}return!1},vu.prototype.on=function(t,e,r,i){var s=0;4===arguments.length&&(s=i.priority||s),o.call(this,t,e,r,s),this.__events__[t].sort(n)},vu.prototype.off=function(t,n,o){1===arguments.length&&e(arguments[0])?i.call(this,arguments[0]):r.apply(this,arguments)},vu.prototype._debugEvents=function(){console.log("### EventEmitter: ",this),t(this.__events__,function(t,e){console.log("- %s listeners for %s: ",t.length,e,t)})},mu.__events__.get=function(){return this.___events___||(this.___events___={}),this.___events___},Object.defineProperties(vu.prototype,mu);var _u=function(t){function e(n,o){t.call(this,n,o),this.name=n,this.message=o.message,this.info=o.info,this.errorCode=o.errorCode,this.cause=o.cause,t.captureStackTrace&&t.captureStackTrace(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.inspect=function(){var t=[];return t.push(this.stack),this.info&&t.push(this.info+". "),this.cause&&(t.push("\nCaused by: "),this.cause.inspect?t.push(this.cause.inspect()):t.push(this.cause.toString())),t.join("")},e}(Error);_u.fromJSON=function(t){if(!t)return null;var e=new _u(t.name,{message:t.message,info:t.info,errorCode:t.errorCode,cause:_u.fromJSON(t.cause)});return e};var wu="undefined"!=typeof window,bu=Array.isArray,Cu="[object Function]",Su="[object GeneratorFunction]",xu=Object.prototype,Eu=xu.toString,Nu=S("object"==typeof global&&global),Iu=S("object"==typeof self&&self),Ou=S(!1),Tu=Nu||Iu||Ou||Function("return this")(),Pu=Tu["__core-js_shared__"],Du=function(){var t=/[^.]+$/.exec(Pu&&Pu.keys&&Pu.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Au=Function.prototype.toString,Mu=/[\\^$.*+?()[\]{}|]/g,ku=/^\[object .+?Constructor\]$/,ju=Object.prototype,Ru=Function.prototype.toString,Lu=ju.hasOwnProperty,Fu=RegExp("^"+Ru.call(Lu).replace(Mu,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bu=O(Object,"create"),Hu="__lodash_hash_undefined__",Uu=Object.prototype,zu=Uu.hasOwnProperty,Wu=Object.prototype,Ju=Wu.hasOwnProperty,qu="__lodash_hash_undefined__";k.prototype.clear=T,k.prototype["delete"]=P,k.prototype.get=D,k.prototype.has=A,k.prototype.set=M;var Vu=Array.prototype,Gu=Vu.splice;z.prototype.clear=j,z.prototype["delete"]=F,z.prototype.get=B,z.prototype.has=H,z.prototype.set=U;var $u=O(Tu,"Map");X.prototype.clear=W,X.prototype["delete"]=V,X.prototype.get=G,X.prototype.has=$,X.prototype.set=K;var Ku="Expected a function";Y.Cache=X;var Xu=Tu.Symbol,Yu="[object Symbol]",Qu=Object.prototype,Zu=Qu.toString,th=1/0,eh=Xu?Xu.prototype:void 0,nh=eh?eh.toString:void 0,oh=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,rh=/\\(\\)?/g,ih=Y(function(t){var e=[];return et(t).replace(oh,function(t,n,o,r){e.push(o?r.replace(rh,"$1"):n||t)}),e}),sh=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ah=/^\w*$/,ph=1/0,ch=Object.prototype,uh=ch.hasOwnProperty,hh=9007199254740991,lh=/^(?:0|[1-9]\d*)$/,fh=Object.getPrototypeOf,dh=Object.prototype,gh=dh.hasOwnProperty,yh=function(t){t&&(this.__root__=t)};yh.prototype.contains=function(t){return Boolean(this.getRoot()[t])},yh.prototype.getRoot=function(){return this.__root__?this.__root__:this},yh.prototype.get=function(t){if(t){if(_(t))return this.getRoot()[t];if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),!u(t))throw new Error("Illegal argument for PathObject.get()");return st(this.getRoot(),t)}},yh.prototype.set=function(t,e){if(!t)throw new Error("Illegal argument: PathObject.set(>path<, value) - path is mandatory.");_(t)?this.getRoot()[t]=e:ut(this.getRoot(),t,e)},yh.prototype["delete"]=function(t){if(_(t))delete this.getRoot()[t];else if(1===t.length)delete this.getRoot()[t[0]];else{var e=vt(this.getRoot(),t);if(!e)throw new Error("Could not delete property at path"+t)}},yh.prototype.clear=function(){var t=this.getRoot();for(var e in t)t.hasOwnProperty(e)&&delete t[e]},yh.prototype._isPathObject=!0;var vh=function(t){function e(e,n){t.call(this,"Conflict: "+JSON.stringify(e)+" vs "+JSON.stringify(n)),this.a=e,this.b=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),mh="insert",_h="delete",wh=function(t){if(!t||void 0===t.type||void 0===t.pos||void 0===t.str)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.pos=t.pos,this.str=t.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!_(this.str))throw new Error("Illegal argument: expecting string.");if(!v(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")};wh.prototype.apply=function(t){if(this.isEmpty())return t;if(this.type===mh){if(t.length<this.pos)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,0,this.str):t.slice(0,this.pos).concat(this.str).concat(t.slice(this.pos))}if(t.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,this.str.length):t.slice(0,this.pos).concat(t.slice(this.pos+this.str.length))},wh.prototype.clone=function(){return new wh(this)},wh.prototype.isNOP=function(){return"NOP"===this.type||0===this.str.length},wh.prototype.isInsert=function(){return this.type===mh},wh.prototype.isDelete=function(){return this.type===_h},wh.prototype.getLength=function(){return this.str.length},wh.prototype.invert=function(){var t={type:this.isInsert()?_h:mh,pos:this.pos,str:this.str};return new wh(t)},wh.prototype.hasConflict=function oO(t){return oO(this,t)},wh.prototype.isEmpty=function(){return 0===this.str.length},wh.prototype.toJSON=function(){return{type:this.type,pos:this.pos,str:this.str}},wh.prototype.toString=function(){return["(",this.isInsert()?mh:_h,",",this.pos,",'",this.str,"')"].join("")},wh.prototype._isOperation=!0,wh.prototype._isTextOperation=!0,wh.transform=function(){return Ct.apply(null,arguments)},wh.Insert=function(t,e){return new wh({type:mh,pos:t,str:e})},wh.Delete=function(t,e){return new wh({type:_h,pos:t,str:e})},wh.INSERT=mh,wh.DELETE=_h,wh.fromJSON=function(t){return new wh(t)};var bh="NOP",Ch="delete",Sh="insert",xh=function(t){if(!t||!t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.type!==bh){if(this.type!==Sh&&this.type!==Ch)throw new Error("Illegal type.");if(this.pos=t.pos,this.val=t.val,!v(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}};xh.prototype.apply=function(t){if(this.type===bh)return t;if(this.type===Sh){if(t.length<this.pos)throw new Error("Provided array is too small.");return t.splice(this.pos,0,this.val),t}if(t.length<this.pos)throw new Error("Provided array is too small.");if(!h(t[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+t[this.pos]);return t.splice(this.pos,1),t},xh.prototype.clone=function(){var t={type:this.type,pos:this.pos,val:f(this.val)};return new xh(t)},xh.prototype.invert=function(){var t=this.toJSON();return this.type===bh?t.type=bh:this.type===Sh?t.type=Ch:t.type=Sh,new xh(t)},xh.prototype.hasConflict=function(t){return xh.hasConflict(this,t)},xh.prototype.toJSON=function(){var t={type:this.type};return this.type===bh?t:(t.pos=this.pos,t.val=f(this.val),t)},xh.prototype.isInsert=function(){return this.type===Sh},xh.prototype.isDelete=function(){return this.type===Ch},xh.prototype.getOffset=function(){return this.pos},xh.prototype.getValue=function(){return this.val},xh.prototype.isNOP=function(){return this.type===bh},xh.prototype.toString=function(){return["(",this.isInsert()?Sh:Ch,",",this.getOffset(),",'",this.getValue(),"')"].join("")},xh.prototype._isOperation=!0,xh.prototype._isArrayOperation=!0;var Eh=function(t,e,n){if(n=n||{},n["no-conflict"]&&St(t,e))throw new vh(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===bh||e.type===bh||(t.type===Sh&&e.type===Sh?xt(t,e):t.type===Ch&&e.type===Ch?Et(t,e):Nt(t,e)),[t,e]};xh.transform=Eh,xh.hasConflict=St,xh.Insert=function(t,e){return new xh({type:Sh,pos:t,val:e})},xh.Delete=function(t,e){return new xh({type:Ch,pos:t,val:e})},xh.fromJSON=function(t){return new xh(t)},xh.NOP=bh,xh.DELETE=Ch,xh.INSERT=Sh;var Nh="shift",Ih=function(t){if(!t||void 0===t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.val=t.val,!this.isShift())throw new Error("Illegal type.");if(!v(this.val))throw new Error("Illegal argument: expecting number as shift value.")};Ih.prototype.apply=function(t){t.offset=t.offset+this.val;
},Ih.prototype.isShift=function(){return this.type===Nh},Ih.prototype.isNOP=function(){switch(this.type){case Nh:return 0===this.val;default:return!1}},Ih.prototype.clone=function(){return new Ih(this)},Ih.prototype.invert=function(){var t;switch(this.type){case Nh:t={type:Nh,val:-this.val};break;default:throw new Error("Invalid type.")}return new Ih(t)},Ih.prototype.hasConflict=function(){return!1},Ih.prototype.toJSON=function(){return{type:this.type,val:this.val}},Ih.prototype.toString=function(){return["(",this.type,",",this.val,"')"].join("")},Ih.prototype._isOperation=!0,Ih.prototype._isCoordinateOperation=!0,Ih.transform=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Ot.apply(void 0,t)},Ih.fromJSON=function(t){return new Ih(t)},Ih.Shift=function(t){return new Ih({type:Nh,val:t})};var Oh="NOP",Th="create",Ph="delete",Dh="update",Ah="set",Mh=function(t){if(!t)throw new Error("Data of ObjectOperation is missing.");if(!t.type)throw new Error("Invalid data: type is mandatory.");if(this.type=t.type,t.type!==Oh){if(this.path=t.path,!t.path)throw new Error("Invalid data: path is mandatory.");if(this.type===Th||this.type===Ph){if(!t.val)throw new Error("Invalid data: value is missing.");this.val=t.val}else if(this.type===Dh){if(!t.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=t.diff,t.diff._isTextOperation)this.propertyType="string";else if(t.diff._isArrayOperation)this.propertyType="array";else{if(!t.diff._isCoordinateOperation)throw new Error("Invalid data: diff must be a TextOperation or an ArrayOperation.");this.propertyType="coordinate"}}else{if(this.type!==Ah)throw new Error("Invalid type: "+t.type);this.val=t.val,this.original=t.original}}};Mh.prototype.apply=function(t){if(this.type===Oh)return t;var e;if(e=t._isPathObject?t:new yh(t),this.type===Th)return e.set(this.path,f(this.val)),t;if(this.type===Ph)e["delete"](this.path,"strict");else if(this.type===Dh){var n=this.diff;switch(this.propertyType){case"array":var o=e.get(this.path);n.apply(o);break;case"string":var r=e.get(this.path);m(r)&&(r=""),r=n.apply(r),e.set(this.path,r);break;case"coordinate":var i=e.get(this.path);if(!i)throw new Error("No coordinate with path "+this.path);n.apply(i);break;default:throw new Error("Invalid state.")}}else{if(this.type!==Ah)throw new Error("Invalid type.");e.set(this.path,f(this.val))}return t},Mh.prototype.clone=function(){var t={type:this.type,path:this.path};return this.val&&(t.val=f(this.val)),this.diff&&(t.diff=this.diff.clone()),new Mh(t)},Mh.prototype.isNOP=function(){return this.type===Oh?!0:this.type===Dh?this.diff.isNOP():void 0},Mh.prototype.isCreate=function(){return this.type===Th},Mh.prototype.isDelete=function(){return this.type===Ph},Mh.prototype.isUpdate=function(t){return t?this.type===Dh&&this.propertyType===t:this.type===Dh},Mh.prototype.isSet=function(){return this.type===Ah},Mh.prototype.invert=function(){if(this.type===Oh)return new Mh({type:Oh});var t=new Mh(this);if(this.type===Th)t.type=Ph;else if(this.type===Ph)t.type=Th;else if(this.type===Dh){var e;if(this.diff._isTextOperation)e=wh.fromJSON(this.diff.toJSON()).invert();else if(this.diff._isArrayOperation)e=xh.fromJSON(this.diff.toJSON()).invert();else{if(!this.diff._isCoordinateOperation)throw new Error("Illegal type");e=Ih.fromJSON(this.diff.toJSON()).invert()}t.diff=e}else t.val=this.original,t.original=this.val;return t},Mh.prototype.hasConflict=function(t){return Mh.hasConflict(this,t)},Mh.prototype.toJSON=function(){if(this.type===Oh)return{type:Oh};var t={type:this.type,path:this.path};if(this.type===Th||this.type===Ph)t.val=this.val;else if(this.type===Dh){if(this.diff._isTextOperation)t.propertyType="string";else if(this.diff._isArrayOperation)t.propertyType="array";else{if(!this.diff._isCoordinateOperation)throw new Error("Invalid property type.");t.propertyType="coordinate"}t.diff=this.diff.toJSON()}else t.val=this.val,t.original=this.original;return t},Mh.prototype.getType=function(){return this.type},Mh.prototype.getPath=function(){return this.path},Mh.prototype.getValue=function(){return this.val},Mh.prototype.getOldValue=function(){return this.original},Mh.prototype.getValueOp=function(){return this.diff},Mh.prototype.toString=function(){switch(this.type){case Th:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case Ph:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case Dh:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case Ah:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case Oh:return"NOP";default:throw new Error("Invalid type")}},Mh.prototype._isOperation=!0,Mh.prototype._isObjectOperation=!0;var kh=0,jh=1,Rh=2,Lh=4,Fh=8,Bh=function(){var t={};return t[Oh]=kh,t[Th]=jh,t[Ph]=Rh,t[Dh]=Lh,t[Ah]=Fh,t}(),Hh=function(){var t={};return t[Rh|Rh]=Pt,t[Rh|jh]=At,t[Rh|Lh]=Mt,t[jh|jh]=Dt,t[jh|Lh]=kt,t[Lh|Lh]=jt,t[jh|Fh]=Rt,t[Rh|Fh]=Lt,t[Lh|Fh]=Ft,t[Fh|Fh]=Bt,t}();Mh.transform=Ht,Mh.hasConflict=Tt,Mh.Create=function(t,e){var n;return n=_(t)?[t]:t,new Mh({type:Th,path:n,val:e})},Mh.Delete=function(t,e){var n;return n=_(t)?[t]:t,new Mh({type:Ph,path:n,val:e})},Mh.Update=function(t,e){return new Mh({type:Dh,path:t,diff:e})},Mh.Set=function(t,e,n){return new Mh({type:Ah,path:t,val:f(n),original:f(e)})},Mh.fromJSON=function(t){if(t=f(t),"update"===t.type)switch(t.propertyType){case"string":t.diff=wh.fromJSON(t.diff);break;case"array":t.diff=xh.fromJSON(t.diff);break;case"coordinate":t.diff=Ih.fromJSON(t.diff);break;default:throw new Error("Unsupported update diff:"+JSON.stringify(t.diff))}var e=new Mh(t);return e},Mh.NOP=Oh,Mh.CREATE=Th,Mh.DELETE=Ph,Mh.UPDATE=Dh,Mh.SET=Ah;var Uh=function(){this.SEPARATOR="	"};Uh.prototype.serialize=function(t){var e=[];switch(t.type){case"create":e.push("c"),e.push(t.val.id),e.push(t.val);break;case"delete":e.push("d"),e.push(t.val.id),e.push(t.val);break;case"set":e.push("s"),e.push(t.path.join(".")),e.push(t.val),e.push(t.original);break;case"update":e.push("u"),e.push(t.path.join(".")),Array.prototype.push.apply(e,this.serializePrimitiveOp(t.diff));break;default:throw new Error("Unsupported operation type.")}return e},Uh.prototype.serializePrimitiveOp=function(t){var e=[];if(t._isTextOperation)t.isInsert()?e.push("t+"):t.isDelete()&&e.push("t-"),e.push(t.pos),e.push(t.str);else if(t._isArrayOperation)t.isInsert()?e.push("a+"):t.isDelete()&&e.push("a-"),e.push(t.pos),e.push(t.val);else{if(!t._isCoordinateOperation)throw new Error("Unsupported operation type.");if(!t.isShift())throw new Error("Unsupported CoordinateOperation type.");e.push("c>>"),e.push(t.pos),e.push(t.val)}return e},Uh.prototype.deserialize=function(t,e){e||(e=new zh(t,this.SEPARATOR));var n,o,r,i,s,a=e.getString();switch(a){case"c":o=e.getPath(),r=e.getObject(),n=Mh.Create(o,r);break;case"d":o=e.getPath(),r=e.getObject(),n=Mh.Delete(o,r);break;case"s":o=e.getPath(),r=e.getAny(),i=e.getAny(),n=Mh.Set(o,i,r);break;case"u":o=e.getPath(),s=this.deserializePrimitiveOp(t,e),n=Mh.Update(o,s);break;default:throw new Error("Illegal type for ObjectOperation: "+a)}return n},Uh.prototype.deserializePrimitiveOp=function(t,e){e||(e=new zh(t,this.SEPARATOR));var n,o,r,i=e.getString();switch(i){case"t+":o=e.getNumber(),r=e.getString(),n=wh.Insert(o,r);break;case"t-":o=e.getNumber(),r=e.getString(),n=wh.Delete(o,r);break;case"a+":o=e.getNumber(),r=e.getAny(),n=xh.Insert(o,r);break;case"a-":o=e.getNumber(),r=e.getAny(),n=xh.Delete(o,r);break;case"c>>":r=e.getNumber(),n=Ih.Shift(r);break;default:throw new Error("Unsupported operation type: "+i)}return n};var zh=function(t,e){u(arguments[0])?this.tokens=arguments[0]:this.tokens=t.split(e),this.pos=-1};zh.prototype.error=function(t){throw new Error("Parsing error: "+t+"\n"+this.tokens[this.pos])},zh.prototype.getString=function(){this.pos++;var t=this.tokens[this.pos];return'"'===t[0]&&(t=t.slice(1,-1)),t},zh.prototype.getNumber=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=v(e)?e:parseInt(this.tokens[this.pos],10)}catch(n){this.error("expected number")}},zh.prototype.getObject=function(){this.pos++;var t,n=this.tokens[this.pos];try{return t=e(n)?n:JSON.parse(this.tokens[this.pos])}catch(o){this.error("expected object")}},zh.prototype.getAny=function(){this.pos++;var t=this.tokens[this.pos];return t},zh.prototype.getPath=function(){var t=this.getString();return t.split(".")},Uh.Tokenizer=zh;var Wh=function(t,e){if("SKIP"!==arguments[0]){if(1===arguments.length){var n=arguments[0];this.path=n.path,this.offset=n.offset}else this.path=t,this.offset=e;if(!u(this.path))throw new Error("Invalid arguments: path should be an array.");if(!v(this.offset)||this.offset<0)throw new Error("Invalid arguments: offset must be a positive number.")}};Wh.prototype.equals=function(t){return t===this||Ut(t.path,this.path)&&t.offset===this.offset},Wh.prototype.withCharPos=function(t){return new Wh(this.path,t)},Wh.prototype.getNodeId=function(){return this.path[0]},Wh.prototype.getPath=function(){return this.path},Wh.prototype.getOffset=function(){return this.offset},Wh.prototype.toJSON=function(){return{path:this.path.slice(),offset:this.offset}},Wh.prototype.toString=function(){return"("+this.path.join(".")+", "+this.offset+")"},Wh.prototype.isPropertyCoordinate=function(){return this.path.length>1},Wh.prototype.isNodeCoordinate=function(){return 1===this.path.length},Wh.prototype.hasSamePath=function(t){return Ut(this.path,t.path)},Wh.prototype._isCoordinate=!0;var Jh=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isAnchor=function(){return!0},e}(Wh),qh=function(){var t={};Object.defineProperty(this,"_internal",{enumerable:!1,value:t}),t.doc=null},Vh={type:{}};qh.prototype.clone=function(){var t=this._clone();return this._internal.doc&&t.attach(this._internal.doc),t},qh.prototype.getDocument=function(){var t=this._internal.doc;if(!t)throw new Error("Selection is not attached to a document.");return t},qh.prototype.isAttached=function(){return Boolean(this._internal.doc)},qh.prototype.attach=function(t){return this._internal.doc=t,this},qh.prototype.isNull=function(){return!1},qh.prototype.isPropertySelection=function(){return!1},qh.prototype.isContainerSelection=function(){return!1},qh.prototype.isNodeSelection=function(){return!1},qh.prototype.isCustomSelection=function(){return!1},qh.prototype.isCollapsed=function(){return!0},qh.prototype.isReverse=function(){return!1},qh.prototype.getType=function(){throw new Error("Selection.getType() is abstract.")},Vh.type.get=function(){return this.getType()},qh.prototype.equals=function(t){return this===t?!0:t?this.isNull()!==t.isNull()?!1:this.getType()===t.getType():!1},qh.prototype.toString=function(){return"null"},qh.prototype.toJSON=function(){throw new Error("This method is abstract.")},qh.prototype.getFragments=function(){return[]},qh.prototype.createWith=function(t){var e=this.constructor,n=this.toJSON();return Object.assign(n,t),e.fromJSON(n)},Object.defineProperties(qh.prototype,Vh),qh.prototype._isSelection=!0;var Gh=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNull=function(){return!0},e.prototype.getType=function(){return"null"},e.prototype.toJSON=function(){return null},e.prototype.clone=function(){return this},e}(qh);qh.nullSelection=Object.freeze(new Gh);var $h=function(t){function e(e,n,o,r){t.call(this),this.type="selection-fragment",this.path=e,this.startOffset=n,this.endOffset=o||n,this.full=Boolean(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isAnchor=function(){return!1},e.prototype.isInline=function(){return!1},e.prototype.isPropertyFragment=function(){return!0},e.prototype.isNodeFragment=function(){return!1},e.prototype.isFull=function(){return this.full},e.prototype.isPartial=function(){return!this.full},e.prototype.getNodeId=function(){return this.path[0]},e}(vu);qh.Fragment=$h;var Kh=function(t){function e(e){t.call(this),this.type="node-fragment",this.nodeId=e,this.path=[e]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isAnchor=function(){return!1},e.prototype.isInline=function(){return!1},e.prototype.isPropertyFragment=function(){return!1},e.prototype.isNodeFragment=function(){return!0},e.prototype.isFull=function(){return!0},e.prototype.isPartial=function(){return!1},e.prototype.getNodeId=function(){return this.nodeId},e}(vu);qh.NodeFragment=Kh;var Xh=function(t){function e(e,n){t.call(this,e,n),this.type="cursor"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isPropertyFragment=function(){return!1},e.prototype.isNodeFragment=function(){return!1},e}(Jh);qh.Cursor=Xh;var Yh=function(t){function e(e,n,o,r,i,s){if(t.call(this),1===arguments.length){var a=arguments[0];e=a.path,n=a.startOffset,o=a.endOffset,r=a.reverse,i=a.containerId,s=a.surfaceId}if(!e||!v(n))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this.start=new Wh(e,n),this.end=new Wh(e,v(o)?o:n),this.reverse=Boolean(r),this.containerId=i,this.surfaceId=s}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={path:{},startOffset:{},endOffset:{}};return n.path.get=function(){return this.start.path},n.startOffset.get=function(){return console.warn("DEPRECATED: Use sel.start.offset instead"),this.start.offset},n.endOffset.get=function(){return console.warn("DEPRECATED: Use sel.end.offset instead"),this.end.offset},e.prototype.toJSON=function(){return{type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset,reverse:this.reverse,containerId:this.containerId,surfaceId:this.surfaceId}},e.prototype.isPropertySelection=function(){return!0},e.prototype.getType=function(){return"property"},e.prototype.isNull=function(){return!1},e.prototype.isCollapsed=function(){return this.start.offset===this.end.offset},e.prototype.isReverse=function(){return this.reverse},e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&this.start.equals(e.start)&&this.end.equals(e.end)},e.prototype.toString=function(){return["PropertySelection(",JSON.stringify(this.path),", ",this.start.offset," -> ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},e.prototype.collapse=function(t){var e;return e="left"===t?this.start.offset:this.end.offset,this.createWithNewRange(e,e)},e.prototype.getPath=function(){return this.start.path},e.prototype.getNodeId=function(){return this.start.path[0]},e.prototype.isInsideOf=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.contains(this,e):e?Ut(this.path,t.path)&&this.start.offset>t.start.offset&&this.end.offset<t.end.offset:Ut(this.path,t.path)&&this.start.offset>=t.start.offset&&this.end.offset<=t.end.offset},e.prototype.contains=function(t,e){return t.isNull()?!1:t.isInsideOf(this,e)},e.prototype.overlaps=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.overlaps(this):Ut(this.path,t.path)?e?!(this.start.offset>=t.end.offset||this.end.offset<=t.start.offset):!(this.start.offset>t.end.offset||this.end.offset<t.start.offset):!1},e.prototype.isRightAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isRightAlignedWith(this):Ut(this.path,t.path)&&this.end.offset===t.end.offset},e.prototype.isLeftAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isLeftAlignedWith(this):Ut(this.path,t.path)&&this.start.offset===t.start.offset},e.prototype.expand=function(t){if(t.isNull())return this;if(t.isContainerSelection())return t.expand(this);if(!Ut(this.path,t.path))throw new Error("Can not expand PropertySelection to a different property.");var e=Math.min(this.start.offset,t.start.offset),n=Math.max(this.end.offset,t.end.offset);return this.createWithNewRange(e,n)},e.prototype.truncateWith=function(e){if(e.isNull())return this;if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;var n,o;if(e.isPropertySelection())n=e.start.offset,o=e.end.offset;else{if(!e.isContainerSelection())return this;n=Ut(e.start.path,this.start.path)?e.start.offset:this.start.offset,o=Ut(e.end.path,this.start.path)?e.end.offset:this.end.offset}var r,i;if(this.start.offset>n&&this.end.offset>o)r=o,i=this.end.offset;else if(this.start.offset<n&&this.end.offset<o)r=this.start.offset,i=n;else if(this.start.offset===n){if(this.end.offset<=o)return t.nullSelection;r=o,i=this.end.offset}else{if(this.end.offset!==o){if(e.contains(this))return t.nullSelection;throw new Error("Illegal state.")}if(this.start.offset>=n)return t.nullSelection;r=this.start.offset,i=n}return this.createWithNewRange(r,i)},e.prototype.createWithNewRange=function(t,n){var o=new e(this.path,t,n,!1,this.containerId,this.surfaceId),r=this._internal.doc;return r&&o.attach(r),o},e.prototype.getFragments=function(){if(this._internal.fragments)return this._internal.fragments;var e;return e=this.isCollapsed()?[new t.Cursor(this.path,this.start.offset)]:[new t.Fragment(this.path,this.start.offset,this.end.offset)],this._internal.fragments=e,e},e.prototype._clone=function(){return new e(this.start.path,this.start.offset,this.end.offset,this.reverse,this.containerId,this.surfaceId)},Object.defineProperties(e.prototype,n),e}(qh);Yh.fromJSON=function(t){return new Yh(t)};var Qh=function(t){function e(e,n,o,r,i,s,a){if(t.call(this),1===arguments.length){var p=arguments[0];e=p.containerId,n=p.startPath,o=p.startOffset,r=p.endPath,i=p.endOffset,s=p.reverse,a=p.surfaceId}if(this.containerId=e,!this.containerId)throw new Error("Invalid arguments: `containerId` is mandatory");this.start=new Wh(n,o),this.end=new Wh(m(r)?n:r,m(i)?o:i),this.reverse=Boolean(s),this.surfaceId=a}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={startPath:{},startOffset:{},endPath:{},endOffset:{},path:{}};return n.startPath.get=function(){return console.warn("DEPRECATED: use sel.start.path instead."),this.start.path},n.startOffset.get=function(){return console.warn("DEPRECATED: use sel.start.offset instead."),this.start.offset},n.endPath.get=function(){return console.warn("DEPRECATED: use sel.end.path instead."),this.end.path},n.endOffset.get=function(){return console.warn("DEPRECATED: use sel.end.offset instead."),this.end.offset},e.prototype.toJSON=function(){return{type:"container",containerId:this.containerId,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset,reverse:this.reverse,surfaceId:this.surfaceId}},e.prototype.isContainerSelection=function(){return!0},e.prototype.getType=function(){return"container"},e.prototype.isNull=function(){return!1},e.prototype.isCollapsed=function(){return this.start.equals(this.end)},e.prototype.isReverse=function(){return this.reverse},e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&this.containerId===e.containerId&&this.start.equals(e.start)&&this.end.equals(e.end)},e.prototype.toString=function(){return["ContainerSelection(",this.containerId,", ",JSON.stringify(this.start.path),", ",this.start.offset," -> ",JSON.stringify(this.end.path),", ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},e.prototype.getContainer=function(){return this._internal.container||(this._internal.container=this.getDocument().get(this.containerId)),this._internal.container},e.prototype.isInsideOf=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),o=this._range(t);return o.start.isBefore(n.start,e)&&n.end.isBefore(o.end,e)},e.prototype.contains=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),o=this._range(t);return n.start.isBefore(o.start,e)&&o.end.isBefore(n.end,e)},e.prototype.containsNode=function(t,e){var n=this.getContainer(),o=new Wh([t],0),r=n.getAddress(o),i=this._range(this),s=i.start.isBefore(r,e);return s&&(r.offset=1,s=i.end.isAfter(r,e)),s},e.prototype.overlaps=function(t){var e=this._range(this),n=this._range(t);return!(e.end.isBefore(n.start,!1)||n.end.isBefore(e.start,!1))},e.prototype.isLeftAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.start.isEqual(n.start)},e.prototype.isRightAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.end.isEqual(n.end)},e.prototype.collapse=function(t){var e;return e="left"===t?this.start:this.end,zt(this,e,e)},e.prototype.expand=function(t){var e,n,o=this._range(this),r=this._range(t);return e=o.start.isEqual(r.start)?new Wh(this.start.path,Math.min(this.start.offset,t.start.offset)):o.start.isAfter(r.start)?new Wh(t.start.path,t.start.offset):this.start,n=o.end.isEqual(r.end)?new Wh(this.end.path,Math.max(this.end.offset,t.end.offset)):o.end.isBefore(r.end,!1)?new Wh(t.end.path,t.end.offset):this.end,zt(this,e,n)},e.prototype.truncateWith=function(e){if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;var n,o,r=this._range(this),i=this._range(e);if(i.start.isBefore(r.start,"strict")&&i.end.isBefore(r.end,"strict"))n=e.end,o=this.end;else if(r.start.isBefore(i.start,"strict")&&r.end.isBefore(i.end,"strict"))n=this.start,o=e.start;else if(r.start.isEqual(i.start)){if(!i.end.isBefore(r.end,"strict"))return t.nullSelection;n=e.end,o=this.end}else{if(!r.end.isEqual(i.end)){if(this.isInsideOf(e))return t.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!r.start.isBefore(i.start,"strict"))return t.nullSelection;n=this.start,o=e.start}return zt(this,n,o)},e.prototype.getNodeIds=function(){var t=this.getContainer(),e=t.getPosition(this.start.path[0]),n=t.getPosition(this.end.path[0]);return t.nodes.slice(e,n+1)},e.prototype.getFragments=function(){if(console.warn("DEPRECATED: this implementation turned out to be too complicated and will be removed soon."),this._internal.fragments)return this._internal.fragments;var e,n,o,r,i,s,a,p=[],c=this.getDocument(),u=this.getContainer(),h=u.getPosition(this.start.path[0]),l=u.getPosition(this.end.path[0]);if(h!==l){if(e=this.start,i=e.path,s=e.offset,o=i[0],n=c.get(o),!n)throw new Error("Node does not exist:"+o);e.isPropertyCoordinate()?(a=c.get(i),r=new t.Fragment(i,s,a.length,0===s),p.push(r)):e.isNodeCoordinate()&&0===s&&p.push(new t.NodeFragment(n.id));for(var f=h+1;l>f;f++)n=u.getChildAt(f),n.isText()?(i=[n.id,"content"],a=c.get(i),p.push(new t.Fragment(i,0,a.length,!0))):p.push(new t.NodeFragment(u.nodes[f]));if(e=this.end,i=e.path,s=e.offset,o=i[0],n=c.get(o),!n)throw new Error("Node does not exist:"+o);e.isPropertyCoordinate()?(a=c.get(i),r=new t.Fragment(i,0,s,s===a.length),p.push(r)):e.isNodeCoordinate()&&s>0&&p.push(new t.NodeFragment(n.id))}else{i=this.start.path,o=i[0],n=c.get(o);var d=this.start.isNodeCoordinate(),g=this.end.isNodeCoordinate();n.isText()?d&&g&&this.start.offset<this.end.offset?p.push(new t.NodeFragment(o)):!d&&g&&this.end.offset>0?(a=c.get(this.start.path),p.push(new t.Fragment(i,this.start.offset,a.length,0===this.start.offset))):d&&!g&&0===this.start.offset?(a=c.get(this.end.path),p.push(new t.Fragment(i,0,this.end.offset,this.end.offset===a.length))):d||g||(a=c.get(this.start.path),p.push(new t.Fragment(i,this.start.offset,this.end.offset,0===this.start.offset&&this.end.offset===a.length))):p.push(new t.NodeFragment(o))}return this._internal.fragments=p,p},e.prototype.splitIntoPropertySelections=function(){var e=[],n=this.getFragments();return n.forEach(function(n){n instanceof t.Fragment&&e.push(new Yh(n.path,n.startOffset,n.endOffset,!1,this.containerId,this.surfaceId))}.bind(this)),e},e.prototype._clone=function(){return new e(this)},e.prototype._range=function(t){if(t._internal.addressRange)return t._internal.addressRange;var e,n=this.getContainer(),o=n.getAddress(t.start);e=t.isCollapsed()?o:n.getAddress(t.end);var r={start:o,end:e};return t._isContainerSelection&&(t._internal.addressRange=r),r},n.path.get=function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")},Object.defineProperties(e.prototype,n),e}(qh);Qh.prototype._isContainerSelection=!0,Qh.fromJSON=function(t){var e=new Qh(t);return e};var Zh=function(t){function e(e,n,o,r,i){if(t.call(this),1===arguments.length){var s=arguments[0];e=s.containerId,n=s.nodeId,o=s.mode,r=s.reverse,i=s.surfaceId}if(!_(e))throw new Error("'containerId' is mandatory.");if(!_(n))throw new Error("'nodeId' is mandatory.");o=o||"full",this.containerId=e,this.nodeId=n,this.mode=o,this.reverse=Boolean(r),this.surfaceId=i,this.start=new Wh([n],0),this.end=new Wh([n],1)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&this.nodeId===e.nodeId&&this.mode===e.mode},e.prototype.isNodeSelection=function(){return!0},e.prototype.getType=function(){return"node"},e.prototype.getNodeId=function(){return this.nodeId},e.prototype.isFull=function(){return"full"===this.mode},e.prototype.isBefore=function(){return"before"===this.mode},e.prototype.isAfter=function(){return"after"===this.mode},e.prototype.isCollapsed=function(){return"full"!==this.mode},e.prototype.toJSON=function(){return{type:"node",nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,containerId:this.containerId,surfaceId:this.surfaceId}},e.prototype.toString=function(){return["NodeSelection(",this.containerId,".",this.nodeId,", ",this.mode,", ",this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},e.prototype.collapse=function(t){if("left"===t)return this.isBefore()?this:new e(this.containerId,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===t)return this.isAfter()?this:new e(this.containerId,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'")},e.prototype._getCoordinate=function(){return"before"===this.mode?new Wh([this.nodeId],0):"after"===this.mode?new Wh([this.nodeId],1):void 0},e.prototype._clone=function(){return new e(this)},e}(qh);Zh.prototype._isNodeSelection=!0,Zh.fromJSON=function(t){return new Zh(t)},Zh._createFromCoordinate=function(t){var e=t.containerId,n=t.getNodeId(),o=0===t.offset?"before":"after";return new Zh(e,n,o,!1)};var tl=function(t){function e(e,n,o){if(t.call(this),1===arguments.length){var r=arguments[0];e=r.customType,n=r.data,o=r.surfaceId}this.customType=e,this.data=n||{},this.surfaceId=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isCustomSelection=function(){return!0},e.prototype.getType=function(){return"custom"},e.prototype.getCustomType=function(){return this.customType},e.prototype.toJSON=function(){return{type:"custom",customType:this.customType,data:f(this.data),surfaceId:this.surfaceId}},e.prototype.toString=function(){return["CustomSelection(",this.customType,", ",JSON.stringify(this.data),")"].join("")},e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&e.isCustomSelection()&&h(this.data,e.data)},e.prototype._clone=function(){return new e(this)},e}(qh);tl.prototype._isCustomSelection=!0,tl.fromJSON=function(t){return new tl(t)};var el=function(t,n,o){if(1===arguments.length&&e(arguments[0])){var r=arguments[0];this.sha=r.sha,this.timestamp=r.timestamp,this.before=r.before||{},this.ops=r.ops,this.info=r.info,this.after=r.after||{}}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=y(),this.info={},this.timestamp=Date.now(),this.ops=t.slice(0),this.before=n||{},this.after=o||{}}this.updated=null,this.created=null,this.deleted=null};el.prototype._extractInformation=function(e){function n(t){switch(t.type){case"create":case"delete":var n=t.val;n.hasOwnProperty("start")&&(s[n.start.path]=!0),n.hasOwnProperty("end")&&(s[n.end.path]=!0);break;case"update":case"set":var o=e.get(t.path[0]);o&&(o._isPropertyAnnotation?s[o.start.path]=!0:o._isContainerAnnotation&&a.push(o));break;default:throw new Error("Illegal state")}}for(var o=this.ops,r={},i={},s={},a=[],p=0;p<o.length;p++){var c=o[p];"create"===c.type&&(r[c.val.id]=c.val,delete i[c.val.id]),"delete"===c.type&&(delete r[c.val.id],i[c.val.id]=c.val),("set"===c.type||"update"===c.type)&&(s[c.path]=!0,s[c.path[0]]=!0),n(c)}a.forEach(function(t){for(var n=e.get(t.containerId,"strict"),o=n.getPosition(t.start.path[0]),r=n.getPosition(t.end.path[0]),a=o;r>=a;a++){var p,c=n.getChildAt(a);p=c.isText()?[c.id,"content"]:[c.id],i[c.id]||(s[p]=!0)}}),Object.keys(i).length>0&&t(s,function(t,e){var n=e.split(",")[0];i[n]&&delete s[e]}),this.created=r,this.deleted=i,this.updated=s},el.prototype.invert=function(){var t=this,e=this.toJSON();e.ops=[];var n=e.before;e.before=e.after,e.after=n;for(var o=el.fromJSON(e),r=[],i=this.ops.length-1;i>=0;i--)r.push(t.ops[i].invert());return o.ops=r,o},el.prototype.isAffected=function(t){return this.updated[t]},el.prototype.isUpdated=function(t){return this.isAffected(t)},el.prototype.serialize=function(){var t=new Uh,e=this.toJSON();return e.ops=this.ops.map(function(e){return t.serialize(e)}),JSON.stringify(e)},el.prototype.clone=function(){return el.fromJSON(this.toJSON())},el.prototype.toJSON=function(){var t={sha:this.sha,before:l(this.before),ops:p(this.ops,function(t){return t.toJSON()}),info:this.info,after:l(this.after)};t.after.selection=void 0,t.before.selection=void 0;var e=this.before.selection;return e&&e._isSelection&&(t.before.selection=e.toJSON()),e=this.after.selection,e&&e._isSelection&&(t.after.selection=e.toJSON()),t},el.deserialize=function(t){var e=new Uh,n=JSON.parse(t);return n.ops=n.ops.map(function(t){return e.deserialize(t)}),n.before.selection&&(n.before.selection=Jt(n.before.selection)),n.after.selection&&(n.after.selection=Jt(n.after.selection)),new el(n)},el.fromJSON=function(t){var e=f(t);return e.ops=t.ops.map(function(t){return Mh.fromJSON(t)}),e.before.selection=Jt(t.before.selection),e.after.selection=Jt(t.after.selection),new el(e)},el.transformInplace=function(t,e){te(t,e)},el.transformSelection=function(t,e){var n=t.clone(),o=ee(n,e);return o?n:t};var nl=function(t,e){this.message=t,this.ws=e,this.isAuthenticated=!1,this.isAuhorized=!1};nl.prototype.setAuthenticated=function(t){this.isAuthenticated=!0,this.session=t},nl.prototype.setAuthorized=function(t){this.isAuthorized=!0,this.authorizationData=t},nl.prototype.setEnhanced=function(){this.isEnhanced=!0};var ol=function(){this.isReady=!1,this.isEnhanced=!1,this.isSent=!1,this.err=null,this.data=null};ol.prototype.error=function(t){this.err=t,this.isReady=!0},ol.prototype.send=function(t){this.data=t,this.isReady=!0},ol.prototype.setEnhanced=function(){this.isEnhanced=!0},ol.prototype.setSent=function(){this.isSent=!0};var rl=function(){};rl.prototype.add=function(t,e){this[t]||(this[t]=[]),this[t].push(e)},rl.prototype.remove=function(t,e){this[t]&&oe(this[t],e)};var il=function(t){this.editorSession=t,this._textProperties={},this._dirtyProps={},this._markers=new sl(t),t.onUpdate(this._onChange,this),t.onRender(this._updateProperties,this)};il.prototype.dispose=function(){this.editorSession.off(this),this._markers.dispose()},il.prototype.register=function(t){var e=String(t.getPath()),n=this._textProperties[e];n||(n=this._textProperties[e]=[]),n.push(t)},il.prototype.deregister=function(t){var e=String(t.getPath()),n=this._textProperties[e];n&&(oe(this._textProperties[e],t),0===n.length&&delete this._textProperties[e])},il.prototype.getMarkers=function(t,e){e=e||{};var n=this.editorSession.getDocument(),o=n.getAnnotations(t)||[],r=this._markers.get(t,e.surfaceId,e.containerId);return o.concat(r)},il.prototype._onChange=function(e){
var n=this;if(e.hasDocumentChanged()){if(e.hasDocumentChanged()){var o=e.getChange();t(o.updated,function(t,e){n._dirtyProps[e]=!0})}Object.assign(this._dirtyProps,this._markers._collectDirtyProps())}},il.prototype._updateProperties=function(){var t=this;Object.keys(this._dirtyProps).forEach(function(e){var n=t._textProperties[e];n&&n.forEach(t._updateTextProperty.bind(t))}),this._dirtyProps={}},il.prototype._updateTextProperty=function(t){var e=t.getPath(),n=this.getMarkers(e,{surfaceId:t.getSurfaceId(),containerId:t.getContainerId()});t.setState({markers:n})};var sl=function(t){this.editorSession=t,this.document=t.getDocument(),this._documentMarkers=new rl,this._surfaceMarkers={},this._containerMarkers={},this._dirtyProps={},this.document.addIndex("markers",this),t.onUpdate("document",this._onDocumentChange,this)};sl.prototype.dispose=function(){delete this.document.data.indexes.markers,this.editorSession.off(this)},sl.prototype.reset=function(){var e=this;this._documentMarkers=new rl,this._surfaceMarkers={},this._containerMarkers={};var n=this.document;t(n.getNodes(),function(t){e.select(t)&&e.create(t)})},sl.prototype.select=function(t){return t._isMarker},sl.prototype.create=function(t){switch(t.constructor.scope){case"document":this._dirtyProps[t.path]=!0,this._documentMarkers.add(t.path,t);break;case"surface":this._surfaceMarkers[t.surfaceId]||(this._surfaceMarkers[t.surfaceId]=new rl),this._dirtyProps[t.path]=!0,this._surfaceMarkers[t.surfaceId].add(t.path,t);break;case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}},sl.prototype["delete"]=function(t){switch(t.constructor.scope){case"document":this._dirtyProps[t.path]=!0,this._documentMarkers.remove(t.path,t);break;case"surface":this._surfaceMarkers[t.surfaceId]||(this._surfaceMarkers[t.surfaceId]=new rl),this._dirtyProps[t.path]=!0,this._surfaceMarkers[t.surfaceId].remove(t.path,t);break;case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}},sl.prototype.get=function(t,e){var n=this._documentMarkers[t]||[];if(e&&this._surfaceMarkers[e]){var o=this._surfaceMarkers[e][t];o&&(n=n.concat(o))}return n},sl.prototype._collectDirtyProps=function(){var t=this._dirtyProps;return this._dirtyProps={},t},sl.prototype._getAllCustomMarkers=function(t){var e=this,n=this._documentMarkers[t]||[];for(var o in e._surfaceMarkers)if(e._surfaceMarkers.hasOwnProperty(o)){var r=e._surfaceMarkers[o][t];r&&(n=n.concat(r))}return n},sl.prototype._onDocumentChange=function(t){var e=this,n=this.doc;t.ops.forEach(function(t){var o=e._getAllCustomMarkers(t.path);if("update"===t.type&&t.diff._isTextOperation){var r=t.diff;switch(r.type){case"insert":e._transformInsert(n,o,r);break;case"delete":e._transformDelete(n,o,r)}}})},sl.prototype._transformInsert=function(t,e,n){var o=n.pos,r=n.str.length;0!==r&&e.forEach(function(t){var e=t.start.offset,n=t.end.offset,i=e,s=n;return o>=n?void 0:e>=o?(i+=r,s+=r,t.start.offset=i,void(t.end.offset=s)):void(n>o&&(s+=r,t.end.offset=s,t.invalidate&&t.invalidate()))})},sl.prototype._transformDelete=function(t,e,n){var o=n.pos,r=n.str.length,i=o+r;o!==i&&e.forEach(function(t){var e=t.start.offset,n=t.end.offset,s=e,a=n;if(e>=i)s-=r,a-=r,t.start.offset=s,t.end.offset=a;else if(o>=n);else{if(e>=o&&(s=e-Math.min(i-o,e-o)),n>=o&&(a=n-Math.min(i-o,n-o)),e!==n&&s===a)return void t.remove();e!==s&&(t.start.offset=s),n!==a&&(t.end.offset=a),t.invalidate&&t.invalidate()}})};var al=function(){},pl=function(){};pl.prototype.get=function(t){return arguments.length>1&&(t=Array.prototype.slice(arguments,0)),_(t)&&(t=[t]),st(this,t)},pl.prototype.getAll=function(t){if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),_(t)&&(t=[t]),!u(t))throw new Error("Illegal argument for TreeIndex.get()");var e=st(this,t);return this._collectValues(e)},pl.prototype.set=function(t,e){_(t)&&(t=[t]),ut(this,t,e,function(t){return t?void 0:new al})},pl.prototype["delete"]=function(t){if(_(t))delete this[t];else if(1===t.length)delete this[t[0]];else{var e=t[t.length-1];t=t.slice(0,-1);var n=st(this,t);n&&delete n[e]}},pl.prototype.clear=function(){var t=this;for(var e in t)t.hasOwnProperty(e)&&delete t[e]},pl.prototype.traverse=function(t){this._traverse(this,[],t)},pl.prototype.forEach=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];(n=this).traverse.apply(n,t);var n},pl.prototype._traverse=function(t,e,n){var o,r=this;for(o in t)if(t.hasOwnProperty(o)){var i=t[o],s=e.concat([o]);i instanceof al?r._traverse(i,s,n):n(i,s)}},pl.prototype._collectValues=function(t){var e={};return this._traverse(t,[],function(t,n){var o=n[n.length-1];e[o]=t}),e};var cl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(e){var n=t.prototype.get.call(this,e);return Boolean(n)},e.prototype.get=function(e){var n=t.prototype.get.call(this,e);return n instanceof al&&(n=n.__values__||[]),n},e.prototype.set=function(e,n){var o=t.prototype.get.call(this,e);o.__values__=n},e.prototype.add=function(t,e){if(_(t)&&(t=[t]),!u(t))throw new Error("Illegal arguments.");var n;ut(this,t.concat(["__values__","__dummy__"]),void 0,function(t,e){return"__values__"===e?(t||(t=[]),n=t):t||(t=new al),t}),delete n.__dummy__,n.push(e)},e.prototype.remove=function(t,e){var n=st(this,t);n instanceof al&&(1===arguments.length?delete n.__values__:oe(n.__values__,e))},e.prototype._collectValues=function(t){var e=[];return this._traverse(t,[],function(t){e.push(t)}),e=Array.prototype.concat.apply([],e)},e}(pl);pl.Arrays=cl;var ul=function(){};ul.prototype.select=function(t){throw new Error("This method is abstract.")},ul.prototype.create=function(t){throw new Error("This method is abstract.")},ul.prototype["delete"]=function(t){throw new Error("This method is abstract.")},ul.prototype.set=function(t,e,n,o){this.update(t,e,n,o)},ul.prototype.update=function(t,e,n,o){throw new Error("This method is abstract.")},ul.prototype.reset=function(t){this._clear(),this._initialize(t)},ul.prototype.clone=function rO(){var t=this.constructor,rO=new t;return rO},ul.prototype._clear=function(){throw new Error("This method is abstract")},ul.prototype._initialize=function(e){t(e.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))},ul.create=function(t){var e=Object.assign(new ul,t);return e.clone=function(){return ul.create(t)},e},ul.filterByType=function(t){return function(e){return e.isInstanceOf(t)}};var hl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ul),ll={insertedText:ae,deletedText:pe,transferAnnotations:ce,expandAnnotation:he,fuseAnnotation:le,truncateAnnotation:ue},fl={isContainerAnnotation:fe,getPropertyAnnotationsForSelection:de,getContainerAnnotationsForSelection:ge,getAnnotationsForSelection:ye,getTextForSelection:ve,getMarkersForSelection:me,getChangeFromDocument:_e,copyNode:be,deleteNode:we,deleteTextRange:Ce,deleteListRange:Se,mergeListItems:xe},dl=function(t){this.document=t,this.selection=qh.nullSelection,this._state={},this._resetState()};dl.prototype.setSelection=function(t){return t?t.attach(this.document):t=qh.nullSelection,this._deriveState(t),this.selection=t,!0},dl.prototype.getSelection=function(){return this.selection},dl.prototype.getAnnotationsForType=function(t){var e=this._state;return e.annosByType?e.annosByType.get(t)||[]:[]},dl.prototype.getMarkers=function(){return this._state.markers||[]},dl.prototype.isInlineNodeSelection=function(){return this._state.isInlineNodeSelection},dl.prototype.getContainer=function(){return this._state.container},dl.prototype.getPreviousNode=function(){return this._state.previousNode},dl.prototype.getNextNode=function(){return this._state.nextNode},dl.prototype.isFirst=function(){return Boolean(this._state.isFirst)},dl.prototype.isLast=function(){return Boolean(this._state.isLast)},dl.prototype.get=function(t){return this._state[t]},dl.prototype.set=function(t,e){if(this._state[t])throw new Error("State "+t+" is already set");this._state[t]=e},dl.prototype._deriveState=function(t){this._resetState(),this._deriveContainerSelectionState(t),this._deriveAnnoState(t),this.document.getIndex("markers")&&this._deriveMarkerState(t)},dl.prototype._deriveContainerSelectionState=function(t){var e=this._state,n=this.document;if(t.containerId){var o=n.get(t.containerId);e.container=o;var r=t.start.getNodeId(),i=t.end.getNodeId(),s=n.get(r).getRoot(),a=o.getPosition(s);a>0&&(e.previousNode=o.getNodeAt(a-1)),e.isFirst=qt(n,t.start);var p,c;i===r?(p=s,c=a):(p=n.get(i).getRoot(),c=o.getPosition(p)),c<o.getLength()-1&&(e.nextNode=o.getNodeAt(c+1)),e.isLast=Vt(n,t.end)}},dl.prototype._deriveAnnoState=function(t){var e=this.document,n=this._state,o=new pl.Arrays,r=fl.getPropertyAnnotationsForSelection(e,t);r.forEach(function(t){o.add(t.type,t)}),1===r.length&&r[0].isInline()&&(n.isInlineNodeSelection=r[0].getSelection().equals(t));var i=t.containerId;if(i){var s=fl.getContainerAnnotationsForSelection(e,t,i);s.forEach(function(t){o.add(t.type,t)})}n.annosByType=o},dl.prototype._deriveMarkerState=function(t){var e=this.document,n=this._state,o=fl.getMarkersForSelection(e,t);n.markers=o},dl.prototype._resetState=function(){return this._state={annosByType:null,markers:null,isInlineNodeSelection:!1,container:null,previousNode:null,nextNode:null,isFirst:!1,isLast:!1},this._state};var gl=function(){this.doneChanges=[],this.undoneChanges=[],this.lastChange=null};gl.prototype.canUndo=function(){return this.doneChanges.length>0},gl.prototype.canRedo=function(){return this.undoneChanges.length>0},gl.prototype.push=function(t){this.doneChanges.push(t),this.undoneChanges=[]};var yl=function(t){this.editorSession=t,this.surfaces={},this._state={focusedSurfaceId:null,selection:null},t.onUpdate("selection",this._onSelectionChanged,this),t.onPostRender(this._recoverDOMSelection,this)};yl.prototype.dispose=function(){this.editorSession.off(this)},yl.prototype.getSurface=function(t){return t?this.surfaces[t]:void 0},yl.prototype.getFocusedSurface=function(){return this._state.focusedSurfaceId?this.getSurface(this._state.focusedSurfaceId):void 0},yl.prototype.getSurfaces=function(){var t=this;return Object.keys(this.surfaces).map(function(e){return t.surfaces[e]})},yl.prototype.registerSurface=function(t){this.surfaces[t.getId()]=t},yl.prototype.unregisterSurface=function(t){t.off(this);var e=t.getId(),n=this.surfaces[e];if(n===t){var o=this.getFocusedSurface();delete this.surfaces[e],t&&o===t&&(this._state.focusedSurfaceId=null)}},yl.prototype._onSelectionChanged=function(t){var e=this._state;e.selection=t,e.focusedSurfaceId=t.surfaceId,t&&t.isCustomSelection()&&wu&&(window.getSelection().removeAllRanges(),window.document.activeElement.blur())},yl.prototype._recoverDOMSelection=function(){var t=this.getFocusedSurface();t&&!t.isDisabled()&&(t.focus(),t.rerenderDOMSelection())};var vl=function(e){function n(t){e.call(this),this._property=t||"id",this.index=new pl}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.get=function(t){return this.index.get(t)||{}},n.prototype.getAll=function(t){return this.index.getAll(t)},n.prototype.select=function(t){return!0},n.prototype.create=function(e){var n=e[this._property];u(n)||(n=[n]),t(n,function(t){this.index.set([t,e.id],e)}.bind(this))},n.prototype["delete"]=function(e){var n=e[this._property];u(n)||(n=[n]),t(n,function(t){this.index["delete"]([t,e.id])}.bind(this))},n.prototype.update=function(e,n,o,r){if(this.select(e)&&n[1]===this._property){var i=r;u(i)||(i=[i]),t(i,function(t){this.index["delete"]([t,e.id])}.bind(this)),i=o,u(i)||(i=[i]),t(i,function(t){this.index.set([t,e.id],e)}.bind(this))}},n.prototype.set=function(t,e,n,o){this.update(t,e,n,o)},n.prototype._clear=function(){this.index.clear()},n.prototype._initialize=function(e){t(e.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))},n}(ul),ml=function(t){function e(){t.call(this),this.byPath=new pl,this.byType=new pl}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.select=function(t){return Boolean(t._isPropertyAnnotation)},e.prototype.reset=function(t){this.byPath.clear(),this.byType.clear(),this._initialize(t)},e.prototype.get=function(n,o,r,i){var s;return s=_(n)||1===n.length?this.byPath.getAll(n)||{}:this.byPath.get(n),s=p(s),v(o)&&(s=ie(s,e.filterByRange(o,r))),i&&(s=ie(s,t.filterByType(i))),s},e.prototype.create=function(t){this.byType.set([t.type,t.id],t),this.byPath.set(t.start.path.concat([t.id]),t)},e.prototype["delete"]=function(t){this._delete(t.type,t.id,t.start.path)},e.prototype._delete=function(t,e,n){this.byType["delete"]([t,e]),this.byPath["delete"](n.concat([e]))},e.prototype.update=function(t,e,n,o){this.select(t)&&"start"===e[1]&&"path"===e[2]&&(this._delete(t.type,t.id,o),this.create(t))},e}(hl);ml.filterByRange=function(t,e){return function(n){var o=n.start.offset,r=n.end.offset,i=r>=t;return v(e)&&(i=i&&e>=o),i}};var _l=function(t){function e(){t.call(this),this.byId=new pl}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.select=function(t){return Boolean(t._isContainerAnnotation)},e.prototype.reset=function(t){this.byId.clear(),this._initialize(t)},e.prototype.get=function(e,n){var o=p(this.byId.get(e));return _(n)&&(o=ie(o,t.filterByType)),o},e.prototype.create=function(t){this.byId.set([t.containerId,t.id],t)},e.prototype["delete"]=function(t){this.byId["delete"]([t.containerId,t.id])},e.prototype.update=function(t,e,n,o){},e}(hl),wl=function(t){this.listeners=new pl.Arrays,this._list=[],this.doc=t};wl.prototype.on=function(t,e,n){this._add(n,t,e)},wl.prototype.off=function(t,e,n){this._remove(t,e,n)},wl.prototype.connect=function(t,e,n){console.warn("DEPRECATED: use proxy.on(path, this.onPropertyChange, this) instead"),this.on(e,n,t)},wl.prototype.disconnect=function(t){console.warn("DEPRECATED: use proxy.off(this) instead"),this.off(t)},wl.prototype.onDocumentChanged=function(e,n,o){if(0!==this._list.length){var r=this.listeners;t(e.updated,function(i,s){var a=r.get(s.split(","));u(a)&&(a=a.slice(0)),t(a,function(t){t.method.call(t.listener,e,n,o)})})}},wl.prototype._add=function(t,e,n){if(!n)throw new Error("Invalid argument: expected function but got "+n);var o={listener:t,path:e,method:n};this.listeners.add(e,o),this._list.push(o)},wl.prototype._remove=function(t,e,n){for(var o=this,r=0;r<this._list.length;r++){var i=o._list[r],s=(!e||h(i.path,e))&&(!t||i.listener===t)&&(!n||i.method!==n);if(s){var a=o._list[r];o._list.splice(r,1),o.listeners.remove(a.path,a)}}};var bl=function(t){this.nodeRegistry=t};bl.prototype.create=function(t,e){var n=this.nodeRegistry.get(t);if(!n)throw new Error("No Node registered by that name: "+t);return new n(e)};var Cl=function(e){function n(t,n){e.call(this),n=n||{},this.schema=t,this.nodes={},this.indexes={},this.options=n||{},this.nodeFactory=n.nodeFactory||new bl(t.nodeRegistry),this.__QUEUE_INDEXING__=!1,this.queue=[]}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.contains=function(t){return Boolean(this.nodes[t])},n.prototype.get=function(t,e){var n=this._get(t);if(e&&void 0===n)throw _(t)?new Error("Could not find node with id '"+t+"'."):this.contains(t[0])?new Error("Property for path '"+t+"' us undefined."):new Error("Could not find node with id '"+t[0]+"'.");return n},n.prototype._get=function(t){if(t){var e;if(_(t))e=this.nodes[t];else if(1===t.length)e=this.nodes[t[0]];else if(t.length>1){for(var n=this.nodes[t[0]],o=1;o<t.length-1;o++){if(!n)return;n=n[t[o]]}if(!n)return;e=n[t[t.length-1]]}return e}},n.prototype.getNodes=function(){return this.nodes},n.prototype.create=function(t){var e=this.nodeFactory.create(t.type,t);if(!e)throw new Error("Illegal argument: could not create node for data:",t);if(this.contains(e.id))throw new Error("Node already exists: "+e.id);if(!e.id||!e.type)throw new Error("Node id and type are mandatory.");this.nodes[e.id]=e;var n={type:"create",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e},n.prototype["delete"]=function(t){var e=this.nodes[t];if(e){e.dispose(),delete this.nodes[t];var n={type:"delete",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e}},n.prototype.set=function(t,e){var n=this.get(t[0]),o=this._set(t,e),r={type:"set",node:n,path:t,newValue:e,oldValue:o};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),o},n.prototype._set=function(t,e){var n;if(2===t.length)n=this.nodes[t[0]][t[1]],this.nodes[t[0]][t[1]]=e;else{if(3!==t.length)throw new Error("Path of length "+t.length+" not supported.");n=this.nodes[t[0]][t[1]][t[2]],this.nodes[t[0]][t[1]][t[2]]=e}return n},n.prototype.update=function(t,e){var n=this.getRealPath(t);if(!n)return void console.error("Could not resolve path",t);var o,r=this.get(n[0]),i=this._get(n);if(e.isOperation)o=e.apply(i);else if(e=this._normalizeDiff(i,e),_(i))switch(e.type){case"delete":o=i.split("").splice(e.start,e.end-e.start).join("");break;case"insert":o=[i.substring(0,e.start),e.text,i.substring(e.start)].join("");break;default:throw new Error("Unknown diff type")}else if(u(i))switch(o=i.slice(0),e.type){case"delete":o.splice(e.pos,1);break;case"insert":o.splice(e.pos,0,e.value);break;default:throw new Error("Unknown diff type")}else{if(!i._isCoordinate)throw new Error("Diff is not supported:",JSON.stringify(e));switch(e.type){case"shift":i={path:i.path,offset:i.offset},o=i,o.offset+=e.value;break;default:throw new Error("Unknown diff type")}}this._set(n,o);var s={type:"update",node:r,path:n,newValue:o,oldValue:i};return this.__QUEUE_INDEXING__?this.queue.push(s):this._updateIndexes(s),i},n.prototype._normalizeDiff=function(t,e){return _(t)?e["delete"]?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", start:s, end: e}) instead'),e={type:"delete",start:e["delete"].start,end:e["delete"].end}):e.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", start:s, text: t}) instead'),e={type:"insert",start:e.insert.offset,text:e.insert.value}):u(t)?e["delete"]?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", pos:1}) instead'),e={type:"delete",pos:e["delete"].offset}):e.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", pos:1, value: "foo"}) instead'),e={type:"insert",pos:e.insert.offset,value:e.insert.value}):t._isCoordinate&&e.hasOwnProperty("shift")&&(console.warn('DEPRECATED: use doc.update(path, {type:"shift", value:2}) instead'),e={type:"shift",value:e.shift}),e},n.prototype.toJSON=function(){var e={};return t(this.nodes,function(t){e[t.id]=t.toJSON()}),{schema:[this.schema.id,this.schema.version],nodes:e}},n.prototype.reset=function(){this.nodes.clear()},n.prototype.addIndex=function(t,e){return this.indexes[t]&&console.error("Index with name %s already exists.",t),e.reset(this),this.indexes[t]=e,e},n.prototype.getIndex=function(t){return this.indexes[t]},n.prototype._updateIndexes=function(e){e&&!this.__QUEUE_INDEXING__&&t(this.indexes,function(t){t.select(e.node)&&(t[e.type]||console.error("Contract: every NodeIndex must implement "+e.type),t[e.type](e.node,e.path,e.newValue,e.oldValue))})},n.prototype._stopIndexing=function(){this.__QUEUE_INDEXING__=!0},n.prototype._startIndexing=function(){var t=this;for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var e=t.queue.shift();t._updateIndexes(e)}},n}(vu),Sl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.create=function(t){t._isNode&&(t=t.toJSON());var e=Mh.Create([t.id],t);return this.apply(e),e},e.prototype["delete"]=function(t){var e=null,n=this.get(t);if(n){var o=n.toJSON();e=Mh.Delete([t],o),this.apply(e)}return e},e.prototype.update=function(t,e){var n=this._getDiffOp(t,e),o=Mh.Update(t,n);return this.apply(o),o},e.prototype.set=function(t,e){var n=this.get(t),o=Mh.Set(t,n,e);return this.apply(o),o},e.prototype.apply=function(e){if(e.type!==Mh.NOP){if(e.type===Mh.CREATE)t.prototype.create.call(this,f(e.val));else if(e.type===Mh.DELETE)t.prototype["delete"].call(this,e.val.id);else if(e.type===Mh.UPDATE){var n=this.get(e.path),o=e.diff;if("array"===e.propertyType)o._isArrayOperation||(o=xh.fromJSON(o)),o.apply(n);else if("string"===e.propertyType){o._isTextOperation||(o=wh.fromJSON(o));var r=o.apply(n);t.prototype.set.call(this,e.path,r)}else{if("coordinate"!==e.propertyType)throw new Error("Unsupported type for operational update.");o._isCoordinateOperation||(o=Ih.fromJSON(o)),o.apply(n)}}else{if(e.type!==Mh.SET)throw new Error("Illegal state.");t.prototype.set.call(this,e.path,e.val)}this.emit("operation:applied",e,this)}},e.prototype._getDiffOp=function(t,e){var n=null;if(e.isOperation)n=e;else{var o=this.get(t);if(e=this._normalizeDiff(o,e),null===o||void 0===o)throw new Error("Property has not been initialized: "+JSON.stringify(t));if(_(o))switch(e.type){case"delete":n=wh.Delete(e.start,o.substring(e.start,e.end));break;case"insert":n=wh.Insert(e.start,e.text);break;default:throw new Error("Unknown diff type")}else if(u(o))switch(e.type){case"delete":n=xh.Delete(e.pos,o[e.pos]);break;case"insert":n=xh.Insert(e.pos,e.value);break;default:throw new Error("Unknown diff type")}else if(o._isCoordinate)switch(e.type){case"shift":n=Ih.Shift(e.value);break;default:throw new Error("Unknown diff type")}}if(!n)throw new Error("Unsupported diff: "+JSON.stringify(e));return n},e}(Cl),xl=function(t){this.doc=t};xl.prototype.create=function(t,e){var n=this.doc.schema.getNodeClass(t);if(!n)throw new Error("No node registered by that name: "+t);return new n(this.doc,e)};var El=function(t,e,n,o,r){if("SKIP"!==arguments[0])if(1===arguments.length&&c(arguments[0])){var i=arguments[0];this.start=i.start,this.end=i.end,this.reverse=Boolean(i.reverse),this.containerId=i.containerId,this.surfaceId=i.surfaceId}else this.start=t,this.end=e,this.reverse=Boolean(n),this.containerId=o,this.surfaceId=r};El.prototype.isCollapsed=function(){return this.start.equals(this.end)},El.prototype.equals=function(t){return this===t?!0:this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},El.prototype.isReverse=function(){return this.reverse},El.prototype.toString=function(){var t=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&t.push("[reverse]"),this.containerId&&t.push("[container="+this.containerId+"]"),this.surfaceId&&t.push("[surface="+this.surfaceId+"]"),t.join("")},El.prototype._isRange=!0;var Nl=function(){};Nl.prototype.importDocument=function(e,n){if(!n.nodes)throw new Error("Invalid JSON format.");var o=e.getSchema();if(n.schema&&o.name!==n.schema.name)throw new Error("Incompatible schema.");var r=n.nodes;return e["import"](function(e){t(r,function(t){e.get(t.id)&&e["delete"](t.id),e.create(t)})}),e},Nl.prototype.exportDocument=function(e){var n=e.getSchema(),o={schema:{name:n.name},nodes:{}};return t(e.getNodes(),function(t){t._isDocumentNode&&(o.nodes[t.id]=t.toJSON())}),o};var Il=function(t){this.doc=t,this.table={},t.data.on("operation:applied",this._onOperationApplied,this)};Il.prototype._onOperationApplied=function(t){function e(t,e){function n(e){r[e]=t;var n=o.get(e);n&&(n.parent=t)}e&&(u(e)?e.forEach(n):n(e))}function n(t){var e=r[t.id];e&&(t.parent=e)}var o=this.doc,r=this.table,i=o.get(t.path[0]);switch(t.type){case"create":switch(i.type){case"list":e(i,i.items);break;case"list-item":n(i);break;case"table":e(i,i.cells);break;case"table-cell":n(i)}break;case"update":var s=t.diff;switch(i.type){case"list":"items"===t.path[1]&&s.isInsert()&&e(i,s.getValue());break;case"table":"cells"===t.path[1]&&s.isInsert()&&e(i,s.getValue())}break;case"set":switch(i.type){case"list":"items"===t.path[1]&&e(i,t.getValue());break;case"table":"cells"===t.path[1]&&e(i,t.getValue())}}},Il.register=function(t){return new Il(t)};var Ol=new Nl,Tl=function(e){function n(t){if(e.call(this),"SKIP"!==arguments[0]){if(this.__id__=y(),!t)throw new Error("A document needs a schema for reflection.");this.schema=t,this.nodeFactory=new xl(this),this.data=new Sl(t,{nodeFactory:this.nodeFactory}),this.addIndex("type",new vl("type")),this.addIndex("annotations",new ml),this.addIndex("container-annotations",new _l),this.eventProxies={path:new wl(this)},this.on("document:changed",this._updateEventProxies,this),Il.register(this)}}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var o={id:{}};return o.id.get=function(){return this.__id__},n.prototype.getSchema=function(){return this.schema},n.prototype.contains=function(t){return this.data.contains(t)},n.prototype.get=function(t,e){return this.data.get(t,e)},n.prototype.getNodes=function(){return this.data.getNodes()},n.prototype["import"]=function(t){try{this.data._stopIndexing(),t(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}},n.prototype.create=function(t){t.id||(t.id=y(t.type));var e=this._create(t),n=new el([e],{},{});return n._extractInformation(this),this._notifyChangeListeners(n,{hidden:!0}),this.data.get(t.id)},n.prototype["delete"]=function(t){var e=this.get(t),n=this._delete(t),o=new el([n],{},{});return o._extractInformation(this),this._notifyChangeListeners(o,{hidden:!0}),e},n.prototype.set=function(t,e){var n=this.get(t),o=this._set(t,e),r=new el([o],{},{});return r._extractInformation(this),this._notifyChangeListeners(r,{hidden:!0}),n},n.prototype.update=function(t,e){var n=this._update(t,e),o=new el([n],{},{});return o._extractInformation(this),this._notifyChangeListeners(o,{hidden:!0}),n},n.prototype.addIndex=function(t,e){return this.data.addIndex(t,e)},n.prototype.getIndex=function(t){return this.data.getIndex(t)},n.prototype.createSelection=function(t){var e;if(m(t))return qh.nullSelection;if(1===arguments.length&&c(t))switch(t.type){case"property":if(m(t.endOffset)&&(t.endOffset=t.startOffset),!t.hasOwnProperty("reverse")&&t.startOffset>t.endOffset){var n;n=[t.endOffset,t.startOffset],t.startOffset=n[0],t.endOffset=n[1],t.reverse=!t.reverse}var o=this.get(t.path,"strict");if(t.startOffset<0||t.startOffset>o.length)throw new Error("Invalid startOffset: target property has length "+o.length+", given startOffset is "+t.startOffset);if(t.endOffset<0||t.endOffset>o.length)throw new Error("Invalid startOffset: target property has length "+o.length+", given endOffset is "+t.endOffset);e=new Yh(t);break;case"container":var r=this.get(t.containerId,"strict");if(!r)throw new Error('Can not create ContainerSelection: container "'+t.containerId+'" does not exist.');var i=this._normalizeCoor({path:t.startPath,offset:t.startOffset}),s=this._normalizeCoor({path:t.endPath,offset:t.endOffset}),a=r.getAddress(i),p=r.getAddress(s);if(!a)throw new Error("Invalid arguments for ContainerSelection: ",i.toString());if(!p)throw new Error("Invalid arguments for ContainerSelection: ",s.toString());if(!t.hasOwnProperty("reverse")&&p.isBefore(a,"strict")){var u;u=[s,i],i=u[0],s=u[1],t.reverse=!0}e=new Qh(r.id,i.path,i.offset,s.path,s.offset,t.reverse,t.surfaceId);break;case"node":e=Yt({doc:this,nodeId:t.nodeId,mode:t.mode,containerId:t.containerId,reverse:t.reverse,surfaceId:t.surfaceId});break;case"custom":e=tl.fromJSON(t);break;default:throw new Error("Illegal selection type",t)}else e=Ee(this,arguments);return e.isNull()||e.attach(this),e},n.prototype.getEventProxy=function(t){return this.eventProxies[t]},n.prototype.newInstance=function(){var t=this.constructor;return new t(this.schema)},n.prototype.createSnippet=function(){var t=this.newInstance(),e=t.create({type:"container",id:n.SNIPPET_ID});return t.getContainer=function(){return e},t.show=function(){e.show.apply(e,arguments)},t},n.prototype.fromSnapshot=function(t){var e=this.newInstance();return e.loadSeed(t),e},n.prototype.getDocumentMeta=function(){return this.get("document")},n.prototype._apply=function(e){t(e.ops,function(t){this.data.apply(t),this.emit("operation:applied",t)}.bind(this)),e._extractInformation(this)},n.prototype._notifyChangeListeners=function(t,e){e=e||{},this.emit("document:changed",t,e,this)},n.prototype._updateEventProxies=function(e,n){t(this.eventProxies,function(t){t.onDocumentChanged(e,n,this)}.bind(this))},n.prototype.loadSeed=function(e){t(this.data.nodes,function(t){this["delete"](t.id)}.bind(this)),t(e.nodes,function(t){this.create(t)}.bind(this))},n.prototype.toJSON=function(){return Ol.exportDocument(this)},n.prototype.getTextForSelection=function(t){return console.warn("DEPRECATED: use documentHelpers.getTextForSelection() instead."),fl.getTextForSelection(this,t)},n.prototype.setText=function(t,e,n){var o,r=this,i=this.getIndex("annotations").get(t);for(o=0;o<i.length;o++)r["delete"](i[o].id);for(this.set(t,e),o=0;o<n.length;o++)r.create(n[o])},n.prototype.getAnnotations=function(t){return this.getIndex("annotations").get(t)},n.prototype._create=function(t){var e=this.data.create(t);return e},n.prototype._delete=function(t){var e=this.data["delete"](t);return e},n.prototype._update=function(t,e){var n=this.data.update(t,e);return n},n.prototype._set=function(t,e){var n=this.data.set(t,e);return n},n.prototype._createSelectionFromRange=function(t){if(!t)return qh.nullSelection;var e=h(t.start.path,t.end.path);return e?t.start.isNodeCoordinate()?new Zh(t.containerId,t.start.getNodeId(),"full",t.reverse,t.surfaceId):this.createSelection({type:"property",path:t.start.path,startOffset:t.start.offset,endOffset:t.end.offset,reverse:t.reverse,containerId:t.containerId,surfaceId:t.surfaceId}):this.createSelection({type:"container",startPath:t.start.path,startOffset:t.start.offset,endPath:t.end.path,endOffset:t.end.offset,reverse:t.reverse,containerId:t.containerId,surfaceId:t.surfaceId})},n.prototype._normalizeCoor=function(t){var e=t.path,n=t.offset;if(1===e.length){var o=this.get(e[0]).getRoot();if(o.isText())return new Wh(o.getTextPath(),0===n?0:o.getLength());if(o.isList()){if(0===n){var r=o.getItemAt(0);return new Wh(r.getTextPath(),0)}var i=this.get(Wt(o.items));return new Wh(i.getTextPath(),i.getLength())}}return new Wh(e,n)},Object.defineProperties(n.prototype,o),n}(vu);Tl.prototype._isDocument=!0,Tl.SNIPPET_ID="snippet",Tl.TEXT_SNIPPET_ID="text-snippet";var Pl=function(e){function n(n){e.call(this,"SKIP"),this.schema=n.schema,this.nodeFactory=new xl(this),this.data=new Sl(this.schema,{nodeFactory:this.nodeFactory}),this.document=n,this.ops=[],this.lastOp=null,t(n.data.indexes,function(t,e){this.data.addIndex(e,t.clone())}.bind(this)),Il.register(this),this.loadSeed(n.toJSON()),n.on("document:changed",this._onDocumentChanged,this)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.dispose=function(){this.document.off(this)},n.prototype.create=function(t){if(t.id||(t.id=y(t.type)),!t.type)throw new Error("No node type provided");return this.lastOp=this.data.create(t),this.lastOp?(this.ops.push(this.lastOp),this.data.get(t.id)):void 0},n.prototype.createDefaultTextNode=function(t,e){return this.create({type:this.getSchema().getDefaultTextType(),content:t||"",direction:e})},n.prototype["delete"]=function(t){this.lastOp=this.data["delete"](t),this.lastOp&&this.ops.push(this.lastOp)},n.prototype.set=function(t,e){this.lastOp=this.data.set(t,e),this.lastOp&&this.ops.push(this.lastOp)},n.prototype.update=function(t,e){var n=this.lastOp=this.data.update(t,e);return n?(this.ops.push(n),n):void 0},n.prototype._onDocumentChanged=function(t){this._apply(t)},n.prototype._apply=function(t){t.ops.forEach(function(t){this.data.apply(t)}.bind(this))},n.prototype._reset=function(){this.ops=[],this.lastOp=null},n.prototype._rollback=function(){
for(var t=this,e=this.ops.length-1;e>=0;e--)t.data.apply(t.ops[e].invert());this.ops=[],this.lastOp=null},n.prototype.newInstance=function(){return this.document.newInstance()},n}(Tl);Pl.prototype._isTransactionDocument=!0;var Dl=function(){};Dl.prototype.annotate=function(t,e){var n=t.selection;if(!n||n.isNull()||n.isCollapsed())throw new Error("Non-collapsed selection required for tx.annotate()");if(!n.isCollapsed()){var o=t.getSchema(),r=o.getNodeClass(e.type);if(!r)throw new Error("Unknown annotation type",e);if(n.isNodeSelection())throw new Error("Node selections are not supported by tx.annotate()");if(n.isCustomSelection())throw new Error("Custom selections are not supported by tx.annotate()");var i=n.start,s=n.end,a=n.containerId,p={start:i,end:s,containerId:a};if(n.isPropertySelection()){if(!r.prototype._isAnnotation)throw new Error("Annotation can not be created for a selection.")}else{if(!n.isContainerSelection())throw new Error("Unsupported selection.");r.prototype._isPropertyAnnotation&&console.warn("NOT SUPPORTED YET: creating property annotations for a non collapsed container selection.")}return Object.assign(p,e),t.create(p)}},Dl.prototype["break"]=function(t){var e=t.selection;if(e.isNodeSelection()){var n=e.containerId,o=t.get(n),r=e.getNodeId(),i=o.getPosition(r,"strict"),s=t.createDefaultTextNode();e.isBefore()?t.update(o.getContentPath(),{type:"insert",pos:i,value:s.id}):(t.update(o.getContentPath(),{type:"insert",pos:i+1,value:s.id}),Kt(t,s,n,"before"))}else if(e.isCustomSelection());else if(e.isCollapsed()||e.isPropertySelection()){var a=e.containerId;if(e.isCollapsed()||(this.deletePropertySelection(t,e),t.setSelection(e.collapse("left"))),a){var p=t.get(a),c=e.start.path[0],u=t.get(c);this._breakNode(t,u,e.start,p)}else this.insertText(t,"\n")}else if(e.isContainerSelection())if(e.start.hasSamePath(e.end))this.deleteContainerSelection(t,e),this["break"](t);else{var h=e.start,l=e.containerId,f=t.get(l),d=h.path[0],g=f.getPosition(d,"strict");this.deleteContainerSelection(t,e),g<f.length-1?Kt(t,f.getNodeAt(g+1),l,"before"):(t.setSelection(e.collapse("left")),this["break"](t))}},Dl.prototype["delete"]=function(t,e){var n=t.selection;if(n.isNodeSelection())this.deleteNodeSelection(t,n,e);else if(n.isCustomSelection());else if(n.isCollapsed()){var o=n.start.path,r=t.get(o[0]),i=t.get(o),s=n.start.offset,a=n.containerId&&(0===s&&"left"===e||s===i.length&&"right"===e);if(a){var p=r.getRoot();if(p.isList()&&0===s&&"left"===e)return this.toggleList(t);var c=t.get(n.containerId);this._merge(t,p,n.start,e,c)}else{var u="left"===e?s-1:s,h=u+1,l={path:o,offset:u},f={path:o,offset:h};fl.deleteTextRange(t,l,f),t.setSelection({type:"property",path:o,startOffset:u,containerId:n.containerId})}}else n.isPropertySelection()?(fl.deleteTextRange(t,n.start,n.end),t.setSelection(n.collapse("left"))):n.isContainerSelection()?this.deleteContainerSelection(t,n):console.warn("Unsupported case: tx.delete(%)",e,n)},Dl.prototype.deleteNodeSelection=function(t,e,n){var o=e.getNodeId(),r=t.get(e.containerId),i=r.getPosition(o,"strict");if(e.isFull()||e.isBefore()&&"right"===n||e.isAfter()&&"left"===n){var s=r.getContentPath();t.update(s,{type:"delete",pos:i}),t["delete"](o);var a=t.createDefaultTextNode();t.update(s,{type:"insert",pos:i,value:a.id}),t.setSelection({type:"property",path:a.getTextPath(),startOffset:0,containerId:r.id})}else if(e.isBefore()&&"left"===n){if(i>0){var p=r.getNodeAt(i-1);p.isText()?(t.setSelection({type:"property",path:p.getTextPath(),startOffset:p.getLength()}),this["delete"](t,n)):t.setSelection({type:"node",nodeId:p.id,containerId:r.id})}}else if(e.isAfter()&&"right"===n){if(i<r.getLength()-1){var c=r.getNodeAt(i+1);c.isText()?(t.setSelection({type:"property",path:c.getTextPath(),startOffset:0}),this["delete"](t,n)):t.setSelection({type:"node",nodeId:c.id,containerId:r.id})}}else console.warn("Unsupported case: delete(%s)",n,e)},Dl.prototype.deletePropertySelection=function(t,e){var n=e.start.path,o=e.start.offset,r=e.end.offset;t.update(n,{type:"delete",start:o,end:r}),ll.deletedText(t,n,o,r)},Dl.prototype.deleteContainerSelection=function(t,e){var n=e.containerId,o=t.get(n),r=e.start,i=e.end,s=r.getNodeId(),a=i.getNodeId(),p=o.getPosition(s,"strict"),c=o.getPosition(a,"strict");if(p===c){var u=t.get(s).getRoot();if(u.isText())fl.deleteTextRange(t,r,i);else{if(!u.isList())throw new Error("Not supported yet.");fl.deleteListRange(t,u,r,i)}return void t.setSelection(e.collapse("left"))}if(p>c){var h;h=[i,r],r=h[0],i=h[1];var l;l=[c,p],p=l[0],c=l[1];var f;f=[a,s],s=f[0],a=f[1]}var d=t.get(r.getNodeId()),g=t.get(i.getNodeId()),y=Gt(t,d,r,null),v=Gt(t,g,null,i);if(v)t.update([o.id,"nodes"],{type:"delete",pos:c}),fl.deleteNode(t,g);else{var m=g.getRoot();m.isText()?fl.deleteTextRange(t,null,i):m.isList()&&fl.deleteListRange(t,m,null,i)}for(var _=c-1;_>p;_--){var w=o.nodes[_];t.update([o.id,"nodes"],{type:"delete",pos:_}),fl.deleteNode(t,t.get(w))}if(y)t.update([o.id,"nodes"],{type:"delete",pos:p}),fl.deleteNode(t,d);else{var b=d.getRoot();b.isText()?fl.deleteTextRange(t,r,null):b.isList()&&fl.deleteListRange(t,b,r,null)}if(y&&v){var C=t.createDefaultTextNode();t.update([o.id,"nodes"],{type:"insert",pos:p,value:C.id}),t.setSelection({type:"property",path:C.getTextPath(),startOffset:0,containerId:n})}else y||v?y?Kt(t,g,o.id,"before"):Kt(t,d,o.id,"after"):(this._merge(t,d,e.start,"right",o),t.setSelection(e.collapse("left")))},Dl.prototype.deleteNode=function(t,e,n){if(!e)throw new Error("Parameter `nodeId` is mandatory.");var o=t.get(e);if(!o)throw new Error("Node does not exist");if(n){var r=t.get(n);r.hide(e)}fl.deleteNode(t,o)},Dl.prototype.insertInlineNode=function(t,e){var n=t.selection;if(!n.isPropertySelection())throw new Error("insertInlineNode requires a PropertySelection");var o="\ufeff";this.insertText(t,o),n=t.selection;var r=t.selection.end.offset,i=r-o.length;return e=Object.assign({},e,{start:{path:n.path,offset:i},end:{path:n.path,offset:r}}),t.create(e)},Dl.prototype.insertBlockNode=function(t,e){var n=t.selection;if(!n||n.isNull())throw new Error("Selection is null.");var o;if(o=e._isNode&&t.get(e.id)?t.get(e.id):t.create(e),n.isNodeSelection()){var r=n.containerId,i=t.get(r),s=n.getNodeId(),a=i.getPosition(s,"strict");n.isBefore()?t.update(i.getContentPath(),{type:"insert",pos:a,value:o.id}):n.isAfter()?(t.update(i.getContentPath(),{type:"insert",pos:a+1,value:o.id}),t.setSelection({type:"node",containerId:r,nodeId:o.id,mode:"after"})):(t.update(i.getContentPath(),{type:"delete",pos:a}),t["delete"](n.getNodeId()),t.update([i.id,"nodes"],{type:"insert",pos:a,value:o.id}),t.setSelection({type:"node",containerId:r,nodeId:o.id,mode:"after"}))}else if(n.isPropertySelection()){if(!n.containerId)throw new Error("insertBlockNode can only be used within a container.");var p=t.get(n.containerId);n.isCollapsed()||(this.deletePropertySelection(t),t.setSelection(n.collapse("left")));var c=t.get(n.path[0]);if(!c)throw new Error("Invalid selection.");var u=p.getPosition(c.id,"strict");if(c.isText()){var h=c.getText();0===h.length?(t.update(p.getContentPath(),{type:"delete",pos:u}),t["delete"](c.id),t.update([p.id,"nodes"],{type:"insert",pos:u,value:o.id}),Kt(t,o,p.id,"after")):0===n.start.offset?t.update(p.getContentPath(),{type:"insert",pos:u,value:o.id}):n.start.offset===h.length?(t.update(p.getContentPath(),{type:"insert",pos:u+1,value:o.id}),Kt(t,o,p.id,"before")):(this["break"](t),t.update(p.getContentPath(),{type:"insert",pos:u+1,value:o.id}),Kt(t,o,p.id,"after"))}else console.error("Not yet implemented: insertBlockNode() on a custom node")}else if(n.isContainerSelection()&&n.isCollapsed()){var l=n.start;if(l.isPropertyCoordinate())t.setSelection({type:"property",path:l.path,startOffset:l.offset,containerId:n.containerId});else{if(!l.isNodeCoordinate())throw new Error("Unsupported selection for insertBlockNode");t.setSelection({type:"node",containerId:n.containerId,nodeId:l.path[0],mode:0===l.offset?"before":"after"})}return this.insertBlockNode(t,o)}},Dl.prototype.insertText=function(t,e){var n=t.selection;if(n.isNodeSelection()){var o=n.containerId,r=t.get(o),i=n.getNodeId(),s=r.getPosition(i,"strict"),a=t.createDefaultTextNode(e);n.isBefore()?r.show(a,s):n.isAfter()?r.show(a,s+1):(r.hide(i),t["delete"](i),r.show(a,s)),Kt(t,a,n.containerId,"after")}else n.isCustomSelection()||(n.isCollapsed()||n.isPropertySelection()?this._insertText(t,n,e):n.isContainerSelection()&&(this.deleteContainerSelection(t,n),this.insertText(t,e)))},Dl.prototype.paste=function(t,e){if(e)if(_(e))Pe(t,{text:e});else{if(!e._isDocument)throw new Error("Illegal content for paste.");Pe(t,{doc:e})}},Dl.prototype.switchTextType=function(t,e){var n=t.selection;if(!n.isPropertySelection())throw new Error("Selection must be a PropertySelection.");var o=n.containerId;if(!o)throw new Error("Selection must be within a container.");var r=n.path,i=r[0],s=t.get(i);if(!s.isInstanceOf("text"))throw new Error("Trying to use switchTextType on a non text node. Skipping.");var a=Object.assign({id:y(e.type),type:e.type,content:s.content,direction:s.direction},e),p=[a.id,"content"];a=t.create(a),ll.transferAnnotations(t,r,0,p,0);var c=t.get(n.containerId),u=c.getPosition(i,"strict");return c.hide(i),c.show(a.id,u),this.deleteNode(t,s.id,o),t.setSelection({type:"property",path:p,startOffset:n.start.offset,endOffset:n.end.offset,containerId:o}),a},Dl.prototype.toggleList=function(t,e){var n=t.selection,o=t.get(n.containerId);if(o)if(n.isPropertySelection()){var r=n.start.path[0],i=t.get(r).getRoot(),s=o.getPosition(i.id,"strict");if(i.isText()){t.update([o.id,"nodes"],{type:"delete",pos:s});var a=t.create({type:"list-item",content:i.getText()});ll.transferAnnotations(t,i.getTextPath(),0,a.getTextPath(),0);var p=t.create(Object.assign({type:"list",items:[a.id]},e));t["delete"](i.id),t.update([o.id,"nodes"],{type:"insert",pos:s,value:p.id}),t.setSelection({type:"property",path:a.getTextPath(),startOffset:n.start.offset,containerId:n.containerId})}else if(i.isList()){var c=n.start.path[0],u=i.getItemPosition(c),h=i.getItemAt(u),l=t.createDefaultTextNode(h.getText());if(ll.transferAnnotations(t,h.getTextPath(),0,l.getTextPath(),0),i.removeItemAt(u),0===i.getLength())t.update([o.id,"nodes"],{type:"delete",pos:s}),t["delete"](i.id),t.update([o.id,"nodes"],{type:"insert",pos:s,value:l.id});else if(0===u)t.update([o.id,"nodes"],{type:"insert",pos:s,value:l.id});else if(i.getLength()<=u)t.update([o.id,"nodes"],{type:"insert",pos:s+1,value:l.id});else{for(var f=[],d=i.items.slice(),g=d.length,y=g-1;y>=u;y--)f.unshift(d[y]),i.removeItemAt(y);var v=t.create({type:"list",items:f,ordered:i.ordered});t.update([o.id,"nodes"],{type:"insert",pos:s+1,value:l.id}),t.update([o.id,"nodes"],{type:"insert",pos:s+2,value:v.id})}t.setSelection({type:"property",path:l.getTextPath(),startOffset:n.start.offset,containerId:n.containerId})}}else n.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")},Dl.prototype.indent=function(t){var e=t.selection;if(e.isPropertySelection()){var n=e.start.getNodeId(),o=t.get(n).getRoot();if(o.isList()){var r=e.start.path[0],i=t.get(r);i&&i.level<3&&t.set([r,"level"],i.level+1)}}else e.isContainerSelection()},Dl.prototype.dedent=function(t){var e=t.selection;if(e.isPropertySelection()){var n=e.start.getNodeId(),o=t.get(n).getRoot();if(o.isList()){var r=e.start.path[0],i=t.get(r);i&&i.level>1&&t.set([r,"level"],i.level-1)}}else e.isContainerSelection()},Dl.prototype._insertText=function(t,e,n){var o=e.start,r=e.end;if(!Ut(o.path,r.path))throw new Error("Unsupported state: range should be on one property");var i=o.path,s=o.offset,a=r.offset,p=!e.isCollapsed(),c=n.length;p&&t.update(i,{type:"delete",start:s,end:a}),t.update(i,{type:"insert",start:s,text:n});var u=t.getAnnotations(i);u.forEach(function(e){var n=e.start.offset,o=e.end.offset;s>o||(n>=a?(t.update([e.id,"start"],{type:"shift",value:s-a+c}),t.update([e.id,"end"],{type:"shift",value:s-a+c})):n>=s&&a>o||e._isInlineNode&&n>=s&&a>=o?t["delete"](e.id):n>=s&&o>=a?((n>s||!p)&&t.update([e.id,"start"],{type:"shift",value:s-n+c}),t.update([e.id,"end"],{type:"shift",value:s-a+c})):s>n&&a>o?t.update([e.id,"end"],{type:"shift",value:s-o+c}):s>n&&o>=a?e._isInlineNode||t.update([e.id,"end"],{type:"shift",value:s-a+c}):console.warn("TODO: handle annotation update case."))});var h=s+n.length;t.setSelection({type:"property",path:o.path,startOffset:h,containerId:e.containerId,surfaceId:e.surfaceId})},Dl.prototype._breakNode=function(t,e,n,o){if(e=e.getRoot(),e.isText())this._breakTextNode(t,e,n,o);else{if(!e.isList())throw new Error("Not supported");this._breakListNode(t,e,n,o)}},Dl.prototype._breakTextNode=function(t,e,n,o){var r=n.path,i=n.offset,s=o.getPosition(e.id,"strict"),a=e.getText();if(0===i){var p=t.create({type:e.type,content:""});o.show(p.id,s),t.setSelection({type:"property",path:r,startOffset:0,containerId:o.id})}else{var c=e.toJSON();delete c.id,c.content=a.substring(i),i===a.length&&(c.type=t.getSchema().getDefaultTextType()),c=t.create(c),i<a.length&&(ll.transferAnnotations(t,r,i,c.getTextPath(),0),t.update(r,{type:"delete",start:i,end:a.length})),o.show(c.id,s+1),t.setSelection({type:"property",path:c.getTextPath(),startOffset:0,containerId:o.id})}},Dl.prototype._breakListNode=function(t,e,n,o){var r=n.path,i=n.offset,s=t.get(r[0]),a=e.length,p=e.getItemPosition(s.id),c=s.getText(),u=s.toJSON();if(delete u.id,0===i)if(c)u.content="",u=t.create(u),e.insertItemAt(p,u.id),t.setSelection({type:"property",path:s.getTextPath(),startOffset:0});else{var h=o.getPosition(e.id,"strict"),l=t.createDefaultTextNode();if(2>a)o.hide(e.id),t["delete"](e.id),o.show(l.id,h);else if(0===p)e.remove(s.id),t["delete"](s.id),o.show(l.id,h);else if(p>=a-1)e.remove(s.id),t["delete"](s.id),o.show(l.id,h+1);else{for(var f=[],d=e.items.slice(),g=a-1;g>p;g--)f.unshift(d[g]),e.remove(d[g]);e.remove(d[p]);var y=t.create({type:"list",items:f,ordered:e.ordered});o.show(l.id,h+1),o.show(y.id,h+2)}t.setSelection({type:"property",path:l.getTextPath(),startOffset:0})}else u.content=c.substring(i),u=t.create(u),i<c.length&&(ll.transferAnnotations(t,r,i,[u.id,"content"],0),t.update(r,{type:"delete",start:i,end:c.length})),e.insertItemAt(p+1,u.id),t.setSelection({type:"property",path:u.getTextPath(),startOffset:0})},Dl.prototype._merge=function(t,e,n,o,r){if(e.isList()){var i=e,s=n.path[0],a=i.getItemPosition(s),p="left"===o&&a>0||"right"===o&&a<i.items.length-1;if(p){a="left"===o?a-1:a;var c=i.getItemAt(a),u=c.getLength();return fl.mergeListItems(t,i.id,a),void t.setSelection({type:"property",path:c.getTextPath(),startOffset:u,containerId:r.id})}}var h=r.getPosition(e,"strict");"left"===o&&h>0?this._mergeNodes(t,r,h-1,o):"right"===o&&h<r.getLength()-1&&this._mergeNodes(t,r,h,o)},Dl.prototype._mergeNodes=function(t,e,n,o){var r=e.getChildAt(n),i=e.getChildAt(n+1);if(r.isText()){if(r.isEmpty())return e.hide(r.id),t["delete"](r.id),void Kt(t,i,e.id,"before");var s=r,a=s.getTextPath(),p=s.getLength();if(i.isText()){var c=i,u=c.getTextPath();e.hide(c.id),t.update(a,{type:"insert",start:p,text:c.getText()}),ll.transferAnnotations(t,u,0,a,p),t["delete"](c.id),t.setSelection({type:"property",path:a,startOffset:p,containerId:e.id})}else if(i.isList()){var h=i,l=h.getFirstItem(),f=l.getTextPath();h.removeItemAt(0),t.update(a,{type:"insert",start:p,text:l.getText()}),ll.transferAnnotations(t,f,0,a,p),t["delete"](l.id),0===h.getLength()&&(e.hide(h.id),t["delete"](h.id)),t.setSelection({type:"property",path:a,startOffset:p,containerId:e.id})}else Xt(t,"left"===o?r.id:i.id,e.id)}else if(r.isList())if(i.isText()){var d=i,g=d.getTextPath(),y=r.getLastItem(),v=y.getTextPath(),m=y.getLength();e.hide(d.id),t.update(v,{type:"insert",start:m,text:d.getText()}),ll.transferAnnotations(t,g,0,v,m),t["delete"](d.id),t.setSelection({type:"property",path:y.getTextPath(),startOffset:m,containerId:e.id})}else if(i.isList()){e.hide(i.id);for(var _=r.items.slice(),w=i.items.slice(),b=0;b<w.length;b++)i.removeItemAt(0),r.appendItem(w[b]);if(t["delete"](i.id),"left"===o)t.setSelection({type:"property",path:t.get(w[0]).getTextPath(),startOffset:0,containerId:e.id});else{var C=t.get(Wt(_));t.setSelection({type:"property",path:C.getTextPath(),startOffset:C.getLength(),containerId:e.id})}}else Xt(t,"left"===o?r.id:i.id,e.id);else i.isText()&&i.isEmpty()?(e.hide(i.id),t["delete"](i.id),Kt(t,r,e.id,"after")):Xt(t,"left"===o?r.id:i.id,e.id)};var Al=function(t){this._document=t,this._selection=null,this._impl=new Dl,this._direction=null},Ml={selection:{},textDirection:{}};Al.prototype.getDocument=function(){return this._document},Al.prototype.get=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return(n=this._document).get.apply(n,t);var n},Al.prototype.contains=function(t){return this._document.contains(t)},Al.prototype.create=function(t){return this._document.create(t)},Al.prototype.createDefaultTextNode=function(t){return this._document.createDefaultTextNode(t,this._direction)},Al.prototype["delete"]=function(t){return this._document["delete"](t)},Al.prototype.set=function(t,e){return this._document.set(t,e)},Al.prototype.update=function(t,e){return this._document.update(t,e)},Al.prototype.createSelection=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return(n=this._document).createSelection.apply(n,t);var n},Al.prototype.setSelection=function(t){t?c(t)&&(t=this.createSelection(t)):t=qh.nullSelection;var e=this._selection;e&&t&&!t.isNull()&&(t.containerId||(t.containerId=e.containerId)),this._selection=t},Al.prototype.getSelection=function(){return this._selection},Ml.selection.get=function(){return this._selection},Ml.selection.set=function(t){this.setSelection(t)},Ml.textDirection.get=function(){return this._direction},Ml.textDirection.set=function(t){this._direction=t},Al.prototype.annotate=function(t){return this._selection&&!this._selection.isNull()?this._impl.annotate(this,t):void 0},Al.prototype["break"]=function(){this._selection&&!this._selection.isNull()&&this._impl["break"](this)},Al.prototype.copySelection=function(){return this._selection&&!this._selection.isNull()?Ne(this.getDocument(),this._selection):void 0},Al.prototype.deleteSelection=function(t){this._selection&&!this._selection.isNull()&&this._impl["delete"](this,"right",t)},Al.prototype.deleteCharacter=function(t){!this._selection||this._selection.isNull()||(this._selection.isCollapsed()?this._impl["delete"](this,t):this.deleteSelection())},Al.prototype.insertText=function(t){this._selection&&!this._selection.isNull()&&this._impl.insertText(this,t)},Al.prototype.insertInlineNode=function(t){this._selection&&!this._selection.isNull()&&this._impl.insertInlineNode(this,t)},Al.prototype.insertBlockNode=function(t){this._selection&&!this._selection.isNull()&&this._impl.insertBlockNode(this,t)},Al.prototype.paste=function(t){this._selection&&!this._selection.isNull()&&this._impl.paste(this,t)},Al.prototype.switchTextType=function(t){return this._selection&&!this._selection.isNull()?this._impl.switchTextType(this,t):void 0},Al.prototype.toggleList=function(t){return this._selection&&!this._selection.isNull()?this._impl.toggleList(this,t):void 0},Al.prototype.indent=function(){this._selection&&!this._selection.isNull()&&this._impl.indent(this)},Al.prototype.dedent=function(){this._selection&&!this._selection.isNull()&&this._impl.dedent(this)},Al.prototype.getIndex=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return(n=this._document).getIndex.apply(n,t);var n},Al.prototype.getAnnotations=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return(n=this._document).getAnnotations.apply(n,t);var n},Al.prototype.getSchema=function(){return this._document.getSchema()},Al.prototype.createSnippet=function(){return this._document.createSnippet()},Object.defineProperties(Al.prototype,Ml);var kl=function(t){function e(e,n){t.call(this),this._stageDoc=this._document=new Pl(e,this),this._editorSession=n,this._isTransacting=!1,this._state="idle",this._surface=null}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={ops:{}};return e.prototype.dispose=function(){this._stageDoc.dispose()},e.prototype.setSelection=function(e){if(t.prototype.setSelection.call(this,e),e=this._selection,!e.isNull()&&!e.surfaceId){var n=this._editorSession.getFocusedSurface();n?e.surfaceId=n.id:console.warn("No focused surface. Selection will not be rendered.")}},n.ops.get=function(){return this._stageDoc.ops},n.ops.set=function(t){this._stageDoc.ops=t},e.prototype.rollback=function(){this._stageDoc._rollback()},e.prototype._apply=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];(n=this._stageDoc)._apply.apply(n,t);var n},e.prototype._recordChange=function(t,e){if(this._isTransacting)throw new Error("Nested transactions are not supported.");if(!re(t))throw new Error("Document.transaction() requires a transformation function.");this._isTransacting=!0,this._reset(),this._state="started";var n;try{this.setSelection(e);var o=this.getSelection();t(this,{selection:o});var r=this.ops;r.length>0&&(n=new el(r,this._before,this._after),n.before={selection:o},n.after={selection:this.getSelection()}),this._state="finished"}finally{"finished"!==this._state&&this.rollback(),this._state="idle",this._isTransacting=!1}return n},e.prototype._reset=function(){this._before={},this._after={},this._stageDoc._reset(),this._info={},this.setSelection(null)},Object.defineProperties(e.prototype,n),e}(Al),jl={},Rl=function(e,n){this.entries={},this.names=[],this.validator=n,e&&t(e,function(t,e){this.add(e,t)}.bind(this))},Ll={_isRegistry:{}};Ll._isRegistry.get=function(){return!0},Rl.prototype.contains=function(t){return this.entries.hasOwnProperty(t)},Rl.prototype.add=function(t,e){if(this.validator&&this.validator(e),jl[t])throw new Error('Illegal key: "'+t+'" is a property of Object which is thus not allowed as a key.');this.contains(t)&&this.remove(t),this.entries[t]=e,this.names.push(t)},Rl.prototype.remove=function(t){var e=this.names.indexOf(t);e>=0&&this.names.splice(e,1),delete this.entries[t]},Rl.prototype.clear=function(){this.names=[],this.entries={}},Rl.prototype.get=function(t){return this.entries[t]},Rl.prototype.each=function(t,e){return console.warn("DEPRECATED: use Registry.forEach(cb) instead"),this.forEach(t.bind(e))},Rl.prototype.forEach=function(t){for(var e=this,n=0;n<this.names.length;n++){var o=e.names[n],r=t(e.entries[o],o);if(r===!1)break}},Rl.prototype.map=function(t){var e=[];return this.forEach(function(n,o){e.push(t(n,o))}),e},Rl.prototype.filter=function(t){var e=[];return this.forEach(function(n,o){t(n,o)&&e.push(n)}),e},Object.defineProperties(Rl.prototype,Ll);var Fl=function(e,n){if(!e.editorSession)throw new Error("EditorSession required.");this.editorSession=e.editorSession,this.doc=this.editorSession.getDocument(),this.context=a({},e,{doc:this.doc}),this.commandRegistry=new Rl,t(n,function(t){if(!t._isCommand)throw new Error("Expecting instances of ui/Command.");this.commandRegistry.add(t.name,t)}.bind(this)),this.editorSession.onUpdate(this.onSessionUpdate,this),this.updateCommandStates(this.editorSession)};Fl.prototype.dispose=function(){this.editorSession.off(this)},Fl.prototype.onSessionUpdate=function(t){(t.hasChanged("change")||t.hasChanged("selection"))&&this.updateCommandStates(t)},Fl.prototype.updateCommandStates=function(t){var e={},n=this.getCommandContext(),o=this._getCommandParams();this.commandRegistry.forEach(function(t){e[t.getName()]=t.getCommandState(o,n)}),h(this.commandStates,e)||(this.commandStates=e,t.setCommandStates(e))},Fl.prototype.executeCommand=function(t,e,n){var o=this,r=this.commandRegistry.get(t);if(!r)return void console.warn("command",t,"not registered");var i=this.commandStates[t],s=a(this._getCommandParams(),e,{commandState:i});if(!r.isAsync){var p=r.execute(s,this.getCommandContext());return p}this.editorSession.lock(),r.execute(s,this.getCommandContext(),function(t,e){t?n?n(t):console.error(t):n&&n(null,e),o.editorSession.unlock()})},Fl.prototype.getCommandStates=function(){return this.commandStates},Fl.prototype.getCommandContext=function(){return this.context},Fl.prototype._getCommandParams=function(){var t=this.context.editorSession,e=t.getSelectionState(),n=e.getSelection(),o=this.context.surfaceManager.getFocusedSurface();return{editorSession:t,selectionState:e,surface:o,selection:n}};var Bl="undefined"!=typeof global?global:window,Hl=Bl.hasOwnProperty("Substance")?Bl.Substance:Bl.Substance={DEBUG_RENDERING:!0},Ul="__lodash_hash_undefined__";Be.prototype.add=Be.prototype.push=Le,Be.prototype.has=Fe;var zl=200,Wl=$e("length"),Jl=9007199254740991,ql=NaN,Vl=/^\s+|\s+$/g,Gl=/^[-+]0x[0-9a-f]+$/i,$l=/^0b[01]+$/i,Kl=/^0o[0-7]+$/i,Xl=parseInt,Yl=1/0,Ql=1.7976931348623157e308,Zl="Expected a function",tf=Math.max,ef=nn(function(t,e){return Ye(t)?Ge(t,e):[]}),nf=function(t){this.arr=t,this.pos=-1},of={_isArrayIterator:{}};of._isArrayIterator.get=function(){return!0},nf.prototype.hasNext=function(){return this.pos<this.arr.length-1},nf.prototype.next=function iO(){this.pos+=1;var iO=this.arr[this.pos];return iO},nf.prototype.back=function(){return this.pos>=0&&(this.pos-=1),this},Object.defineProperties(nf.prototype,of);var rf="This method is not implemented.",sf=function(){},af={id:{},tagName:{},nodeName:{},nodeType:{},className:{},textContent:{},innerHTML:{},outerHTML:{},firstChild:{},lastChild:{},nextSibling:{},previousSibling:{},parentNode:{},height:{},width:{}};sf.prototype.getNativeElement=function(){throw new Error(rf)},sf.prototype.hasClass=function(t){throw new Error(rf)},sf.prototype.addClass=function(t){throw new Error(rf)},sf.prototype.removeClass=function(t){throw new Error(rf)},sf.prototype.attr=function(){if(1===arguments.length){if(_(arguments[0]))return this.getAttribute(arguments[0]);e(arguments[0])&&t(arguments[0],function(t,e){this.setAttribute(e,t)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this},sf.prototype.removeAttr=function(t){var e=t.split(/\s+/);return 1===e.length?this.removeAttribute(t):e.forEach(function(t){this.removeAttribute(t)}.bind(this)),this},sf.prototype.getAttribute=function(t){throw new Error(rf)},sf.prototype.setAttribute=function(t,e){throw new Error(rf)},sf.prototype.removeAttribute=function(t){throw new Error(rf)},sf.prototype.getAttributes=function(){throw new Error(rf)},sf.prototype.htmlProp=function(){if(1===arguments.length){if(_(arguments[0]))return this.getProperty(arguments[0]);e(arguments[0])&&t(arguments[0],function(t,e){this.setProperty(e,t)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this},sf.prototype.getProperty=function(t){throw new Error(rf)},sf.prototype.setProperty=function(t,e){throw new Error(rf)},sf.prototype.removeProperty=function(t){throw new Error(rf)},sf.prototype.getTagName=function(){throw new Error(rf)},sf.prototype.setTagName=function(t){throw new Error(rf)},sf.prototype.getId=function(){return this.getAttribute("id")},sf.prototype.setId=function(t){this.setAttribute("id",t)},sf.prototype.val=function(t){return 0===arguments.length?this.getValue():(this.setValue(t),this)},sf.prototype.getValue=function(){return this.getProperty("value")},sf.prototype.setValue=function(t){return this.setProperty("value",t),this},sf.prototype.css=function(){if(1===arguments.length){if(_(arguments[0]))return this.getStyle(arguments[0]);if(!e(arguments[0]))throw new Error("Illegal arguments.");t(arguments[0],function(t,e){this.setStyle(e,t)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this},sf.prototype.getStyle=function(t){throw new Error(rf)},sf.prototype.setStyle=function(t,e){throw new Error(rf)},sf.prototype.text=function(t){return 0===arguments.length?this.getTextContent():(this.setTextContent(t),this)},sf.prototype.getTextContent=function(){throw new Error(rf)},sf.prototype.setTextContent=function(t){throw new Error(rf)},sf.prototype.html=function(t){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(t),this)},sf.prototype.getInnerHTML=function(){throw new Error(rf)},sf.prototype.setInnerHTML=function(t){throw new Error(rf)},sf.prototype.getOuterHTML=function(){throw new Error(rf)},sf.prototype.on=function(t,e,n,o){if(!_(t))throw new Error('Illegal argument: "event" must be a String.');if(o=o||{},n&&(o.context=n),o.selector&&!_(o.selector))throw new Error("Illegal argument: selector must be a string.");if(!e||!re(e))throw new Error("Illegal argument: invalid handler function for event "+t);return this.addEventListener(t,e,o),this},sf.prototype.off=function(t,e){if(1!==arguments.length||_(t))this.removeEventListener(t,e);else{var n=arguments[0];this.getEventListeners().filter(function(t){return t.context===n}).forEach(function(t){this.removeEventListener(t)}.bind(this))}return this},sf.prototype.addEventListener=function(t,e,n){throw new Error(rf)},sf.prototype.removeEventListener=function(t,e){throw new Error(rf)},sf.prototype.getEventListeners=function(){throw new Error(rf)},sf.prototype.getNodeType=function(){if(this.isTextNode())return"text";if(this.isCommentNode())return"comment";if(this.isElementNode())return"element";if(this.isDocumentNode())return"document";throw new Error("Unsupported node type")},sf.prototype.getChildCount=function(){throw new Error(rf)},sf.prototype.getChildNodes=function(){throw new Error(rf)},sf.prototype.getChildren=function(){throw new Error(rf)},sf.prototype.getChildAt=function(t){throw new Error(rf)},sf.prototype.getChildIndex=function(t){throw new Error(rf)},sf.prototype.getChildNodeIterator=function(){return new nf(this.getChildNodes())},sf.prototype.getLastChild=function(){throw new Error(rf)},sf.prototype.getFirstChild=function(){throw new Error(rf)},sf.prototype.getNextSibling=function(){throw new Error(rf)},sf.prototype.getPreviousSibling=function(){throw new Error(rf)},sf.prototype.isTextNode=function(){return!1},sf.prototype.isElementNode=function(){return!1},sf.prototype.isCommentNode=function(){return!1},sf.prototype.isDocumentNode=function(){return!1},sf.prototype.clone=function(){throw new Error(rf)},sf.prototype.createElement=function(t){throw new Error(rf)},sf.prototype.createTextNode=function(t){throw new Error(rf)},sf.prototype.is=function(t){throw new Error(rf)},sf.prototype.getParent=function(){throw new Error(rf)},sf.prototype.getRoot=function(){throw new Error(rf)},sf.prototype.getOwnerDocument=function(){throw new Error(rf)},sf.prototype.find=function(t){throw new Error(rf)},sf.prototype.findAll=function(t){throw new Error(rf)},sf.prototype.append=function(t){var e;if(1===arguments.length){if(!u(t))return this.appendChild(t),this;e=t}else e=arguments;return e&&Array.prototype.forEach.call(e,this.appendChild.bind(this)),this},sf.prototype.appendChild=function(t){throw new Error(rf)},sf.prototype.insertAt=function(t,e){throw new Error(rf)},sf.prototype.insertBefore=function(t,e){throw new Error(rf)},sf.prototype.removeAt=function(t){throw new Error(rf)},sf.prototype.removeChild=function(t){throw new Error(rf)},sf.prototype.replaceChild=function(t,e){throw new Error(rf)},sf.prototype.remove=function(){var t=this.getParent();t&&t.removeChild(this)},sf.prototype.empty=function(){throw new Error(rf)},sf.prototype.serialize=function(){return this.getOuterHTML()},sf.prototype.isInDocument=function(){for(var t=this;t;){if(t.isDocumentNode())return!0;t=t.getParent()}},sf.prototype.focus=function(){return this},sf.prototype.blur=function(){return this},sf.prototype.click=function(){return this},sf.prototype.getWidth=function(){return 0},sf.prototype.getHeight=function(){return 0},sf.prototype.getOuterHeight=function(t){return 0},sf.prototype.getOffset=function(){return{top:0,left:0}},sf.prototype.getPosition=function(){return{top:0,left:0}},sf.prototype.getElementFactory=function(){return this.createElement.bind(this);
},af.id.get=function(){return this.getId()},af.id.set=function(t){this.setId(t)},af.tagName.get=function(){return this.getTagName()},af.tagName.set=function(t){this.setTagName(t)},af.nodeName.get=function(){return this.getTagName()},af.nodeType.get=function(){return this.getNodeType()},af.className.get=function(){return this.getAttribute("class")},af.className.set=function(t){this.setAttribute("class",t)},af.textContent.get=function(){return this.getTextContent()},af.textContent.set=function(t){this.setTextContent(t)},af.innerHTML.get=function(){return this.getInnerHTML()},af.innerHTML.set=function(t){this.setInnerHTML(t)},af.outerHTML.get=function(){return this.getOuterHTML()},af.firstChild.get=function(){return this.getFirstChild()},af.lastChild.get=function(){return this.getLastChild()},af.nextSibling.get=function(){return this.getNextSibling()},af.previousSibling.get=function(){return this.getPreviousSibling()},af.parentNode.get=function(){return this.getParent()},af.height.get=function(){return this.getHeight()},af.width.get=function(){return this.getWidth()},Object.defineProperties(sf.prototype,af),sf.prototype._isDOMElement=!0,sf.pxStyles={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0},sf.EMPTY_HTML="<html><head></head><body></body></html>";var pf=function(t,e,n){if(!_(t)||!re(e))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");n=n||{};var o=e,r=n.context,i=Boolean(n.capture);r&&(e=e.bind(r)),n.once===!0&&(e=sn(this,e)),this.eventName=t,this.originalHandler=o,this.handler=e,this.capture=i,this.context=r,this.options=n,this._el=null};pf.prototype._isDOMEventListener=!0,pf.findIndex=function(t,e,n){var o=-1;return o=arguments[1]._isDOMEventListener?t.indexOf(arguments[1]):on(t,rn.bind(null,{eventName:e,originalHandler:n}))};var cf=function(t){function e(e){t.call(this),this.parent=null,this._owner=e,this._ref=null}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={childNodes:{}};return e.prototype.getParent=function(){return this.parent},n.childNodes.get=function(){return this.getChildNodes()},e.prototype.getComponent=function(){return this._comp},e.prototype.ref=function(t){if(!t)throw new Error("Illegal argument");if(this._ref)throw new Error("A VirtualElement can only be referenced once.");if(this._ref=t,this._context){var e=this._context.refs;if(e[t])throw new Error('An item with reference "'+t+'" already exists.');e[t]=this}return this},e.prototype.isInDocument=function(){return!1},Object.defineProperties(e.prototype,n),e}(sf);cf.prototype._isVirtualElement=!0;var uf=function(t){function e(e){t.call(this),this._tagName=e,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTagName=function(){return this._tagName},e.prototype.setTagName=function(t){return this._tagName=t,this},e.prototype.hasClass=function(t){return this.classNames?this.classNames.indexOf(t)>-1:!1},e.prototype.addClass=function(t){return this.classNames||(this.classNames=[]),this.classNames.push(t),this},e.prototype.removeClass=function(t){return this.classNames&&(this.classNames=ef(this.classNames,t)),this},e.prototype.removeAttribute=function(t){return this.attributes&&delete this.attributes[t],this},e.prototype.getAttribute=function(t){return this.attributes?this.attributes[t]:void 0},e.prototype.setAttribute=function(t,e){return this.attributes||(this.attributes={}),this.attributes[t]=e,this},e.prototype.getAttributes=function(){var t={};return this.attributes&&a(t,this.attributes),this.classNames&&(t["class"]=this.classNames.join(" ")),this.style&&(t.style=p(this.style,function(t,e){return e+":"+t}).join(";")),t},e.prototype.getId=function(){return this.getAttribute("id")},e.prototype.setId=function(t){return this.setAttribute("id",t),this},e.prototype.setTextContent=function(t){if(!_(t))throw new Error("Illegal argument: expecting a string.");return t=t||"",this.empty(),this.appendChild(t),this},e.prototype.setInnerHTML=function(t){return t=t||"",this.empty(),this._innerHTMLString=t,this},e.prototype.getInnerHTML=function(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")},e.prototype.getValue=function(){return this.htmlProp("value")},e.prototype.setValue=function(t){return this.htmlProp("value",t),this},e.prototype.getChildNodes=function(){return this.children},e.prototype.getChildren=function(){return this.children.filter(function(t){return"text"!==t.getNodeType()})},e.prototype.isTextNode=function(){return!1},e.prototype.isElementNode=function(){return!0},e.prototype.isCommentNode=function(){return!1},e.prototype.isDocumentNode=function(){return!1},e.prototype.append=function(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this},e.prototype.appendChild=function(t){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,t),this},e.prototype.insertAt=function(t,e){if(e=this._normalizeChild(e),!e)throw new Error("Illegal child: "+e);if(!e._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+e);if(0>t||t>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,t,e),this},e.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);if(!(n>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(n,t),this},e.prototype.removeAt=function(t){if(0>t||t>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(t),this},e.prototype.removeChild=function(t){if(!t||!t._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.children.indexOf(t);if(0>e)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this},e.prototype.replaceChild=function(t,e){if(!(e&&t&&e._isVirtualElement&&t._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var n=this.children.indexOf(t);if(0>n)throw new Error("replaceChild(): element is not a child.");return this.removeAt(n),this.insertAt(n,e),this},e.prototype.empty=function(){for(var t=this.children;t.length;){var e=t.pop();e.parent=null}return delete this._innerHTMLString,this},e.prototype.getProperty=function(t){return this.htmlProps?this.htmlProps[t]:void 0},e.prototype.setProperty=function(t,e){return this.htmlProps||(this.htmlProps={}),this.htmlProps[t]=e,this},e.prototype.removeProperty=function(t){return this.htmlProps&&delete this.htmlProps[t],this},e.prototype.getStyle=function(t){return this.style?this.style[t]:void 0},e.prototype.setStyle=function(t,e){return this.style||(this.style={}),sf.pxStyles[t]&&v(e)&&(e+="px"),this.style[t]=e,this},e.prototype.addEventListener=function(t,e,n){var o;return 1===arguments.length&&arguments[0]._isDOMEventListener?o=arguments[0]:(n=n||{},n.context=n.context||this._owner._comp,o=new pf(t,e,n)),this.eventListeners||(this.eventListeners=[]),this.eventListeners.push(o),this},e.prototype.removeEventListener=function(t,e){return this.eventListeners&&sf._findEventListenerIndex(this.eventListeners,t,e),this},e.prototype.getEventListeners=function(){return this.eventListeners},e.prototype.getNodeType=function(){return"element"},e.prototype.hasInnerHTML=function(){return Boolean(this._innerHTMLString)},e.prototype._normalizeChild=function(t){return _(t)&&(t=new ff(t)),t},e.prototype._append=function(t,e){if(1===e.length&&!u(e[0]))return void this._appendChild(t,e[0]);var n;if(u(e[0]))n=e[0];else{if(!(arguments.length>1))return;n=Array.prototype.slice.call(e,0)}n.forEach(this._appendChild.bind(this,t))},e.prototype._appendChild=function(t,e){return(e=this._normalizeChild(e))?(t.push(e),this._attach(e),e):void 0},e.prototype._insertAt=function(t,e,n){n&&(t.splice(e,0,n),this._attach(n))},e.prototype._removeAt=function(t,e){var n=t[e];t.splice(e,1),this._detach(n)},e.prototype._attach=function(t){t.parent=this,this._context&&t._owner!==this._owner&&t._ref&&(this._context.foreignRefs[t._ref]=t)},e.prototype._detach=function(t){t.parent=null,this._context&&t._owner!==this._owner&&t._ref&&delete this.context.foreignRefs[t._ref]},e.prototype._mergeHTMLConfig=function(t){t.classNames&&(this.classNames||(this.classNames=[]),this.classNames=this.classNames.concat(t.classNames)),t.attributes&&(this.attributes||(this.attributes={}),a(this.attributes,t.attributes)),t.htmlProps&&(this.htmlProps||(this.htmlProps={}),a(this.htmlProps,t.htmlProps)),t.style&&(this.style||(this.style={}),a(this.style,t.style)),t.eventListeners&&(this.eventListeners||(this.eventListeners=[]),this.eventListeners=this.eventListeners.concat(t.eventListeners))},e}(cf);uf.prototype._isVirtualHTMLElement=!0;var hf=function(t){function e(e,n){t.call(this),n=n||{},this.ComponentClass=e,this.props=n,n.children||(n.children=[]),this.children=n.children}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isVirtualComponent:{}};return n._isVirtualComponent.get=function(){return!0},e.prototype.getComponent=function(){return this._comp},e.prototype.getChildren=function(){return this.props.children},e.prototype.getNodeType=function(){return"component"},e.prototype.outlet=function(t){return new lf(this,t)},e.prototype._attach=function(t){t._preliminaryParent=this},e.prototype._detach=function(t){t._preliminaryParent=null},e.prototype._copyHTMLConfig=function(){return{classNames:l(this.classNames),attributes:l(this.attributes),htmlProps:l(this.htmlProps),style:l(this.style),eventListeners:l(this.eventListeners)}},Object.defineProperties(e.prototype,n),e}(uf),lf=function(t,e){this.virtualEl=t,this.name=e,Object.freeze(this)};lf.prototype._getOutlet=function(){var t=this.virtualEl.props[this.name];return t||(t=[],this.virtualEl.props[this.name]=t),t},lf.prototype.append=function(){var t=this._getOutlet();return this.virtualEl._append(t,arguments),this},lf.prototype.empty=function(){var t=this.virtualEl.props[this.name];return t.forEach(function(t){this._detach(t)}.bind(this)),t.splice(0,t.length),this};var ff=function(t){function e(e){t.call(this),this.text=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isVirtualTextNode:{}};return n._isVirtualTextNode.get=function(){return!0},Object.defineProperties(e.prototype,n),e}(cf);cf.Component=hf,cf.TextNode=ff,cf.createElement=function(){var t,e,n=arguments[0],o=arguments[1];if(_(n))e="element";else{if(!re(n)||!n.prototype._isComponent)throw m(n)?new Error("$$(null): provided argument was null or undefined."):new Error("Illegal usage of $$()");e="component"}var r,i,s={},a=[];for(var p in o)if(o.hasOwnProperty(p)){var u=o[p];switch(p){case"class":r=u;break;case"ref":i=u;break;default:s[p]=u}}return"element"===e?(t=new uf(n),t.attr(s)):t=new hf(n,s),t._owner=this.owner,r&&t.addClass(r),i&&t.ref(i),a.forEach(function(e){if(re(e.handler))t.on(e.name,e.handler);else{if(!c(e.handler))throw new Error("Illegal arguments for $$(_,{ on"+e.name+"})");var n=e.handler;t.on(e.name,n.handler,n.context,n)}}),arguments.length>2&&t.append(Re(Array.prototype.slice.call(arguments,2),3)),t};var df=function(t,e,n){this.owner=t,this.target=e,this.originalEvent=n};df.delegatedHandler=function(t,e){var n=t.handler,o=t.context,r=t.options.selector;return function(t){for(var i=sf.wrap(t.target);i;){if(i.is(r)){n(new df(o,t.target,t));break}if(i===e)break;i=i.parentNode}}};var gf=function(t){function e(e){t.call(this),console.assert(e instanceof window.Node,"Expecting native DOM node."),this.el=e,e._wrapper=this,this.eventListeners=[],this._changedProperties=new Set}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={childNodes:{},children:{},ownerDocument:{}};return e.prototype.getNativeElement=function(){return this.el},e.prototype.hasClass=function(t){return this.el.classList.contains(t)},e.prototype.addClass=function(t){return this.el.classList.add(t),this},e.prototype.removeClass=function(t){return this.el.classList.remove(t),this},e.prototype.getAttribute=function(t){return this.el.getAttribute(t)},e.prototype.setAttribute=function(t,e){return this.el.setAttribute(t,e),this},e.prototype.removeAttribute=function(t){return this.el.removeAttribute(t),this},e.prototype.getAttributes=function(){for(var t={},e=this.el.attributes,n=e.length,o=0;n>o;o++){var r=e.item(o);t[r.name]=r.value}return t},e.prototype.getProperties=function(){var t=this,e={};return this._changedProperties.forEach(function(n){e[n]=t.el[n]}),e},e.prototype.getProperty=function(t){return this.el[t]},e.prototype.setProperty=function(t,e){return this._changedProperties.add(t),this.el[t]=e,this},e.prototype.removeProperty=function(t){return this._changedProperties["delete"](t),delete this.el[t],this},e.prototype.getTagName=function(){return this._isXML()?this.el.tagName:this.el.tagName?this.el.tagName.toLowerCase():void 0},e.prototype.setTagName=function(t){var e,n=this,o=this.createElement(t),r=this.el.attributes,i=r.length;for(e=0;i>e;e++){var s=r.item(e);o.setAttribute(s.name,s.value)}return this._changedProperties.forEach(function(t){o[t]=n.el[t]}),this.eventListeners.forEach(function(t){o.addEventListener(t.eventName,t.handler,t.capture)}),o.append(this.getChildNodes()),this._replaceNativeEl(o.getNativeElement()),this},e.prototype.getId=function(){return this.el.id},e.prototype.setId=function(t){return this.el.id=t,this},e.prototype.getStyle=function(t){var e=this.getComputedStyle();return e[t]||this.el.style[t]},e.prototype.getComputedStyle=function(){return window.getComputedStyle(this.el)},e.prototype.setStyle=function(e,n){return t.pxStyles[e]&&v(n)&&(n+="px"),this.el.style[e]=n,this},e.prototype.getTextContent=function(){return this.el.textContent},e.prototype.setTextContent=function(t){return this.el.textContent=t,this},e.prototype.getInnerHTML=function(){var t=this.el.innerHTML;if(!_(t)){for(var e=this.el.ownerDocument.createDocumentFragment(),n=this.el.firstChild;n;n=n.nextSibling)e.appendChild(n.cloneNode(!0));var o=new window.XMLSerializer;t=o.serializeToString(e)}return t},e.prototype.setInnerHTML=function(t){return this.el.innerHTML=t,this},e.prototype.getOuterHTML=function(){var t=this.el.outerHTML;if(!_(t)){var e=new window.XMLSerializer;t=e.serializeToString(this.el)}return t},e.prototype.addEventListener=function(t,e,n){var o;return o=1===arguments.length&&arguments[0]?arguments[0]:new pf(t,e,n),o.options.selector&&!o.__hasEventDelegation__&&(o.handler=df.delegatedHandler(o,this.getNativeElement()),o.__hasEventDelegation__=!0),this.el.addEventListener(o.eventName,o.handler,o.capture),this.eventListeners.push(o),o._el=this,this},e.prototype.removeEventListener=function(t,e){var n=null,o=-1;return o=pf.findIndex(this.eventListeners,t,e),n=this.eventListeners[o],o>-1&&(this.eventListeners.splice(o,1),n._el=null,this.el.removeEventListener(n.eventName,n.handler)),this},e.prototype.removeAllEventListeners=function(){for(var t=this,e=0;e<this.eventListeners.length;e++){var n=t.eventListeners[e];n._el=null,t.el.removeEventListener(n.eventName,n.handler)}this.eventListeners=[]},e.prototype.getEventListeners=function(){return this.eventListeners},e.prototype.getChildCount=function(){return this.el.childNodes.length},e.prototype.getChildNodes=function(){for(var t=[],n=this.el.firstChild;n;n=n.nextSibling)t.push(e.wrapNativeElement(n));return t},n.childNodes.get=function(){return this.getChildNodes()},e.prototype.getChildren=function(){for(var t=[],n=this.el.firstChild;n;n=n.nextSibling)n.nodeType===window.Node.ELEMENT_NODE&&t.push(e.wrapNativeElement(n));return t},n.children.get=function(){return this.getChildren()},e.prototype.getChildAt=function(t){return e.wrapNativeElement(this.el.childNodes[t])},e.prototype.getChildIndex=function(t){if(!t._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,t.el)},e.prototype.getFirstChild=function(){var t=this.el.firstChild;return t?e.wrapNativeElement(t):null},e.prototype.getLastChild=function(){var t=this.el.lastChild;return t?e.wrapNativeElement(t):null},e.prototype.getNextSibling=function(){var t=this.el.nextSibling;return t?e.wrapNativeElement(t):null},e.prototype.getPreviousSibling=function(){var t=this.el.previousSibling;return t?e.wrapNativeElement(t):null},e.prototype.isTextNode=function(){return this.el.nodeType===window.Node.TEXT_NODE},e.prototype.isElementNode=function(){return this.el.nodeType===window.Node.ELEMENT_NODE},e.prototype.isCommentNode=function(){return this.el.nodeType===window.Node.COMMENT_NODE},e.prototype.isDocumentNode=function(){return this.el.nodeType===window.Node.DOCUMENT_NODE},e.prototype.clone=function o(){var o=this.el.cloneNode(!0);return e.wrapNativeElement(o)},e.prototype.createDocument=function(t){return e.createDocument(t)},e.prototype.createElement=function(t){var n=this._getNativeOwnerDocument(),o=n.createElement(t);return e.wrapNativeElement(o)},e.prototype.createTextNode=function(t){var n=this._getNativeOwnerDocument(),o=n.createTextNode(t);return e.wrapNativeElement(o)},e.prototype.createComment=function(t){var n=this._getNativeOwnerDocument(),o=n.createComment(t);return e.wrapNativeElement(o)},e.prototype.createProcessingInstruction=function(t,n){var o=this._getNativeOwnerDocument(),r=o.createProcessingInstruction(t,n);return e.wrapNativeElement(r)},e.prototype.createCDATASection=function(t){var n=this._getNativeOwnerDocument(),o=n.createCDATASection(t);return e.wrapNativeElement(o)},e.prototype.is=function(t){var e=this.el;return this.isElementNode()?an(e,t):!1},e.prototype.getParent=function(){var t=this.el.parentNode;return t?e.wrapNativeElement(t):null},e.prototype.getRoot=function(){for(var t=this.el,n=t;n;)t=n,n=t.parentNode;return e.wrapNativeElement(t)},e.prototype.getOwnerDocument=function(){return e.wrapNativeElement(this._getNativeOwnerDocument())},n.ownerDocument.get=function(){return this.getOwnerDocument()},e.prototype._getNativeOwnerDocument=function(){return this.isDocumentNode()?this.el:this.el.ownerDocument},e.prototype.find=function(t){var n=null;return this.el.querySelector&&(n=this.el.querySelector(t)),n?e.wrapNativeElement(n):null},e.prototype.findAll=function(t){var n=[];return this.el.querySelectorAll&&(n=this.el.querySelectorAll(t)),Array.prototype.map.call(n,function(t){return e.wrapNativeElement(t)})},e.prototype._normalizeChild=function(t){if(t instanceof window.Node){if(t._wrapper)return t;t=e.wrapNativeElement(t)}if((_(t)||v(t))&&(t=this.createTextNode(t)),!t||!t._isBrowserDOMElement)throw new Error("Illegal child type.");return t.el._wrapper||(t.el._wrapper=t),console.assert(t.el._wrapper===t,"The backlink to the wrapper should be consistent"),t.getNativeElement()},e.prototype.appendChild=function(t){var e=this._normalizeChild(t);return this.el.appendChild(e),this},e.prototype.insertAt=function(t,e){var n=this._normalizeChild(e),o=this.el.childNodes;return t>=o.length?this.el.appendChild(n):this.el.insertBefore(n,o[t]),this},e.prototype.insertBefore=function(t,e){if(!e||!e._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var n=this._normalizeChild(t);return this.el.insertBefore(n,e.el),this},e.prototype.removeAt=function(t){return this.el.removeChild(this.el.childNodes[t]),this},e.prototype.removeChild=function(t){if(!t||!t._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(t.el),this},e.prototype.replaceChild=function(t,e){if(!(e&&t&&e._isBrowserDOMElement&&t._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(e.el,t.el),this},e.prototype.empty=function(){for(var t=this.el;t.lastChild;)t.removeChild(t.lastChild);return this},e.prototype.remove=function(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this},e.prototype.serialize=function(){var t=this.el.outerHTML;if(_(t))return t;var e=new window.XMLSerializer;return e.serializeToString(this.el)},e.prototype.isInDocument=function(){for(var t=this.el;t;){if(t.nodeType===window.Node.DOCUMENT_NODE)return!0;t=t.parentNode}},e.prototype._replaceNativeEl=function(t){console.assert(t instanceof window.Node,"Expecting a native element.");var e=this.el,n=e.parentNode;n&&n.replaceChild(t,e),this.el=t,this.el._wrapper=this},e.prototype._getChildNodeCount=function(){return this.el.childNodes.length},e.prototype.focus=function(){return this.el.focus(),this},e.prototype.blur=function(){return this.el.focus(),this},e.prototype.click=function(){return this.el.click(),this},e.prototype.getWidth=function(){var t=this.el.getClientRects()[0];return t?t.width:0},e.prototype.getHeight=function(){var t=this.el.getClientRects()[0];return t?t.height:0},e.prototype.getOffset=function(){var t=this.el.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},e.prototype.getPosition=function(){return{left:this.el.offsetLeft,top:this.el.offsetTop}},e.prototype.getOuterHeight=function(t){var e=this.el.offsetHeight;if(t){var n=this.getComputedStyle();e+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)}return e},e.prototype._isXML=function(){return"application/xml"===this._getNativeOwnerDocument().contentType},Object.defineProperties(e.prototype,n),e}(sf);gf.prototype._isBrowserDOMElement=!0,gf.createDocument=function(t){var e;return"xml"===t?(e=window.document.implementation.createDocument(null,"dummy"),e.removeChild(e.firstChild)):e=(new window.DOMParser).parseFromString(sf.EMPTY_HTML,"text/html"),gf.wrapNativeElement(e)},gf.createElement=function(t){return gf.wrapNativeElement(window.document.createElement(t))},gf.createTextNode=function(t){return gf.wrapNativeElement(window.document.createTextNode(t))},gf.parseMarkup=function(t,e,n){var o,r=[];if(!t)return gf.createDocument(e);var i=new window.DOMParser;if("html"===e?(n=t.search(/<\s*html/i)>=0,o=i.parseFromString(t,"text/html")):"xml"===e&&(o=i.parseFromString(t,"text/xml")),!o)throw new Error("Could not parse DOM string.");var s=o.querySelector("parsererror");if(s)throw new Error("ParserError: could not parse "+t);if("html"===e)if(n)r=[o.querySelector("html")];else{var a=o.querySelector("body");r=a.childNodes}else"xml"===e&&(r=n?[o]:o.childNodes);var p=Array.prototype.map.call(r,function(t){return new gf(t)});return 1===p.length?p[0]:p},gf.parseHTML=function(t,e){return gf.parseMarkup(t,"html",e)},gf.parseXML=function(t,e){return gf.parseMarkup(t,"xml",e)};var yf=function(t){function e(e){if(t.call(this,e),!(e instanceof window.Node)||3!==e.nodeType)throw new Error("Expecting native TextNode.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNodeType=function(){return"text"},e}(gf);gf.wrapNativeElement=function(t){return t?t._wrapper?t._wrapper:t instanceof window.Node?3===t.nodeType?new yf(t):new gf(t):t===window?gf.getBrowserWindow():void 0:null};var vf=function(){this.el=window,window.__BrowserDOMElementWrapper__=this,this.eventListeners=[]};vf.prototype.on=gf.prototype.on,vf.prototype.off=gf.prototype.off,vf.prototype.addEventListener=gf.prototype.addEventListener,vf.prototype.removeEventListener=gf.prototype.removeEventListener,vf.prototype.getEventListeners=gf.prototype.getEventListeners,gf.getBrowserWindow=function(){return window.__BrowserDOMElementWrapper__?window.__BrowserDOMElementWrapper__:new vf(window)},gf.isReverse=function(t,e,n,o){if(n&&t){gf.isReverse._r1||(gf.isReverse._r1=window.document.createRange(),gf.isReverse._r2=window.document.createRange());var r=gf.isReverse._r1,i=gf.isReverse._r2;r.setStart(t.getNativeElement(),e),i.setStart(n.getNativeElement(),o);var s=r.compareBoundaryPoints(window.Range.START_TO_START,i);if(1===s)return!0}return!1},gf.getWindowSelection=function(){var t=window.getSelection(),e={anchorNode:gf.wrapNativeElement(t.anchorNode),anchorOffset:t.anchorOffset,focusNode:gf.wrapNativeElement(t.focusNode),focusOffset:t.focusOffset};return e};var mf={},_f=wu?gf:mf,wf={};wf.createDocument=function(t){return wf._impl.createDocument(t)},wf.createElement=function(t){return wf._impl.createElement(t)},wf.createTextNode=function(t){return wf._impl.createTextNode(t)},wf.getBrowserWindow=function(){return wf._impl.getBrowserWindow()},wf.parseHTML=function(t){return wf._impl.parseHTML(t)},wf.parseXML=function(t,e){return wf._impl.parseXML(t,e)},wf.wrap=wf.wrapNativeElement=function(t){if(!t)throw new Error("Illegal argument");return t._isXNode?t:wf._impl.wrapNativeElement(t)},wf.isReverse=function(t,e,n,o){return wf._impl.isReverse(t,e,n,o)},wf._impl=_f,wf._reset=function(){wf._impl=_f},wf._useXNode=function(){wf._impl=mf};var bf=function(t){void 0===t&&(t={}),this.elementFactory=t.elementFactory||wf.createDocument("html")};bf.prototype._render=function(t,e,n){var o=xn(t),r=new bf.State(this.elementFactory);e&&r.setOldProps(o,e),n&&r.setOldState(o,n);try{cn(r,o,"forceCapture"),o._isVirtualComponent?un(r,o._content):un(r,o),hn(r,o)}finally{r.dispose()}},bf.prototype._renderChild=function(t,e){var n=new bf.State(this.elementFactory);e.parent={_comp:t};try{return cn(n,e),un(n,e),e._comp}finally{n.dispose()}};var Cf=function(t,e){this.state=t,this.owner=e.owner,this.refs={},this.foreignRefs={},this.elements=e.elements,this.pos=0,this.updates=e.components.length,this.remaining=this.updates,this.$$=this._createComponent.bind(this)};Cf.prototype._createComponent=function(){var t=this.state,e=this.elements[this.pos++];return!t.isCaptured(e)&&e._isVirtualComponent&&e.parent&&t.isCaptured(e.parent)&&(cn(t,e),this.updates++,this.remaining--),e=cf.createElement.apply(this,arguments),e._context=this,e._owner=this.owner,e._attach=function(){},e._detach=function(){},e},Cf.prototype.hasPendingCaptures=function(){return this.updates>0&&this.remaining>0},Cf.prototype.reset=function(){this.pos=0,this.updates=0,this.refs={}},Cf.prototype._ancestorsReady=function(t){for(var e=this;t;){if(e.state.isCaptured(t)||t===e.owner||t===e.owner._content)return!0;t=t.parent}return!1},bf._internal={_capture:cn,_wrap:xn};var Sf=function(t){this.owner=t,this.refs={},this.foreignRefs={},this.elements=[],this.components=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0};Sf.prototype._createComponent=function(){var t=cf.createElement.apply(this,arguments);return t._context=this,t._owner=this.owner,t._isVirtualComponent&&this.components.push(t),this.elements.push(t),t},bf.createContext=function(t){var e=xn(t);return new Sf(e)};var xf=function(t){this.elementFactory=t,this.poluted=[],this.id="__"+y()};xf.prototype.dispose=function(){var t=this.id;this.poluted.forEach(function(e){delete e[t]})},xf.prototype.set=function(t,e,n){var o=t[this.id];o||(o={},t[this.id]=o,this.poluted.push(t)),o[e]=n},xf.prototype.get=function(t,e){var n=t[this.id];return n?n[e]:void 0},xf.prototype.setMapped=function(t){this.set(t,"mapped",!0)},xf.prototype.isMapped=function(t){return Boolean(this.get(t,"mapped"))},xf.prototype.setRelocated=function(t){this.set(t,"relocated",!0)},xf.prototype.isRelocated=function(t){return Boolean(this.get(t,"relocated"))},xf.prototype.setDetached=function(t){this.set(t,"detached",!0)},xf.prototype.isDetached=function(t){return Boolean(this.get(t,"detached"))},xf.prototype.setCaptured=function(t){this.set(t,"captured",!0)},xf.prototype.isCaptured=function(t){return Boolean(this.get(t,"captured"))},xf.prototype.setNew=function(t){this.set(t,"created",!0)},xf.prototype.isNew=function(t){return Boolean(this.get(t,"created"))},xf.prototype.setUpdated=function(t){this.set(t,"updated",!0)},xf.prototype.isUpdated=function(t){return Boolean(this.get(t,"updated"))},xf.prototype.setSkipped=function(t){this.set(t,"skipped",!0)},xf.prototype.isSkipped=function(t){return Boolean(this.get(t,"skipped"))},xf.prototype.setRendered=function(t){this.set(t,"rendered",!0)},xf.prototype.isRendered=function(t){return Boolean(this.get(t,"rendered"))},xf.prototype.setOldProps=function(t,e){this.set(t,"oldProps",e)},xf.prototype.getOldProps=function(t){return this.get(t,"oldProps")},xf.prototype.setOldState=function(t,e){this.set(t,"oldState",e)},xf.prototype.getOldState=function(t){return this.get(t,"oldState")},bf.State=xf;var Ef=function(e){function n(t,n,o){void 0===n&&(n={}),void 0===o&&(o={}),e.call(this),this.parent=t&&t._isComponent?t:null,this.el=o.el;var r=o.context?o.context:this._getContext()||{};this.context=r,Object.freeze(this.context),this.renderingEngine=t&&t.renderingEngine||r.renderingEngine||o.renderingEngine||new bf,this._SKIP_COMPONENT_INIT||(this.__id__=y(),this.refs={},this.__foreignRefs__={},this._actionHandlers={},this.props=n,Object.freeze(this.props),this.state=this.getInitialState()||{},Object.freeze(this.state))}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var o={textContent:{},innerHTML:{},outerHTML:{},childNodes:{}};return n.prototype.getId=function(){return this.__id__},n.prototype.setId=function(){throw new Error("'id' is readonly")},n.prototype.getChildContext=function(){return this.childContext||{}},n.prototype.getInitialState=function(){return{}},n.prototype.getParent=function(){return this.parent},n.prototype.getRoot=function(){for(var t=this,e=t;e;)t=e,e=t.getParent();return t},n.prototype.getNativeElement=function(){return this.el.getNativeElement()},n.prototype.getLabel=function(t){var e=this.context.labelProvider;if(!e)throw new Error("Missing labelProvider.");return e.getLabel(t)},n.prototype.getComponent=function(t,e){var n=this.getComponentRegistry();if(!n)throw new Error("Missing componentRegistry.");var o=n.get(t);if(!e&&!o)throw new Error("No Component registered with name "+t);return o},n.prototype.getComponentRegistry=function(){return this.props.componentRegistry||this.context.componentRegistry},n.prototype.getFlow=function(){return this.context.flow},n.prototype.render=function(t){return t("div")},n.prototype.mount=function(t){if(!t)throw new Error("Element is required.");return t._isDOMElement||(t=wf.wrapNativeElement(t)),this.el=null,this.renderingEngine=new bf({elementFactory:t.getOwnerDocument()}),this._render(),t.appendChild(this.el),t.isInDocument()&&this.triggerDidMount(!0),this},n.prototype.shouldRerender=function(t,e){return!0},n.prototype.rerender=function(){this._rerender(this.props,this.state)},n.prototype._rerender=function(t,e){this._render(t,e),this.isMounted()||this.didUpdate(t,e)},n.prototype._render=function(t,e){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{this.renderingEngine._render(this,t,e)}finally{delete this.__isRendering__}},n.prototype.triggerDidMount=function(){this.getChildren().forEach(function(t){t.triggerDidMount(!0)}),this.__isMounted__||(this.__isMounted__=!0,this.didMount())},n.prototype.didMount=function(){},n.prototype.didUpdate=function(){},n.prototype.isMounted=function(){return this.__isMounted__},n.prototype.triggerDispose=function(){this.getChildren().forEach(function(t){t.triggerDispose()}),this.dispose(),this.__isMounted__=!1},n.prototype.dispose=function(){},n.prototype._setParent=function(t){this.parent=t,this.context=this._getContext()||{},Object.freeze(this.context)},n.prototype.send=function(t){for(var e=arguments,n=this;n;){if(n._actionHandlers&&n._actionHandlers[t])return n._actionHandlers[t].apply(n,Array.prototype.slice.call(e,1)),
!0;n=n.getParent()}return console.warn("Action",t,"was not handled."),!1},n.prototype.handleActions=function(e){return t(e,function(t,e){this.handleAction(e,t)}.bind(this)),this},n.prototype.handleAction=function(t,e){if(!t||!e||!re(e))throw new Error("Illegal arguments.");e=e.bind(this),this._actionHandlers[t]=e},n.prototype.getState=function(){return this.state},n.prototype.setState=function(t){var e=this.props,n=this.state,o=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),t);this.willUpdateState(t),this.state=t||{},Object.freeze(this.state),o?this._rerender(e,n):this.__isSettingProps__||this.didUpdate(e,n)},n.prototype.extendState=function(t){t=a({},this.state,t),this.setState(t)},n.prototype.willUpdateState=function(t){},n.prototype.getProps=function(){return this.props},n.prototype.setProps=function(t){var e=this.props,n=this.state,o=this.shouldRerender(t,this.state);this._setProps(t),o?this._rerender(e,n):this.didUpdate(e,n)},n.prototype._setProps=function(t){t=t||{},this.__isSettingProps__=!0;try{this.willReceiveProps(t),this.props=t||{},Object.freeze(t)}finally{delete this.__isSettingProps__}},n.prototype.extendProps=function(t){var e=a({},this.props,t);this.setProps(e)},n.prototype.willReceiveProps=function(t){},n.prototype.getTextContent=function(){return this.el?this.el.textContent:void 0},o.textContent.get=function(){return this.getTextContent()},n.prototype.getInnerHTML=function(){return this.el?this.el.getInnerHTML():void 0},o.innerHTML.get=function(){return this.getInnerHTML()},n.prototype.getOuterHTML=function(){return this.el?this.el.getOuterHTML():void 0},o.outerHTML.get=function(){return this.getOuterHTML()},n.prototype.getAttribute=function(t){return this.el?this.el.getAttribute(t):void 0},n.prototype.setAttribute=function(t,e){return this.el&&this.el.setAttribute(t,e),this},n.prototype.getProperty=function(t){return this.el?this.el.getProperty(t):void 0},n.prototype.setProperty=function(t,e){return this.el&&this.el.setProperty(t,e),this},n.prototype.hasClass=function(t){return this.el?this.el.hasClass(t):void 0},n.prototype.addClass=function(t){return this.el&&this.el.addClass(t),this},n.prototype.removeClass=function(t){return this.el&&this.el.removeClass(t),this},n.prototype.getStyle=function(t){return this.el?this.el.getStyle(t):void 0},n.prototype.setStyle=function(t,e){return this.el?this.el.setStyle(t,e):this},n.prototype.getValue=function(){return this.el?this.el.getValue():void 0},n.prototype.setValue=function(t){return this.el&&this.el.setValue(t),this},n.prototype.getChildCount=function(){return this.el?this.el.getChildCount():0},o.childNodes.get=function(){return this.getChildNodes()},n.prototype.getChildNodes=function(){if(!this.el)return[];var t=this.el.getChildNodes();return t=t.map(In).filter(Boolean)},n.prototype.getChildren=function(){if(!this.el)return[];var t=this.el.getChildren();return t=t.map(In).filter(Boolean)},n.prototype.getChildAt=function(t){var e=this.el.getChildAt(t);return On(e)},n.prototype.find=function(t){var e=this.el.find(t);return In(e)},n.prototype.findAll=function(t){var e=this.el.findAll(t);return e.map(In).filter(Boolean)},n.prototype.appendChild=function(t){this.insertAt(this.getChildCount(),t)},n.prototype.insertAt=function(t,e){if(_(e)&&(e=new cf.TextNode(e)),!e._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');var n=this.renderingEngine._renderChild(this,e);this.el.insertAt(t,n.el),Nn(this,n)},n.prototype.removeAt=function(t){var e=this.el.getChildAt(t);if(e){var n=On(e);En(n),this.el.removeAt(t)}},n.prototype.removeChild=function(t){if(!t||!t._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");En(t),this.el.removeChild(t.el)},n.prototype.replaceChild=function(t,e){if(!(e&&t&&e._isComponent&&t._isComponent))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");En(t),this.el.replaceChild(e.el,t.el),this.isMounted()&&e.triggerDidMount(!0)},n.prototype.empty=function(){return this.el&&(this.getChildNodes().forEach(function(t){En(t)}),this.el.empty()),this},n.prototype.remove=function(){En(this),this.el.remove()},n.prototype.addEventListener=function(){throw new Error("Not supported.")},n.prototype.removeEventListener=function(){throw new Error("Not supported.")},n.prototype.insertBefore=function(){throw new Error("Not supported.")},n.prototype.click=function(){this.el&&this.el.click()},n.prototype.getComponentPath=function(){for(var t=[],e=this;e;)t.unshift(e),e=e.getParent();return t},n.prototype._getContext=function(){var t={},e=this.getParent();return e&&(t=a(t,e.context),e.getChildContext)?a(t,e.getChildContext()):t},Object.defineProperties(n.prototype,o),n}(vu);Ef.prototype._isComponent=!0,Ef.prototype.attr=sf.prototype.attr,Ef.prototype.htmlProp=sf.prototype.htmlProp,Ef.prototype.val=sf.prototype.val,Ef.prototype.css=sf.prototype.css,Ef.prototype.text=sf.prototype.text,Ef.prototype.append=sf.prototype.append,Ef.unwrap=In,Ef.render=function(t){t=t||{};var e=this,n=new e(null,t);return n._render(),n},Ef.mount=function(t,e){if(1===arguments.length&&(e=t,t={}),!e)throw new Error("'el' is required.");if(_(e)){var n=e;if(!wu)throw new Error("This selector is not supported on server side.");e=window.document.querySelector(n)}e._isDOMElement||(e=new wf.wrapNativeElement(e));var o=this,r=new o(null,t);return r.mount(e),r},Ef.getComponentForDOMElement=function(t){return In(t)},Ef.unwrapDOMElement=function(t){return console.warn("DEPRECATED: Use Component.getComponentForDOMElement"),Ef.getComponentForDOMElement(t)},Ef.getComponentFromNativeElement=function(t){return In(wf.wrapNativeElement(t))};var Nf=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ef);Nf.prototype._isElementComponent=!0,Nf.prototype._SKIP_COMPONENT_INIT=!0;var If=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setTextContent=function(t){if(!this.el)throw new Error("Component must be rendered first.");this.el.textContent!==t&&(this.el.textContent=t)},e.prototype.getChildNodes=function(){return[]},e.prototype.getChildren=function(){return[]},e}(Ef);If.prototype._isTextNodeComponent=!0,If.prototype._SKIP_COMPONENT_INIT=!0,Ef.Element=Nf,Ef.TextNode=If;var Of=function(){},Tf={_isDragAndDropHandler:{}};Of.prototype.match=function(t,e){return!1},Of.prototype.drop=function(t,e){},Tf._isDragAndDropHandler.get=function(){return!0},Object.defineProperties(Of.prototype,Tf);var Pf={inBrowser:wu,isIE:!1,isFF:!1,isWebkit:!1,version:-1,isWindows:wu&&void 0!==window.navigator&&window.navigator.appVersion&&-1!==window.navigator.appVersion.indexOf("Win"),isMac:wu&&void 0!==window.navigator&&window.navigator.platform.indexOf("Mac")>=0};if("undefined"!=typeof window){var Df=window.navigator.userAgent,Af=Df.indexOf("MSIE "),Mf=Df.indexOf("Trident/"),kf=Df.indexOf("Edge/");Af>0?(Pf.isIE=!0,Pf.version=10):Mf>0?(Pf.isIE=!0,Pf.version=11,Pf.isTrident=!0):kf>0&&(Pf.isIE=!0,Pf.isEdge=!0,Pf.version=12,parseInt(Df.substring(kf+5,Df.indexOf(".",kf)),10)),Pf.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Pf.isWebkit=!Pf.isFF&&!Pf.isIE}var jf=function(t){function e(e,n){t.call(this),this.context=n;var o=[],r=[];e.forEach(function(t){var e=t.type||"drop-asset";switch(e){case"drop-asset":o.push(t);break;case"move-inline":r.push(t);break;default:console.warn("Unknown type of drop handler.",t)}}),this.dropHandlers=[new Lf(r),new Rf,new Ff(o,this.context),new Bf],wu&&(this.el=wf.wrapNativeElement(document),this.el.on("dragstart",this.onDragStart,this),this.el.on("drop",this.onDragEnd,this),this.el.on("dragenter",this.onDragEnter,this),this.el.on("dragexit",this.onDragExit,this),this.el.on("mousedown",this.onMousedown,this))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.el&&this.el.off(this)},e.prototype.onDragStart=function(t){this._initDrag(t,{external:!1});var e=document.createElement("img");e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",t.dataTransfer.setDragImage(e,0,0),"inline"===this.dragState.mode?t.dataTransfer.setData("text/html",e.outerHTML):t.dataTransfer.setData("text/html","<div></div>")},e.prototype.onDragEnter=function(t){this.dragState||this._initDrag(t,{external:!0})},e.prototype.onDragEnd=function(t){t.__reserved__||this.dragState&&(t.stopPropagation(),t.preventDefault(),this._onDragEnd(t))},e.prototype.onDragExit=function(t){Pf.isFF||this._onDragEnd(t)},e.prototype.extendDragState=function(t){Object.assign(this.dragState,t)},e.prototype.onMousedown=function(t){this.dragState&&(this.dragState=null,this._onDragEnd(t))},e.prototype._onDragEnd=function(t){this.dragState?this._handleDrop(t):console.warn("Not in a valid drag state."),this.emit("drag:finished"),this.dragState=null},e.prototype._handleDrop=function(t){var e,n,o=this,r=this.dragState,i=!1;for(r.event=t,r.data=this._getData(t),e=0;e<this.dropHandlers.length&&!i;e++)n=o.dropHandlers[e],i=n.match(r);if(i){var s=this.context.editorSession;s.transaction(function(t){n.drop(t,r)})}else console.error("No drop handler could be found.")},e.prototype._initDrag=function(t,e){function n(){t.preventDefault(),t.stopPropagation()}var o=this._getSelection(),r=Object.assign({startEvent:t},e);if(this.dragState=r,r.external)return r.selectionDrag=!1,r.sourceSelection=null,r.scrollPanes=this._getSurfacesGroupedByScrollPane(),void this.emit("drag:started",r);var i=(o.isPropertySelection()||o.isContainerSelection())&&Mn(t);if(i)return o.isContainerSelection()?(console.warn("Dragging of ContainerSelection is not supported yet."),n()):(r.inline=!0,r.selectionDrag=!0,void(r.sourceSelection=o));var s=Ef.unwrap(t.target);if(!s)return n();var a;if(s._isInlineNodeComponent?(a=s,r.inline=!0,r.sourceNode=s.props.node):a=s.context.isolatedNodeComponent,!a)return n();var p=a.context.surface;if(a._isInlineNodeComponent){var c=a.props.node;return r.inline=!0,r.selectionDrag=!0,void(r.sourceSelection={type:"property",path:c.start.path,startOffset:c.start.offset,endOffset:c.end.offset,containerId:p.getContainerId(),surfaceId:p.id})}r.selectionDrag=!1,r.nodeDrag=!0,r.sourceSelection={type:"node",nodeId:a.props.node.id,containerId:p.getContainerId(),surfaceId:p.id},r.scrollPanes=this._getSurfacesGroupedByScrollPane(),this.emit("drag:started",r)},e.prototype._getSurfacesGroupedByScrollPane=function(){var t=this.context.surfaceManager.getSurfaces(),e={};return t.forEach(function(t){if(t.isContainerEditor()){var n=t.context.scrollPane,o=n.getName(),r=t.getName();if(e[o])e[o].surfaces[r]=t;else{var i={};i[r]=t,e[o]={scrollPane:n,surfaces:i}}}}),e},e.prototype._getSelection=function(){return this.context.editorSession.getSelection()},e.prototype._getComponents=function(t){for(var e=[],n=t;n;){var o=Ef.getComponentForDOMElement(n);if(o&&(e.unshift(o),o._isSurface))return e;n=n.parentNode}return null},e.prototype._getIsolatedNodeOrContainerChild=function(t){var e,n;for(n=t,e=n.parentNode;e;){if(e._comp&&e._comp._isContainerEditor)return n._comp;if(n._comp&&n._comp._isIsolatedNode)return n._comp;n=e,e=n.parentNode}},e.prototype._extractUris=function(t){var e=[],n=t.getData("text/uri-list");return n&&(e=n.split("\n").filter(function(t){return!t.startsWith("#")})),e},e.prototype._getData=function(t){var e=t.dataTransfer;return e?{files:Array.prototype.slice.call(e.files),uris:this._extractUris(e),text:e.getData("text/plain"),html:e.getData("text/html")}:void 0},e}(vu),Rf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.match=function(t){var e=t.dropParams,n=e.insertPos;return!t.external&&t.nodeDrag&&"place"===t.dropType&&n>=0},e.prototype.drop=function(t,e){var n=e.dropParams,o=n.insertPos;t.setSelection(e.sourceSelection);var r=t.copySelection();t.deleteSelection({clear:!0});var i=e.targetSurface.getContainerId(),s=e.targetSurface.getName(),a=t.get(i),p=a.nodes[o],c="before";p||(p=a.nodes[o-1],c="after"),t.setSelection({type:"node",nodeId:p,mode:c,containerId:i,surfaceId:s}),t.paste(r)},e}(Of),Lf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.match=function(t){return!t.external&&t.inline},e.prototype.drop=function(t,e){var n=e.event,o=e.sourceSelection,r=Tn(n);if(r){var i=Ef.unwrap(n.target);if(i){var s=i.context.domSelection;if(s){var a=s.mapDOMRange(r);if(a){var p=t.getDocument()._createSelectionFromRange(a);t.selection=o;var c=t.copySelection();t.deleteSelection(),t.selection=el.transformSelection(p,t),t.paste(c)}}}}},e}(Of),Ff=function(t){function e(e,n){t.call(this),this.assetHandlers=e,this.context=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.match=function(t){return"place"===t.dropType&&t.external},e.prototype.drop=function(t,e){var n=this,o=e.dropParams,r=o.insertPos,i=e.data.files,s=e.data.uris,a=e.targetSurface.getContainerId(),p=e.targetSurface.id,c=t.get(a),u=c.nodes[r],h="before";u||(u=c.nodes[r-1],h="after"),t.setSelection({type:"node",nodeId:u,mode:h,containerId:a,surfaceId:p}),i.length>0?i.forEach(function(e){n._callHandlers(t,{file:e,type:"file"})}):s.length>0?s.forEach(function(e){n._callHandlers(t,{uri:e,type:"uri"})}):console.info("TODO: implement html/text drop here")},e.prototype._callHandlers=function(t,e){var n,o,r=this;for(n=0;n<this.assetHandlers.length;n++){o=r.assetHandlers[n];var i=o.match(e,r.context);if(i){o.drop(t,e,r.context);break}}},e}(Of),Bf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.match=function(t){return"custom"===t.dropType},e.prototype.drop=function(t,e){e.component.handleDrop(t,e)},e}(Of),Hf=["keydown","keyup","keypress","mousedown","mouseup","copy"],Uf=function(t,e){this.editorSession=t,this.surfaceManager=e,this.listeners=[],this.initialize()};Uf.prototype.initialize=function(){if(wu){var t=wf.wrapNativeElement(window.document);Hf.forEach(function(e){t.on(e,this._dispatch.bind(this,e),this)}.bind(this))}},Uf.prototype.dispose=function(){if(wu){var t=wf.wrapNativeElement(window.document);t.off(this)}},Uf.prototype.addEventListener=function(t,e,n){if(!n.id)throw new Error("GlobalEventHandler can only be used with option 'id'");var o=new pf(t,e,n);this.listeners.push(o)},Uf.prototype.removeEventListener=function(t){var e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)},Uf.prototype.getEventListeners=function(){return this.listeners},Uf.prototype._getActiveListener=function(t){var e=this,n=this.editorSession,o=n.getSelection();if(o)for(var r=o.surfaceId,i=0;i<this.listeners.length;i++){var s=e.listeners[i];if(s.eventName===t&&s.options.id===r)return s}},Uf.prototype._dispatch=function(t,e){var n=this._getActiveListener(t);n&&n.handler(e)},Uf.prototype.on=sf.prototype.on,Uf.prototype.off=sf.prototype.off;var zf=function(t,e){this.context=t,this.macros=e,this.context.editorSession.onFinalize("document",this.onDocumentChanged,this)};zf.prototype.dispose=function(){this.context.editorSession.off(this)},zf.prototype.onDocumentChanged=function(t,e){this.executeMacros(t,e)},zf.prototype.executeMacros=function(t,e){var n,o,r,i,s,a,p=this,c=this.context.editorSession.getDocument();switch(e.action){case"type":var u=t.ops[0];"update"===u.type&&u.diff._isTextOperation&&(a=u.path,n=a[0],o=c.get(n),r=c.get(a),i=u.diff.pos,s=i+u.diff.getLength());break;case"break":var h=t.before.selection;if(!h.isPropertySelection())return;if(a=h.path,n=a[0],o=c.get(n),!o||!o.isText())return;r=o.getText(),i=h.start.offset,s=i;break;case"paste":if(1===t.ops.length){var l=t.ops[0];if("update"===l.type&&"string"===l.propertyType){if(a=l.path,n=a[0],o=c.get(n),!o.isText())return;r=o.getText(),i=l.diff.pos,s=i+l.diff.getLength()}}break;default:return}var f={action:e.action,node:o,path:a,text:r,start:i,end:s,editorSession:this.context.editorSession,selection:this.context.editorSession.getSelection()};setTimeout(function(){for(var t=0;t<p.macros.length;t++){var e=p.macros[t],n=e.execute(f,p.context);if(n)break}})};var Wf={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32},Jf=function(t,e){this.editorSession=t,this.commandName=e};Jf.prototype.execute=function(t){var e=t.editorSession.getCommandStates()[this.commandName];return!e||e.disabled?!1:(this.editorSession.executeCommand(this.commandName,t),!0)};var qf=function(t,e,n){var o=this;this.editorSession=t,this.context=n.context||{},this.keydownBindings={},this.textinputBindings={},e.forEach(function(e){var n=e.key,r=e.spec,i=r.type||"keydown";if(!r.command)throw new Error("Keyboard binding not supported",r);var s=new Jf(t,r.command),a=s.execute.bind(s);"keydown"===i?o.keydownBindings[jn(n)]=a:"textinput"===i&&(o.textinputBindings[n]=a)})};qf.prototype.onKeydown=function(t){var e=kn(t),n=this.keydownBindings[e];if(n){t.preventDefault(),t.stopPropagation();var o=this._getParams();return n(o,this.context)}},qf.prototype.onTextInput=function(t){var e=this.textinputBindings[t];if(e){var n=this._getParams();return e(n,this.context)}},qf.prototype._getParams=function(){var t=this.editorSession,e=t.getSelectionState(),n=e.getSelection(),o=this.context.surfaceManager.getFocusedSurface();return{editorSession:t,selectionState:e,surface:o,selection:n}},qf.parseCombo=jn;var Vf=function(e,n,o){var r=this;this.editorSession=e,this.extensions=n,this.proxies={},this.context=o,t(e.getDocument().getNodes(),function(t){t._isFileNode&&r.storeFile(t)}),this.editorSession.onUpdate("document",this._onDocumentChange,this)};Vf.prototype.dispose=function(){this.editorSession.off(this)},Vf.prototype.storeFile=function(t){var e=this.proxies[t.id];return e||(e=this.createFileProxy(t),e&&(this.proxies[t.id]=e)),t.proxy=e,e},Vf.prototype.createFileProxy=function(t){for(var e=this,n=this.context,o=0;o<this.extensions.length;o++){var r=e.extensions[o];if(r.match(t,n))return new r(t,n)}console.error("No file adapter found for ",t)},Vf.prototype.getProxy=function(t){return this.proxies[t.id]},Vf.prototype.sync=function(){var t=p(this.proxies,function(t){return t.sync()});return Promise.all(t)},Vf.prototype._onDocumentChange=function(e){var n=this,o=this.editorSession.getDocument();t(e.created,function(t){var e=o.get(t.id);e._isFileNode&&n.storeFile(e)})};var Gf=function(e){function n(t,n){if(e.call(this),n=n||{},this.id=n.id||y(),this.document=t,!n.configurator)throw new Error("No configurator provided.");this.configurator=n.configurator,this._transaction=new kl(t,this),this._history=new gl,this._currentChange=null,this._selectionState=new dl(t),this._commandStates=[],this._resources=["document","selection","commandStates"],this._dirtyFlags={},this._change=null,this._info=null,this._flowStages=["update","pre-render","render","post-render","position","finalize"],this._postponed=[],this._observers={},this._lang=n.lang||this.configurator.getDefaultLanguage(),this._dir=n.dir||"ltr",this.surfaceManager=new yl(this),this._context={editorSession:this,surfaceManager:this.surfaceManager},n.context&&Object.assign(this._context,n.context);var o=this.configurator,r=o.getCommands(),i=o.getDropHandlers(),s=o.getMacros(),a=o.getConverterRegistry(),p=o.getEditingBehavior();this.fileManager=n.fileManager||new Vf(this,o.getFileAdapters(),this._context),this._hasUnsavedChanges=!1,this._isSaving=!1,n.saveHandler?this.saveHandler=n.saveHandler:this.saveHandler=o.getSaveHandler(),this.commandManager=new Fl(this._context,r),this.dragManager=new jf(i,Object.assign({},this._context,{commandManager:this.commandManager})),this.macroManager=new zf(this._context,s),this.globalEventHandler=new Uf(this,this.surfaceManager),this.markersManager=new il(this),this.keyboardManager=new qf(this,o.getKeyboardShortcuts(),{context:this._context}),this.converterRegistry=a,this.editingBehavior=p}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.dispose=function(){this.surfaceManager.dispose(),this.fileManager.dispose(),this.commandManager.dispose(),this.dragManager.dispose(),this.macroManager.dispose(),this.globalEventHandler.dispose(),this.markersManager.dispose()},n.prototype.hasChanged=function(t){return this._dirtyFlags[t]},n.prototype.hasDocumentChanged=function(){return this.hasChanged("document")},n.prototype.hasSelectionChanged=function(){return this.hasChanged("selection")},n.prototype.hasCommandStatesChanged=function(){return this.hasChanged("commandStates")},n.prototype.hasLanguageChanged=function(){return this.hasChanged("lang")},n.prototype.hasTextDirectionChanged=function(){return this.hasChanged("dir")},n.prototype.get=function(t){switch(t){case"document":return this.getDocument();case"selection":return this.getSelection();case"commandStates":return this.getCommandStates();case"change":return this.getChange();default:throw new Error("Unknown resource: "+t)}},n.prototype.getConfigurator=function(){return this.configurator},n.prototype.getDocument=function(){return this.document},n.prototype.getSelection=function(){return this.getSelectionState().getSelection()},n.prototype.getSelectionState=function(){return this._selectionState},n.prototype.getCommandStates=function(){return this._commandStates},n.prototype.getChange=function(){return this._change},n.prototype.getChangeInfo=function(){return this._info},n.prototype.getFocusedSurface=function(){return this.surfaceManager.getFocusedSurface()},n.prototype.getSurface=function(t){return this.surfaceManager.getSurface(t)},n.prototype.getLanguage=function(){return this._lang},n.prototype.getTextDirection=function(){return this._dir},n.prototype.canUndo=function(){return this._history.canUndo()},n.prototype.canRedo=function(){return this._history.canRedo()},n.prototype.executeCommand=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];(n=this.commandManager).executeCommand.apply(n,t);var n},n.prototype.setSelection=function(t){if(t&&c(t)&&(t=this.getDocument().createSelection(t)),t&&!t.isNull()&&!t.surfaceId){var e=this.getFocusedSurface();e&&(t.surfaceId=e.id)}return this._setSelection(t)&&this.startFlow(),t},n.prototype.selectNode=function(t){var e=this.getFocusedSurface();this.setSelection({type:"node",nodeId:t,containerId:e.getContainerId(),surfaceId:e.id})},n.prototype.setCommandStates=function(t){this._commandStates=t,this._setDirty("commandStates")},n.prototype.setLanguage=function(t){this._lang!==t&&(this._lang=t,this._setDirty("lang"),this.startFlow())},n.prototype.setTextDirection=function(t){this._dir!==t&&(this._dir=t,this._setDirty("dir"),this.startFlow())},n.prototype.createSelection=function(){var t=this.getDocument();return t.createSelection.apply(t,arguments)},n.prototype.getCollaborators=function(){return null},n.prototype.setSaveHandler=function(t){this.saveHandler=t},n.prototype.transaction=function(t,e){e=e||{};var n=this._transaction._recordChange(t,this.getSelection(),this.getFocusedSurface());return n?this._commit(n,e):(this._setSelection(this._transaction.getSelection()),this.startFlow()),n},n.prototype.undo=function(){this._undoRedo("undo")},n.prototype.redo=function(){this._undoRedo("redo")},n.prototype.onUpdate=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this._registerObserver("update",t)},n.prototype.onPreRender=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this._registerObserver("pre-render",t)},n.prototype.onRender=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this._registerObserver("render",t)},n.prototype.onPostRender=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this._registerObserver("post-render",t)},n.prototype.onPosition=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this._registerObserver("position",t)},n.prototype.onFinalize=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this._registerObserver("finalize",t)},n.prototype.off=function(t){e.prototype.off.call(this,t),this._deregisterObserver(t)},n.prototype._setSelection=function(t){var e=this.getSelectionState().setSelection(t);return e&&this._setDirty("selection"),e},n.prototype._undoRedo=function(t){var e,n,o=this.getDocument();"redo"===t?(e=this._history.undoneChanges,n=this._history.doneChanges):(e=this._history.doneChanges,n=this._history.undoneChanges);var r=e.pop();if(r){this._applyChange(r,{}),this._transaction._apply(r),n.push(r.invert());var i=r.after.selection;i&&i.attach(o),this._setSelection(i),this.startFlow()}else console.warn("No change can be %s.","undo"===t?"undone":"redone")},n.prototype._transformLocalChangeHistory=function(t){var e={ops:t.ops.map(function(t){return t.clone()})};el.transformInplace(e,this._history.doneChanges),el.transformInplace(e,this._history.undoneChanges)},n.prototype._transformSelection=function(t){var e=this.getSelection(),n=el.transformSelection(e,t);return n},n.prototype._commit=function(t,e){this._commitChange(t,e),this._hasUnsavedChanges=!0,this.startFlow()},n.prototype._commitChange=function(t,e){t.timestamp=Date.now(),this._applyChange(t,e),e.history===!1||e.hidden||this._history.push(t.invert());var n=t.after.selection||qh.nullSelection;n.isNull()||n.surfaceId||(n.surfaceId=t.after.surfaceId),this._setSelection(n)},n.prototype._applyChange=function(t,e){return t?(this.getDocument()._apply(t),this._setDirty("document"),this._change=t,void(this._info=e)):void console.error("FIXME: change is null.")},n.prototype.hasUnsavedChanges=function(){return this._hasUnsavedChanges},n.prototype.save=function(){var t=this,e=this.saveHandler;if(this._hasUnsavedChanges&&!this._isSaving){if(this._isSaving=!0,e){var n={editorSession:this,fileManager:this.fileManager};return e.saveDocument(n).then(function(){t._hasUnsavedChanges=!1,t.setSelection(t.getSelection())})["catch"](function(t){console.error("Error during save",t)}).then(function(){t._isSaving=!1})}return console.error("Document saving is not handled at the moment. Make sure saveHandler instance provided to editorSession"),Promise.reject()}},n.prototype.startFlow=function(){if(!this._flowing){this._flowing=!0;try{this.performFlow()}finally{this._resetFlow(),this._flowing=!1}var t=this._postponed,e=this;this._postponed=[],setTimeout(function(){t.forEach(function(t){t(e)})},0)}},n.prototype.performFlow=function(){var t=this;this._flowStages.forEach(function(e){t._notifyObservers(e)})},n.prototype.postpone=function(t){this._postponed.push(t)},n.prototype._parseObserverArgs=function(t){var e={resource:null,handler:null,context:null,options:{}},n=0,o=t[n];if(_(o)&&(e.resource=o,n++,o=t[n]),!o)throw new Error("Provided handler function was nil.");if(!re(o))throw new Error("Expecting a handler Function.");return e.handler=o,n++,o=t[n],o&&(e.context=o,n++,o=t[n]),o&&(e.options=o),e},n.prototype._registerObserver=function(t,e){var n=this._parseObserverArgs(e),o=this._observers[t];o||(o=this._observers[t]=[]),o.push(n)},n.prototype._deregisterObserver=function(e){t(this._observers,function(t){for(var n=0;n<t.length;n++){var o=t[n];o.context===e&&(t.splice(n,1),n--)}}),e._deregistered=!0},n.prototype._notifyObservers=function(t){var e=this,n=this._observers[t];if(n)for(var o=n.slice(),r=0;r<o.length;r++){var i=o[r];if(!i._deregistered)if(i.resource)if("document"===i.resource){if(!e.hasDocumentChanged())continue;var s=e.getChange(),a=e.getChangeInfo(),p=i.options.path;p?s.isAffected(p)&&i.handler.call(i.context,s,a,e):i.handler.call(i.context,s,a,e)}else{if(!e.hasChanged(i.resource))continue;var c=e.get(i.resource);i.handler.call(i.context,c,e)}else i.handler.call(i.context,e)}},n.prototype._setDirty=function(t){this._dirtyFlags[t]=!0},n.prototype._resetFlow=function(){var t=this;Object.keys(this._dirtyFlags).forEach(function(e){t._dirtyFlags[e]=!1}),this._change=null,this._info=null},n}(vu),$f=function(t){this.config=t};$f.prototype.createDocument=function(t,e){Rn("POST",this.config.httpUrl,t,e)},$f.prototype.getDocument=function(t,e){Rn("GET",this.config.httpUrl+t,null,e)},$f.prototype.deleteDocument=function(t,e){Rn("DELETE",this.config.httpUrl+t,null,e)};var Kf=NaN,Xf=Bn(function(t,e){return t+e}),Yf="Expected a function",Qf=O(Tu,"WeakMap"),Zf=Qf&&new Qf,td=Zf?function(t,e){return Zf.set(t,e),t}:Un,ed=Object.create,nd=1,od=Math.max,rd=Math.max,id=4294967295;Kn.prototype=zn($n.prototype),Kn.prototype.constructor=Kn;var sd=Zf?function(t){return Zf.get(t)}:Xn,ad={},pd=Object.prototype,cd=pd.hasOwnProperty;Qn.prototype=zn($n.prototype),Qn.prototype.constructor=Qn;var ud=Object.prototype,hd=ud.hasOwnProperty;eo.prototype=$n.prototype,eo.prototype.constructor=eo;var ld=150,fd=16,dd=function(){var t=0,e=0;return function(n,o){var r=oo(),i=fd-(r-e);if(e=r,i>0){if(++t>=ld)return n}else t=0;return td(n,o)}}(),gd=1,yd=2,vd=4,md=8,_d=32,wd=64,bd=Math.min,Cd="__lodash_placeholder__",Sd=1,xd=2,Ed=8,Nd=16,Id=128,Od=512,Td=1,Pd="__lodash_placeholder__",Dd=1,Ad=2,Md=4,kd=8,jd=128,Rd=256,Ld=Math.min,Fd="Expected a function",Bd=1,Hd=2,Ud=8,zd=16,Wd=32,Jd=64,qd=Math.max,Vd=128,Gd=Object.prototype,$d=Object.keys,Kd="[object Arguments]",Xd=Object.prototype,Yd=Xd.hasOwnProperty,Qd=Xd.toString,Zd=Xd.propertyIsEnumerable,tg="[object String]",eg=Object.prototype,ng=eg.toString,og=Object.prototype,rg=og.hasOwnProperty,ig=og.propertyIsEnumerable,sg=!ig.call({valueOf:1},"valueOf"),ag=vo(function(t,e){if(sg||mo(e)||Xe(e))return void go(e,xo(e),t);for(var n in e)rg.call(e,n)&&at(t,n,e[n])}),pg=Tu.Reflect,cg=Object.prototype,ug=pg?pg.enumerate:void 0,hg=cg.propertyIsEnumerable;ug&&!hg.call({valueOf:1},"valueOf")&&(No=function(t){return Eo(ug(t))});var lg=No,fg=Object.prototype,dg=fg.hasOwnProperty,gg=Object.prototype,yg=gg.propertyIsEnumerable,vg=!yg.call({valueOf:1},"valueOf"),mg=vo(function(t,e){if(vg||mo(e)||Xe(e))return void go(e,Io(e),t);for(var n in e)at(t,n,e[n])}),_g=vo(function(t,e,n,o){go(e,Io(e),t,o)}),wg=vo(function(t,e,n,o){go(e,xo(e),t,o)}),bg=nn(function(t,e){return Oo(t,Do(e,1))}),Cg="[object Error]",Sg=Object.prototype,xg=Sg.toString,Eg=nn(function(t,e){try{return Qe(t,void 0,e)}catch(n){return Ao(n)?n:new Error(n)}}),Ng="Expected a function",Ig=1,Og=32,Tg=nn(function(t,e,n){var o=Ig;if(n.length){var r=ao(n,io(Tg));o|=Og}return lo(t,o,e,n,r)});Tg.placeholder={};var Pg=nn(function(t,e){return ko(Do(e,1),function(e){e=rt(e),t[e]=Tg(t[e],t)}),t}),Dg=1,Ag=2,Mg=32,kg=nn(function(t,e,n){var o=Dg|Ag;if(n.length){var r=ao(n,io(kg));o|=Mg}return lo(e,o,t,n,r)});kg.placeholder={};var jg="\\ud800-\\udfff",Rg="\\u0300-\\u036f\\ufe20-\\ufe23",Lg="\\u20d0-\\u20f0",Fg="\\ufe0e\\ufe0f",Bg="\\u200d",Hg=RegExp("["+Bg+jg+Rg+Lg+Fg+"]"),Ug="\\ud800-\\udfff",zg="\\u0300-\\u036f\\ufe20-\\ufe23",Wg="\\u20d0-\\u20f0",Jg="\\ufe0e\\ufe0f",qg="["+Ug+"]",Vg="["+zg+Wg+"]",Gg="\\ud83c[\\udffb-\\udfff]",$g="(?:"+Vg+"|"+Gg+")",Kg="[^"+Ug+"]",Xg="(?:\\ud83c[\\udde6-\\uddff]){2}",Yg="[\\ud800-\\udbff][\\udc00-\\udfff]",Qg="\\u200d",Zg=$g+"?",ty="["+Jg+"]?",ey="(?:"+Qg+"(?:"+[Kg,Xg,Yg].join("|")+")"+ty+Zg+")*",ny=ty+Zg+ey,oy="(?:"+[Kg+Vg+"?",Vg,Xg,Yg,qg].join("|")+")",ry=RegExp(Gg+"(?="+Gg+")|"+oy+ny,"g"),iy=Lo("toUpperCase"),sy={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},ay=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,py="\\u0300-\\u036f\\ufe20-\\ufe23",cy="\\u20d0-\\u20f0",uy="["+py+cy+"]",hy=RegExp(uy,"g"),ly=/[a-zA-Z0-9]+/g,fy="\\ud800-\\udfff",dy="\\u0300-\\u036f\\ufe20-\\ufe23",gy="\\u20d0-\\u20f0",yy="\\u2700-\\u27bf",vy="a-z\\xdf-\\xf6\\xf8-\\xff",my="\\xac\\xb1\\xd7\\xf7",_y="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",wy="\\u2000-\\u206f",by=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Cy="A-Z\\xc0-\\xd6\\xd8-\\xde",Sy="\\ufe0e\\ufe0f",xy=my+_y+wy+by,Ey="['’]",Ny="["+xy+"]",Iy="["+dy+gy+"]",Oy="\\d+",Ty="["+yy+"]",Py="["+vy+"]",Dy="[^"+fy+xy+Oy+yy+vy+Cy+"]",Ay="\\ud83c[\\udffb-\\udfff]",My="(?:"+Iy+"|"+Ay+")",ky="[^"+fy+"]",jy="(?:\\ud83c[\\udde6-\\uddff]){2}",Ry="[\\ud800-\\udbff][\\udc00-\\udfff]",Ly="["+Cy+"]",Fy="\\u200d",By="(?:"+Py+"|"+Dy+")",Hy="(?:"+Ly+"|"+Dy+")",Uy="(?:"+Ey+"(?:d|ll|m|re|s|t|ve))?",zy="(?:"+Ey+"(?:D|LL|M|RE|S|T|VE))?",Wy=My+"?",Jy="["+Sy+"]?",qy="(?:"+Fy+"(?:"+[ky,jy,Ry].join("|")+")"+Jy+Wy+")*",Vy=Jy+Wy+qy,Gy="(?:"+[Ty,jy,Ry].join("|")+")"+Vy,$y=RegExp([Ly+"?"+Py+"+"+Uy+"(?="+[Ny,Ly,"$"].join("|")+")",Hy+"+"+zy+"(?="+[Ny,Ly+By,"$"].join("|")+")",Ly+"?"+By+"+"+Uy,Ly+"+"+zy,Oy,Gy].join("|"),"g"),Ky=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Xy="['’]",Yy=RegExp(Xy,"g"),Qy=Wo(function(t,e,n){
return e=e.toLowerCase(),t+(n?Fo(e):e)}),Zy=Math.min,tv=qo("ceil"),ev=Math.ceil,nv=Math.max,ov=200;er.prototype.clear=Xo,er.prototype["delete"]=Yo,er.prototype.get=Qo,er.prototype.has=Zo,er.prototype.set=tr;var rv=Object.getOwnPropertySymbols;rv||(ir=rr);var iv=ir,sv=O(Tu,"DataView"),av=O(Tu,"Promise"),pv=O(Tu,"Set"),cv="[object Map]",uv="[object Object]",hv="[object Promise]",lv="[object Set]",fv="[object WeakMap]",dv="[object DataView]",gv=Object.prototype,yv=gv.toString,vv=E(sv),mv=E($u),_v=E(av),wv=E(pv),bv=E(Qf);(sv&&cr(new sv(new ArrayBuffer(1)))!=dv||$u&&cr(new $u)!=cv||av&&cr(av.resolve())!=hv||pv&&cr(new pv)!=lv||Qf&&cr(new Qf)!=fv)&&(cr=function(t){var e=yv.call(t),n=e==uv?t.constructor:void 0,o=n?E(n):void 0;if(o)switch(o){case vv:return dv;case mv:return cv;case _v:return hv;case wv:return lv;case bv:return fv}return e});var Cv=cr,Sv=Object.prototype,xv=Sv.hasOwnProperty,Ev=Tu.Uint8Array,Nv=/\w*$/,Iv=Xu?Xu.prototype:void 0,Ov=Iv?Iv.valueOf:void 0,Tv="[object Boolean]",Pv="[object Date]",Dv="[object Map]",Av="[object Number]",Mv="[object RegExp]",kv="[object Set]",jv="[object String]",Rv="[object Symbol]",Lv="[object ArrayBuffer]",Fv="[object DataView]",Bv="[object Float32Array]",Hv="[object Float64Array]",Uv="[object Int8Array]",zv="[object Int16Array]",Wv="[object Int32Array]",Jv="[object Uint8Array]",qv="[object Uint8ClampedArray]",Vv="[object Uint16Array]",Gv="[object Uint32Array]",$v="object"==typeof exports&&exports,Kv=$v&&"object"==typeof module&&module,Xv=Kv&&Kv.exports===$v,Yv=Xv?Tu.Buffer:void 0,Qv=Yv?function(t){return t instanceof Yv}:xr,Zv="[object Arguments]",tm="[object Array]",em="[object Boolean]",nm="[object Date]",om="[object Error]",rm="[object Function]",im="[object GeneratorFunction]",sm="[object Map]",am="[object Number]",pm="[object Object]",cm="[object RegExp]",um="[object Set]",hm="[object String]",lm="[object Symbol]",fm="[object WeakMap]",dm="[object ArrayBuffer]",gm="[object DataView]",ym="[object Float32Array]",vm="[object Float64Array]",mm="[object Int8Array]",_m="[object Int16Array]",wm="[object Int32Array]",bm="[object Uint8Array]",Cm="[object Uint8ClampedArray]",Sm="[object Uint16Array]",xm="[object Uint32Array]",Em={};Em[Zv]=Em[tm]=Em[dm]=Em[gm]=Em[em]=Em[nm]=Em[ym]=Em[vm]=Em[mm]=Em[_m]=Em[wm]=Em[sm]=Em[am]=Em[pm]=Em[cm]=Em[um]=Em[hm]=Em[lm]=Em[bm]=Em[Cm]=Em[Sm]=Em[xm]=!0,Em[om]=Em[rm]=Em[fm]=!1;var Nm=1,Im=2,Om=1,Tm=2,Pm="[object Boolean]",Dm="[object Date]",Am="[object Error]",Mm="[object Map]",km="[object Number]",jm="[object RegExp]",Rm="[object Set]",Lm="[object String]",Fm="[object Symbol]",Bm="[object ArrayBuffer]",Hm="[object DataView]",Um=Xu?Xu.prototype:void 0,zm=Um?Um.valueOf:void 0,Wm=2,Jm="[object Arguments]",qm="[object Array]",Vm="[object Boolean]",Gm="[object Date]",$m="[object Error]",Km="[object Function]",Xm="[object Map]",Ym="[object Number]",Qm="[object Object]",Zm="[object RegExp]",t_="[object Set]",e_="[object String]",n_="[object WeakMap]",o_="[object ArrayBuffer]",r_="[object DataView]",i_="[object Float32Array]",s_="[object Float64Array]",a_="[object Int8Array]",p_="[object Int16Array]",c_="[object Int32Array]",u_="[object Uint8Array]",h_="[object Uint8ClampedArray]",l_="[object Uint16Array]",f_="[object Uint32Array]",d_={};d_[i_]=d_[s_]=d_[a_]=d_[p_]=d_[c_]=d_[u_]=d_[h_]=d_[l_]=d_[f_]=!0,d_[Jm]=d_[qm]=d_[o_]=d_[Vm]=d_[r_]=d_[Gm]=d_[$m]=d_[Km]=d_[Xm]=d_[Ym]=d_[Qm]=d_[Zm]=d_[t_]=d_[e_]=d_[n_]=!1;var g_=Object.prototype,y_=g_.toString,v_=2,m_="[object Arguments]",__="[object Array]",w_="[object Object]",b_=Object.prototype,C_=b_.hasOwnProperty,S_=1,x_=2,E_=1,N_=2,I_="Expected a function",O_=oi(),T_=ii(ri),P_=Object.prototype,D_=P_.hasOwnProperty,A_=ai(function(t,e,n){D_.call(t,n)?++t[n]:t[n]=1}),M_=8;ci.placeholder={};var k_=16;ui.placeholder={};var j_="Expected a function",R_=Math.max,L_=Math.min,F_=Object.prototype,B_=F_.hasOwnProperty,H_=nn(function(t){return t.push(void 0,li),Qe(_g,void 0,t)}),U_="[object Object]",z_=Object.prototype,W_=Function.prototype.toString,J_=z_.hasOwnProperty,q_=W_.call(Object),V_=z_.toString,G_=vo(function(t,e,n,o){vi(t,e,n,o)}),$_=nn(function(t){return t.push(void 0,mi),Qe(G_,void 0,t)}),K_="Expected a function",X_=nn(function(t,e){return _i(t,1,e)}),Y_=nn(function(t,e,n){return _i(t,Ze(e)||0,n)}),Q_=nn(function(t,e){return Ye(t)?Ge(t,Do(e,1,Ye,!0)):[]}),Z_=nn(function(t,e){var n=ft(e);return Ye(n)&&(n=void 0),Ye(t)?Ge(t,Do(e,1,Ye,!0),Yr(n)):[]}),tw=nn(function(t,e){var n=ft(e);return Ye(n)&&(n=void 0),Ye(t)?Ge(t,Do(e,1,Ye,!0),void 0,n):[]}),ew=Bn(function(t,e){return t/e}),nw=oi(!0),ow=ii(Ii,!0),rw="[object Map]",iw="[object Set]",sw=Ai(xo),aw=Ai(Io),pw={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},cw=/[&<>"'`]/g,uw=RegExp(cw.source),hw=/[\\^$.*+?()[\]{}|]/g,lw=RegExp(hw.source),fw=4294967295,dw=Math.max,gw=qi(Gi),yw=Math.max,vw=Math.min,mw=qi(Xi),_w=1/0,ww=1/0,bw=512,Cw=qo("floor"),Sw=200,xw="Expected a function",Ew=8,Nw=32,Iw=128,Ow=256,Tw=ps(),Pw=ps(!0),Dw=Object.prototype,Aw=Dw.hasOwnProperty,Mw=ai(function(t,e,n){Aw.call(t,n)?t[n].push(e):t[n]=[e]}),kw=ms(vs),jw=ms(function(t,e){return t>=e}),Rw=Math.max,Lw=Math.min,Fw=Math.max,Bw=Math.max,Hw=Math.min,Uw=nn(function(t){var e=Je(t,Os);return e.length&&e[0]===t[0]?Is(e):[]}),zw=nn(function(t){var e=ft(t),n=Je(t,Os);return e===ft(n)?e=void 0:n.pop(),n.length&&n[0]===t[0]?Is(n,Yr(e)):[]}),Ww=nn(function(t){var e=ft(t),n=Je(t,Os);return e===ft(n)?e=void 0:n.pop(),n.length&&n[0]===t[0]?Is(n,void 0,e):[]}),Jw=Ps(function(t,e,n){t[e]=n},ei(Un)),qw=Object.prototype,Vw=qw.hasOwnProperty,Gw=Ps(function(t,e,n){Vw.call(t,e)?t[e].push(n):t[e]=[n]},Yr),$w=nn(Ds),Kw=nn(function(t,e,n){var o=-1,r="function"==typeof e,i=ot(e),s=Xe(t)?Array(t.length):[];return T_(t,function(t){var a=r?e:i&&null!=t?t[e]:void 0;s[++o]=a?Qe(a,t,n):Ds(t,e,n)}),s}),Xw="[object ArrayBuffer]",Yw=Object.prototype,Qw=Yw.toString,Zw="[object Boolean]",tb=Object.prototype,eb=tb.toString,nb="[object Date]",ob=Object.prototype,rb=ob.toString,ib="[object Map]",sb="[object Set]",ab=Object.prototype,pb=ab.hasOwnProperty,cb=ab.propertyIsEnumerable,ub=!cb.call({valueOf:1},"valueOf"),hb=Tu.isFinite,lb="[object Map]",fb="[object Number]",db=Object.prototype,gb=db.toString,yb=Pu?b:xr,vb="[object RegExp]",mb=Object.prototype,_b=mb.toString,wb=9007199254740991,bb="[object Set]",Cb="[object WeakMap]",Sb="[object WeakSet]",xb=Object.prototype,Eb=xb.toString,Nb=Array.prototype,Ib=Nb.join,Ob=Wo(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Tb=ai(function(t,e,n){t[n]=e}),Pb=Math.max,Db=Math.min,Ab=Wo(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),Mb=Lo("toLowerCase"),kb=ms(ra),jb=ms(function(t,e){return e>=t}),Rb=NaN,Lb=vo(function(t,e,n){vi(t,e,n)}),Fb=nn(function(t,e){return function(n){return Ds(n,t,e)}}),Bb=nn(function(t,e){return function(n){return Ds(t,n,e)}}),Hb=Bn(function(t,e){return t*e}),Ub="Expected a function",zb="[object Map]",Wb="[object Set]",Jb="symbol"==typeof(Jb=Xu&&Xu.iterator)?Jb:void 0,qb=Object.getOwnPropertySymbols,Vb=qb?function(t){for(var e=[];t;)To(e,iv(t)),t=ht(t);return e}:iv,Gb=nn(function(t,e){return null==t?{}:(e=Je(Do(e,1),rt),Ea(t,Ge(Na(t),e)))}),$b=Ra(Je),Kb=Math.min,Xb=nn(function(t,e){e=1==e.length&&bu(e[0])?Je(e[0],qe(Yr)):Je(Do(e,1,ja),qe(Yr));var n=e.length;return nn(function(o){for(var r=this,i=-1,s=Kb(o.length,n);++i<s;)o[i]=e[i].call(r,o[i]);return Qe(t,this,o)})}),Yb=Ra(Ri),Qb=Ra(Mr),Zb=9007199254740991,tC=Math.floor,eC="\\ud800-\\udfff",nC="\\u0300-\\u036f\\ufe20-\\ufe23",oC="\\u20d0-\\u20f0",rC="\\ufe0e\\ufe0f",iC="["+eC+"]",sC="["+nC+oC+"]",aC="\\ud83c[\\udffb-\\udfff]",pC="(?:"+sC+"|"+aC+")",cC="[^"+eC+"]",uC="(?:\\ud83c[\\udde6-\\uddff]){2}",hC="[\\ud800-\\udbff][\\udc00-\\udfff]",lC="\\u200d",fC=pC+"?",dC="["+rC+"]?",gC="(?:"+lC+"(?:"+[cC,uC,hC].join("|")+")"+dC+fC+")*",yC=dC+fC+gC,vC="(?:"+[cC+sC+"?",sC,uC,hC,iC].join("|")+")",mC=RegExp(aC+"(?="+aC+")|"+vC+yC,"g"),_C=Math.ceil,wC=Math.ceil,bC=Math.floor,CC=/^\s+|\s+$/g,SC=/^0x/i,xC=Tu.parseInt,EC=32,NC=nn(function(t,e){var n=ao(e,io(NC));return lo(t,EC,void 0,e,n)});NC.placeholder={};var IC=64,OC=nn(function(t,e){var n=ao(e,io(OC));return lo(t,IC,void 0,e,n)});OC.placeholder={};var TC=ai(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),PC=nn(function(t,e){return null==t?{}:Ea(t,Je(Do(e,1),rt))}),DC=Array.prototype,AC=DC.splice,MC=nn(Ka),kC=Array.prototype,jC=kC.splice,RC=nn(function(t,e){e=Do(e,1);var n=t?t.length:0,o=Oo(t,e);return Qa(t,Je(e,function(t){return pt(t,n)?+t:t}).sort(Da)),o}),LC=Math.floor,FC=Math.random,BC=parseFloat,HC=Math.min,UC=Math.random,zC=Math.ceil,WC=Math.max,JC=np(),qC=np(!0),VC=256,GC=nn(function(t,e){return lo(t,VC,void 0,void 0,void 0,Do(e,1))}),$C=String.prototype,KC=$C.replace,XC=Array.prototype,YC=XC.reverse,QC=qo("round"),ZC=4294967295,tS="[object Map]",eS="[object Set]",nS=Wo(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}),oS=nn(function(t,e){if(null==t)return[];var n=e.length;return n>1&&yo(t,e[0],e[1])?e=[]:n>2&&yo(e[0],e[1],e[2])&&(e=[e[0]]),e=1==e.length&&bu(e[0])?e[0]:Do(e,1,ja),Ma(t,e,[])}),rS=4294967295,iS=rS-1,sS=Math.floor,aS=Math.min,pS=4294967295,cS=pS>>>1,uS=4294967295,hS=String.prototype,lS=hS.split,fS="Expected a function",dS=Math.max,gS=Wo(function(t,e,n){return t+(n?" ":"")+iy(e)}),yS=Bn(function(t,e){return t-e}),vS={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},mS=/<%=([\s\S]+?)%>/g,_S=/<%-([\s\S]+?)%>/g,wS=/<%([\s\S]+?)%>/g,bS={escape:_S,evaluate:wS,interpolate:mS,variable:"",imports:{_:{escape:ki}}},CS=/\b__p \+= '';/g,SS=/\b(__p \+=) '' \+/g,xS=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ES=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,NS=/($^)/,IS=/['\n\r\u2028\u2029\\]/g,OS="Expected a function",TS=9007199254740991,PS=4294967295,DS=Math.min,AS=9007199254740991,MS=/^\s+|\s+$/g,kS=/\s+$/,jS=/^\s+/,RS=30,LS="...",FS=/\w*$/,BS={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},HS=/&(?:amp|lt|gt|quot|#39|#96);/g,US=RegExp(HS.source),zS=1/0,WS=pv&&1/mr(new pv([,-0]))[1]==zS?function(t){return new pv(t)}:Xn,JS=200,qS=nn(function(t){return dc(Do(t,1,Ye,!0))}),VS=nn(function(t){var e=ft(t);return Ye(e)&&(e=void 0),dc(Do(t,1,Ye,!0),Yr(e))}),GS=nn(function(t){var e=ft(t);return Ye(e)&&(e=void 0),dc(Do(t,1,Ye,!0),void 0,e)}),$S=0,KS=Math.max,XS=Wo(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),YS=nn(function(t){t=Do(t,1);var e=t.length,n=e?t[0]:0,o=this.__wrapped__,r=function(e){return Oo(e,t)};return!(e>1||this.__actions__.length)&&o instanceof Kn&&pt(n)?(o=o.slice(n,+n+(e?1:0)),o.__actions__.push({func:Kp,args:[r],thisArg:void 0}),new Qn(o,this.__chain__).thru(function(t){return e&&!t.length&&t.push(void 0),t})):this.thru(r)}),QS=nn(function(t){return Tc(zi(t,Ye))}),ZS=nn(function(t){var e=ft(t);return Ye(e)&&(e=void 0),Tc(zi(t,Ye),Yr(e))}),tx=nn(function(t){var e=ft(t);return Ye(e)&&(e=void 0),Tc(zi(t,Ye),void 0,e)}),ex=nn(_c),nx=nn(function(t){var e=t.length,n=e>1?t[e-1]:void 0;return n="function"==typeof n?(t.pop(),n):void 0,wc(t,n)}),ox={chunk:Go,compact:Dr,concat:Ar,difference:Q_,differenceBy:Z_,differenceWith:tw,drop:wi,dropRight:bi,dropRightWhile:Si,dropWhile:xi,fill:Ui,findIndex:Gi,findLastIndex:Xi,first:Qi,flatten:rs,flattenDeep:is,flattenDepth:ss,fromPairs:fs,head:Qi,indexOf:Es,initial:Ns,intersection:Uw,intersectionBy:zw,intersectionWith:Ww,join:na,last:ft,lastIndexOf:oa,nth:Sa,pull:MC,pullAll:Ka,pullAllBy:Xa,pullAllWith:Ya,pullAt:RC,remove:pp,reverse:lp,slice:mp,sortedIndex:Sp,sortedIndexBy:xp,sortedIndexOf:Ep,sortedLastIndex:Np,sortedLastIndexBy:Ip,sortedLastIndexOf:Op,sortedUniq:Pp,sortedUniqBy:Dp,tail:Hp,take:Up,takeRight:zp,takeRightWhile:Wp,takeWhile:Jp,union:qS,unionBy:VS,unionWith:GS,uniq:gc,uniqBy:yc,uniqWith:vc,unzip:_c,unzipWith:wc,without:ef,xor:QS,xorBy:ZS,xorWith:tx,zip:ex,zipObject:Dc,zipObjectDeep:Ac,zipWith:nx},rx={at:bg,countBy:A_,each:Ei,eachRight:Oi,every:Fi,filter:Ji,find:gw,findLast:mw,flatMap:es,flatMapDeep:ns,flatMapDepth:os,forEach:Ei,forEachRight:Oi,groupBy:Mw,includes:xs,invokeMap:Kw,keyBy:Tb,map:ts,orderBy:ka,partition:TC,reduce:rp,reduceRight:sp,reject:ap,sample:fp,sampleSize:dp,shuffle:yp,size:vp,some:wp,sortBy:oS},ix={now:oo},sx={after:Hn,ary:fo,before:Mo,bind:Tg,bindKey:kg,curry:ci,curryRight:ui,debounce:hi,defer:X_,delay:Y_,flip:as,memoize:Y,negate:_a,once:Ta,overArgs:Xb,partial:NC,partialRight:OC,rearg:GC,rest:nn,spread:Mp,throttle:$p,unary:hc,wrap:Nc},ax={castArray:Jo,clone:Nr,cloneDeep:Ir,cloneDeepWith:Or,cloneWith:Tr,eq:R,gt:kw,gte:jw,isArguments:bo,isArray:bu,isArrayBuffer:As,isArrayLike:Xe,isArrayLikeObject:Ye,isBoolean:Ms,isBuffer:Qv,isDate:ks,isElement:js,isEmpty:Rs,isEqual:Ls,isEqualWith:Fs,isError:Ao,isFinite:Bs,isFunction:b,isInteger:Hs,isLength:Ke,isMap:Us,isMatch:zs,isMatchWith:Ws,isNaN:qs,isNative:Vs,isNil:Gs,isNull:$s,isNumber:Js,isObject:w,isObjectLike:Q,isPlainObject:di,isRegExp:Ks,isSafeInteger:Xs,isSet:Ys,isString:Co,isSymbol:Z,isTypedArray:Lr,isUndefined:Qs,isWeakMap:Zs,isWeakSet:ta,lt:kb,lte:jb,toArray:wa,toFinite:tn,toInteger:en,toLength:Bi,toNumber:Ze,toPlainObject:gi,toSafeInteger:nc,toString:et},px={add:Xf,ceil:tv,divide:ew,floor:Cw,max:ua,maxBy:ha,mean:da,meanBy:ga,min:ya,minBy:va,multiply:Hb,round:QC,subtract:yS,sum:Fp,sumBy:Bp},cx={clamp:Ko,inRange:bs,random:tp},ux={assign:ag,assignIn:mg,assignInWith:_g,assignWith:wg,create:pi,defaults:H_,defaultsDeep:$_,entries:sw,entriesIn:aw,extend:mg,extendWith:_g,findKey:Ki,findLastKey:Yi,forIn:cs,forInRight:us,forOwn:hs,forOwnRight:ls,functions:gs,functionsIn:ys,get:st,has:_s,hasIn:Gr,invert:Jw,invertBy:Gw,invoke:$w,keys:xo,keysIn:Io,mapKeys:ia,mapValues:sa,merge:Lb,mergeWith:G_,omit:Gb,omitBy:Oa,pick:PC,pickBy:Ja,result:hp,set:gp,setWith:ut,toPairs:sw,toPairsIn:aw,transform:rc,unset:vt,update:Sc,updateWith:xc,values:Ss,valuesIn:Ec},hx={at:YS,chain:Vo,commit:Pr,lodash:eo,next:ba,plant:qa,reverse:Oc,tap:qp,thru:Kp,toIterator:Yp,toJSON:Zp,value:Zp,valueOf:Zp,wrapperChain:Ic},lx={camelCase:Qy,capitalize:Fo,deburr:Uo,endsWith:Ti,escape:ki,escapeRegExp:ji,kebabCase:Ob,lowerCase:Ab,lowerFirst:Mb,pad:Ha,padEnd:Ua,padStart:za,parseInt:Wa,repeat:cp,replace:up,snakeCase:nS,split:Ap,startCase:gS,startsWith:kp,template:Gp,templateSettings:bS,toLower:tc,toUpper:oc,trim:ac,trimEnd:pc,trimStart:cc,truncate:uc,unescape:fc,upperCase:XS,upperFirst:iy,words:zo},fx={attempt:Eg,bindAll:Pg,cond:Qr,conforms:ti,constant:ei,flow:Tw,flowRight:Pw,identity:Un,iteratee:ea,matches:aa,matchesProperty:pa,method:Fb,methodOf:Bb,mixin:ma,noop:Xn,nthArg:xa,over:$b,overEvery:Yb,overSome:Qb,property:Xr,propertyOf:Va,range:JC,rangeRight:qC,stubArray:rr,stubFalse:xr,stubObject:jp,stubString:Rp,stubTrue:Lp,times:Xp,toPath:ec,uniqueId:mc},dx=Math.max,gx=Math.min,yx=200,vx=1,mx=2,_x=Math.min,wx="4.13.1",bx=2,Cx=1,Sx=3,xx=4294967295,Ex=Array.prototype,Nx=Object.prototype,Ix=Nx.hasOwnProperty,Ox="symbol"==typeof(Ox=Xu&&Xu.iterator)?Ox:void 0,Tx=Math.max,Px=Math.min,Dx=function(t){return function(e,n,o){if(null==o){var r=w(n),i=r&&xo(n),s=i&&i.length&&ds(n,i);(s?s.length:r)||(o=n,n=e,e=this)}return t(e,n,o)}}(ma);eo.after=sx.after,eo.ary=sx.ary,eo.assign=ux.assign,eo.assignIn=ux.assignIn,eo.assignInWith=ux.assignInWith,eo.assignWith=ux.assignWith,eo.at=rx.at,eo.before=sx.before,eo.bind=sx.bind,eo.bindAll=fx.bindAll,eo.bindKey=sx.bindKey,eo.castArray=ax.castArray,eo.chain=hx.chain,eo.chunk=ox.chunk,eo.compact=ox.compact,eo.concat=ox.concat,eo.cond=fx.cond,eo.conforms=fx.conforms,eo.constant=fx.constant,eo.countBy=rx.countBy,eo.create=ux.create,eo.curry=sx.curry,eo.curryRight=sx.curryRight,eo.debounce=sx.debounce,eo.defaults=ux.defaults,eo.defaultsDeep=ux.defaultsDeep,eo.defer=sx.defer,eo.delay=sx.delay,eo.difference=ox.difference,eo.differenceBy=ox.differenceBy,eo.differenceWith=ox.differenceWith,eo.drop=ox.drop,eo.dropRight=ox.dropRight,eo.dropRightWhile=ox.dropRightWhile,eo.dropWhile=ox.dropWhile,eo.fill=ox.fill,eo.filter=rx.filter,eo.flatMap=rx.flatMap,eo.flatMapDeep=rx.flatMapDeep,eo.flatMapDepth=rx.flatMapDepth,eo.flatten=ox.flatten,eo.flattenDeep=ox.flattenDeep,eo.flattenDepth=ox.flattenDepth,eo.flip=sx.flip,eo.flow=fx.flow,eo.flowRight=fx.flowRight,eo.fromPairs=ox.fromPairs,eo.functions=ux.functions,eo.functionsIn=ux.functionsIn,eo.groupBy=rx.groupBy,eo.initial=ox.initial,eo.intersection=ox.intersection,eo.intersectionBy=ox.intersectionBy,eo.intersectionWith=ox.intersectionWith,eo.invert=ux.invert,eo.invertBy=ux.invertBy,eo.invokeMap=rx.invokeMap,eo.iteratee=fx.iteratee,eo.keyBy=rx.keyBy,eo.keys=xo,eo.keysIn=ux.keysIn,eo.map=rx.map,eo.mapKeys=ux.mapKeys,eo.mapValues=ux.mapValues,eo.matches=fx.matches,eo.matchesProperty=fx.matchesProperty,eo.memoize=sx.memoize,eo.merge=ux.merge,eo.mergeWith=ux.mergeWith,eo.method=fx.method,eo.methodOf=fx.methodOf,eo.mixin=Dx,eo.negate=sx.negate,eo.nthArg=fx.nthArg,eo.omit=ux.omit,eo.omitBy=ux.omitBy,eo.once=sx.once,eo.orderBy=rx.orderBy,eo.over=fx.over,eo.overArgs=sx.overArgs,eo.overEvery=fx.overEvery,eo.overSome=fx.overSome,eo.partial=sx.partial,eo.partialRight=sx.partialRight,eo.partition=rx.partition,eo.pick=ux.pick,eo.pickBy=ux.pickBy,eo.property=fx.property,eo.propertyOf=fx.propertyOf,eo.pull=ox.pull,eo.pullAll=ox.pullAll,eo.pullAllBy=ox.pullAllBy,eo.pullAllWith=ox.pullAllWith,eo.pullAt=ox.pullAt,eo.range=fx.range,eo.rangeRight=fx.rangeRight,eo.rearg=sx.rearg,eo.reject=rx.reject,eo.remove=ox.remove,eo.rest=nn,eo.reverse=ox.reverse,eo.sampleSize=rx.sampleSize,eo.set=ux.set,eo.setWith=ux.setWith,eo.shuffle=rx.shuffle,eo.slice=ox.slice,eo.sortBy=rx.sortBy,eo.sortedUniq=ox.sortedUniq,eo.sortedUniqBy=ox.sortedUniqBy,eo.split=lx.split,eo.spread=sx.spread,eo.tail=ox.tail,eo.take=ox.take,eo.takeRight=ox.takeRight,eo.takeRightWhile=ox.takeRightWhile,eo.takeWhile=ox.takeWhile,eo.tap=hx.tap,eo.throttle=sx.throttle,eo.thru=Kp,eo.toArray=ax.toArray,eo.toPairs=ux.toPairs,eo.toPairsIn=ux.toPairsIn,eo.toPath=fx.toPath,eo.toPlainObject=ax.toPlainObject,eo.transform=ux.transform,eo.unary=sx.unary,eo.union=ox.union,eo.unionBy=ox.unionBy,eo.unionWith=ox.unionWith,eo.uniq=ox.uniq,eo.uniqBy=ox.uniqBy,eo.uniqWith=ox.uniqWith,eo.unset=ux.unset,eo.unzip=ox.unzip,eo.unzipWith=ox.unzipWith,eo.update=ux.update,eo.updateWith=ux.updateWith,eo.values=ux.values,eo.valuesIn=ux.valuesIn,eo.without=ox.without,eo.words=lx.words,eo.wrap=sx.wrap,eo.xor=ox.xor,eo.xorBy=ox.xorBy,eo.xorWith=ox.xorWith,eo.zip=ox.zip,eo.zipObject=ox.zipObject,eo.zipObjectDeep=ox.zipObjectDeep,eo.zipWith=ox.zipWith,eo.entries=ux.toPairs,eo.entriesIn=ux.toPairsIn,eo.extend=ux.assignIn,eo.extendWith=ux.assignInWith,Dx(eo,eo),eo.add=px.add,eo.attempt=fx.attempt,eo.camelCase=lx.camelCase,eo.capitalize=lx.capitalize,eo.ceil=px.ceil,eo.clamp=cx.clamp,eo.clone=ax.clone,eo.cloneDeep=ax.cloneDeep,eo.cloneDeepWith=ax.cloneDeepWith,eo.cloneWith=ax.cloneWith,eo.deburr=lx.deburr,eo.divide=px.divide,eo.endsWith=lx.endsWith,eo.eq=ax.eq,eo.escape=lx.escape,eo.escapeRegExp=lx.escapeRegExp,eo.every=rx.every,eo.find=rx.find,eo.findIndex=ox.findIndex,eo.findKey=ux.findKey,eo.findLast=rx.findLast,eo.findLastIndex=ox.findLastIndex,eo.findLastKey=ux.findLastKey,eo.floor=px.floor,eo.forEach=rx.forEach,eo.forEachRight=rx.forEachRight,eo.forIn=ux.forIn,eo.forInRight=ux.forInRight,eo.forOwn=ux.forOwn,eo.forOwnRight=ux.forOwnRight,eo.get=ux.get,eo.gt=ax.gt,eo.gte=ax.gte,eo.has=ux.has,eo.hasIn=ux.hasIn,eo.head=ox.head,eo.identity=Un,eo.includes=rx.includes,eo.indexOf=ox.indexOf,eo.inRange=cx.inRange,eo.invoke=ux.invoke,eo.isArguments=ax.isArguments,eo.isArray=bu,eo.isArrayBuffer=ax.isArrayBuffer,eo.isArrayLike=ax.isArrayLike,eo.isArrayLikeObject=ax.isArrayLikeObject,eo.isBoolean=ax.isBoolean,eo.isBuffer=ax.isBuffer,eo.isDate=ax.isDate,eo.isElement=ax.isElement,eo.isEmpty=ax.isEmpty,eo.isEqual=ax.isEqual,eo.isEqualWith=ax.isEqualWith,eo.isError=ax.isError,eo.isFinite=ax.isFinite,eo.isFunction=ax.isFunction,eo.isInteger=ax.isInteger,eo.isLength=ax.isLength,eo.isMap=ax.isMap,eo.isMatch=ax.isMatch,eo.isMatchWith=ax.isMatchWith,eo.isNaN=ax.isNaN,eo.isNative=ax.isNative,eo.isNil=ax.isNil,eo.isNull=ax.isNull,eo.isNumber=ax.isNumber,eo.isObject=w,eo.isObjectLike=ax.isObjectLike,eo.isPlainObject=ax.isPlainObject,eo.isRegExp=ax.isRegExp,eo.isSafeInteger=ax.isSafeInteger,eo.isSet=ax.isSet,eo.isString=ax.isString,eo.isSymbol=ax.isSymbol,eo.isTypedArray=ax.isTypedArray,eo.isUndefined=ax.isUndefined,eo.isWeakMap=ax.isWeakMap,eo.isWeakSet=ax.isWeakSet,eo.join=ox.join,eo.kebabCase=lx.kebabCase,eo.last=ft,eo.lastIndexOf=ox.lastIndexOf,eo.lowerCase=lx.lowerCase,eo.lowerFirst=lx.lowerFirst,eo.lt=ax.lt,eo.lte=ax.lte,eo.max=px.max,eo.maxBy=px.maxBy,eo.mean=px.mean,eo.meanBy=px.meanBy,eo.min=px.min,eo.minBy=px.minBy,eo.stubArray=fx.stubArray,eo.stubFalse=fx.stubFalse,eo.stubObject=fx.stubObject,eo.stubString=fx.stubString,eo.stubTrue=fx.stubTrue,eo.multiply=px.multiply,eo.nth=ox.nth,eo.noop=fx.noop,eo.now=ix.now,eo.pad=lx.pad,eo.padEnd=lx.padEnd,eo.padStart=lx.padStart,eo.parseInt=lx.parseInt,eo.random=cx.random,eo.reduce=rx.reduce,eo.reduceRight=rx.reduceRight,eo.repeat=lx.repeat,eo.replace=lx.replace,eo.result=ux.result,eo.round=px.round,eo.sample=rx.sample,eo.size=rx.size,eo.snakeCase=lx.snakeCase,eo.some=rx.some,eo.sortedIndex=ox.sortedIndex,eo.sortedIndexBy=ox.sortedIndexBy,eo.sortedIndexOf=ox.sortedIndexOf,eo.sortedLastIndex=ox.sortedLastIndex,eo.sortedLastIndexBy=ox.sortedLastIndexBy,eo.sortedLastIndexOf=ox.sortedLastIndexOf,eo.startCase=lx.startCase,eo.startsWith=lx.startsWith,eo.subtract=px.subtract,eo.sum=px.sum,eo.sumBy=px.sumBy,eo.template=lx.template,eo.times=fx.times,eo.toFinite=ax.toFinite,eo.toInteger=en,eo.toLength=ax.toLength,eo.toLower=lx.toLower,eo.toNumber=ax.toNumber,eo.toSafeInteger=ax.toSafeInteger,eo.toString=ax.toString,eo.toUpper=lx.toUpper,eo.trim=lx.trim,eo.trimEnd=lx.trimEnd,eo.trimStart=lx.trimStart,eo.truncate=lx.truncate,eo.unescape=lx.unescape,eo.uniqueId=fx.uniqueId,eo.upperCase=lx.upperCase,eo.upperFirst=lx.upperFirst,eo.each=rx.forEach,eo.eachRight=rx.forEachRight,eo.first=ox.head,Dx(eo,function(){var t={};return ri(eo,function(e,n){Ix.call(eo.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),eo.VERSION=wx,(eo.templateSettings=lx.templateSettings).imports._=eo,ko(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){eo[t].placeholder=eo}),ko(["drop","take"],function(t,e){Kn.prototype[t]=function(n){var o=this.__filtered__;if(o&&!e)return new Kn(this);n=void 0===n?1:Tx(en(n),0);var r=this.clone();return o?r.__takeCount__=Px(n,r.__takeCount__):r.__views__.push({size:Px(n,xx),type:t+(r.__dir__<0?"Right":"")}),r},Kn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),ko(["filter","map","takeWhile"],function(t,e){var n=e+1,o=n==Cx||n==Sx;Kn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Yr(t,3),type:n}),e.__filtered__=e.__filtered__||o,e}}),ko(["head","last"],function(t,e){var n="take"+(e?"Right":"");Kn.prototype[t]=function(){return this[n](1).value()[0]}}),ko(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");Kn.prototype[t]=function(){return this.__filtered__?new Kn(this):this[n](1)}}),Kn.prototype.compact=function(){return this.filter(Un)},Kn.prototype.find=function(t){return this.filter(t).head()},Kn.prototype.findLast=function(t){return this.reverse().find(t)},Kn.prototype.invokeMap=nn(function(t,e){return"function"==typeof t?new Kn(this):this.map(function(n){return Ds(n,t,e)})}),Kn.prototype.reject=function(t){return t=Yr(t,3),this.filter(function(e){return!t(e)})},Kn.prototype.slice=function(t,e){t=en(t);var n=this;return n.__filtered__&&(t>0||0>e)?new Kn(n):(0>t?n=n.takeRight(-t):t&&(n=n.drop(t)),void 0!==e&&(e=en(e),n=0>e?n.dropRight(-e):n.take(e-t)),n)},Kn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Kn.prototype.toArray=function(){return this.take(xx)},ri(Kn.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),o=/^(?:head|last)$/.test(e),r=eo[o?"take"+("last"==e?"Right":""):e],i=o||/^find/.test(e);r&&(eo.prototype[e]=function(){var e=this.__wrapped__,s=o?[1]:arguments,a=e instanceof Kn,p=s[0],c=a||bu(e),u=function(t){var e=r.apply(eo,To([t],s));return o&&h?e[0]:e};c&&n&&"function"==typeof p&&1!=p.length&&(a=c=!1);var h=this.__chain__,l=!!this.__actions__.length,f=i&&!h,d=a&&!l;if(!i&&c){e=d?e:new Kn(this);var g=t.apply(e,s);return g.__actions__.push({func:Kp,args:[u],thisArg:void 0}),new Qn(g,h)}return f&&d?t.apply(this,s):(g=this.thru(u),f?o?g.value()[0]:g.value():g)})}),ko(["pop","push","shift","sort","splice","unshift"],function(t){var e=Ex[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",o=/^(?:pop|shift)$/.test(t);eo.prototype[t]=function(){var t=arguments;if(o&&!this.__chain__){var r=this.value();return e.apply(bu(r)?r:[],t)}return this[n](function(n){return e.apply(bu(n)?n:[],t)})}}),ri(Kn.prototype,function(t,e){var n=eo[e];if(n){var o=n.name+"",r=ad[o]||(ad[o]=[]);r.push({name:e,func:n})}}),ad[po(void 0,bx).name]=[{name:"wrapper",func:void 0}],Kn.prototype.clone=Mc,Kn.prototype.reverse=kc,Kn.prototype.value=Rc,eo.prototype.at=hx.at,eo.prototype.chain=hx.wrapperChain,eo.prototype.commit=hx.commit,eo.prototype.next=hx.next,eo.prototype.plant=hx.plant,eo.prototype.reverse=hx.reverse,eo.prototype.toJSON=eo.prototype.valueOf=eo.prototype.value=hx.value,Ox&&(eo.prototype[Ox]=hx.toIterator);var Ax={nodes:{}},Mx=function(t){this.changeStore=t.changeStore,this.snapshotStore=t.snapshotStore};Mx.prototype.getSnapshot=function(t,e,n){var o=this,r=Ax;this._getClosestSnapshot(t,e,function(i,s,a){if(i)return n(i);if(s&&e===a)return n(null,s,e);var p;p=s?a:0,s&&(r=s),o.changeStore.getChanges(t,p,e,function(t,o){return t?n(t):o.length<e-p?n("Changes missing for reconstructing version "+e):(r=Lc(r,o),void n(null,r,e))})})},Mx.prototype.createSnapshot=function(t,e,n){var o=this;this.getSnapshot(t,e,function(r,i){return r?n(r):void o.snapshotStore.saveSnapshot(t,e,i,n)})},Mx.prototype._getClosestSnapshot=function(t,e,n){var o,r=this;this.snapshotStore.getVersions(t,function(i,s){if(s.indexOf(e)>=0)o=e;else{var a=s.filter(function(t){return parseInt(t,10)<e});o=Math.max.apply(null,a)}return o?void r.snapshotStore.getSnapshot(t,e,n):n(null,void 0)})};var kx=function(t){function e(e){t.call(this),this.changeStore=e.changeStore,this.snapshotStore=e.snapshotStore,this.snapshotFrequency=e.snapshotFrequency||1,this.snapshotEngine=new Mx({changeStore:this.changeStore,snapshotStore:this.snapshotStore})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createDocument=function(t,e,n){this.addChange(t,e,n)},e.prototype.getDocument=function(t,e,n){var o=this;if("function"==typeof e&&(n=e,e=void 0),!t)throw new Error("Invalid Arguments");void 0===e?this.getVersion(t,function(e,r){return e?n(e):void o.snapshotEngine.getSnapshot(t,r,n)}):this.snapshotEngine.getSnapshot(t,e,n)},e.prototype.deleteDocument=function(t,e){this.changeStore.deleteChanges(t,function(t){return t?e(new Error("Deleting changes failed")):void 0})},e.prototype.documentExists=function(t,e){this.getVersion(t,function(t,n){n>=0?e(null,!0):e(null,!1)})},e.prototype.getChanges=function(t,e,n,o){this.changeStore.getChanges(t,e,n,o)},e.prototype.getVersion=function(t,e){this.changeStore.getVersion(t,e)},e.prototype.requestSnapshot=function(t,e,n){e%this.snapshotFrequency===0?this.snapshotEngine.createSnapshot(t,e,n):n(null)},e.prototype.addChange=function(t,e,n){var o=this;this.changeStore.addChange(t,e,function(e,r){return e?n(e):void o.requestSnapshot(t,r,function(){n(null,r)})})},e}(vu),jx=function(t){this.configurator=t.configurator,this.engine=this.configurator.getDocumentEngine(),this.path="/api/documents"};jx.prototype.bind=function(t){t.post(this.path,this._createDocument.bind(this)),t.get(this.path+"/:id",this._getDocument.bind(this)),t["delete"](this.path+"/:id",this._deleteDocument.bind(this))},jx.prototype._createDocument=function(t,e,n){var o=t.body,r=o.documentId,i=o.change;this.engine.createDocument(r,i,function(t,o){return t?n(t):void e.json(o)})},jx.prototype._getDocument=function(t,e,n){var o=t.params.id;this.engine.getDocument(o,function(t,o,r){return t?n(t):void e.json({data:o,version:r})})},jx.prototype._deleteDocument=function(t,e,n){var o=t.params.id;this.engine.deleteDocument(o,function(t,o){return t?n(t):void e.json(o)})};var Rx=function(t){this._snapshots=t||{}};Rx.prototype.getVersions=function(t,e){var n=this._getVersions(t);e(null,n)},Rx.prototype.getSnapshot=function(t,e,n){if(3===!arguments.length)throw new Error("Invalid Arguments");var o=this._snapshots[t];if(!o)return n(null,void 0);var r=o[e];r?n(null,r,e):n(null,void 0)},Rx.prototype.saveSnapshot=function(t,e,n,o){if(!t||!e||!n)throw new Error("Invalid arguments");var r=this._snapshots[t];r||(r=this._snapshots[t]={}),r[e]=n,o(null,r[e])},Rx.prototype.deleteSnapshot=function(t,e,n){var o=this._snapshots[t];if(!o||!o[e])return n(new Error("Snapshot does not exist and can not be deleted"));var r=this._snapshots[t][e];delete this._snapshots[t][e],n(null,r)},Rx.prototype._getVersions=function(t){var e=this._snapshots[t];return e?Object.keys(e):[]};var Lx=function(){this.config={heartbeat:3e4,documentStore:void 0,changeStore:void 0,snapshotStore:void 0}};Lx.prototype.setHost=function(t){this.config.host=t},Lx.prototype.setPort=function(t){this.config.port=t},Lx.prototype.setDocumentStore=function(t){this.config.documentStore=t},Lx.prototype.setChangeStore=function(t){this.config.changeStore=t},Lx.prototype.setSnapshotStore=function(t){this.config.snapshotStore=t},Lx.prototype.getHost=function(){return this.config.host},Lx.prototype.getPort=function(){return this.config.port},Lx.prototype.getDocumentStore=function(){return this.config.documentStore},Lx.prototype.getChangeStore=function(){return this.config.changeStore},Lx.prototype.getSnapshotStore=function(){return this.config.snapshotStore},Lx.prototype.getDocumentEngine=function(){return this.documentEngine||(this.documentEngine=new kx({documentStore:this.config.documentStore,changeStore:this.config.changeStore,snapshotStore:this.config.snapshotStore})),this.documentEngine},Lx.prototype["import"]=function(t,e){return t.configure(this,e||{}),this};var Fx=function(t){this.definition=t},Bx={type:{},name:{}};Fx.prototype.isArray=function(){return u(this.definition.type)},Fx.prototype.isReference=function(){return this.isArray()?"id"===Wt(this.definition.type):"id"===this.definition.type},Fx.prototype.isText=function(){return Boolean(this.definition._isText)},Fx.prototype.isOwned=function(){return Boolean(this.definition.owned)},Fx.prototype.isOptional=function(){return Boolean(this.definition.optional)},Fx.prototype.isNotNull=function(){return Boolean(this.definition.notNull)},Fx.prototype.hasDefault=function(){return this.definition.hasOwnProperty("default")},Fx.prototype.getDefault=function(){return this.definition["default"]},Fx.prototype.createDefaultValue=function(){if(u(this.definition.type))return[];switch(this.definition.type){case"object":return{};case"number":return-1;case"coordinate":return new Wh([],0);case"boolean":return!1;case"id":return null;case"string":return"";default:return null}},Bx.type.get=function(){return this.definition.type},Bx.name.get=function(){return this.definition.name},Object.defineProperties(Fx.prototype,Bx);var Hx=function(n){function o(t){var e=this;n.call(this);var o=this.constructor,r=o.schema;for(var i in r)if(r.hasOwnProperty(i)){var s=r[i],a=void 0!==t[i],p=s.hasDefault(),c=s.isOptional();if(!c&&!p&&!a)throw new Error("Property "+i+" is mandatory for node type "+e.type);a?e[i]=zc(s,t[i]):p&&(e[i]=f(zc(s,s.getDefault())))}}n&&(o.__proto__=n),o.prototype=Object.create(n&&n.prototype),o.prototype.constructor=o;var r={type:{}};return o.prototype.dispose=function(){},o.prototype.isInstanceOf=function(t){return o.isInstanceOf(this.constructor,t)},o.prototype.getSchema=function(){return this.constructor.schema},o.prototype.getTypeNames=function(){for(var t=[],e=this.constructor;"node"!==e.type;)t.push(e.type),e=Object.getPrototypeOf(e);return t},o.prototype.getPropertyType=function(t){var e=this.constructor.schema;return e[t].type;
},o.prototype.toJSON=function(){var n=this,o={type:this.type},r=this.getSchema();return t(r,function(t,r){var i=n[r];t.isOptional()&&void 0===i||((u(i)||e(i))&&(i=f(i)),o[t.name]=i)}),o},r.type.get=function(){return this.constructor.type},Object.defineProperties(o.prototype,r),o}(vu);Hx.prototype._isNode=!0,Object.defineProperty(Hx,"schema",{get:function(){return this._schema},set:function(t){var e=this;t.type&&(e.type=t.type),e._schema=Bc(e,t)}}),Hx.define=Hx.defineSchema=function(t){this.schema=t},Hx.schema={type:"node",id:"string"},Hx.isInstanceOf=function(t,e){for(var n=t.type;"node"!==n;){if(n===e)return!0;var o=Object.getPrototypeOf(t.prototype).constructor;if(!o||!o.type)break;t=o,n=t.type}return!1};var Ux=function(t){function e(e,n){t.call(this,n),this.document=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDocument=function(){return this.document},e.prototype.hasParent=function(){return Boolean(this.parent)},e.prototype.getParent=function(){return this.document.get(this.parent)},e.prototype.getRoot=function(){for(var t=this;t.parent;)t=t.parent;return t},e.prototype.hasChildren=function(){return!1},e.prototype.getChildIndex=function(t){return-1},e.prototype.getChildAt=function(t){return null},e.prototype.getChildCount=function(){return 0},e.prototype.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlightedScope=e,this.highlighted=t,this.emit("highlighted",t))},e.prototype.on=function(t,e,n){var o=Wc(t);if(o){var r=o[1];if(this.constructor.schema[r]){var i=this.getDocument();i.getEventProxy("path").on([this.id,r],e,n)}}vu.prototype.on.apply(this,arguments)},e.prototype.off=function(t,e,n){var o=this.getDocument(),r=!1;if(e?r=Wc(e):o.getEventProxy("path").off(t),r){var i=r[1];o.getEventProxy("path").off(t,[this.id,i],n)}vu.prototype.off.apply(this,arguments)},e.prototype._onPropertyChange=function(t){var e=[t+":changed"].concat(Array.prototype.slice.call(arguments,1));this.emit.apply(this,e)},e.prototype.isBlock=function(){return Boolean(this.constructor.isBlock)},e.prototype.isText=function(){return Boolean(this.constructor.isText)},e.prototype.isInline=function(){return Boolean(this.constructor.isInline)},e.prototype.isList=function(){return Boolean(this.constructor.isList)},e.prototype.isIsolatedNode=function(){return!this.isText()&&!this.isList()},e}(Hx);Ux.prototype._isDocumentNode=!0,Ux.isBlock=!1,Ux.isText=!1,Ux.isPropertyAnnotation=!1,Ux.isContainerAnnotation=!1,Ux.isInline=!1;var zx=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ux);zx.isBlock=!0;var Wx=function(t,e){this.pos=t,this.offset=e};Wx.prototype.isBefore=function(t,e){return e=Boolean(e),this.pos<t.pos?!0:this.pos>t.pos?!1:this.offset<t.offset?!0:this.offset>t.offset?!1:!e},Wx.prototype.isAfter=function(t,e){return t.isBefore(this,e)},Wx.prototype.isEqual=function(t){return this.pos===t.pos&&this.offset===t.offset},Wx.prototype.toString=function(){return[this.pos,".",this.offset].join("")};var Jx=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this._enableCaching()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{}};return e.prototype.dispose=function(){this.document.off(this)},e.prototype.getContentPath=function(){return[this.id,"nodes"]},e.prototype.getContent=function(){return this.nodes},e.prototype.getPosition=function(t,e){_(t)&&(t=this.document.get(t));var n=this._getPosition(t);if(e&&0>n)throw new Error("Node is not within this container: "+t.id);return n},e.prototype.getNodeAt=function(t){var e=this.getContent();if(0>t||t>=e.length)throw new Error("Array index out of bounds: "+t+", "+e.length);return this.getDocument().get(e[t])},e.prototype.getNodes=function(){var t=this.getDocument();return this.getContent().map(function(e){return t.get(e)}).filter(Boolean)},e.prototype.show=function(t,e){var n=this.getDocument(),o=arguments[0];_(o)||o._isNode&&(t=o.id),v(e)||(e=this.getLength()),n.update(this.getContentPath(),{type:"insert",pos:e,value:t})},e.prototype.hide=function(t){var e=this.getDocument(),n=this.getPosition(t);n>=0&&e.update(this.getContentPath(),{type:"delete",pos:n})},e.prototype.getAddress=function(t){if(!t._isCoordinate)throw new Error("Illegal argument: Container.getAddress(coor) expects a Coordinate instance.");var e,n=t.path[0],o=this.getPosition(n);return e=t.isNodeCoordinate()?t.offset>0?Number.MAX_VALUE:0:t.offset,new Wx(o,e)},e.prototype.getLength=function(){return this.getContent().length},n.length.get=function(){return this.getLength()},e.prototype._getPosition=function(t){return this._isCaching?this._getCachedPosition(t):this._lookupPosition(t)},e.prototype._getCachedPosition=function(t){var e=this._cachedPositions||this._fillCache(),n=t.id,o=-1;return e.hasOwnProperty(n)?o=e[n]:(o=this._lookupPosition(t),e[n]=o),o},e.prototype._fillCache=function(){var t={};return this.nodes.forEach(function(e,n){t[e]=n}),this._cachedPositions=t,t},e.prototype._invalidateCache=function(){this._cachedPositions=null},e.prototype._lookupPosition=function(t){return t.hasParent()&&(t=t.getRoot()),this.getContent().indexOf(t.id)},e.prototype._enableCaching=function(){this.document&&(this.document.data.on("operation:applied",this._onOperationApplied,this),this._isCaching=!0)},e.prototype._onOperationApplied=function(t){("set"===t.type||"update"===t.type)&&t.path[0]===this.id&&this._invalidateCache()},e.prototype._onDocumentChange=function(t){t.isUpdated(this.getContentPath())&&this._invalidateCache()},e.prototype.hasChildren=function(){return this.nodes.length>0},e.prototype.getChildIndex=function(t){return this.nodes.indexOf(t.id)},e.prototype.getChildren=function(){var t=this.getDocument(),e=this.nodes;return e.map(function(e){return t.get(e)})},e.prototype.getChildAt=function(t){var e=this.nodes;if(0>t||t>=e.length)throw new Error("Array index out of bounds: "+t+", "+e.length);return this.getDocument().get(e[t])},e.prototype.getChildCount=function(){return this.nodes.length},Object.defineProperties(e.prototype,n),e}(Ux);Jx.prototype._isContainer=!0,Jx.schema={type:"container",nodes:{type:["array","id"],"default":[]}};var qx=function(t){function e(e,n){t.call(this,e,Jc(n)),this.start=new Wh(this.start),this.end=new Wh(this.end)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={startPath:{},startOffset:{},endPath:{},endOffset:{}};return n.startPath.get=function(){return console.warn("DEPRECATED: use Annotation.start.path instead."),this.start.path},n.startPath.set=function(t){console.warn("DEPRECATED: use Annotation.start.path instead."),this.start.path=t},n.startOffset.get=function(){return console.warn("DEPRECATED: use Annotation.start.offset instead."),this.start.offset},n.startOffset.set=function(t){console.warn("DEPRECATED: use Annotation.start.offset instead."),this.start.offset=t},n.endPath.get=function(){return console.warn("DEPRECATED: use Annotation.end.path instead."),this.end.path},n.endPath.set=function(t){console.warn("DEPRECATED: use Annotation.end.path instead."),this.end.path=t},n.endOffset.get=function(){return console.warn("DEPRECATED: use Annotation.end.offset instead."),this.end.offset},n.endOffset.set=function(t){console.warn("DEPRECATED: use Annotation.end.offset instead."),this.end.offset=t},e.prototype.getText=function(){var t=this.getDocument();return t?fl.getTextForSelection(t,this.getSelection()):(console.warn("Trying to use a Annotation which is not attached to the document."),"")},e.prototype.canSplit=function(){return!0},e.prototype.isAnchor=function(){return!1},Object.defineProperties(e.prototype,n),e}(Ux);qx.define({type:"annotation",start:"coordinate",end:"coordinate"}),qx.prototype._isAnnotation=!0;var Vx=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getSelection=function(){var t=this.getDocument();return t?t.createSelection({type:"container",containerId:this.containerId,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),qh.nullSelection())},n.prototype.setHighlighted=function(e,n){this.highlighted!==e&&(this.highlighted=e,this.highlightedScope=n,this.emit("highlighted",e,n),t(this.fragments,function(t){t.emit("highlighted",e,n)}))},n.prototype._updateRange=function(t,e){if(!e.isContainerSelection())throw new Error("Invalid argument.");h(this.start.path,e.start.path)||t.set([this.id,"start","path"],e.start.path),this.start.offset!==e.start.offset&&t.set([this.id,"start","offset"],e.start.offset),h(this.end.path,e.end.path)||t.set([this.id,"end","path"],e.end.path),this.end.offset!==e.end.offset&&t.set([this.id,"end","offset"],e.end.offset)},n}(qx);Vx.schema={type:"container-annotation",containerId:"string"},Vx.prototype._isContainerAnnotation=!0;var Gx=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={path:{},startPath:{},endPath:{}};return n.path.get=function(){return this.start.path},e.prototype.getPath=function(){return this.start.path},e.prototype.getSelection=function(){return this.getDocument().createSelection({type:"property",path:this.path,startOffset:this.start.offset,endOffset:this.end.offset})},e.prototype._updateRange=function(t,e){if(!e.isPropertySelection())throw new Error("Invalid argument: PropertyAnnotation._updateRange() requires a PropertySelection.");Ut(this.start.path,e.start.path)||t.set([this.id,"path"],e.start.path),this.start.offset!==e.start.offset&&t.set([this.id,"start","offset"],e.start.offset),this.end.offset!==e.end.offset&&t.set([this.id,"end","offset"],e.end.offset)},n.startPath.get=function(){return this.path},n.endPath.get=function(){return this.path},Object.defineProperties(e.prototype,n),e}(qx);Gx.isPropertyAnnotation=!0,Gx.prototype._isAnnotation=!0,Gx.prototype._isPropertyAnnotation=!0,Gx.schema={type:"annotation",start:"coordinate",end:"coordinate",_content:{type:"string",optional:!0}};var $x=1,Kx=-1,Xx=-2,Yx=function(t){Object.assign(this,t)};Yx.prototype.start=function(t,e,n){if(!_(e))throw new Error("Illegal argument: 'text' must be a String, but was "+e);this._start(t,e,n)},Yx.prototype.onText=function(t,e,n){},Yx.prototype.onEnter=function(t,e){return null},Yx.prototype.onExit=function(t,e,n){},Yx.prototype._enter=function(t,e){return t.counter++,this.onEnter(t,e)},Yx.prototype._exit=function(t,e,n){this.onExit(t,e,n)},Yx.prototype._createText=function(t,e,n){this.onText(t,e,n)},Yx.prototype._start=function(t,e,n){for(var o=this,r=qc.call(this,n),i=[{context:t,entry:null}],s=0,a=0;a<r.length;a++){var p=r[a],c=e.substring(s,p.pos);c&&o._createText(i[i.length-1].context,c,p),s=p.pos;var u,h,l;if(p.mode===$x||p.mode===Xx){for(u=1;u<i.length&&!(p.level<i[u].entry.level);u++);for(h=i.length-1;h>=u;h--)l=i[h].entry,l.length=s-l.pos,o._exit(l,i[h].context,i[h-1].context);for(i.splice(u,0,{entry:p}),h=u;h<i.length;h++)l=i[h].entry,l.pos=s,i[h].context=o._enter(l,i[h-1].context)}if(p.mode===Kx||p.mode===Xx){for(u=1;u<i.length&&i[u].entry.node!==p.node;u++);for(h=i.length-1;h>=u;h--)l=i[h].entry,l.length=s-l.pos,o._exit(l,i[h].context,i[h-1].context);for(i.splice(u,1),h=u;h<i.length;h++)l=i[h].entry,l.pos=s,i[h].context=o._enter(l,i[h-1].context)}}var f=e.substring(s);f&&this._createText(t,f)},Yx.SHOULD_NOT_SPLIT=0,Yx.NORMAL=10,Yx.ANY=100,Yx.ALWAYS_ON_TOP=Number.MAX_VALUE;var Qx=function(t,e){if(this.context=e||{},!t.converters)throw new Error("config.converters is mandatory");if(t.converters._isRegistry?this.converters=t.converters:(this.converters=new Rl,t.converters.forEach(function(t){var e=re(t)?new t:t;return e.type?void this.converters.add(e.type,e):void console.error("Converter must provide the type of the associated node.",e)}.bind(this))),this.state={doc:null},this.config=t,this._elementFactory=t.elementFactory,!this._elementFactory)throw new Error("'elementFactory' is mandatory");this.$$=this.createElement.bind(this)};Qx.prototype.exportDocument=function(t){return this.convertDocument(t)},Qx.prototype.convertDocument=function(t){throw new Error("This method is abstract")},Qx.prototype.convertContainer=function(t){if(!t)throw new Error("Illegal arguments: container is mandatory.");var e=t.getDocument();this.state.doc=e;var n=[];return t.nodes.forEach(function(t){var o=e.get(t),r=this.convertNode(o);n.push(r)}.bind(this)),n},Qx.prototype.convertNode=function(t){_(t)?t=this.state.doc.get(t):this.state.doc=t.getDocument();var e=this.getNodeConverter(t);if(t._isPropertyAnnotation&&(!e||!e["export"]))return this._convertPropertyAnnotation(t);e||(e=this.getDefaultBlockConverter());var n;return n=e.tagName?this.$$(e.tagName):this.$$("div"),n.attr(this.config.idAttribute,t.id),n=e["export"]?e["export"](t,n,this)||n:this.getDefaultBlockConverter()["export"](t,n,this)||n},Qx.prototype.convertProperty=function(t,e,n){this.initialize(t,n);var o=this.$$("div").append(this.annotatedText(e));return o.innerHTML},Qx.prototype.annotatedText=function(t){var e=this.state.doc,n=e.get(t),o=e.getIndex("annotations").get(t);return this._annotatedText(n,o)},Qx.prototype.getNodeConverter=function(t){return this.converters.get(t.type)},Qx.prototype.getDefaultBlockConverter=function(){throw new Error("This method is abstract.")},Qx.prototype.getDefaultPropertyAnnotationConverter=function(){throw new Error("This method is abstract.")},Qx.prototype.getDocument=function(){return this.state.doc},Qx.prototype.createElement=function(t){return this._elementFactory.createElement(t)},Qx.prototype._annotatedText=function(t,e){var n=this,o=new Yx;o.onText=function(t,e){t.children.push($c(e))},o.onEnter=function(t){var e=t.node;return{annotation:e,children:[]}},o.onExit=function(t,e,o){var r=e.annotation,i=n.getNodeConverter(r);i||(i=n.getDefaultPropertyAnnotationConverter());var s;s=i.tagName?this.$$(i.tagName):this.$$("span"),s.attr(this.config.idAttribute,r.id),s.append(e.children),i["export"]&&(s=i["export"](r,s,n)||s),o.children.push(s)}.bind(this);var r={children:[]};return o.start(r,t,e),r.children},Qx.prototype._convertPropertyAnnotation=function(t){var e=this.$$("div").append(this.annotatedText(t.path)),n=e.find("["+this.config.idAttribute+'="'+t.id+'"]');return n};var Zx=/^\s+/g,tE=/^\s*/g,eE=/\s+$/g,nE=/\s+/g,oE=" ",rE=/[\t\n\r]+/g,iE=function sO(t,e){if(this.context=e||{},!t.converters)throw new Error("config.converters is mandatory");if(!t.DocumentClass)throw new Error("DocumentClass is mandatory");this.config=a({idAttribute:"id"},t),this.schema=t.schema,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[];var n=this.schema,o=n.getDefaultTextType();t.converters.forEach(function(t){var e;if(e="function"==typeof t?new t:t,!e.type)return void console.error("Converter must provide the type of the associated node.",e);if(!e.matchElement&&!e.tagName)return void console.error("Converter must provide a matchElement function or a tagName property.",e);e.matchElement||(e.matchElement=this._defaultElementMatcher.bind(e));var r=n.getNodeClass(e.type);return r?(this._defaultBlockConverter||o!==e.type||(this._defaultBlockConverter=e),this._allConverters.push(e),void(r.prototype._isPropertyAnnotation?this._propertyAnnotationConverters.push(e):this._blockConverters.push(e))):void console.error("No node type defined for converter",e.type)}.bind(this)),this.state=new sO.State};iE.prototype.reset=function(){this.state.reset(),this.createDocument()},iE.prototype.createDocument=function(){return this.state.doc=this._createDocument(this.config.schema),this.state.doc},iE.prototype._createDocument=function(t){var e=new this.config.DocumentClass(t);return e},iE.prototype.generateDocument=function(){return this.state.doc||(this.state.doc=this.createDocument()),this._createNodes(),this.state.doc},iE.prototype._createNodes=function(){var t=this.state;Xc(t.doc,t.nodes),this._createInlineNodes()},iE.prototype._createInlineNodes=function(){var t=this.state;Xc(t.doc,t.inlineNodes)},iE.prototype.convertContainer=function(t,e){var n=this,o=this.state;o.container=[],o.containerId=e;for(var r=new nf(t);r.hasNext();){var i,s=r.next(),a=n._getConverterForElement(s,"block");if(a)i=n._createNode(s,a.type),o.pushContext(s.tagName,a),i=a["import"](s,i,n)||i,o.popContext(),n._createAndShow(i);else if(s.isCommentNode());else if(s.isTextNode()){var p=s.textContent;if(/^\s*$/.exec(p))continue;r.back(),n._wrapInlineElementsIntoBlockElement(r)}else s.isElementNode()&&(r.back(),n._wrapInlineElementsIntoBlockElement(r))}var c={type:"container",id:e,nodes:this.state.container.slice(0)};return this.createNode(c),c},iE.prototype.convertElement=function(t){var e=!this.state.isConverting;e&&(this.state.isConverting=!0);var n=this._convertElement(t);return this.config["stand-alone"]&&e&&(this.state.isConverting=!1,this.generateDocument(),n=this.state.doc.get(n.id),this.reset()),n},iE.prototype._convertElement=function(t,e){var n,o=this._getConverterForElement(t,e);if(!o)throw new Error("No converter found for "+t.tagName);n=this._createNode(t,o.type);var r=this.schema.getNodeClass(n.type);return this.state.pushContext(t.tagName,o),r.isInline?this._convertInlineNode(t,n,o):r.prototype._isPropertyAnnotation?this._convertPropertyAnnotation(t,n):n=o["import"](t,n,this)||n,this.state.popContext(),this.createNode(n),n},iE.prototype._convertPropertyAnnotation=function(t,e){e._content=this.annotatedText(t,e.path),e.start={path:[e.id,"_content"],offset:0},e.end={offset:e._content.length}},iE.prototype._convertInlineNode=function(t,e,n){return e._content="$",e.start={path:[e.id,"_content"],offset:0},e.end={offset:1},e=n["import"](t,e,this)},iE.prototype.createNode=function(t){if(!t.type)throw new Error("node.type required.");if(t.id||(t.id=this.nextId(t.type)),this.state.ids[t.id])throw new Error("Node with id alread exists:"+t.id);return this.state.ids[t.id]=!0,this.state.nodes.push(t),t},iE.prototype.show=function(t){this.state.container.push(t.id)},iE.prototype._createNode=function(e,n){var o=this.schema.getNodeClass(n);if(!o)throw new Error("No NodeClass registered for type "+n);var r={};t(o.schema,function(t,e){t.hasDefault()?r[e]=l(t["default"]):r[e]=t.createDefaultValue()}),r.type=n,r.id=this.getIdForElement(e,n);var i=new o(null,r);return i},iE.prototype._createAndShow=function(t){this.createNode(t),this.show(t)},iE.prototype.annotatedText=function(t,e,n){var o=this.state;if(e)n&&n.preserveWhitespace&&(o.preserveWhitespace=!0),o.stack.push({path:e,offset:0,text:""});else if(0===o.stack.length)throw new Error("Contract: DOMImporter.annotatedText() requires 'path' for non-reentrant call.",t.outerHTML);this.state.lastChar="";var r,i=t.getChildNodeIterator();return r=this._annotatedText(i),e&&(o.stack.pop(),o.preserveWhitespace=!1),r},iE.prototype.plainText=function(t){var e=this.state,n=t.textContent;if(e.stack.length>0){var o=Wt(e.stack);o.offset+=n.length,o.text+=o.text.concat(n)}return n},iE.prototype.customText=function(t){var e=this.state;if(e.stack.length>0){var n=Wt(e.stack);n.offset+=t.length,n.text+=n.text.concat(t)}return t},iE.prototype.nextId=function(t){return this.state.uuid(t)},iE.prototype.getIdForElement=function(t,e){var n=this,o=t.getAttribute(this.config.idAttribute);if(o&&!this.state.ids[o])return o;var r=t.getRoot();for(o=this.nextId(e);this.state.ids[o]||r.find("#"+o);)o=n.nextId(e);return o},iE.prototype.defaultConverter=function aO(t,e){this.IGNORE_DEFAULT_WARNINGS||console.warn("This element is not handled by the converters you provided. This is the default implementation which just skips conversion. Override DOMImporter.defaultConverter(el, converter) to change this behavior.",t.outerHTML);var n=this.schema.getDefaultTextType(),aO=this._defaultBlockConverter;if(!aO)throw new Error("Could not find converter for default type ",n);var o=this._createNode(t,n);return this.state.pushContext(t.tagName,e),o=aO["import"](t,o,e)||o,this.state.popContext(),o},iE.prototype._defaultElementMatcher=function(t){return t.is(this.tagName)},iE.prototype._annotatedText=function(t){var e=this,n=this.state,o=Wt(n.stack);if(!o)throw new Error("Illegal state: context is null.");for(;t.hasNext();){var r=t.next(),i="";if(r.isTextNode())i=e._prepareText(n,r.textContent),i.length&&(o.text=o.text.concat(i),o.offset+=i.length);else{if(r.isCommentNode())continue;if(r.isElementNode()){var s=e._getConverterForElement(r,"inline");if(!s){e.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",r.outerHTML),e.annotatedText(r);continue}var a=o.offset,p=s.type,c=e._createNode(r,p);if(s["import"]){n.stack.push({path:o.path,offset:a,text:""}),n.pushContext(r.tagName,s),c=s["import"](r,c,e)||c,n.popContext();var u=e.schema.getNodeClass(p);u.isInline?e.customText("​"):e.annotatedText(r);var h=n.stack.pop();o.offset=h.offset,o.text=o.text.concat(h.text)}else e.annotatedText(r);var l=o.offset;c.start={path:o.path.slice(0),offset:a},c.end={offset:l},n.inlineNodes.push(c)}else console.warn("Unknown element type. Taking plain text.",r.outerHTML),i=e._prepareText(n,r.textContent),o.text=o.text.concat(i),o.offset+=i.length}}return o.text},iE.prototype._getConverterForElement=function(t,e){var n,o=this;if("block"===e){if(!t.tagName)return null;n=this._blockConverters}else n="inline"===e?this._propertyAnnotationConverters:this._allConverters;for(var r=null,i=0;i<n.length;i++)if(o._converterCanBeApplied(n[i],t)){r=n[i];break}return r},iE.prototype._converterCanBeApplied=function(t,e){return t.matchElement(e,t)},iE.prototype._createElement=function(t){return this._el.createElement(t)},iE.prototype._wrapInlineElementsIntoBlockElement=function(t){for(var e=this,n=this._createElement("div");t.hasNext();){var o=t.next(),r=e._getConverterForElement(o,"block");if(r){t.back();break}n.append(o.clone())}var i=this.defaultConverter(n,this);if(i){if(!i.type)throw new Error("Contract: DOMImporter.defaultConverter() must return a node with type.");this._createAndShow(i)}return i},iE.prototype._createDefaultBlockElement=function(t){var e=this.defaultConverter(t,this);if(e){if(!e.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.",t.outerHTML);e.id=e.id||this.defaultId(t,e.type),this._createAndShow(e)}},iE.prototype._prepareText=function(t,e){if(t.preserveWhitespace)return e;var n=oE;return e=e.replace(rE,""),e=t.lastChar===oE?e.replace(tE,n):e.replace(Zx,n),e=e.replace(eE,n),(this.config.REMOVE_INNER_WS||t.removeInnerWhitespace)&&(e=e.replace(nE,oE)),t.lastChar=e[e.length-1]||t.lastChar,e},iE.prototype._trimTextContent=function(t){var e,n,o=t.getChildNodes(),r=o[0],i=Wt(o);return r&&r.isTextNode()&&(e=r.textContent,n=this._trimLeft(e),r.textContent=n),i&&i.isTextNode()&&(e=i.textContent,n=this._trimRight(e),i.textContent=n),t},iE.prototype._trimLeft=function(t){return t.replace(Zx,"")},iE.prototype._trimRight=function(t){return t.replace(eE,"")};var sE=function(){this.reset()};sE.prototype.reset=function(){this.preserveWhitespace=!1,this.nodes=[],this.inlineNodes=[],this.containerId=null,this.container=[],this.ids={},this.contexts=[],this.stack=[],this.lastChar="",this.skipTypes={},this.ignoreAnnotations=!1,this.isConverting=!1,this.uuid=Kc()},sE.prototype.pushContext=function(t,e){this.contexts.push({tagName:t,converter:e})},sE.prototype.popContext=function(){return this.contexts.pop()},sE.prototype.getCurrentContext=function(){return Wt(this.contexts)},iE.State=sE;var aE=function(t,e){this.fileNode=t,this.context=e,t.setProxy(this)},pE={id:{}};pE.id.get=function(){return this.fileNode.id},aE.prototype.triggerUpdate=function(){var t=this.fileNode.id;this.context.editorSession.transaction(function(e){e.set([t,"__changed__"],"")},{history:!1})},aE.prototype.getUrl=function(){return""},aE.prototype.sync=function(){return Promise.reject(new Error("sync method not implemented"))},Object.defineProperties(aE.prototype,pE),aE.match=function(t,e){return!1};var cE=function(t){function e(e,n){t.call(this,Yc(e),n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.exportDocument=function(t){var e=wf.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(t,e)},e.prototype.getDefaultBlockConverter=function(){return hE},e.prototype.getDefaultPropertyAnnotationConverter=function(){return uE},e}(Qx),uE={tagName:"span","export":function(e,n){n.tagName="span",n.attr("data-type",e.type);var o=e.toJSON();t(o,function(t,e){"id"!==e&&"type"!==e&&(_(t)||v(t)||Fc(t))&&n.attr("data-"+e,t)})}},hE={"export":function(e,n,o){n.attr("data-type",e.type);var r=e.toJSON();t(r,function(t,r){if("id"!==r&&"type"!==r){var i=o.$$("div").attr("property",r);"string"===e.getPropertyType(r)&&t?i.append(o.annotatedText([e.id,r])):i.text(t),n.append(i)}})}},lE=function(t){function e(e){t.call(this,Object.assign({idAttribute:"data-id"},e)),this._el=wf.parseHTML("<html></html>")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.importDocument=function(t){this.reset();var e=wf.parseHTML(t);return this.convertDocument(e),this.generateDocument(),this.state.doc},e.prototype.convertDocument=function(t){throw new Error("This method is abstract")},e}(iE),fE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);fE.prototype._isInlineNode=!0,fE.isInline=!0;var dE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.invalidate=function(){},e.prototype.remove=function(){this.getDocument().data["delete"](this.id)},e.prototype.containsSelection=function(t){return t.isNull()?!1:t.isPropertySelection()?Ut(this.start.path,t.start.path)&&this.start.offset<=t.start.offset&&this.end.offset>=t.end.offset:void console.warn("Marker.contains() does not support other selection types.")},e}(Gx);dE.prototype._isPropertyAnnotation=!1,dE.prototype._isMarker=!0;var gE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTextPath=function(){return this.getPath()},e.prototype.getPath=function(){return[this.id,"content"]},e.prototype.getText=function(){return this.content},e.prototype.isEmpty=function(){return!this.content},e.prototype.getLength=function(){return this.content.length},e}(Ux);gE.isText=!0,gE.schema={type:"text",content:"text",direction:{type:"string",optional:!0}};var yE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(gE);yE.isBlock=!0;var vE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("button").addClass("sc-button");return this.props.icon&&e.append(this.renderIcon(t)),this.props.label&&e.append(this.renderLabel(t)),this.props.active&&e.addClass("sm-active"),this.props.style&&e.addClass("sm-style-"+this.props.style),this.props.disabled?e.attr("tabindex",-1).attr("disabled",!0):e.attr("tabindex",1),e.append(this.props.children),e},e.prototype.renderIcon=function(t){var e=this.context.iconProvider.renderIcon(t,this.props.icon);return e},e.prototype.renderLabel=function(t){return t("div").addClass("se-label").append(this.getLabel(this.props.label))},e.prototype.renderHint=function(t){return t("div").addClass("se-hint").append(this.getLabel(this.props.hint+"-hint"))},e.prototype.getLabel=function(t){var e=this.context.labelProvider;return e.getLabel(t)},e}(Ef),mE={name:"button",configure:function(t){t.addComponent("button",vE)}},_E=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getInitialState=function(){return{activeToolGroups:this.getActiveToolGroups()}},e.prototype.shouldRerender=function(t,e){var n=!h(this.props,t)||!h(this.state.activeToolGroups,e.activeToolGroups);return n?!0:(this.hide(),!1)},e.prototype.didMount=function(){this.context.editorSession.onRender(this._onCommandStatesChanged,this)},e.prototype.dispose=function(){this.context.editorSession.off(this)},e.prototype._onCommandStatesChanged=function(t){t.hasChanged("commandStates")&&this.setState({activeToolGroups:this.getActiveToolGroups()})},e.prototype.getActiveToolGroups=function(){var t=this;this._hasActiveTools=!1;var e=this.context.toolGroups,n=this.getActiveToolGroupNames(),o=new Map;return n.forEach(function(n){var r=e.get(n);if(r){var i=r.tools,s=t.getActiveTools(i,n);o.set(n,{name:n,Class:r.Class,tools:s})}}),o},e.prototype.getActiveTools=function(t,e){var n=this,o=new Map,r=this._getCommandStates();return t.forEach(function(t,e){if(!r[e])throw new Error("Could not find commandState for "+e);var i=Object.assign({},r[e],{name:e,label:e,style:n.getToolStyle(e)});(!i.disabled||n.showDisabled())&&(o.set(t.name,{name:t.name,Class:t.Class,toolProps:i}),n._hasActiveTools=!0)}),o},e.prototype.hasActiveTools=function(){return Boolean(this._hasActiveTools)},e.prototype.getActiveToolGroupNames=function(){throw new Error("Abstract method")},e.prototype.showDisabled=function(){return!1},e.prototype.hide=function(){},e.prototype.getToolStyle=function(){throw new Error("Abstract method")},e.prototype._getCommandStates=function(){return this.context.commandManager.getCommandStates()},e}(Ef),wE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){if(t.prototype.didMount.call(this),!this.context.scrollPane)throw new Error("Requires a scrollPane context");this.context.scrollPane.on("context-menu:opened",this._onContextMenuOpened,this)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.context.scrollPane.off(this)},e.prototype.render=function(t){var e=this,n=t("div").addClass("sc-context-menu sm-hidden"),o=this.state.activeToolGroups;return o.forEach(function(o){var r=Object.assign({},o,{toolStyle:e.getToolStyle(),showLabels:!0});if(r.tools.size>0){var i=t(o.Class,r);n.append(i)}}),n},e.prototype.getActiveToolGroupNames=function(){return["context-menu-primary","context-menu-document"]},e.prototype.showDisabled=function(){return!0},e.prototype.getToolStyle=function(){return"plain-dark"},e.prototype.hide=function(){this.el.addClass("sm-hidden")},e.prototype._onContextMenuOpened=function(t){var e=t.mouseBounds;this.el.removeClass("sm-hidden");var n=this.el.htmlProp("offsetWidth");this.el.css("top",e.top);var o=e.left;o=Math.max(o,0);var r=e.left+e.right-n;o=Math.min(o,r),this.el.css("left",o)},e}(_E),bE={name:"context-menu",configure:function(t){t.addComponent("context-menu",wE)}},CE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-grid");return this.props.mobile&&e.addClass("sm-mobile"),e.append(this.props.children),e},e}(Ef),SE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("se-row");return e.append(this.props.children),e},e}(Ef),xE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){
var e=t("div").addClass("se-cell");return e.addClass("sm-column-"+this.props.columns),e.append(this.props.children),e},e}(Ef);CE.Row=SE,CE.Cell=xE;var EE={name:"grid",configure:function(t){t.addComponent("grid",CE)}},NE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this,n=t("div").addClass(this.getClassNames());n.addClass("sm-hidden"),n.addClass("sm-theme-"+this.getTheme());var o=this.state.activeToolGroups,r=t("div").addClass("se-active-tools");return o.forEach(function(n){var o=Object.assign({},n,{toolStyle:e.getToolStyle(),showIcons:!0});r.append(t(n.Class,o))}),n.append(r),n},e.prototype.getToolStyle=function(){return"outline-dark"},e.prototype.show=function(t){this.el.removeClass("sm-hidden"),this._position(t)},e.prototype.hide=function(){this.el.addClass("sm-hidden")},e.prototype._position=function(t){t&&(this.el.css("top",t.rectangle.top+t.rectangle.height-t.rectangle.height/2),this.el.css("left",0))},e.prototype.getClassNames=function(){return"sc-gutter"},e.prototype.getTheme=function(){return"dark"},e.prototype.getActiveToolGroupNames=function(){return["gutter"]},e}(_E),IE={name:"gutter",configure:function(t){t.addToolGroup("gutter"),t.addComponent("gutter",NE)}},OE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._onChange=function(){var t=this.context.editorSession,e=this.props.path,n=this.el.val();t.transaction(function(t){t.set(e,n)})},e.prototype.render=function(t){var e;if(this.props.path){var n=this.context.editorSession,o=n.getDocument();e=o.get(this.props.path)}else e=this.props.value;var r=t("input").attr({value:e,type:this.props.type,placeholder:this.props.placeholder}).addClass("sc-input");return this.props.path&&r.on("change",this._onChange),this.props.centered&&r.addClass("sm-centered"),r},e}(Ef),TE={name:"input",configure:function(t){t.addComponent("input",OE)}},PE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-layout");return e.addClass("sm-width-"+this.props.width),this.props.textAlign&&e.addClass("sm-text-align-"+this.props.textAlign),this.props.noPadding&&e.addClass("sm-no-padding"),e.append(this.props.children),e},e}(Ef),DE={name:"layout",configure:function(t){t.addComponent("layout",PE)}},AE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-modal");return e.on("click",this._closeModal),this.props.width&&e.addClass("sm-width-"+this.props.width),e.append(t("div").addClass("se-body").append(this.props.children)),e},e.prototype._closeModal=function(t){var e=t.target.classList.contains("sc-modal");e&&this.send("closeModal")},e}(Ef),ME={name:"modal",configure:function(t){t.addComponent("modal",AE)}},kE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){if(t.prototype.didMount.call(this),!this.context.scrollPane)throw new Error("Requires scrollPane context");this.context.scrollPane.on("selection:positioned",this._onSelectionPositioned,this)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.context.scrollPane.off(this)},e.prototype.render=function(t){var e=this,n=t("div").addClass(this.getClassNames());n.addClass("sm-hidden"),n.addClass("sm-theme-"+this.getTheme());var o=this.state.activeToolGroups,r=t("div").addClass("se-active-tools");return o.forEach(function(n){var o=Object.assign({},n,{toolStyle:e.getToolStyle(),showIcons:!0});r.append(t(n.Class,o))}),n.append(r),n},e.prototype.getToolStyle=function(){return"plain-dark"},e.prototype.show=function(t){this.el.removeClass("sm-hidden"),this._position(t)},e.prototype.hide=function(){this.el.addClass("sm-hidden")},e.prototype._onSelectionPositioned=function(t){var e=!0;if(t.editorId!==this.context.editorSession.id&&(e=!1),this.hasActiveTools()&&e){this.el.removeClass("sm-hidden");var n=this.el.htmlProp("offsetWidth"),o=t.selectionRect,r=o.width;this.el.css("top",o.top+o.height);var i=o.left+r/2-n/2;i=Math.max(i,0);var s=o.left+r+o.right-n;i=Math.min(i,s),this.el.css("left",i)}else this.el.addClass("sm-hidden")},e.prototype.getClassNames=function(){return"sc-overlay"},e.prototype.getTheme=function(){return"dark"},e.prototype.getActiveToolGroupNames=function(){return this.props.toolGroups||["overlay"]},e}(_E),jE={name:"overlay",configure:function(t){t.addToolGroup("overlay"),t.addComponent("overlay",kE)}},RE=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.didMount=function(){this.context.dragManager.on("drag:started",this.onDragStarted,this),this.context.dragManager.on("drag:finished",this.onDragFinished,this)},n.prototype.render=function(e){var n=this,o=e("div").addClass("sc-dropzones");return this.state.dropzones?(o.on("dragenter",this.onDrag).on("dragover",this.onDrag),t(this.state.dropzones,function(t,r){t.forEach(function(t,i){var s,a=t.type;if("place"===a?s=e("div").addClass("se-dropzone").attr({"data-dropzone-index":i,"data-dropzone-surface":r}).append(e("div").addClass("se-drop-teaser").css({top:t.teaserPos})):"custom"===a&&(s=e("div").addClass("se-custom-dropzone").attr({"data-dropzone-index":i,"data-dropzone-surface":r}).append(e("div").addClass("se-message").append(t.message))),s){var p=e("div").addClass("se-drop-shield").on("dragenter",n.onDragEnter).on("dragleave",n.onDragLeave).on("drop",n.onDrop).on("mouseenter",n.onDragEnter).on("mouseleave",n.onDragLeave).on("mouseup",n.onDrop);s.append(p),s.css({position:"absolute",top:t.top,left:t.left,width:t.width,height:t.height}),o.append(s)}})})):o.addClass("sm-hidden"),o},n.prototype.onDragStarted=function(t){var e=this,n=this._computeDropzones(t);setTimeout(function(){e.setState({dropzones:n})},250)},n.prototype.onDragFinished=function(){this.setState({})},n.prototype.onDragEnter=function(t){t.target.parentNode.classList.add("sm-over")},n.prototype.onDragLeave=function(t){t.target.parentNode.classList.remove("sm-over")},n.prototype.onDrag=function(t){t.preventDefault()},n.prototype.onDrop=function(t){t.__reserved__=!0,t.preventDefault(),t.stopPropagation();var e=t.target.parentNode.dataset.dropzoneIndex,n=t.target.parentNode.dataset.dropzoneSurface,o=this.state.dropzones[n][e],r=o.dropParams,i=o.type,s=this.context.surfaceManager.getSurface(n),a=o.component,p=o.dropzoneComponent,c=this.context.dragManager;c.extendDragState({targetSurface:s,dropType:i,dropParams:r,component:a,dropzoneComponent:p}),c._onDragEnd(t)},n.prototype._getBoundingRect=function(t){var e=t.context.scrollPane,n=e.getContentElement().getNativeElement(),o=Qc(t.getNativeElement(),n);return o},n.prototype._computeDropzones=function(e){var n=this,o=this.context.scrollPane.getName(),r=e.scrollPanes[o].surfaces,i={};return t(r,function(t){for(var e=t.childNodes,o=e.length+1,r=[],s=0;o>s;s++){if(0===s){var a=n._getBoundingRect(e[0]);r.push({type:"place",left:a.left,top:a.top,width:a.width,height:a.height/2,teaserPos:0,dropParams:{insertPos:s}})}else if(s===o-1){var p=n._getBoundingRect(e[s-1]);r.push({type:"place",left:p.left,top:p.top+p.height/2,width:p.width,height:p.height/2,teaserPos:p.height/2,dropParams:{insertPos:s}})}else{var c=n._getBoundingRect(e[s-1]),u=n._getBoundingRect(e[s]),h=c.top+c.height/2,l=u.top+u.height/2;r.push({type:"place",left:c.left,top:h,width:c.width,height:l-h,teaserPos:(c.top+c.height+u.top)/2-h,dropParams:{insertPos:s}})}if(o-1>s){var f=e[s];if(f._isIsolatedNodeComponent&&(f=f.getContent()),f.getDropzoneSpecs){var d=f.getDropzoneSpecs();d.forEach(function(t){var e=t.component,o=n._getBoundingRect(e);r.push({type:"custom",component:f,dropzoneComponent:e,left:o.left,top:o.top,width:o.width,height:o.height,message:t.message,dropParams:t.dropParams})})}}}i[t.getName()]=r}),i},n.prototype._renderDropTeaser=function(t){t.visible?(this.el.removeClass("sm-hidden"),this.el.css("top",t.rect.top),this.el.css("left",t.rect.left),this.el.css("right",t.rect.right)):this.el.addClass("sm-hidden")},n}(Ef),LE={name:"dropzones",configure:function(t){t.addComponent("dropzones",RE)}},FE=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.didMount=function(){wf.getBrowserWindow().on("resize",this.onResize,this),this.props.scrollPane.on("scroll",this.onScroll,this),setTimeout(function(){this.updatePositions()}.bind(this))},n.prototype.dispose=function(){wf.getBrowserWindow().off(this),this.props.scrollPane.off(this)},n.prototype.didUpdate=function(){this.updatePositions()},n.prototype.render=function(e){var n=e("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){var o=[];t(this.props.highlights,function(n,r){t(n,function(t){o.push(e("div").ref(t).addClass("se-highlight sm-"+r))})}),n.append(e("div").ref("highlights").addClass("se-highlights").append(o))}return n.append(e("div").ref("thumb").addClass("se-thumb")),n},n.prototype.updatePositions=function(){var e=this.props.scrollPane,o=e.getScrollableElement(),r=e.getContentHeight(),i=e.getHeight(),s=e.getScrollPosition(),a=e.getContentElement();this.factor=r/i,this.factor<=1?this.el.addClass("sm-hide-thumb"):this.el.removeClass("sm-hide-thumb"),this.refs.thumb.css({top:s/this.factor,height:i/this.factor}),this.props.highlights&&t(this.props.highlights,function(e){t(e,function(t){var e=o.find('*[data-id="'+t+'"]');if(e){var r=Qc(e.getNativeElement(),a.getNativeElement()),i=r.top/this.factor,s=r.height/this.factor;s<n.overlayMinHeight&&(s=n.overlayMinHeight);var p=this.refs[t];p?this.refs[t].css({top:i,height:s}):console.warn("no ref found for highlight",t)}}.bind(this))}.bind(this))},n.prototype.getScrollableElement=function(){return this.props.scrollPane.getScrollableElement()},n.prototype.onResize=function(){this.rerender()},n.prototype.onScroll=function(){this.updatePositions()},n.prototype.onMouseDown=function(t){t.stopPropagation(),t.preventDefault(),this._mouseDown=!0;var e=wf.getBrowserWindow();e.on("mousemove",this.onMouseMove,this),e.on("mouseup",this.onMouseUp,this);var n=this.el.getOffset().top,o=t.pageY-n,r=this.refs.thumb.el;t.target!==r.getNativeElement()?(this.offset=r.height/2,this.onMouseMove(t)):this.offset=o-r.getPosition().top},n.prototype.onMouseUp=function(){this._mouseDown=!1;var t=wf.getBrowserWindow();t.off("mousemove",this.onMouseMove,this),t.off("mouseup",this.onMouseUp,this)},n.prototype.onMouseMove=function(t){if(this._mouseDown){var e=this.props.scrollPane,n=e.getScrollableElement(),o=this.el.getOffset().top,r=t.pageY-o,i=(r-this.offset)*this.factor;n.setProperty("scrollTop",i)}},n}(Ef);FE.overlayMinHeight=2;var BE={name:"scrollbar",configure:function(t){t.addComponent("scrollbar",FE)}},HE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getChildContext=function(){return{scrollPane:this}},e.prototype.didMount=function(){wu&&(this.windowEl=wf.wrapNativeElement(window),this.windowEl.on("resize",this.onSelectionPositioned,this))},e.prototype.dispose=function(){this.windowEl&&this.windowEl.off(this)},e.prototype.getName=function(){return this.props.name},e.prototype.updateSelection=function(t){var e=t.editorId;this._editorId=e,this.onSelectionPositioned()},e.prototype.onSelectionPositioned=function(){var t=this._getContentRect(),e=this._getSelectionRect();if(e){var n={contentRect:t,selectionRect:e,editorId:this._editorId};this._emitSelectionPositioned(n),this._scrollSelectionIntoView(e)}},e.prototype._emitSelectionPositioned=function(t){this.emit("selection:positioned",t),this.emit("dom-selection:rendered",t)},e.prototype._onContextMenu=function(t){t.preventDefault();var e=this._getMouseBounds(t);this.emit("context-menu:opened",{mouseBounds:e})},e.prototype._scrollSelectionIntoView=function(t){var e=this.getScrollPosition(),n=e+this.getHeight(),o=t.top,r=t.top+t.height;(e>o&&e>r||o>n&&r>n)&&this.setScrollPosition(o)},e.prototype.getHeight=function(){throw new Error("Abstract method")},e.prototype.getContentHeight=function(){throw new Error("Abstract method")},e.prototype.getContentElement=function(){throw new Error("Abstract method")},e.prototype.getScrollableElement=function(){throw new Error("Abstract method")},e.prototype.getScrollPosition=function(){throw new Error("Abstract method")},e.prototype.setScrollPosition=function(){throw new Error("Abstract method")},e.prototype.getPanelOffsetForElement=function(t){throw new Error("Abstract method")},e.prototype.scrollTo=function(t,e){throw new Error("Abstract method")},e.prototype._getContentRect=function(){return this.getContentElement().getNativeElement().getBoundingClientRect()},e.prototype._getSelectionRect=function(){return Pn(this._getContentRect())},e.prototype._getMouseBounds=function(t){return eu(t,this.getContentElement().getNativeElement())},e}(Ef),UE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){t.prototype.didMount.call(this),this.refs.scrollbar&&this.props.highlights&&this.props.highlights.on("highlights:updated",this.onHighlightsUpdated,this),this.refs.scrollbar&&(this.domObserver=new window.MutationObserver(this._onContentChanged.bind(this)),this.domObserver.observe(this.el.getNativeElement(),{subtree:!0,attributes:!0,characterData:!0,childList:!0}),this.context.editorSession.onPosition(this._onPosition,this))},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.props.highlights&&this.props.highlights.off(this),this.context.editorSession.off(this),this.context.dragManager.off(this)},e.prototype.render=function(t){var e=t("div").addClass("sc-scroll-pane");return Pf.isFF&&e.addClass("sm-firefox"),this.props.noStyle||e.addClass("sm-default-style"),"substance"===this.props.scrollbarType&&(e.addClass("sm-substance-scrollbar"),e.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),e.append(t(FE,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),e.append(t("div").ref("scanline").addClass("se-scanline"))),e.append(t("div").ref("scrollable").addClass("se-scrollable").append(this.renderContent(t)).on("scroll",this.onScroll)),e},e.prototype.renderContent=function(t){var e=t("div").ref("content").addClass("se-content");return e.append(this.props.children),"custom"===this.props.contextMenu&&e.on("contextmenu",this._onContextMenu),e},e.prototype._onContentChanged=function(){this._contentChanged=!0},e.prototype._onPosition=function(){this.refs.scrollbar&&this._contentChanged&&(this._contentChanged=!1,this._updateScrollbar())},e.prototype._updateScrollbar=function(){this.refs.scrollbar&&this.refs.scrollbar.updatePositions()},e.prototype.onHighlightsUpdated=function(t){this.refs.scrollbar.extendProps({highlights:t})},e.prototype.onScroll=function(){var t=this.getScrollPosition(),e=this.refs.scrollable;this.props.onScroll&&this.props.onScroll(t,e),this.props.tocProvider&&this.props.tocProvider.markActiveEntry(this),this.emit("scroll",t,e)},e.prototype.getHeight=function(){var t=this.getScrollableElement();return t.height},e.prototype.getContentHeight=function(){var t=this.refs.content.el.getNativeElement();return t.scrollHeight},e.prototype.getContentElement=function(){return this.refs.content.el},e.prototype.getScrollableElement=function(){return this.refs.scrollable.el},e.prototype.getScrollPosition=function(){var t=this.getScrollableElement();return t.getProperty("scrollTop")},e.prototype.setScrollPosition=function(t){var e=this.getScrollableElement();e.setProperty("scrollTop",t)},e.prototype.getPanelOffsetForElement=function(t){var e=t.getNativeElement(),n=this.refs.content.getNativeElement(),o=Qc(e,n);return o.top},e.prototype.scrollTo=function(t,e){var n=this.getScrollableElement(),o=n.find('*[data-id="'+t+'"]');if(o){var r=this.getPanelOffsetForElement(o),i=!0;if(e){var s=n.height,a=n.getProperty("scrollTop");i=a>r||r>a+s}i&&this.setScrollPosition(r)}else console.warn(t,"not found in scrollable container")},e.prototype.onSelectionPositioned=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.prototype.onSelectionPositioned.apply(this,e),this._updateScrollbar()},e.prototype._onContextMenu=function(e){t.prototype._onContextMenu.call(this,e),this._updateScrollbar()},e}(HE),zE={name:"scroll-pane",configure:function(t){t.addComponent("scroll-pane",UE)}},WE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getChildContext=function(){return{scrollPane:this}},e.prototype.getName=function(){return"body"},e.prototype.render=function(t){var e=t("div").addClass("sc-body-scroll-pane");return"custom"===this.props.contextMenu&&e.on("contextmenu",this._onContextMenu),e.append(this.props.children),e},e.prototype.getHeight=function(){return window.innerHeight},e.prototype.getContentHeight=function(){return document.body.scrollHeight},e.prototype.getContentElement=function(){return wf.wrapNativeElement(window.document.body)},e.prototype.getScrollableElement=function(){return document.body},e.prototype.getScrollPosition=function(){return document.body.scrollTop},e.prototype.setScrollPosition=function(t){document.body.scrollTop=t},e.prototype.getPanelOffsetForElement=function(t){console.warn("TODO: implement")},e.prototype.scrollTo=function(t,e){console.warn("TODO: implement")},e}(HE),JE={name:"body-scroll-pane",configure:function(t){t.addComponent("body-scroll-pane",WE)}},qE=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");var e=t("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?e.addClass("sm-horizontal"):e.addClass("sm-vertical");var n=this.props.children[0],o=this.props.children[1];return this.props.sizeB?(o.addClass("se-pane sm-sized"),o.css(this.getSizedStyle(this.props.sizeB)),n.addClass("se-pane sm-auto-fill")):(n.addClass("se-pane sm-sized"),n.css(this.getSizedStyle(this.props.sizeA)),o.addClass("se-pane sm-auto-fill")),e.append(n,o),e},e.prototype.getSizedStyle=function(t){return t&&"inherit"!==t?"horizontal"===this.props.splitType?{height:t}:{width:t}:{}},e}(Ef),VE={name:"split-pane",configure:function(t){t.addComponent("split-pane",qE)}},GE=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.render=function(e){var n=e("div").addClass("sc-tabbed-pane"),o=e("div").addClass("se-tabs");return t(this.props.tabs,function(t){var n=e("a").addClass("se-tab").attr({href:"#","data-id":t.id}).on("click",this.onTabClicked);t.id===this.props.activeTab&&n.addClass("sm-active"),n.append(e("span").addClass("label").append(t.name)),o.append(n)}.bind(this)),n.append(o),n.append(e("div").addClass("se-tab-content").ref("tabContent").append(this.props.children)),n},n.prototype.onTabClicked=function(t){t.preventDefault();var e=t.currentTarget.dataset.id;this.send("switchTab",e)},n}(Ef),$E={name:"tabbed-pane",configure:function(t){t.addComponent("tabbed-pane",GE)}},KE=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getUrl=function(){return this.proxy?this.proxy.getUrl():(console.warn("No file proxy attached to ",this.id),"")},e.prototype.setProxy=function(t){this.proxy=t},e}(Ux);KE.type="file",KE.schema={url:{type:"string",optional:!0},fileType:{type:"string",optional:!0},mimeType:{type:"string",optional:!0},sourceFile:{type:"object",optional:!0}},KE.prototype._isFileNode=!0,KE._isFileNode=!0;var XE={name:"file",configure:function(t){t.addNode(KE)}},YE=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isTool:{}};return n._isTool.get=function(){return!0},e.prototype.render=function(t){var e=t("div").addClass("se-tool"),n=this.getClassNames();n&&e.addClass(n);var o=this.getTitle();return o&&(e.attr("title",o),e.attr("aria-label",o)),e.append(this.renderButton(t)),e},e.prototype.renderButton=function(t){var e=this.getComponent("button"),n=t(e,{icon:this.props.showIcon?this.props.name:null,label:this.props.showLabel?this.props.name:null,hint:this.props.showHint?this.props.name:null,active:this.props.active,disabled:this.props.disabled,style:this.props.style}).on("click",this.onClick);return n},e.prototype.getClassNames=function(){return""},e.prototype.getTitle=function(){var t=this.context.labelProvider,e=this.props.title||t.getLabel(this.getName());return this.props.mode&&(e=[Fo(this.props.mode),e].join(" ")),e},e.prototype.getCommandName=function(){return this.getName()},e.prototype.getName=function(){return this.props.name},e.prototype.onClick=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.executeCommand()},e.prototype.executeCommand=function(t){this.context.commandManager.executeCommand(this.getCommandName(),a({mode:this.props.mode},t))},Object.defineProperties(e.prototype,n),e}(Ef),QE=function(t){if(this.config=t||{},this.name=this.config.name,!this.name)throw new Error("'name' is required")},ZE={isAsync:{}};ZE.isAsync.get=function(){return!1},QE.prototype.getName=function(){return this.name},QE.prototype.getCommandState=function(t,e){throw new Error("Command.getCommandState() is abstract.")},QE.prototype.execute=function(t,e){throw new Error("Command.execute() is abstract.")},QE.prototype._getEditorSession=function(t,e){var n=t.editorSession||e.editorSession;if(!n)throw new Error("'editorSession' is required.");return n},QE.prototype._getSelection=function(t){var e=t.selection||t.selectionState.getSelection();if(!e)throw new Error("'selection' is required.");return e},Object.defineProperties(QE.prototype,ZE),QE.prototype._isCommand=!0;var tN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.editorSession;return{disabled:!e.canUndo(),active:!1}},e.prototype.execute=function(t){var e=t.editorSession;return e.canUndo()?(e.undo(),!0):!1},e}(QE),eN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.editorSession;return{disabled:!e.canRedo(),active:!1}},e.prototype.execute=function(t){var e=t.editorSession;return e.canRedo()?(e.redo(),!0):!1},e}(QE),nN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.editorSession;return{disabled:e.getSelection().isNull()}},e.prototype.execute=function(t){var e=t.editorSession,n=e.getDocument(),o=t.surface||e.getFocusedSurface();if(o){var r;if(o._isContainerEditor){var i=o.getContainer();if(0===i.nodes.length)return!1;var s=i.nodes[0],a=Wt(i.nodes);r=e.createSelection({type:"container",startPath:[s],startOffset:0,endPath:[a],endOffset:1,containerId:i.id,surfaceId:o.id})}else if(o._isTextPropertyEditor){var p=o.getPath(),c=n.get(p);r=e.createSelection({type:"property",path:p,startOffset:0,endOffset:c.length,surfaceId:o.id})}return e.setSelection(r),!0}return!1},e}(QE),oN={name:"base",configure:function(t){t["import"](XE),t["import"](zE),t["import"](JE),t["import"](VE),t["import"]($E),t["import"](BE),t["import"](EE),t["import"](ME),t["import"](TE),t["import"](mE),t["import"](DE),t["import"](bE),t["import"](jE),t["import"](LE),t["import"](IE),t.addToolGroup("document"),t.addToolGroup("annotations"),t.addToolGroup("default"),t.addToolGroup("context-menu-primary"),t.addToolGroup("context-menu-document"),t.addToolGroup("insert"),t.addCommand("undo",tN),t.addCommand("redo",eN),t.addCommand("select-all",nN),t.addTool("undo",YE,{toolGroup:["document","context-menu-document"]}),t.addTool("redo",YE,{toolGroup:["document","context-menu-document"]}),t.addTool("select-all",YE,{toolGroup:["context-menu-document"]}),t.addIcon("undo",{fontawesome:"fa-undo"}),t.addIcon("redo",{fontawesome:"fa-repeat"}),t.addIcon("edit",{fontawesome:"fa-cog"}),t.addIcon("delete",{fontawesome:"fa-times"}),t.addIcon("expand",{fontawesome:"fa-arrows-h"}),t.addIcon("truncate",{fontawesome:"fa-arrows-h"}),t.addLabel("undo",{en:"Undo",de:"Rückgängig"}),t.addLabel("redo",{en:"Redo",de:"Wiederherstellen"}),t.addLabel("select-all",{en:"Select All",de:"Alles Auswählen"}),t.addLabel("container-selection",{en:"Container",de:"Container"}),t.addLabel("container",{en:"Container",de:"Container"}),t.addLabel("insert-container",{en:"Insert Container",de:"Container einfügen"}),Pf.isMac?(t.addKeyboardShortcut("cmd+z",{command:"undo"}),t.addKeyboardShortcut("cmd+shift+z",{command:"redo"}),t.addKeyboardShortcut("cmd+a",{command:"select-all"})):(t.addKeyboardShortcut("ctrl+z",{command:"undo"}),t.addKeyboardShortcut("ctrl+shift+z",{command:"redo"}),t.addKeyboardShortcut("ctrl+a",{command:"select-all"}))}},rN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(yE);rN.type="blockquote";var iN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.getTagName(),n=t(e).attr("data-id",this.props.node.id).addClass(this.getClassNames());return n},e.prototype.getTagName=function(){return"div"},e.prototype.getClassNames=function(){return""},e}(Ef),sN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){var t=this.props.node;t.on("highlighted",this.onHighlightedChanged,this)},e.prototype.dispose=function(){var t=this.props.node;t.off(this)},e.prototype.render=function(t){var e=t(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&e.addClass("sm-highlighted"),e.append(this.props.children),e},e.prototype.getClassNames=function(){return"sc-"+this.props.node.type},e.prototype.onHighlightedChanged=function(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")},e.prototype.getTagName=function(){return"span"},e}(Ef),aN=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this.name=this.props.node.id,this._id=this.context.surface.id+"/"+this.name,this._state={selectionFragment:null},this.handleAction("escape",this.escape),this.ContentClass=this._getContentClass(this.props.node)||t;var o=Pf.isFF||!this.ContentClass.noBlocker;this.blockingMode=o?"closed":"open"}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={id:{}};return e.prototype.getChildContext=function(){return{isolatedNodeComponent:this,surface:void 0}},e.prototype.getInitialState=function(){var t=this.context.editorSession.getSelectionState();return this._deriveStateFromSelectionState(t)},e.prototype.didMount=function(){t.prototype.didMount.call(this);var e=this.context.editorSession;e.onRender("selection",this._onSelectionChanged,this)},e.prototype.dispose=function(){t.prototype.dispose.call(this);var e=this.context.editorSession;e.off(this)},e.prototype.renderContent=function(t,e,n){void 0===n&&(n={});var o=this.ContentClass;if(o){var r=Object.assign({disabled:this.props.disabled,node:e,isolatedNodeState:this.state.mode,focused:"focused"===this.state.mode},n);return t(o,r)}return console.error("Could not resolve a component for type: "+e.type),t(this.__elementTag)},e.prototype.getId=function(){return this._id},n.id.get=function(){return this.getId()},e.prototype.getMode=function(){return this.state.mode},e.prototype.isOpen=function(){return"open"===this.blockingMode},e.prototype.isClosed=function(){return"closed"===this.blockingMode},e.prototype.isNotSelected=function(){return!this.state.mode},e.prototype.isSelected=function(){return"selected"===this.state.mode},e.prototype.isCoSelected=function(){return"co-selected"===this.state.mode},e.prototype.isFocused=function(){return"focused"===this.state.mode},e.prototype.isCoFocused=function(){return"co-focused"===this.state.mode},e.prototype.escape=function(){this.selectNode()},e.prototype._onSelectionChanged=function(){var t=this.context.editorSession,e=this._deriveStateFromSelectionState(t.getSelectionState());!e&&this.state.mode?this.extendState({mode:null}):e&&e.mode!==this.state.mode&&this.extendState(e)},e.prototype.onKeydown=function(t){t.keyCode===Wf.ESCAPE&&"focused"===this.state.mode&&(t.stopPropagation(),t.preventDefault(),this.escape())},e.prototype._getContentClass=function(t){var e=this.context.componentRegistry,n=e.get(t.type);return n},e.prototype._getSurface=function(t){var e=t.get("surface");if(void 0===e){var n=t.getSelection();if(n&&n.surfaceId){var o=this.context.surfaceManager;e=o.getSurface(n.surfaceId)}else e=null;t.set("surface",e)}return e},e.prototype._getIsolatedNodes=function(t){var e=t.get("isolatedNodes");if(!e){var n=t.getSelection();if(e=[],n&&n.surfaceId){var o=this.context.surfaceManager,r=o.getSurface(n.surfaceId);e=r.getComponentPath().filter(function(t){return t._isAbstractIsolatedNodeComponent})}t.set("isolatedNodes",e)}return e},e.prototype._shouldConsumeEvent=function(e){var n=t.unwrap(e.target);return n&&(n===this||n.context.isolatedNodeComponent===this)},Object.defineProperties(e.prototype,n),e}(Ef);aN.prototype._isAbstractIsolatedNodeComponent=!0;var pN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.props.node,n=this.ContentClass,o=t("span");o.addClass(this.getClassNames()).addClass("sc-inline-node").addClass("sm-"+this.props.node.type).attr("data-id",e.id).attr("data-inline","1");var r=this.isDisabled();return this.state.mode?o.addClass("sm-"+this.state.mode):o.addClass("sm-not-selected"),n.noStyle||o.addClass("sm-default-style"),o.on("keydown",this.onKeydown),o.append(this.renderContent(t,e).ref("content").addClass("se-content")),r&&o.addClass("sm-disabled").attr("contenteditable",!1).on("click",this.onClick),o.attr("draggable",!0),o},e.prototype.isDisabled=function(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1},e.prototype.getClassNames=function(){return""},e.prototype.onClick=function(t){this._shouldConsumeEvent(t)&&this.selectNode()},e.prototype.selectNode=function(){var t=this.context.editorSession,e=this.context.surface,n=this.props.node;t.setSelection({type:"property",path:n.start.path,startOffset:n.start.offset,endOffset:n.end.offset,containerId:e.getContainerId(),surfaceId:e.id})},e.prototype._deriveStateFromSelectionState=function(t){var e=this._getSurface(t);if(!e)return null;if(e===this.context.surface){var n=t.getSelection(),o=this.props.node;if(n.isPropertySelection()&&!n.isCollapsed()&&h(n.path,o.path)){var r=o.getSelection();if(r.equals(n))return{mode:"selected"};if(n.contains(r))return{mode:"co-selected"}}}var i=e.context.isolatedNodeComponent;
if(!i)return null;if(i===this)return{mode:"focused"};var s=this._getIsolatedNodes(t);return s.indexOf(this)>-1?{mode:"co-focused"}:null},e}(aN);pN.prototype._isInlineNodeComponent=!0;var cN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this._renderContent(t).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"});return e},e.prototype.getText=function(){return this.getDocument().get(this.props.path)||""},e.prototype.getAnnotations=function(){return this.getDocument().getIndex("annotations").get(this.props.path)},e.prototype._getTagName=function(){return this.props.tagName},e.prototype._onDocumentChange=function(t){t.change&&t.change.updated[this.getPath()]&&this.rerender()},e.prototype._renderContent=function(t){var e=this.getText(),n=this.getAnnotations(),o=t(this._getTagName()||"span");if(n&&n.length>0){var r=new Yx({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this,t),onExit:this._finishFragment.bind(this)});r.start(o,e,n)}else o.append(e);return o},e.prototype._renderTextNode=function(t,e){e&&e.length>0&&t.append(e)},e.prototype._renderFragment=function(t,e){var n=this.getDocument(),o=this.getComponentRegistry(),r=e.node;if("container-annotation-fragment"===r.type);else if("container-annotation-anchor"!==r.type){var i=o.get(r.type)||sN;!r.constructor.isInline||i.prototype._isInlineNodeComponent||i.isCustom||(i=pN);var s=t(i,{doc:n,node:r});return s}},e.prototype._finishFragment=function(t,e,n){n.append(e)},e.prototype.getDocument=function(){return this.props.doc||this.context.doc},e}(Ef),uN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("span").addClass("se-cursor");if(e.append("\ufeff"),e.append(t("div").addClass("se-cursor-inner")),this.props.collaborator){var n=this.props.collaborator.colorIndex;e.addClass("sm-collaborator-"+n)}else e.addClass("sm-local-user");return e},e}(Ef),hN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("span").addClass("se-selection-fragment");if(this.props.collaborator){var n=this.props.collaborator.colorIndex;e.addClass("sm-collaborator-"+n)}else e.addClass("sm-local-user");return e.append(this.props.children),e},e}(Ef),lN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getInitialState=function(){var t,e=this.context.markersManager,n=this.props.path;if(e)e.register(this),t=e.getMarkers(n,{surfaceId:this.getSurfaceId(),containerId:this.getContainerId()});else{var o=this.getDocument();t=o.getAnnotations(n)}return{markers:t}},e.prototype.didMount=function(){this.context.surface&&this.context.surface.hasNativeSpellcheck()&&(this.domObserver=new window.MutationObserver(this._onDomMutations.bind(this)),this.domObserver.observe(this.el.getNativeElement(),{subtree:!0,characterData:!0,characterDataOldValue:!0}))},e.prototype.dispose=function(){this.context.markersManager&&this.context.markersManager.deregister(this)},e.prototype.render=function(t){var e=this.getPath(),n=this._renderContent(t).addClass("sc-text-property").attr({"data-path":e.join(".")}).css({"white-space":"pre-wrap"});return this.props.withoutBreak||n.append(t("br")),n},e.prototype.getAnnotations=function(){return this.state.markers},e.prototype._renderFragment=function(e,n){var o,r=n.node,i=r.id;return"cursor"===r.type?o=e(uN,{collaborator:r.collaborator}):"selection-fragment"===r.type?o=e(hN,{collaborator:r.collaborator}):(o=t.prototype._renderFragment.apply(this,arguments),o.ref(i+"@"+n.counter)),o.attr("data-offset",n.pos),o},e.prototype._onDomMutations=function(t){if(2===t.length&&t[0].target===t[1].target){var e=t[0].target._wrapper;if(e)return void this._applyTextMutation(e,t[0].oldValue)}this.rerender()},e.prototype._applyTextMutation=function(t,e){var n=su(t,0),o=t.textContent,r=ou(e,o,n),i=this.context.editorSession,s=this.getPath();i.transaction(function(t){r.forEach(function(e){"replace"===e.type?(t.update(s,{type:"delete",start:e.start,end:e.end}),t.update(s,{type:"insert",start:e.start,text:e.text})):t.update(s,e)})})},e.prototype.getPath=function(){return this.props.path},e.prototype.getText=function(){return this.getDocument().get(this.getPath())},e.prototype.getDocument=function(){return this.props.doc||this.context.doc},e.prototype.getSurface=function(){return this.props.surface||this.context.surface},e.prototype.getSurfaceId=function(){var t=this.getSurface();return t?t.id:null},e.prototype.getContainerId=function(){var t=this.getSurface();return t?t.getContainerId():null},e.prototype.isEditable=function(){return this.getSurface().isEditable()},e.prototype.isReadonly=function(){return this.getSurface().isReadonly()},e.prototype.getDOMCoordinate=function(t){return this._getDOMCoordinate(this.el,t)},e.prototype._finishFragment=function(t,e,n){e.attr("data-length",t.length),n.append(e)},e.prototype._getDOMCoordinate=function(t,e){var n,o=this,r=0;if(0===e)return{container:t.getNativeElement(),offset:0};for(var i=t.getFirstChild();i;i=i.getNextSibling(),r++)if(i.isTextNode()){if(n=i.textContent.length,n>=e)return{container:i.getNativeElement(),offset:e};e-=n}else if(i.isElementNode()){var s=i.getAttribute("data-length");if(!s)return console.error("FIXME: Can not map to DOM coordinates."),null;if(n=parseInt(s,10),n>=e){if(i.attr("data-inline")){var a=i.getNextSibling();return a&&a.isTextNode()?{container:a.getNativeElement(),offset:0}:{container:t.getNativeElement(),offset:t.getChildIndex(i)+1}}return o._getDOMCoordinate(i,e,r)}e-=n}},e}(cN);lN.prototype._isTextPropertyComponent=!0,lN.getCoordinate=function(t,e,n){var o=iu(t,e,n);if(!o)return null;var r=su(o.node,o.offset);if(v(r)){var i=new Wh(o.path,r);return i._comp=o.comp,i}return null};var fN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);n.addClass("sc-text-block");var o=this.props.node;return o.direction&&n.attr("dir",o.direction),n.append(e(lN,{path:o.getTextPath(),direction:o.direction})),n},e}(iN),dN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);dN.type="code";var gN=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(t.apply(this,e),!this.config.nodeType)throw new Error("'nodeType' is required")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAnnotationType=function(){return this.config.nodeType},e.prototype.getAnnotationData=function(){return{}},e.prototype.isDisabled=function(t){return!t||t.isNull()||!t.isAttached()||t.isCustomSelection()||t.isNodeSelection()||t.isContainerSelection()?!0:!(!this.config.disableCollapsedCursor||!t.isCollapsed())},e.prototype.canCreate=function(t,e){return 0===t.length&&!e.isCollapsed()},e.prototype.canFuse=function(t,e){return t.length>=2&&!e.isCollapsed()},e.prototype.canDelete=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.isInsideOf(n)},e.prototype.canExpand=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.overlaps(n)&&!e.isInsideOf(n)},e.prototype.canTruncate=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return(e.isLeftAlignedWith(n)||e.isRightAlignedWith(n))&&!e.contains(n)&&!e.isCollapsed()},e.prototype.getCommandState=function(t){var e=this._getSelection(t);if(this.isDisabled(e))return{disabled:!0};var n=this._getAnnotationsForSelection(t),o={disabled:!1,active:!1,mode:null};return this.canCreate(n,e)?o.mode="create":this.canFuse(n,e)?o.mode="fuse":this.canTruncate(n,e)?(o.active=!0,o.mode="truncate"):this.canExpand(n,e)?o.mode="expand":this.canDelete(n,e)?(o.active=!0,o.mode="delete"):o.disabled=!0,o},e.prototype.execute=function(t){var e=t.commandState;if(e.disabled)return!1;switch(e.mode){case"create":return this.executeCreate(t);case"fuse":return this.executeFuse(t);case"truncate":return this.executeTruncate(t);case"expand":return this.executeExpand(t);case"delete":return this.executeDelete(t);default:return console.warn("Command.execute(): unknown mode",e.mode),!1}},e.prototype.executeCreate=function(t){var e=this._getAnnotationsForSelection(t);this._checkPrecondition(t,e,this.canCreate);var n=this._getEditorSession(t),o=this.getAnnotationData();o.type=this.getAnnotationType();var r;return n.transaction(function(t){r=t.annotate(o)}),{mode:"create",anno:r}},e.prototype.executeFuse=function(t){var e=this._getAnnotationsForSelection(t);return this._checkPrecondition(t,e,this.canFuse),this._applyTransform(t,function(t){ll.fuseAnnotation(t,e)}),{mode:"fuse",anno:e[0]}},e.prototype.executeTruncate=function(t){var e=this._getAnnotationsForSelection(t),n=e[0];return this._checkPrecondition(t,e,this.canTruncate),this._applyTransform(t,function(e){ll.truncateAnnotation(e,n,t.selection)}),{mode:"truncate",anno:n}},e.prototype.executeExpand=function(t){var e=this._getAnnotationsForSelection(t),n=e[0];return this._checkPrecondition(t,e,this.canExpand),this._applyTransform(t,function(e){ll.expandAnnotation(e,n,t.selection)}),{mode:"expand",anno:n}},e.prototype.executeDelete=function(t){var e=this._getAnnotationsForSelection(t),n=e[0];return this._checkPrecondition(t,e,this.canDelete),this._applyTransform(t,function(t){return t["delete"](n.id)}),{mode:"delete",annoId:n.id}},e.prototype._checkPrecondition=function(t,e,n){var o=this._getSelection(t);if(!n.call(this,e,o))throw new Error("AnnotationCommand: can't execute command for selection "+o.toString())},e.prototype._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.getAnnotationType())},e.prototype._applyTransform=function(t,e){var n=this._getSelection(t);if(!n.isNull()){var o,r=this._getEditorSession(t);return r.setSelection(n),r.transaction(function(n){var r=e(n,t);r&&(o=r.result)}),o}},e}(QE),yN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sm-annotation-tool"),n},e.prototype.renderButton=function(e){var n=t.prototype.renderButton.call(this,e);return n.append(this.renderMode(e)),n},e.prototype.renderMode=function(t){var e=this.props.mode,n=t("div").addClass("se-mode"),o=this.context.iconProvider.renderIcon(t,e);return o&&n.append(o),n},e}(YE),vN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(yE);vN.type="codeblock";var mN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);mN.type="emphasis",mN.fragmentation=Yx.ANY;var _N={type:"emphasis",tagName:"em",matchElement:function(t){return t.is("em, i")}},wN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTagName=function(){return"em"},e}(sN),bN={name:"emphasis",configure:function(t,e){var n=e.toolGroup,o=e.disableCollapsedCursor;t.addNode(mN),t.addConverter("html",_N),t.addConverter("xml",_N),t.addComponent("emphasis",wN),t.addCommand("emphasis",gN,{nodeType:mN.type,disableCollapsedCursor:o}),t.addTool("emphasis",yN,{toolGroup:n||"annotations"}),t.addIcon("emphasis",{fontawesome:"fa-italic"}),t.addLabel("emphasis",{en:"Emphasis",de:"Betonung"}),Pf.isMac?t.addKeyboardShortcut("cmd+i",{command:"emphasis"}):t.addKeyboardShortcut("ctrl+i",{command:"emphasis"})},Emphasis:mN,EmphasisHTMLConverter:_N},CN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImageFile=function(){return this.imageFile?this.document.get(this.imageFile):void 0},e.prototype.getUrl=function(){var t=this.getImageFile();return t?t.getUrl():void 0},e}(Ux);CN.schema={type:"image",imageFile:{type:"file"}};var SN=function(t){function e(e,n){t.call(this,e,n),this.file=e.sourceFile,this.file&&(this._fileUrl=URL.createObjectURL(this.file)),this.url=e.url}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getUrl=function(){return this.url?this.url:this._fileUrl?this._fileUrl:""},e.prototype.sync=function(){return this.url||(console.info("Simulating file upload. Creating blob url instead.",this._fileUrl),this.url=this._fileUrl),Promise.resolve()},e}(aE),xN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(SN);xN.match=function(t){return"image"===t.fileType};var EN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getWrappedNode=function(){return this.getDocument().get(this.wrappedNode)},e}(fE);EN.schema={type:"inline-wrapper",wrappedNode:"id"};var NN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(yE);NN.type="paragraph";var IN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sc-paragraph")},e.prototype.getTagName=function(){return"p"},e}(fN),ON={type:"paragraph",tagName:"p","import":function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])},"export":function(t,e,n){e.append(n.annotatedText([t.id,"content"]))}},TN={name:"paragraph",configure:function(t){t.addNode(NN),t.addComponent(NN.type,IN),t.addConverter("html",ON),t.addConverter("xml",ON),t.addTextType({name:"paragraph",data:{type:"paragraph"}}),t.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"}),t.addLabel("paragraph.content",{en:"Paragraph",de:"Paragraph"})},Paragraph:NN,ParagraphComponent:IN,ParagraphHTMLConverter:ON},PN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);PN.type="strong",PN.fragmentation=Yx.ANY;var DN={type:"strong",tagName:"strong",matchElement:function(t){return t.is("strong, b")}},AN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTagName=function(){return"strong"},e}(sN),MN={name:"strong",configure:function(t,e){var n=e.toolGroup,o=e.disableCollapsedCursor;t.addNode(PN),t.addConverter("html",DN),t.addConverter("xml",DN),t.addComponent("strong",AN),t.addCommand("strong",gN,{nodeType:"strong",disableCollapsedCursor:o}),t.addTool("strong",yN,{toolGroup:n||"annotations"}),t.addIcon("strong",{fontawesome:"fa-bold"}),t.addLabel("strong",{en:"Strong",de:"Fett"}),Pf.isMac?t.addKeyboardShortcut("cmd+b",{command:"strong"}):t.addKeyboardShortcut("ctrl+b",{command:"strong"})},Strong:PN,StrongHTMLConverter:DN},kN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);kN.type="subscript",kN.fragmentation=Yx.ANY;var jN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);jN.type="superscript",jN.fragmentation=Yx.ANY;var RN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(yE);RN.schema={type:"heading",level:{type:"number","default":1}};var LN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sc-heading sm-level-"+this.props.node.level)},e.prototype.getTagName=function(){return"h"+this.props.node.level},e}(fN),FN={type:"heading",matchElement:function(t){return/^h\d$/.exec(t.tagName)},"import":function(t,e,n){e.level=Number(t.tagName[1]),e.content=n.annotatedText(t,[e.id,"content"])},"export":function(t,e,n){e.tagName="h"+t.level,e.append(n.annotatedText([t.id,"content"]))}},BN={name:"heading",configure:function(t){t.addNode(RN),t.addComponent(RN.type,LN),t.addConverter("html",FN),t.addConverter("xml",FN),t.addTextType({name:"heading1",data:{type:"heading",level:1}}),t.addTextType({name:"heading2",data:{type:"heading",level:2}}),t.addTextType({name:"heading3",data:{type:"heading",level:3}}),t.addLabel("heading1",{en:"Heading 1",de:"Überschrift 1"}),t.addLabel("heading2",{en:"Heading 2",de:"Überschrift 2"}),t.addLabel("heading3",{en:"Heading 3",de:"Überschrift 3"})},Heading:RN,HeadingComponent:LN,HeadingHTMLConverter:FN},HN=function(e){function n(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];e.apply(this,t),this._navIdx=-1}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.didMount=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];e.prototype.didMount.apply(this,t),this._focusToggle()},n.prototype.render=function(e){var n=this.context.labelProvider,o="No selection";this.props.currentTextType&&(o=this.props.currentTextType.name);var r=e("div").addClass("sc-switch-text-type"),i=e("button").ref("toggle").addClass("se-toggle").attr("title",n.getLabel("switch_text")).append(n.getLabel(o)).on("click",this.toggleAvailableTextTypes);if(this.props.disabled||!this.props.currentTextType?(r.addClass("sm-disabled"),i.attr("tabindex",-1)):i.attr("tabindex",1),r.append(i),this.state.open){r.addClass("sm-open");var s=e("div").addClass("se-options").ref("options");t(this.props.textTypes,function(t){var o=e("button").addClass("se-option sm-"+t.name).attr("data-type",t.name).append(n.getLabel(t.name)).on("click",this.handleClick);s.append(o)}.bind(this)),r.append(s),r.on("keydown",this.onKeydown)}return r},n.prototype.didUpdate=function(){this._focusToggle()},n.prototype._focusToggle=function(){this.state.open&&this.refs.toggle.el.focus()},n.prototype.executeCommand=function(t){this.context.commandManager.executeCommand(this.getCommandName(),{textType:t})},n.prototype.getTextCommands=function(){var t=this.getSurface();return!this.textCommands&&t&&(this.textCommands=t.getTextCommands()),this.textCommands||{}},n.prototype.handleClick=function(t){t.preventDefault(),this.executeCommand(t.currentTarget.dataset.type)},n.prototype.onKeydown=function(t){var e=!1;switch(t.keyCode){case Wf.UP:this._nav(-1),e=!0;break;case Wf.DOWN:this._nav(1),e=!0;break;case Wf.ESCAPE:this.toggleDropdown(),e=!0}e&&(t.preventDefault(),t.stopPropagation())},n.prototype.toggleAvailableTextTypes=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.toggleDropdown()},n.prototype.toggleDropdown=function(){this._navIdx=-1,this.extendState({open:!this.state.open})},n.prototype._nav=function(t){if(this._navIdx+=t,this._navIdx=Math.max(0,this._navIdx),this._navIdx=Math.min(this._getOptionsCount()-1,this._navIdx),this._navIdx>=0){var e=this.refs.options.children[this._navIdx];e.focus()}},n.prototype._getOptionsCount=function(){return this.refs.options.children.length},n}(YE);HN.command="switch-text-type";var UN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTextTypes=function(t){var e=t.surface;return e&&e.isContainerEditor()?e.getTextTypes():[]},e.prototype.getTextType=function(t){var e=this.getTextTypes(t);return gw(e,function(e){return e.name===t.textType})},e.prototype.getCurrentTextType=function(t,e){var n,o=this.getTextTypes(t);return o.forEach(function(t){var o=l(t.data);delete o.type,zs(e,o)&&e.type===t.data.type&&(n=t)}),n},e.prototype.isDisabled=function(t){var e=t.selection,n=t.surface;return n&&n.isEnabled()&&!e.isNull()?!!(e&&this.config.disableCollapsedCursor&&e.isCollapsed()):!0},e.prototype.getCommandState=function(t){var e,n=t.editorSession.getDocument(),o=t.selection,r={disabled:!1,textTypes:this.getTextTypes(t)};if(this.isDisabled(t))r.disabled=!0;else if(o.isContainerSelection())r.disabled=!0,r.currentTextType={name:"container-selection"};else if(o.isPropertySelection()){var i=o.getPath();e=n.get(i[0]),e&&(e.isText()&&e.isBlock()&&(r.currentTextType=this.getCurrentTextType(t,e)),r.currentTextType||(r.currentTextType={name:[e.type,i[1]].join(".")},r.disabled=!0))}else o.isNodeSelection()?(e=n.get(o.getNodeId()),r.currentTextType={name:e.type},r.disabled=!0):o.isCustomSelection()&&(r.currentTextType={name:"custom"},r.disabled=!0);return r},e.prototype.execute=function(t){var e=this.getTextType(t),n=e.data,o=t.surface,r=t.editorSession;return o?(r.transaction(function(t){return t.switchTextType(n)}),n):void console.warn("No focused surface. Stopping command execution.")},e}(QE),zN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);zN.schema={type:"link",title:{type:"string",optional:!0},url:{type:"string","default":""}},zN.fragmentation=Yx.SHOULD_NOT_SPLIT;var WN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.prototype.didMount.apply(this,e);var o=this.props.node;this.context.editorSession.onRender("document",this.rerender,this,{path:[o.id,"url"]})},e.prototype.dispose=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.prototype.dispose.apply(this,e),this.context.editorSession.off(this)},e.prototype.render=function(e){var n=t.prototype.render.call(this,e);n.tagName="a",n.attr("href",this.props.node.url);var o=[this.props.node.url];return this.props.node.title&&o.push(this.props.node.title),n.attr("title",o.join(" | "))},e}(sN),JN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canFuse=function(){return!1},e.prototype.executeCreate=function(e){var n=t.prototype.executeCreate.call(this,e),o=this._getEditorSession(e);return o.transaction(function(t){t.setSelection(t.selection.collapse())}),n},e}(gN),qN={type:"link",tagName:"a","import":function(t,e){e.url=t.attr("href"),e.title=t.attr("title")},"export":function(t,e){e.attr({href:t.url,title:t.title})}},VN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getUrlPath=function(){var t=this.constructor.urlPropertyPath;return[this.props.node.id].concat(t)},e.prototype._openLink=function(){var t=this.context.editorSession.getDocument();window.open(t.get(this.getUrlPath()),"_blank")},e.prototype.render=function(t){var e=this.getComponent("input"),n=this.getComponent("button"),o=t("div").addClass("sc-edit-link-tool");if(this.props.disabled)return console.warn("Tried to render EditLinkTool while disabled."),o;var r=this.getUrlPath();return o.append(t(e,{type:"url",path:r,placeholder:"Paste or type a link url"}),t(n,{icon:"open-link",style:this.props.style}).attr("title",this.getLabel("open-link")).on("click",this._openLink),t(n,{icon:"delete",style:this.props.style}).attr("title",this.getLabel("delete-link")).on("click",this.onDelete)),o},e.prototype.onDelete=function(t){t.preventDefault();var e=this.props.node,n=this.context.surfaceManager,o=n.getFocusedSurface();if(!o)return void console.warn("No focused surface. Stopping command execution.");var r=this.context.editorSession;r.transaction(function(t,n){return t["delete"](e.id),n})},e}(YE);VN.urlPropertyPath=["url"];var GN=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(t.apply(this,e),!this.config.nodeType)throw new Error("'nodeType' is required")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=this._getSelection(t),n=this._getAnnotationsForSelection(t),o={disabled:!0};return 1===n.length&&e.isPropertySelection()&&e.isCollapsed()&&(o.disabled=!1,o.node=n[0]),o},e.prototype.execute=function(t){},e.prototype._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.config.nodeType)},e}(QE),$N={name:"link",configure:function(t,e){var n=e.toolGroup,o=e.editLinkToolGroup,r=e.disableCollapsedCursor;t.addNode(zN),t.addComponent("link",WN),t.addConverter("html",qN),t.addConverter("xml",qN),t.addCommand("link",JN,{nodeType:"link",disableCollapsedCursor:r}),t.addCommand("edit-link",GN,{nodeType:"link"}),t.addTool("link",yN,{toolGroup:n||"annotations"}),t.addTool("edit-link",VN,{toolGroup:o||"overlay"}),t.addIcon("link",{fontawesome:"fa-link"}),t.addIcon("open-link",{fontawesome:"fa-external-link"}),t.addLabel("link",{en:"Link",de:"Link"}),t.addLabel("open-link",{en:"Open Link",de:"Link öffnen"}),t.addLabel("delete-link",{en:"Remove Link",de:"Link löschen"}),Pf.isMac?t.addKeyboardShortcut("cmd+k",{command:"link"}):t.addKeyboardShortcut("ctrl+k",{command:"link"})},Link:zN,LinkComponent:WN,LinkCommand:JN,EditLinkTool:VN},KN=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{}};return e.prototype.getItemAt=function(t){return this.getDocument().get(this.items[t])},e.prototype.getFirstItem=function(){return this.getItemAt(0)},e.prototype.getLastItem=function(){return this.getItemAt(this.getLength()-1)},e.prototype.getItems=function(){var t=this.getDocument();return this.items.map(function(e){return t.get(e)})},e.prototype.getItemPosition=function(t){t._isNode&&(t=t.id);var e=this.items.indexOf(t);if(0>e)throw new Error("Item is not within this list: "+t);return e},e.prototype.insertItemAt=function(t,e){var n=this.getDocument();n.update([this.id,"items"],{type:"insert",pos:t,value:e})},e.prototype.appendItem=function(t){this.insertItemAt(this.items.length,t)},e.prototype.removeItemAt=function(t){var e=this.getDocument();e.update([this.id,"items"],{type:"delete",pos:t})},e.prototype.remove=function(t){var e=this.getDocument(),n=this.getItemPosition(t);n>=0&&e.update([this.id,"items"],{type:"delete",pos:n})},e.prototype.getLength=function(){return this.items.length},n.length.get=function(){return this.getLength()},Object.defineProperties(e.prototype,n),e}(Ux);KN.isList=!0,KN.type="list",KN.schema={ordered:{type:"boolean","default":!1},items:{type:["array","id"],"default":[],owned:!0}};var XN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(gE);XN.type="list-item",XN.schema={level:{type:"number","default":1}};var YN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(lN),QN=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){this.context.editorSession.onRender("document",this._onChange,this)},e.prototype.render=function(t){var e=this.props.node,n=t(pu(e)).addClass("sc-list").attr("data-id",e.id);return cu(e,n,function(e){if(_(e))return t(e);if("list-item"===e.type){var n=e;return t(YN,{path:[n.id,"content"],node:n,tagName:"li"}).ref(n.id)}}),n},e.prototype._onChange=function(t){var e=this,n=this.props.node;if(t.isAffected(n.id))return this.rerender();for(var o=n.items,r=0;r<o.length;r++)if(t.isAffected([o[r],"level"]))return e.rerender()},e}(Ef);QN.prototype._isCustomNodeComponent=!0;var ZN={type:"list",matchElement:function(t){return t.is("ul")||t.is("ol")},"import":function(t,e,n){function o(e){for(var n=e,o=1;n;){if(n.parentNode===t)return o;n=n.parentNode,r.matchElement(n)&&o++}}var r=this;this._santizeNestedLists(t),t.is("ol")&&(e.ordered=!0);var i=t.findAll("li");i.forEach(function(t){var r=n.convertElement(t);r.level=o(t),e.items.push(r.id)})},"export":function(t,e,n){var o=n.$$;return e.tagName=pu(t),cu(t,e,function(t){if(_(t))return o(t);var e=t;return o("li").append(n.annotatedText(e.getTextPath()))}),e},_santizeNestedLists:function(t){var e=t.findAll("ol,ul");e.forEach(function(t){for(;!t.parentNode.is("ol,ul");){var e=t.parentNode,n=e.parentNode,o=n.getChildIndex(e);n.insertAt(o+1,t)}})}},tI={type:"list-item",matchElement:function(t){return t.is("li")},"import":function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])},"export":function(t,e,n){e.append(n.annotatedText(t.getTextPath()))}},eI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=this._getSelection(t),n={},o=this.config.disableCollapsedCursor&&e.isCollapsed();return(o||!e.isPropertySelection())&&(n.disabled=!0),n},e.prototype.execute=function(t){var e=this.config.ordered,n=t.editorSession;n.transaction(function(t){t.toggleList({ordered:e})})},e}(QE),nI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getClassNames=function(){return"sc-insert-list-tool"},e.prototype.renderButton=function(e){var n=t.prototype.renderButton.call(this,e);return[n]},e.prototype.onClick=function(){this.executeCommand({context:this.context})},e}(YE),oI={name:"list",configure:function(t,e){var n=e.toolGroup,o=e.disableCollapsedCursor;t.addNode(KN),t.addNode(XN),t.addComponent("list",QN),t.addCommand("insert-unordered-list",eI,{nodeType:"list",ordered:!1,disableCollapsedCursor:o}),t.addTool("insert-unordered-list",nI,{toolGroup:n}),t.addLabel("insert-unordered-list",{en:"Unordered list",de:"Aufzählung"}),t.addIcon("insert-unordered-list",{fontawesome:"fa-list-ul"}),t.addCommand("insert-ordered-list",eI,{nodeType:"list",ordered:!0,disableCollapsedCursor:o}),t.addTool("insert-ordered-list",nI,{toolGroup:n}),t.addLabel("insert-ordered-list",{en:"Ordered list",de:"Nummerierte Liste"}),t.addIcon("insert-ordered-list",{fontawesome:"fa-list-ol"}),t.addConverter("html",ZN),t.addConverter("html",tI)}},rI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getRowCount=function(){return this.cells.length},e.prototype.getColCount=function(){return this.cells.length>0?this.cells[0].length:0},e.prototype.getCellAt=function(t,e){var n=this.cells[t][e];return n?this.document.get(n):void 0},e}(zx);rI.schema={type:"table",cells:{type:["array","array","id"],"default":[],owned:!0}};var iI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(gE);iI.schema={type:"table-cell",rowspan:{type:"number","default":0},colspan:{type:"number","default":0}};var sI=function(t){function e(n){if(e._addConverters(n),!n.schema)throw new Error("Missing argument: config.schema is required.");t.call(this,n),this.IGNORE_DEFAULT_WARNINGS=!0,a(n,{trimWhitespaces:!0,REMOVE_INNER_WS:!0}),this._isWindows=Pf.isWindows,this._emptyDoc=this._createDocument(this.schema)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,
e.prototype.importDocument=function(t){var e,n;if(this._isWindows){var o=/<!--StartFragment-->(.*)<!--EndFragment-->/.exec(t);o&&(t=o[1])}if(t.search(/script id=.substance-clipboard./)>=0){n=wf.parseHTML(t);var r=n.find("#substance-clipboard");if(r){var i=r.textContent;try{return this.importFromJSON(i)}catch(s){console.error(s)}}}if(n=wf.parseHTML(t),u(n)?(e=this._createElement("body"),e.append(n)):e=n.find("body"),e||(e=this._createElement("body"),e.append(n)),e=this._sanitizeBody(e),!e)return console.warn("Invalid HTML."),null;this.reset(),this.convertBody(e);var a=this.generateDocument();return a},e.prototype._sanitizeBody=function(t){return t=this._fixupGoogleDocsBody(t),t.findAll("meta").forEach(function(t){return t.remove()}),t},e.prototype._fixupGoogleDocsBody=function(t){if(t){var e=t.find("b");return e&&/^docs-internal/.exec(e.id)?e:t}},e.prototype.importFromJSON=function(t){var e=this.createDocument(),n=JSON.parse(t),o=new Nl;return o.importDocument(e,n),e},e.prototype.convertBody=function(t){this.convertContainer(t.childNodes,Tl.SNIPPET_ID)},e.prototype._wrapInlineElementsIntoBlockElement=function(t){for(var e=this,n=this._createElement("p");t.hasNext();){var o=t.next(),r=e._getConverterForElement(o,"block");if(r){t.back();break}n.append(o.clone(!0))}n.attr("data-id",Tl.TEXT_SNIPPET_ID);var i=this.defaultConverter(n,this);if(i){if(!i.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.");this._createAndShow(i)}return i},e.prototype.createDocument=function(){return this._emptyDoc.createSnippet()},e.prototype._getUnsupportedNodeConverter=function(){},e}(lE),aI={"catch-all-block":{type:"paragraph",matchElement:function(t){return t.is("div")},"import":function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])}}};sI._addConverters=function(e){if(e.converters){var n=new Rl;e.converters.forEach(function(t,e){n.add(e,t)}),t(aI,function(t,e){n.add(e,t)}),e.converters=n}};var pI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.exportDocument=function(t){this.state.doc=t;var e,n=this.convertDocument(t);e=1===n.length&&n[0].attr("data-id")===Tl.TEXT_SNIPPET_ID?n[0].innerHTML:n.map(function(t){return t.outerHTML}).join("");var o=new Nl,r=JSON.stringify(o.exportDocument(t)),i='<script id="substance-clipboard" type="application/json">'+r+"</script>";return"<html><head>"+i+"</head><body>"+e+"</body></html>"},e.prototype.convertDocument=function(t){var e=t.get(Tl.SNIPPET_ID);if(!e)throw new Error('Illegal clipboard document: could not find container "'+Tl.SNIPPET_ID+'"');return this.convertContainer(e)},e}(cE),cI=function(t,e){this.editorSession=t;var n=t.getDocument(),o=n.getSchema(),r=[];e.converterRegistry&&(r=e.converterRegistry.get("html")||[]);var i={schema:o,DocumentClass:n.constructor,converters:r};this.htmlImporter=new sI(i),this.htmlExporter=new pI(i)};cI.prototype.getEditorSession=function(){return this.editorSession},cI.prototype.attach=function(t){t.on("copy",this.onCopy,this),t.on("cut",this.onCut,this),t.on("paste",this.onPaste,this)},cI.prototype.detach=function(t){t.off(this)},cI.prototype.onCopy=function(t){var e=this._copy();Hl._clipboardData=t.clipboardData,t.clipboardData&&e.doc&&(t.preventDefault(),t.clipboardData.setData("text/plain",e.text),Pf.isIE||Pf.isEdge||t.clipboardData.setData("text/html",e.html))},cI.prototype.onCut=function(t){t.preventDefault(),this.onCopy(t);var e=this.getEditorSession();e.transaction(function(t){t.deleteSelection()})},cI.prototype.onPaste=function(t){for(var e=t.clipboardData,n={},o=0;o<e.types.length;o++)n[e.types[o]]=!0;t.preventDefault(),t.stopPropagation();var r,i;return n["text/plain"]&&(r=e.getData("text/plain")),n["text/html"]&&(i=e.getData("text/html")),Pf.isEdge&&Hl.clipboardData&&Hl.clipboardData.text===r?i=Hl.clipboardData.html:Hl.clipboardData={text:r,html:i},Pf.isFF&&!i?void this._pastePlainText(r):void(i?this._pasteHtml(i,r)||this._pastePlainText(r):this._pastePlainText(r))},cI.prototype._pastePlainText=function(t){var e=this.getEditorSession();e.transaction(function(e){e.paste(t)},{action:"paste"})},cI.prototype._copy=function(){var t=this.getEditorSession(),e=t.getSelection(),n=t.getDocument(),o=null,r="",i="";return e.isCollapsed()||(r=fl.getTextForSelection(n,e)||"",o=Ne(n,e),i=this.htmlExporter.exportDocument(o)),{doc:o,html:i,text:r}},cI.prototype._pasteHtml=function(t,e){var n=this.htmlImporter.importDocument(t);return this.paste(n,e),!0},cI.prototype.paste=function(t,e){var n=t||e,o=this.getEditorSession();n&&o.transaction(function(t){t.paste(n)},{action:"paste"})};var uI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){return t("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.properties,null,2))},e}(Ef),hI=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(t.apply(this,e),this.editorSession=this.props.editorSession||this.context.editorSession,!this.editorSession)throw new Error("No EditorSession provided");if(this.name=this.props.name,!this.name)throw new Error("Surface must have a name.");if(this.name.indexOf("/")>-1)throw new Error("Surface.name must not contain '/'");if(this._surfaceId=hu(this),this.clipboard=new cI(this.editorSession,{converterRegistry:this.context.converterRegistry}),this.domSelection=this.context.domSelection,!this.domSelection)throw new Error("DOMSelection instance must be provided via context.");this.domObserver=null,wu&&(this.documentEl=wf.wrapNativeElement(window.document)),this.undoEnabled=!0,this._textProperties={},this._state={skipNextFocusEvent:!1}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={id:{}};return e.prototype.getChildContext=function(){return{surface:this,doc:this.getDocument(),isolatedNodeComponent:null}},e.prototype.didMount=function(){this.context.surfaceManager&&this.context.surfaceManager.registerSurface(this),this.editorSession.onRender("selection",this._onSelectionChanged,this)},e.prototype.dispose=function(){this.editorSession.off(this),this.domObserver&&this.domObserver.disconnect(),this.context.surfaceManager&&this.context.surfaceManager.unregisterSurface(this)},e.prototype.didUpdate=function(){this._updateContentEditableState()},e.prototype.render=function(t){var e=this.props.tagName||"div",n=t(e).addClass("sc-surface").attr("tabindex",2).attr("data-surface-id",this.id);return this.isDisabled()||(this.isEditable()&&(n.on("keydown",this.onKeyDown),Pf.isIE||n.on("compositionstart",this.onCompositionStart),wu&&window.TextEvent&&!Pf.isIE?n.on("textInput",this.onTextInput):n.on("keypress",this.onTextInputShim)),this.isReadonly()||(n.on("mousedown",this.onMouseDown),n.on("contextmenu",this.onContextMenu),n.on("focus",this.onNativeFocus),n.on("blur",this.onNativeBlur),this.clipboard.attach(n))),n},e.prototype.renderNode=function(t,e){var n=this.getDocument(),o=this.getComponentRegistry(),r=o.get(e.type);return r||(console.error("Could not resolve a component for type: "+e.type),r=uI),t(r,{doc:n,node:e}).ref(e.id)},e.prototype.getComponentRegistry=function(){return this.context.componentRegistry||this.props.componentRegistry},e.prototype.getName=function(){return this.name},e.prototype.getId=function(){return this._surfaceId},e.prototype.isDisabled=function(){return this.props.disabled},e.prototype.isEditable=function(){return"full"===this.props.editing||void 0===this.props.editing},e.prototype.isSelectable=function(){return"selection"===this.props.editing||"full"===this.props.editing},e.prototype.isReadonly=function(){return"readonly"===this.props.editing},e.prototype.getElement=function(){return this.el},e.prototype.getDocument=function(){return this.editorSession.getDocument()},e.prototype.getEditorSession=function(){return this.editorSession},e.prototype.isEnabled=function(){return!this.state.disabled},e.prototype.isContainerEditor=function(){return!1},e.prototype.hasNativeSpellcheck=function(){return"native"===this.props.spellcheck},e.prototype.getContainerId=function(){return null},e.prototype.blur=function(){this.el&&this.el.blur()},e.prototype.focus=function(){this.isDisabled()||(Pf.isFF&&(this.domSelection.clear(),this.el.getNativeElement().blur()),this._focus())},e.prototype.rerenderDOMSelection=function(){if(!this.isDisabled()&&wu){var t=this.editorSession.getSelection();t.surfaceId===this.getId()&&(this.domSelection.setSelection(t),this.context.scrollPane.updateSelection({editorId:this.editorSession.id}))}},e.prototype.getDomNodeForId=function(t){return this.el.getNativeElement().querySelector('*[data-id="'+t+'"]')},e.prototype.onKeyDown=function(t){if(this._shouldConsumeEvent(t)&&229!==t.which){switch(t.keyCode){case Wf.LEFT:case Wf.RIGHT:return this._handleLeftOrRightArrowKey(t);case Wf.UP:case Wf.DOWN:return this._handleUpOrDownArrowKey(t);case Wf.HOME:case Wf.END:return this._handleHomeOrEndKey(t);case Wf.PAGEUP:case Wf.PAGEDOWN:return this._handlePageUpOrDownKey(t);case Wf.ENTER:return this._handleEnterKey(t);case Wf.SPACE:return this._handleSpaceKey(t);case Wf.TAB:return this._handleTabKey(t);case Wf.BACKSPACE:case Wf.DELETE:return this._handleDeleteKey(t)}this.editorSession.keyboardManager.onKeydown(t)}},e.prototype.onTextInput=function(t){if(this._shouldConsumeEvent(t)&&(t.preventDefault(),t.stopPropagation(),t.data)){var e=t.data;this.editorSession.keyboardManager.onTextInput(e)||this.editorSession.transaction(function(t){t.insertText(e)},{action:"type"})}},e.prototype.onCompositionStart=function(t){!this._shouldConsumeEvent(t)},e.prototype.onTextInputShim=function(t){if(this._shouldConsumeEvent(t)&&!(0===t.which||0===t.charCode||t.keyCode===Wf.TAB||t.keyCode===Wf.ESCAPE||Boolean(t.metaKey)||Boolean(t.ctrlKey)^Boolean(t.altKey))){var e=String.fromCharCode(t.which);t.shiftKey||(e=e.toLowerCase()),t.preventDefault(),t.stopPropagation(),this.editorSession.keyboardManager.onTextInput(e)||e.length>0&&this.editorSession.transaction(function(t){t.insertText(e)},{action:"type"})}},e.prototype.onMouseDown=function(t){if(this._shouldConsumeEvent(t)&&!t.__reserved__&&(t.__reserved__=this,this.isEditable()&&this.el.setAttribute("contenteditable",!0),0===t.button)){if(!(Pf.isIE&&Pf.version<12)&&t.detail>=3){var e=this.getEditorSession().getSelection();if(e.isPropertySelection())return this._selectProperty(e.path),t.preventDefault(),void t.stopPropagation();if(e.isContainerSelection())return this._selectProperty(e.startPath),t.preventDefault(),void t.stopPropagation()}this._state.skipNextFocusEvent=!0,this.documentEl&&this.documentEl.on("mouseup",this.onMouseUp,this,{once:!0})}},e.prototype.onMouseUp=function(t){t.stopPropagation(),setTimeout(function(){var t=this.domSelection.getSelection();this._setSelection(t)}.bind(this))},e.prototype.onContextMenu=function(t){if(this._shouldConsumeEvent(t)){var e=this.domSelection.getSelection();this._setSelection(e)}},e.prototype.onNativeBlur=function(){var t=this._state;t.hasNativeFocus=!1},e.prototype.onNativeFocus=function(){var t=this._state;t.hasNativeFocus=!0},e.prototype._onSelectionChanged=function(t){var e=this._deriveModeFromSelection(t);this.state.mode!==e&&this.extendState({mode:e})},e.prototype._deriveModeFromSelection=function(t){if(!t)return null;var e,n=t.surfaceId,o=this.getId();return uu(n,o)&&(e=n.length===o.length?"focused":"co-focused"),e},e.prototype._updateContentEditableState=function(){var t=!1;if(this.isEditable()&&!this.props.disabled&&(t=!0,"co-focused"===this.state.mode)){var e=this.context.editorSession.getSelectionState(),n=e.getSelection(),o=this.context.surfaceManager.getSurface(n.surfaceId);if(o){var r=o.context.isolatedNodeComponent;r&&(t=r.isOpen())}}t?this.el.setAttribute("contenteditable",!0):this.el.removeAttribute("contenteditable")},e.prototype._focus=function(){this._state.hasNativeFocus=!0,this.el&&!Pf.isWebkit&&(this._state.skipNextFocusEvent=!0,this.el.focus(),this._state.skipNextFocusEvent=!1)},e.prototype._handleLeftOrRightArrowKey=function(t){t.stopPropagation();var e=t.keyCode===Wf.LEFT?"left":"right";window.setTimeout(function(){this._updateModelSelection({direction:e})}.bind(this))},e.prototype._handleUpOrDownArrowKey=function(t){t.stopPropagation(),window.setTimeout(function(){var e={direction:t.keyCode===Wf.UP?"left":"right"};this._updateModelSelection(e)}.bind(this))},e.prototype._handleHomeOrEndKey=function(t){t.stopPropagation(),window.setTimeout(function(){var e={direction:t.keyCode===Wf.HOME?"left":"right"};this._updateModelSelection(e)}.bind(this))},e.prototype._handlePageUpOrDownKey=function(t){t.stopPropagation(),window.setTimeout(function(){var e={direction:t.keyCode===Wf.PAGEUP?"left":"right"};this._updateModelSelection(e)}.bind(this))},e.prototype._handleSpaceKey=function(t){t.preventDefault(),t.stopPropagation(),this.editorSession.transaction(function(t){t.insertText(" ")},{action:"type"})},e.prototype._handleTabKey=function(t){var e=this;t.stopPropagation(),window.setTimeout(function(){e._updateModelSelection()})},e.prototype._handleEnterKey=function(t){t.preventDefault(),t.stopPropagation(),this.editorSession.transaction(function(t){t["break"]()},{action:"break"})},e.prototype._handleDeleteKey=function(t){t.preventDefault(),t.stopPropagation();var e=t.keyCode===Wf.BACKSPACE?"left":"right";this.editorSession.transaction(function(t){t.deleteCharacter(e)},{action:"delete"})},e.prototype._hasNativeFocus=function(){return Boolean(this._state.hasNativeFocus)},e.prototype._setSelection=function(t){!t.isNull()&&t.surfaceId===this.id&&Pf.isFF&&this._focus(),this.editorSession.setSelection(t)},e.prototype._updateModelSelection=function(t){var e=this.domSelection.getSelection(t);this._setSelection(e)},e.prototype._selectProperty=function(t){var e=this.getDocument(),n=e.get(t);this._setSelection(e.createSelection({type:"property",path:t,startOffset:0,endOffset:n.length}))},e.prototype._registerTextProperty=function(t){var e=t.getPath();this._textProperties[e]=t},e.prototype._unregisterTextProperty=function(t){var e=t.getPath();this._textProperties[e]===t&&delete this._textProperties[e]},e.prototype._getTextPropertyComponent=function(t){return this._textProperties[t]},e.prototype._renderNode=function(t,e){var n=this.getDocument(),o=n.get(e),r=this.context.componentRegistry||this.props.componentRegistry,i=r.get(o.type);return i||(console.error("Could not resolve a component for type: "+o.type),i=uI),t(i,{doc:n,node:o})},e.prototype._shouldConsumeEvent=function(e){var n=t.unwrap(e.target._wrapper);return n&&(n===this||n.context.surface===this)},e.prototype.getSelectionFromEvent=function(t){var e=Tn(t),n=this.domSelection.getSelectionForDOMRange(e);return n.surfaceId=this.getId(),n},e.prototype.setSelectionFromEvent=function(t){var e=this.getSelectionFromEvent(t);e?(this._state.skipNextFocusEvent=!0,this._setSelection(e)):console.error("Could not create a selection from event.")},n.id.get=function(){return this._surfaceId},Object.defineProperties(e.prototype,n),e}(Ef);hI.prototype._isSurface=!0;var lI=function(t){function e(e,n){if(n.name=n.name||n.path.join("."),t.call(this,e,n),!n.path)throw new Error("Property 'path' is mandatory.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.apply(this,arguments);return n.addClass("sc-text-property-editor"),this.props.disabled||(n.addClass("sm-enabled"),n.attr("contenteditable",!0),n.attr("spellcheck","native"===this.props.spellcheck)),n.append(e(lN,{tagName:this.props.tagName||"div",path:this.props.path,withoutBreak:this.props.withoutBreak})),n},e.prototype._handleEnterKey=function(e){e.preventDefault(),e.stopPropagation(),this.props.multiLine&&t.prototype._handleEnterKey.call(this,e)},e.prototype.getPath=function(){return this.props.path},e}(hI);lI.prototype._isTextPropertyEditor=!0;var fI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.props.node,n=t("td").addClass("sc-table-cell");return n.append(t(lI,{path:e.getTextPath(),disabled:this.props.disabled}).ref("editor")),e.rowspan>0&&n.attr("rowspan",e.rowspan),e.colspan>0&&n.attr("colspan",e.colspan),n},e.prototype.grabFocus=function(){var t=this.props.node;this.context.editorSession.setSelection({type:"property",path:t.getPath(),startOffset:t.getLength(),surfaceId:this.refs.editor.id})},e}(Ef);fI.prototype._isTableCellComponent=!0;var dI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){for(var e=this,n=t("table").addClass("sc-table"),o=this.props.node,r=this.props.node.getDocument(),i=this.props.node.cells,s=o.getRowCount(),a=o.getColCount(),p=0;s>p;p++){for(var c=t("tr"),u=0;a>u;u++){var h=i[p][u];if(h){var l=r.get(h),f=t(fI,{node:l,disabled:e.props.disabled}).ref(l.id);c.append(f)}}n.append(c)}return n.on("click",this.onClick),n.on("dblclick",this.onDblClick),n},e.prototype.onClick=function(t){t.stopPropagation()},e.prototype.onDblClick=function(e){e.stopPropagation();var n=t.unwrap(e.target);if(n){var o;n._isTableCellComponent?o=n:n._isTextPropertyEditor?o=n.getParent():n._isTextPropertyComponent?o=n.getParent().getParent():console.warn("TODO: find the right cell"),o&&o.grabFocus()}},e.prototype.grabFocus=function(){var t=this.props.node.cells[0][0];if(t){var e=this.refs[t];e.grabFocus()}},e}(Ef);dI.hasDropzones=!0;var gI={type:"table",tagName:"table","import":function(t,e,n){for(var o=t.find("tbody").getChildren(),r=0,i=[],s=[],a=function(t){var e=o[t].getChildren(),a=[];r=Math.max(e.length,r);for(var p=0;p<e.length;p++){var c=e[p];s[p]>1&&(a.push(null),s[p]-=1);var u=n.convertElement(c);a.push(u.id),u.rowspan>1&&(s[p]=u.rowspan),u.colspan>1&&lu(u.colspan-1,function(){a.push(null)})}i.push(a)},p=0;p<o.length;p++)a(p);e.cells=i},"export":function(t,e,n){for(var o=n.$$,r=t.getRowCount(),i=t.getColCount(),s=0;r>s;s++){for(var a=o("tr"),p=0;i>p;p++){var c=t.cells[s][p];if(c){var u=n.convertNode(c);a.append(u)}}e.append(a)}return e}},yI={type:"table-cell",tagName:"td","import":function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"]);var o=t.attr("colspan"),r=t.attr("rowspan");o&&(e.colspan=Number(o)),r&&(e.rowspan=Number(r))},"export":function(t,e,n){return e.append(n.annotatedText([t.id,"content"])),t.rowspan>0&&e.attr("rowspan",t.rowspan),t.colspan>0&&e.attr("colspan",t.colspan),e}},vI={name:"table",configure:function(t){t.addNode(rI),t.addNode(iI),t.addComponent("table",dI),t.addConverter("html",gI),t.addConverter("html",yI),t.addConverter("xml",gI),t.addConverter("xml",yI),t.addLabel("table",{en:"Table",de:"Tabelle"}),t.addLabel("table-cell.content",{en:"Cell",de:"Zelle"})}},mI=function(t,e){this.editorSession=t,this.context=e,this.editorSession.onRender("document",this._onDocumentChange,this)};mI.prototype._onDocumentChange=function(e){var n=this,o=this.editorSession.getDocument();t(e.created,function(t){t=o.get(t.id),t.constructor.isResource&&setTimeout(function(){n.triggerFetch(t)})})},mI.prototype.triggerFetch=function(t){var e=this;t.fetchPayload(this.context,function(n,o){n?e._updateNode(t.id,{errorMessage:n.toString()}):e._updateNode(t.id,o)})},mI.prototype._updateNode=function(e,n){var o=this.editorSession;o.transaction(function(o){t(n,function(t,n){o.set([e,n],t)})})};var _I="X",wI=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.props.node,n=this.ContentClass,o=this.props.disabled,r=t("div");r.addClass(this.getClassNames()).addClass("sc-isolated-node").addClass("sm-"+this.props.node.type).attr("data-id",e.id),o&&r.addClass("sm-disabled"),this.state.mode&&r.addClass("sm-"+this.state.mode),n.noStyle||r.addClass("sm-default-style"),r.on("keydown",this.onKeydown);var i="closed"===this.blockingMode&&!this.state.unblocked;r.append(t("div").addClass("se-bracket sm-left").ref("left").append(_I));var s=this.renderContent(t,e,{disabled:this.props.disabled||i}).ref("content");return s.attr("contenteditable",!1),r.append(s),r.append(t(bI).ref("blocker")),r.append(t("div").addClass("se-bracket sm-right").ref("right").append(_I)),i||(r.addClass("sm-no-blocker"),r.on("click",this.onClick).on("dblclick",this.onDblClick)),r.on("mousedown",this._reserveMousedown,this),r},e.prototype.getClassNames=function(){return""},e.prototype.getContent=function(){return this.refs.content},e.prototype.selectNode=function(){var t=this.context.editorSession,e=this.context.surface,n=this.props.node.id;t.setSelection({type:"node",nodeId:n,containerId:e.getContainerId(),surfaceId:e.id})},e.prototype.onClick=function(t){t.stopPropagation()},e.prototype.onDblClick=function(t){t.stopPropagation()},e.prototype.grabFocus=function(t){var e=this.refs.content;return e.grabFocus?(e.grabFocus(t),!0):void 0},e.prototype._reserveMousedown=function(t){t.__reserved__||(t.__reserved__=this)},e.prototype._deriveStateFromSelectionState=function(t){var e=this._getSurface(t),n={mode:null,unblocked:null};if(!e)return n;if(e===this.context.surface){var o=t.getSelection(),r=this.props.node.id;o.isNodeSelection()&&o.getNodeId()===r&&(o.isFull()?(n.mode="selected",n.unblocked=!0):o.isBefore()?(n.mode="cursor",n.position="before"):o.isAfter()&&(n.mode="cursor",n.position="after")),o.isContainerSelection()&&o.containsNode(r)&&(n.mode="co-selected")}else{var i=e.context.isolatedNodeComponent;if(i)if(i===this)n.mode="focused",n.unblocked=!0;else{var s=this._getIsolatedNodes(t);s.indexOf(this)>-1&&(n.mode="co-focused",n.unblocked=!0)}}return n},e}(aN);wI.prototype._isIsolatedNodeComponent=!0,wI.prototype._isDisabled=wI.prototype.isDisabled,wI.getDOMCoordinate=function(t,e){var n=wI.getDOMCoordinates(t),o=n.start,r=n.end;return 0===e.offset?o:r},wI.getDOMCoordinates=function(t){var e=t.refs.left,n=t.refs.right;return{start:{container:e.getNativeElement(),offset:0},end:{container:n.getNativeElement(),offset:n.getChildCount()}}},wI.getCoordinate=function(t,e){var n=Ef.unwrap(t,"strict").context.isolatedNodeComponent,o=null;"left"===e.direction||t===n.refs.left.el?o=0:("right"===e.direction||t===n.refs.right.el)&&(o=1);var r;return null!==o&&(r=new Wh([n.props.node.id],o),r._comp=n),r};var bI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){return t("div").addClass("sc-isolated-node-blocker").attr("draggable",!0).attr("contenteditable",!1).on("click",this.onClick).on("dblclick",this.onDblClick)},e.prototype.onClick=function(t){if(t.target===this.getNativeElement()){t.stopPropagation();var e=this._getIsolatedNodeComponent();e.extendState({mode:"selected",unblocked:!0}),e.selectNode()}},e.prototype.onDblClick=function(t){t.stopPropagation()},e.prototype._getIsolatedNodeComponent=function(){return this.context.isolatedNodeComponent},e}(Ef),CI=!1,SI=function(t){this.editor=t,wu&&(this.wRange=window.document.createRange()),this.state={dom:null,model:null}};SI.prototype.getSelection=function(t){if(wu){var e=this.mapDOMSelection(t),n=this.editor.getDocument();return n._createSelectionFromRange(e)}},SI.prototype.getSelectionForDOMRange=function(t){var e=this.mapDOMRange(t),n=this.editor.getDocument();return n._createSelectionFromRange(e)},SI.prototype.mapDOMSelection=function(t){function e(){return r.dom=null,r.model=null,null}var n,o=window.getSelection(),r=this.state;if(CI&&console.info("DOM->Model: ",o.anchorNode,o.anchorOffset,o.focusNode,o.focusOffset),0===o.rangeCount)return e();var i=wf.wrapNativeElement(o.anchorNode);if(o.isCollapsed){var s=this._getCoordinate(i,o.anchorOffset,t);if(!s)return e();n=fu({start:s,end:s})}else{var a=wf.wrapNativeElement(o.focusNode);n=this._getRange(i,o.anchorOffset,a,o.focusOffset,t)}return CI&&console.info("DOM->Model: range ",n?n.toString():null),r.model=n,n},SI.prototype.setSelection=function(t){function e(t){var e=t.anchorNode,n=t.anchorOffset,i=t.focusNode,s=t.focusOffset;o.removeAllRanges(),r.setStart(e,n),r.setEnd(e,n),o.addRange(r),(i!==n||s!==n)&&o.extend(i,s)}if(wu){var n=this.state,o=window.getSelection(),r=this.wRange;if(!t||t.isNull())return this.clear();var i=this.mapModelToDOMCoordinates(t),s=i.start,a=i.end;if(!s)return this.clear();if(t.isReverse()){var p;p=[a,s],s=p[0],a=p[1]}n.dom={anchorNode:s.container,anchorOffset:s.offset,focusNode:a.container,focusOffset:a.offset},e(n.dom)}},SI.prototype.mapModelToDOMCoordinates=function(t){CI&&console.info("Model->DOM: sel =",t.toString());var e,n=this.editor.surfaceManager.getSurface(t.surfaceId);if(n?e=n.el:(console.warn('Selection should have "surfaceId" set.'),e=this.editor.el),t.isNull()||t.isCustomSelection())return{};var o,r;if(t.isPropertySelection()||t.isContainerSelection()){if(o=this._getDOMCoordinate(e,t.start),!o)return console.warn("FIXME: selection seems to be invalid."),{};if(t.isCollapsed())r=o;else if(r=this._getDOMCoordinate(e,t.end),!r)return console.warn("FIXME: selection seems to be invalid."),{}}else if(t.isNodeSelection()){var i=Ef.unwrap(e.find('*[data-id="'+t.getNodeId()+'"]'));if(!i)return console.error("Could not find component with id",t.getNodeId()),{};if(i._isIsolatedNodeComponent){var s=wI.getDOMCoordinates(i,t);o=s.start,r=s.end}else{var a=i.el;o={container:a.getNativeElement(),offset:0},r={container:a.getNativeElement(),offset:a.getChildCount()}}}return CI&&console.info("Model->DOM:",o.container,o.offset,r.container,r.offset,"isReverse?",t.isReverse()),{start:o,end:r}},SI.prototype._getDOMCoordinate=function(t,e){var n,o=null;if(e.isNodeCoordinate()){if(n=Ef.unwrap(t.find('*[data-id="'+e.getNodeId()+'"]')))if(n._isIsolatedNodeComponent)o=wI.getDOMCoordinate(n,e);else{var r=0;e.offset>0&&(r=n.getChildCount()),o={container:n.getNativeElement(),offset:r}}}else n=Ef.unwrap(t.find('.sc-text-property[data-path="'+e.path.join(".")+'"]')),n&&(o=n.getDOMCoordinate(e.offset));return o},SI.prototype.mapDOMRange=function(t,e){return this._getRange(wf.wrapNativeElement(t.startContainer),t.startOffset,wf.wrapNativeElement(t.endContainer),t.endOffset,e)},SI.prototype.clear=function(){window.getSelection().removeAllRanges(),this.state.dom=null,this.state.model=null},SI.prototype.collapse=function(t){var e,n=window.getSelection();n.rangeCount>0&&(e=n.getRangeAt(0),e.collapse("left"===t),n.removeAllRanges(),n.addRange(e))},SI.prototype.select=function(t){var e=window.getSelection(),n=window.document.createRange();n.selectNode(t.getNativeElement()),e.removeAllRanges(),e.addRange(n)},SI.prototype.extend=function(t,e){var n=window.getSelection();n.extend(t.getNativeElement(),e)},SI.prototype.setCursor=function(t,e){var n=window.getSelection(),o=window.document.createRange();o.setStart(t.getNativeElement(),e),n.removeAllRanges(),n.addRange(o)},SI.prototype._getRange=function(t,e,n,o,r){void 0===r&&(r={});var i,s,a=wf.isReverse(t,e,n,o),p=t===n&&e===o;return p?i=s=this._getCoordinate(t,e,r):(i=this._getCoordinate(t,e,{direction:a?"right":"left"}),s=this._getCoordinate(n,o,r)),i&&s?fu({start:i,end:s,isReverse:a}):null},SI.prototype._getCoordinate=function(t,e,n){void 0===n&&(n={});var o=null;o||(o=lN.getCoordinate(this.editor.el,t,e));var r=Ef.unwrap(t);if(!o&&r&&r.context.isolatedNodeComponent&&(o=wI.getCoordinate(t,n)),!o)if(r&&r._isContainerEditor){var i=0===e?0:e-1,s=0===e,a=r.getContainer(),p=a.getNodeAt(i),c=r.getChildAt(i);o=new Wh([p.id],s?0:1),o._comp=c}else if(t.isElementNode()&&t.getChildCount()>0){var u,h=e>0?t.getChildAt(e-1):t.firstChild,l=Ef.unwrap(h);l&&l._isTextPropertyComponent&&(u=h),u&&(o=lN.getCoordinate(t,u,e>0?u.getChildCount():0))}return o};var xI=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this._initialize(this.props)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._initialize=function(t){if(!t.editorSession)throw new Error("EditorSession instance required");this.editorSession=t.editorSession,this.doc=this.editorSession.getDocument();var e=this.editorSession.getConfigurator();this.componentRegistry=e.getComponentRegistry(),this.toolGroups=e.getToolGroups(),this.labelProvider=e.getLabelProvider(),this.iconProvider=e.getIconProvider(),this.surfaceManager=this.editorSession.surfaceManager,this.commandManager=this.editorSession.commandManager,this.dragManager=this.editorSession.dragManager,this.macroManager=this.editorSession.macroManager,this.converterRegistry=this.editorSession.converterRegistry,this.globalEventHandler=this.editorSession.globalEventHandler,this.editingBehavior=this.editorSession.editingBehavior,this.markersManager=this.editorSession.markersManager,this.resourceManager=new mI(this.editorSession,this.getChildContext()),this.domSelection=new SI(this)},e.prototype.render=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t.prototype.render.apply(this,e)},e.prototype.willReceiveProps=function(t){var e=t.editorSession,n=e&&e!==this.editorSession;n&&(this._dispose(),this._initialize(t))},e.prototype.dispose=function(){this._dispose()},e.prototype._dispose=function(){this.empty()},e.prototype.getChildContext=function(){return{editor:this,editorSession:this.editorSession,doc:this.doc,componentRegistry:this.componentRegistry,surfaceManager:this.surfaceManager,domSelection:this.domSelection,commandManager:this.commandManager,markersManager:this.markersManager,converterRegistry:this.converterRegistry,dragManager:this.dragManager,editingBehavior:this.editingBehavior,globalEventHandler:this.globalEventHandler,iconProvider:this.iconProvider,labelProvider:this.labelProvider,resourceManager:this.resourceManager,toolGroups:this.toolGroups}},e.prototype.getDocument=function(){return this.editorSession.getDocument()},e.prototype.getConfigurator=function(){return this.editorSession.getConfigurator()},e.prototype.getEditorSession=function(){return this.editorSession},e.prototype.getComponentRegistry=function(){return this.componentRegistry},e.prototype.onSessionUnlocked=function(){this.refs.blocker&&this.refs.blocker.remove()},e}(Ef),EI=function(){this._merge={},this._mergeComponents={},this._break={}};EI.prototype.defineMerge=function(t,e,n){return this._merge[t]||(this._merge[t]={}),this._merge[t][e]=n,this},EI.prototype.canMerge=function(t,e){return this._merge[t]&&this._merge[t][e]},EI.prototype.getMerger=function(t,e){return this._merge[t][e]},EI.prototype.defineComponentMerge=function(t,e){this._mergeComponents[t]=e},EI.prototype.canMergeComponents=function(t){return this._mergeComponents[t]},EI.prototype.getComponentMerger=function(t){return this._mergeComponents[t]},EI.prototype.defineBreak=function(t,e){return this._break[t]=e,this},EI.prototype.canBreak=function(t){return this._break[t]},EI.prototype.getBreaker=function(t){return this._break[t]};var NI=function(t){function e(e,n,o){if(n.containerId=n.containerId||n.node.id,n.name=n.name||n.containerId||n.node.id,t.call(this,e,n,o),this.containerId=this.props.containerId,!_(this.containerId))throw new Error("Property 'containerId' is mandatory.");var r=this.getDocument();if(this.container=r.get(this.containerId),!this.container)throw new Error("Container with id "+this.containerId+" does not exist.");this.textTypes=this.props.textTypes||[],this.editingBehavior=this.context.editingBehavior||new EI,this._deriveInternalState(this.props)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.shouldRerender=function(t){return!(t.disabled===this.props.disabled)},e.prototype.willReceiveProps=function(e){
t.prototype.willReceiveProps.apply(this,arguments),this._deriveInternalState(e)},e.prototype.didMount=function(){t.prototype.didMount.apply(this,arguments);var e=this.getEditorSession();e.onUpdate("document",this._onContainerChanged,this,{path:[this.getContainerId(),"nodes"]})},e.prototype.dispose=function(){t.prototype.dispose.apply(this,arguments);var e=this.getEditorSession();e.off(this)},e.prototype.render=function(e){var n=t.prototype.render.call(this,e),o=this.getDocument(),r=this.getContainerId(),i=o.get(r);return i||console.warn("No container node found for ",r),n.addClass("sc-container-editor container-node "+r).attr("data-id",r),n.attr("spellcheck","native"===this.props.spellcheck),i.getNodes().forEach(function(t){n.append(this._renderNode(e,t))}.bind(this)),this.props.disabled||this.isEmpty()||(n.addClass("sm-enabled"),n.setAttribute("contenteditable",!0)),n},e.prototype._renderNode=function(e,n){if(!n)throw new Error("Illegal argument");if(n.isText())return t.prototype.renderNode.call(this,e,n);var o=this.context.componentRegistry,r=o.get(n.type);return r.prototype._isCustomNodeComponent||r.prototype._isIsolatedNodeComponent?e(r,{node:n}).ref(n.id):e(wI,{node:n}).ref(n.id)},e.prototype._deriveInternalState=function(t){var e=this._state;!t.hasOwnProperty("enabled")||t.enabled?e.enabled=!0:e.enabled=!1},e.prototype._selectNextIsolatedNode=function(t){var e=this.getEditorSession().getSelectionState(),n="left"===t?e.getPreviousNode():e.getNextNode();return n&&n.isIsolatedNode()&&("left"===t&&e.isFirst()||"right"===t&&e.isLast())?(this.getEditorSession().setSelection({type:"node",nodeId:n.id,containerId:e.getContainer().id,surfaceId:this.id}),!0):!1},e.prototype._handleLeftOrRightArrowKey=function(t){var e=this;t.stopPropagation();var n=this.getDocument(),o=this.getEditorSession().getSelection(),r=t.keyCode===Wf.LEFT,i=!r,s=r?"left":"right";if(o&&!o.isNull()){var a=n.get(o.containerId,"strict");if(o.isNodeSelection()){var p=a.getPosition(n.get(o.getNodeId()));if(r&&0===p||i&&p===a.length-1)return void t.preventDefault()}o.isNodeSelection()&&!t.shiftKey&&this.domSelection.collapse(s)}window.setTimeout(function(){e._updateModelSelection({direction:s})})},e.prototype._handleUpOrDownArrowKey=function(t){var e=this;t.stopPropagation();var n=this.getDocument(),o=this.getEditorSession().getSelection(),r=t.keyCode===Wf.UP,i=!r,s=r?"left":"right";if(o&&!o.isNull()){var a=n.get(o.containerId,"strict");if(o.isNodeSelection()){var p=a.getPosition(n.get(o.getNodeId()));if(r&&0===p||i&&p===a.length-1)return void t.preventDefault();var c=this.getEditorSession();if(!t.shiftKey){if(t.preventDefault(),r){var u=a.getChildAt(p-1);return void Kt(c,u,o.containerId,"after")}var h=a.getChildAt(p+1);return void Kt(c,h,o.containerId,"before")}}}window.setTimeout(function(){e._updateModelSelection({direction:s})})},e.prototype._handleTabKey=function(e){var n=this.getEditorSession(),o=n.getSelection();if(o.isNodeSelection()&&o.isFull()){var r=this.refs[o.getNodeId()];if(r&&Qt(n,r))return e.preventDefault(),void e.stopPropagation()}t.prototype._handleTabKey.call(this,e)},e.prototype.isContainerEditor=function(){return!0},e.prototype.getContainerId=function(){return this.containerId},e.prototype.getContainer=function(){return this.getDocument().get(this.getContainerId())},e.prototype.isEmpty=function(){var t=this.getContainer();return t&&0===t.nodes.length},e.prototype.isEditable=function(){return t.prototype.isEditable.call(this)&&!this.isEmpty()},e.prototype.getTextTypes=function(){return this.textTypes||[]},e.prototype.getTextCommands=function(){var t={};return this.commandRegistry.each(function(e){e.constructor.textTypeName&&(t[e.getName()]=e)}),t},e.prototype._onContainerChanged=function(t){for(var e=this,n=this.getDocument(),o=bf.createContext(this),r=o.$$,i=this.getContainer(),s=i.getContentPath(),a=0;a<t.ops.length;a++){var p=t.ops[a];if("update"===p.type&&p.path[0]===s[0]){var c=p.diff;if("insert"===c.type){var u=c.getValue(),h=n.get(u),l=void 0;l=h?e._renderNode(r,h):r("div"),e.insertAt(c.getOffset(),l)}else"delete"===c.type&&e.removeAt(c.getOffset())}}},e}(hI);NI.prototype._isContainerEditor=!0;var II=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this,n=t("div").addClass(this.getClassNames()),o=this.state.activeToolGroups;return o.forEach(function(o){var r=Object.assign({},o,{toolStyle:e.getToolStyle(),layout:"horizontal",showIcons:!0});n.append(t(o.Class,r))}),n},e.prototype.getActiveToolGroupNames=function(){return this.props.toolGroups||["text","document","annotations","default"]},e.prototype.getClassNames=function(){return"sc-toolbar"},e.prototype.getToolStyle=function(){return"outline"},e.prototype.showDisabled=function(){return!0},e}(_E),OI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.componentRegistry.get("split-pane"),n=t("div").addClass("sc-prose-editor"),o=this._renderToolbar(t),r=this._renderEditor(t),i=this.componentRegistry.get("scroll-pane"),s=this.componentRegistry.get("overlay"),a=this.componentRegistry.get("context-menu"),p=this.componentRegistry.get("dropzones"),c=t(i,{name:"contentPanel",contextMenu:this.props.contextMenu||"native",scrollbarPosition:"right",scrollbarType:this.props.scrollbarType}).append(r,t(s),t(a),t(p)).ref("contentPanel");return n.append(t(e,{splitType:"horizontal"}).append(o,c)),n},e.prototype._renderToolbar=function(t){var e=this.commandManager.getCommandStates();return t("div").addClass("se-toolbar-wrapper").append(t(II,{commandStates:e}).ref("toolbar"))},e.prototype._renderEditor=function(t){var e=this.getConfigurator();return t(NI,{disabled:this.props.disabled,editorSession:this.editorSession,node:this.doc.get("body"),commands:e.getSurfaceCommandNames(),textTypes:e.getTextTypes()}).ref("body")},e}(xI),TI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.invalidate=function(){this.remove()},e}(dE);TI.schema={type:"spell-error",suggestions:{type:["object"],"default":[]}},TI.scope="document";var PI="http://localhost:4777/api/check",DI=function(t,e){e=e||{};var n=e.wait||750;this.editorSession=t,this.apiURL=e.apiURL||PI,this.textPropertyManager=t.markersManager,this.markersManager=t.markersManager,this._schedule={},this._scheduleCheck=hi(this._runSpellCheck.bind(this),n),t.onFinalize("document",this._onDocumentChange,this)};DI.prototype.dispose=function(){this.editorSession.off(this)},DI.prototype.check=function(t){this._runSpellCheck(String(t))},DI.prototype.runGlobalCheck=function(){var t=this,e=Object.keys(this.textPropertyManager._textProperties);e.forEach(function(e){t._runSpellCheck(e)})},DI.prototype._onDocumentChange=function(t,e){var n=this;if(!e.spellcheck){var o=this.textPropertyManager._textProperties;Object.keys(t.updated).forEach(function(t){o[t]&&n._scheduleCheck(t)})}},DI.prototype._runSpellCheck=function(t){var e=this,n=t.split(","),o=this.editorSession.getDocument().get(n),r=this.editorSession.getLanguage();o&&_(o)&&du({method:"POST",url:this.apiURL,header:{"Content-Type":"application/json; charset=UTF-8"},data:{text:o,lang:r}}).then(function(t){t=JSON.parse(t),e._addSpellErrors(n,t)})["catch"](function(t){console.error(t)})},DI.prototype._addSpellErrors=function(t,e){var n=this.editorSession.getDocument(),o=n.getIndex("markers").get(t).filter(function(t){return"spell-error"===t.type}),r=e.map(function(e){return{type:"spell-error",start:{path:t,offset:e.start},end:{offset:e.end},suggestions:e.suggestions}});this.editorSession.transaction(function(t){o.forEach(function(e){t["delete"](e.id)}),r.forEach(function(e){t.create(e)})},{history:!1,spellcheck:!0})};var AI=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){return t("i").addClass("fa "+this.props.icon)},e}(Ef),MI=function(e){function n(t,n){e.call(this,t,n),this.document=t,this.config=n,this.entries=this.computeEntries(),this.entries.length>0?this.activeEntry=this.entries[0].id:this.activeEntry=null,this.document.on("document:changed",this.handleDocumentChange,this)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.dispose=function(){var t=this.getDocument();t.disconnect(this)},n.prototype.handleDocumentChange=function(t){for(var e=this.getDocument(),n=!1,o=this.constructor.tocTypes,r=0;r<t.ops.length;r++){var i=t.ops[r],s=void 0;if(i.isCreate()||i.isDelete()){var a=i.getValue();if(s=a.type,gu(o,s)){n=!0;break}}else{var p=i.path[0],c=e.get(p);if(c&&gu(o,c.type)){n=!0;break}}}n&&(this.entries=this.computeEntries(),this.emit("toc:updated"))},n.prototype.computeEntries=function(){var e=this.getDocument(),n=this.config,o=[],r=e.get(n.containerId).nodes;return t(r,function(t){var n=e.get(t);"heading"===n.type&&o.push({id:n.id,name:n.content,level:n.level,node:n})}),o},n.prototype.getEntries=function(){return this.entries},n.prototype.getDocument=function(){return this.document},n.prototype.markActiveEntry=function(t){var e=t.getContentElement(),n=t.getContentHeight(),o=t.getHeight(),r=t.getScrollPosition(),i=r+o,s=r,a=2*i-n,p=Math.max(s,a),c=this.computeEntries();if(0!==c.length){for(var u=c[0].id,h=c.length-1;h>=0;h--){var l=c[h],f=e.find('[data-id="'+l.id+'"]');if(!f)return void console.warn("Not found in Content panel",l.id);var d=t.getPanelOffsetForElement(f);if(p>=d){u=l.id;break}}this.activeEntry!==u&&(this.activeEntry=u,this.emit("toc:updated"))}},n}(vu);MI.tocTypes=["heading"];var kI=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this.__isStarted__=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.start=function(){var t=wf.getBrowserWindow();t.on("hashchange",this._onHashChange,this),this.__isStarted__=!0},e.prototype.readRoute=function(){return this.__isStarted__||this.start(),this.parseRoute(this.getRouteString())},e.prototype.writeRoute=function(t,e){e=e||{};var n=this.stringifyRoute(t);n?this._writeRoute(n,e):this.clearRoute(e)},e.prototype.dispose=function(){var t=wf.getBrowserWindow();t.off(this)},e.prototype.parseRoute=function(t){return e.routeStringToObject(t)},e.prototype.stringifyRoute=function(t){return e.objectToRouteString(t)},e.prototype.getRouteString=function(){return window.location.hash.slice(1)},e.prototype._writeRoute=function(t,e){this.__isSaving__=!0;try{e.replace?window.history.replaceState({},"","#"+t):window.history.pushState({},"","#"+t)}finally{this.__isSaving__=!1}},e.prototype.clearRoute=function(t){this._writeRoute("",t)},e.prototype._onHashChange=function(){if(!this.__isSaving__){if(this.__isLoading__)return void console.error("FIXME: router is currently applying a route.");this.__isLoading__=!0;try{var t=this.getRouteString(),e=this.parseRoute(t);this.emit("route:changed",e)}finally{this.__isLoading__=!1}}},e}(vu);kI.objectToRouteString=function(e){var n=[];return t(e,function(t,e){n.push(e+"="+t)}),n.join(",")},kI.routeStringToObject=function(t){var e={};if(!t)return e;var n=t.split(",");return n.forEach(function(t){var n=t.split("=");if(2!==n.length)throw new Error("Illegal route.");e[n[0].trim()]=n[1].trim()}),e};var jI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.register=function(t){var e=t.prototype.type;if("string"!=typeof e||""===e)throw console.error("#### nodeClazz",t),new Error("Node names must be strings and must not be empty");if(!t.prototype._isNode)throw new Error("Nodes must be subclasses of Substance.Data.Node");if(this.contains(e))throw new Error("Node class is already registered: "+e);this.add(e,t)},e}(Rl),RI=function(t,e){this.name=t,this.version=e,this.nodeRegistry=new jI,this.tocTypes=[],this.addNodes(this.getBuiltIns())};RI.prototype.addNodes=function(e){e&&t(e,function(t){t.prototype._isNode?this.addNode(t):console.error("Illegal node class: ",t)}.bind(this))},RI.prototype.addNode=function(t){this.nodeRegistry.register(t),t.tocType&&this.tocTypes.push(t.type)},RI.prototype.getNodeClass=function(t){return this.nodeRegistry.get(t)},RI.prototype.getBuiltIns=function(){return[]},RI.prototype.isInstanceOf=function(t,e){var n=this.getNodeClass(t);return n?Hx.isInstanceOf(n,e):!1},RI.prototype.each=function(){this.nodeRegistry.each.apply(this.nodeRegistry,arguments)},RI.prototype.getTocTypes=function(){return this.tocTypes},RI.prototype.getDefaultTextType=function(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")},RI.prototype.getNodeSchema=function(t){var e=this.getNodeClass(t);return e?e.schema:(console.error("Unknown node type ",t),null)};var LI=function(t){function e(e,n,o){void 0===o&&(o={}),t.call(this,e,n),this.defaultTextType=o.defaultTextType}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefaultTextType=function(){return this.defaultTextType},e.prototype.isAnnotationType=function(t){var e=this.getNodeClass(t);return e&&e.prototype._isPropertyAnnotation},e.prototype.getBuiltIns=function(){return[Ux,Gx,Jx,Vx]},e}(RI),FI=function(t){function e(e){t.call(this,e,function(t){if(!t.prototype._isComponent)throw new Error("Component registry: wrong type. Expected a ComponentClass. Was: "+String(t))})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Rl),BI=function(e){this.map={},t(e,function(t,e){var n=t.fontawesome;n&&this.addIcon(e,n)}.bind(this))};BI.prototype.renderIcon=function(t,e){var n=this.map[e];return n?t(AI,{icon:n}):void 0},BI.prototype.addIcon=function(t,e){this.map[t]=e};var HI=function(t,e){this.lang=e||"en",this.labels=t};HI.prototype.getLabel=function(t){var e=this.labels[this.lang];return e?e[t]||t:t};var UI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this,n=this.props.tools,o=t("div").addClass("sc-tool-group");return o.addClass("sm-target-"+this.props.name),this.props.layout&&o.addClass("sm-layout-"+this.props.layout),n.forEach(function(n){var r=Object.assign({},n.toolProps,{showIcon:e.props.showIcons,showLabel:e.props.showLabels,style:e.props.toolStyle});o.append(t(n.Class,r))}),o},e}(Ef),zI=function(){};zI.prototype.saveDocument=function(t){var e=t.fileManager;return console.info("Simulating save ..."),e.sync().then(function(){console.info("Creating document snapshot...")})};var WI=function(){this.config={schema:{},nodes:{},components:{},converters:{},importers:{},exporters:{},fileProxies:[],commands:{},tools:new Map,toolGroups:new Map,textTypes:[],editingBehaviors:[],macros:[],dropHandlers:[],keyboardShortcuts:[],icons:{},labels:{},lang:"en_US",SaveHandlerClass:null}};WI.prototype.defineSchema=function(t){this.config.schema=t},WI.prototype.addNode=function(t){var e=t.type;if(!e)throw new Error("A NodeClass must have a type.");if(this.config.nodes[e])throw new Error("NodeClass with this type name is already registered: "+e);this.config.nodes[e]=t},WI.prototype.addConverter=function(t,e){var n=this.config.converters[t];if(n||(n={},this.config.converters[t]=n),!e.type)throw new Error("A converter needs an associated type.");n[e.type]=e},WI.prototype.addImporter=function(t,e){this.config.importers[t]=e},WI.prototype.addExporter=function(t,e){this.config.exporters[t]=e},WI.prototype.addComponent=function(t,e,n){if(!n&&this.config.components[t])throw new Error(t+" already registered");if(!e)throw new Error("Provided nil for component "+t);if(!e.prototype._isComponent)throw new Error("ComponentClass must be a subclass of ui/Component.");this.config.components[t]=e},WI.prototype.addCommand=function(t,e,n){if(!_(t))throw new Error("Expecting 'name' to be a String");if(!e)throw new Error("Provided nil for command "+t);if(!e.prototype._isCommand)throw new Error("Expecting 'CommandClass' to be of type ui/Command.");this.config.commands[t]={name:t,CommandClass:e,options:n||{}}},WI.prototype.addToolGroup=function(t,e,n){n=n||{},e=e||UI,this.config.toolGroups.set(t,{name:t,tools:new Map,Class:e,options:n})},WI.prototype.addTool=function(t,e,n){var o=this;n=n||{},n.target&&console.warn("DEPRECATED: please use `toolGroup` instead of `target`",t);var r=n.toolGroup||n.target;if(_(r)&&(r=[r]),!r&&n.overlay?r=["overlay"]:r||(r=["default"]),!_(t))throw new Error("Expecting 'name' to be a String");if(!e)throw new Error("Provided nil for tool "+t);if(!e||!e.prototype._isTool)throw new Error("Expecting 'ToolClass' to be of type ui/Tool. name:");r.forEach(function(r){var i=o.config.toolGroups.get(r);return i?void i.tools.set(t,{name:t,Class:e,options:n||{}}):void console.error("No toolGroup registered with name: "+r)})},WI.prototype.addIcon=function(t,e){var n=this.config.icons[t];n||(n={},this.config.icons[t]=n),Object.assign(n,e)},WI.prototype.addLabel=function(e,n){_(n)?(this.config.labels.en||(this.config.labels.en={}),this.config.labels.en[e]=n):t(n,function(t,n){this.config.labels[n]||(this.config.labels[n]={}),this.config.labels[n][e]=t}.bind(this))},WI.prototype.addSeed=function(t){this.config.seed=t},WI.prototype.addTextType=function(t,e){this.config.textTypes.push({spec:t,options:e||{}})},WI.prototype.addEditingBehavior=function(t){this.config.editingBehaviors.push(t)},WI.prototype.addMacro=function(t){this.config.macros.push(t)},WI.prototype.addDragAndDrop=function(t){if(console.warn("DEPRECATED: Use addDropHandler() instead"),!t.prototype._isDragAndDropHandler)throw new Error("Only instances of DragAndDropHandler are allowed.");this.addDropHandler(new t)},WI.prototype.addDropHandler=function(t){t._isDragAndDropHandler&&(t.type=t.type||"drop-asset"),this.config.dropHandlers.push(t)},WI.prototype.addKeyboardShortcut=function(t,e){var n={key:t,spec:e};this.config.keyboardShortcuts.push(n)},WI.prototype.addFileProxy=function(t){this.config.fileProxies.push(t)},WI.prototype.getFileAdapters=function(){return this.config.fileProxies.slice(0)},WI.prototype["import"]=function(t,e){return t.configure(this,e||{}),this},WI.prototype.getConfig=function(){return this.config},WI.prototype.getStyles=function(){return this.config.styles},WI.prototype.getSchema=function(){var t=this.config.schema,e=new LI(t.name,"1.0.0");return e.getDefaultTextType=function(){return t.defaultTextType},e.addNodes(this.config.nodes),e},WI.prototype.createArticle=function(t){var e=this.config.schema,n=this.getSchema(),o=new e.ArticleClass(n);return t&&t(o),o},WI.prototype.createImporter=function(t,e,n){void 0===n&&(n={});var o=this.config.importers[t],r=Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(t),DocumentClass:this.config.schema.ArticleClass},n);return new o(r,e)},WI.prototype.createExporter=function(t,e,n){void 0===n&&(n={});var o=this.config.exporters[t],r=Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(t)},n);return new o(r,e)},WI.prototype.getToolGroups=function(){return this.config.toolGroups},WI.prototype.getTools=function(t){return this.config.toolGroups.get(t).tools},WI.prototype.getComponentRegistry=function(){var e=new FI;return t(this.config.components,function(t,n){e.add(n,t)}),e},WI.prototype.getCommands=function(){return p(this.config.commands,function(t,e){return new t.CommandClass(Object.assign({name:e},t.options))})},WI.prototype.getSurfaceCommandNames=function(){var t=this.getCommands(),e=t.map(function(t){return t.type});return e},WI.prototype.getConverterRegistry=function(){if(!this.converterRegistry){var e=new Rl;t(this.config.converters,function(t,n){e.add(n,new Rl(t))}),this.converterRegistry=e}return this.converterRegistry},WI.prototype.getDropHandlers=function(){return this.config.dropHandlers.slice(0)},WI.prototype.getSeed=function(){return this.config.seed},WI.prototype.getTextTypes=function(){return this.config.textTypes.map(function(t){return t.spec})},WI.prototype.getIconProvider=function(){return new BI(this.config.icons)},WI.prototype.getLabelProvider=function(){return new HI(this.config.labels)},WI.prototype.getEditingBehavior=function(){var t=new EI;return this.config.editingBehaviors.forEach(function(e){e.register(t)}),t},WI.prototype.getMacros=function(){return this.config.macros},WI.prototype.getKeyboardShortcuts=function(){return this.config.keyboardShortcuts},WI.prototype.setDefaultLanguage=function(t){this.config.lang=t},WI.prototype.getDefaultLanguage=function(){return this.config.lang||"en_US"},WI.prototype.setSaveHandlerClass=function(t){this.config.SaveHandlerClass=t},WI.prototype.getSaveHandler=function(){var t=this.config.SaveHandlerClass||zI;return new t};var JI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){var t=this.context.scrollPane,e=this.componentRegistry.get("overlay"),n=this.componentRegistry.get("dropzones");this.overlay=new e(this,{toolGroups:["annotations","text","overlay"]}).mount(t.el),this.dropzones=new n(this,{}).mount(t.el)},e.prototype.dispose=function(){this.overlay.remove(),this.dropzones.remove()},e.prototype.render=function(t){var e=t("div").addClass("sc-rich-text-area-editor"),n=this.getConfigurator();return e.append(t(NI,{disabled:this.props.disabled,editorSession:this.editorSession,node:this.doc.get("body"),commands:n.getSurfaceCommandNames(),textTypes:n.getTextTypes()}).ref("body")),e},e}(OI),qI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.convertDocument=function(t){u(t)||(t=[t]),this.convertContainer(t,"body")},e}(lE),VI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.convertDocument=function(t){var e=t.get("body"),n=this.convertContainer(e);return n.map(function(t){return t.outerHTML}).join("")},e}(cE),GI={name:"rich-text-area",configure:function(t){t.defineSchema({name:"rich-text-area",ArticleClass:Tl,defaultTextType:"paragraph"});var e={disableCollapsedCursor:!0,toolGroup:"overlay"};t["import"](oN,e),t["import"](TN,e),t.addImporter("html",qI),t.addExporter("html",VI)}},$I=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gx);$I.define({type:"xref",content:{type:"string",optional:!0}}),$I.fragmentation=Yx.SHOULD_NOT_SPLIT;var KI={type:"xref",tagName:"span",matchElement:function(t){return t.is("span")&&"xref"===t.attr("data-type")}},XI={name:"xref",configure:function(t,e){var n=e.toolGroup,o=e.disableCollapsedCursor;t.addNode($I),t.addComponent("xref",sN),t.addConverter("html",KI),t.addCommand("xref",gN,{nodeType:"xref",disableCollapsedCursor:o}),t.addTool("xref",yN,{toolGroup:n||"annotations"}),t.addIcon("xref",{fontawesome:"fa-comment"}),t.addLabel("xref","Comment")}},YI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this,n=this.getComponent("button"),o=t("div").addClass("sc-minimal-switch-text-type");return this.props.textTypes.forEach(function(r){var i=t(n,{label:r.name,active:e.props.currentTextType.name===r.name,disabled:e.props.disabled,style:e.props.style}).attr("data-type",r.name).on("click",e.handleClick);o.append(i)}),o},e.prototype.handleClick=function(t){var e=t.currentTarget.dataset.type;t.preventDefault(),this.context.commandManager.executeCommand(this.getCommandName(),{textType:e})},e}(YE),QI={name:"minimal-switch-text-type",configure:function(t){t.addToolGroup("text"),t.addCommand("minimal-switch-text-type",UN,{disableCollapsedCursor:!0}),t.addTool("minimal-switch-text-type",YI,{toolGroup:"text"}),t.addLabel("paragraph","P"),t.addLabel("heading1","H1"),t.addLabel("heading2","H2"),t.addLabel("heading3","H3")}},ZI={strong:MN,emphasis:bN,link:$N,list:oI,table:vI,xref:XI,heading:BN},tO=["heading","strong","emphasis","link","list","table"],eO=function(t){function e(){for(var e=this,n=[],o=arguments.length;o--;)n[o]=arguments[o];t.apply(this,n),this.cfg=(new WI)["import"](GI);var r=this.props.config.enabledPackages||tO,i={disableCollapsedCursor:!0,toolGroup:"annotations"};r.forEach(function(t){e.cfg["import"](ZI[t],i)}),r.indexOf("heading")>=0&&this.cfg["import"](QI),this._initDoc(this.props)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){this.registerHandlers()},e.prototype.didUpdate=function(){this.registerHandlers()},e.prototype.hideOverlays=function(){this.refs.editor.hideOverlays()},e.prototype.registerHandlers=function(){this.editorSession.onRender("selection",this._onSelectionChanged,this)},e.prototype.unregisterHandlers=function(){this.editorSession.off(this)},e.prototype.dispose=function(){this.unregisterHandlers()},e.prototype.blur=function(){this.editorSession.setSelection(null)},e.prototype._onSelectionPositioned=function(t){t.editorId=this.props.editorId,this.emit("selection:positioned",t)},e.prototype.getChildContext=function(){return{editorId:this.props.editorId,scrollPane:this.props.scrollPane}},e.prototype.willReceiveProps=function(t){this.dispose(),this.empty(),this._initDoc(t)},e.prototype._initDoc=function(t){this.importer=this.cfg.createImporter("html"),this.doc=this.importer.importDocument(t.html),this.editorSession=new Gf(this.doc,{id:this.props.editorId,configurator:this.cfg})},e.prototype._onSelectionChanged=function(){var t=this.editorSession.getSelectionState(),e=t.getAnnotationsForType("xref")[0];this.emit("selection:changed",{activeAnnotation:e,editorId:this.props.editorId})},e.prototype.render=function(t){var e=t("div").addClass("sc-rich-text-area");return e.append(t(JI,{editorSession:this.editorSession,editorId:this.props.editorId}).ref("editor")),e},e.prototype.getHTML=function(){var t=this.cfg.createExporter("html");return t.exportDocument(this.doc)},e}(Ef),nO=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this._editables={},this.bodyScrollPane=WE.mount({},document.body),this.bodyScrollPane.on("selection:positioned",this._onSelectionPositioned,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.bodyScrollPane.off(this)},e.prototype.addRichTextArea=function(t,e,n){n=n||{},e=wf.wrapNativeElement(e);var o=e.innerHTML;e.innerHTML="";var r=eO.mount({scrollPane:this.bodyScrollPane,editorId:t,html:o,config:n},e);return r.on("selection:positioned",this._onSelectionPositioned,this),r.on("selection:changed",this._onSelectionChanged,this),this._editables[t]=r,r},e.prototype._onSelectionPositioned=function(t){this.emit("selection:positioned",t)},e.prototype._onSelectionChanged=function(t){this.emit("selection:changed",t)},e.prototype.removeRichTextArea=function(t){this._editables[t].off(this)},e.prototype.getHTML=function(t){return this._editables[t].getHTML()},e.prototype.setHTML=function(t,e){var n=this._editables[t];n.extendProps({html:e})},e}(vu);window.SubstanceForms=nO});
//# sourceMappingURL=/Users/michael/projects/substance/forms/dist/substance-forms.min.js.map