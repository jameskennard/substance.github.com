{"version":3,"file":"app.js","sources":["../../code-editor/app.js"],"sourcesContent":["import {\n  Component, ProseEditor, ProseEditorConfigurator, EditorSession,\n  ProseEditorPackage, BlockNode, Tool, InsertNodeCommand\n} from 'substance'\n\n/*\n  Node definition\n*/\nclass Script extends BlockNode {}\n\nScript.define({\n  type: 'script',\n  language: 'string',\n  source: 'text'\n})\n\n/*\n  Display component\n*/\nclass ScriptEditor extends Component {\n  render($$) {\n    let node = this.props.node\n    let el = $$('div').addClass('sc-script-editor')\n    el.append(\n      $$('div').append(node.source).ref('source')\n    )\n    return el;\n  }\n\n  // don't rerender because this would destroy ACE\n  shouldRerender() {\n    return false;\n  }\n\n  didMount() {\n    let editorSession = this.context.editorSession\n    let node = this.props.node;\n    let editor = ace.edit(this.refs.source.getNativeElement())\n    // editor.setTheme(\"ace/theme/monokai\");\n    editor.setOptions({\n      maxLines: Infinity,\n    });\n    editor.$blockScrolling = Infinity;\n    editor.getSession().setMode(\"ace/mode/\" + node.language)\n    // TODO: don't we need to dispose the editor?\n    // For now we update the model only on blur\n    // Option 1: updating on blur\n    //   pro: one change for the whole code editing session\n    //   con: very implicit, very late, hard to get selection right\n    editor.on('blur', this._updateModelOnBlur.bind(this))\n\n    editor.commands.addCommand({\n      name: 'escape',\n      bindKey: {win: 'Escape', mac: 'Escape'},\n      exec: function(editor) {\n        this.send('escape')\n        editor.blur()\n      }.bind(this),\n      readOnly: true // false if this command should not apply in readOnly mode\n    });\n\n    this.editor = editor\n    editorSession.onRender('document', this._onModelChange, this, {\n      path: [node.id, 'source']\n    })\n  }\n\n  dispose() {\n    this.context.editorSession.off(this)\n    this.editor.destroy()\n  }\n\n  _updateModelOnBlur() {\n    let editor = this.editor\n    let nodeId = this.props.node.id\n    let source = editor.getValue()\n    if (source !== this.props.node.source) {\n      this.context.editorSession.transaction(function(tx) {\n        tx.set([nodeId, 'source'], editor.getValue())\n      }, { source: this, skipSelection: true })\n    }\n  }\n\n  _onModelChange(change, info) {\n    if (info.source !== this) {\n      this.editor.setValue(this.props.node.source, -1)\n    }\n  }\n}\n\nScriptEditor.fullWidth = true;\n\n/*\n  Command for script insertion\n*/\nclass InsertScriptCommand extends InsertNodeCommand {\n  createNodeData() {\n    return {\n      type: 'script',\n      language: 'javascript',\n      content: ''\n    }\n  }\n}\n\n/*\n  Package defintion for script extension\n*/\nlet ScriptPackage = {\n  name: 'script',\n  configure: function(config) {\n    config.addNode(Script)\n    config.addComponent(Script.type, ScriptEditor)\n    config.addCommand('insert-script', InsertScriptCommand)\n    config.addTool('insert-script', Tool, {toolGroup: 'insert'})\n    config.addIcon('insert-script', { 'fontawesome': 'fa-code' })\n    config.addLabel('insert-script', 'Source Code')\n  }\n}\n\n/*\n  Example document\n*/\nlet fixture = function(tx) {\n  let body = tx.get('body')\n  tx.create({\n    id: 'h1',\n    type: 'heading',\n    level: 1,\n    content: 'Embedding a 3rdParty CodeEditor'\n  })\n  body.show('h1')\n  tx.create({\n    id: 'intro',\n    type: 'paragraph',\n    content: [\n      'It is possible to use 3rd party components, a code editor for instance, such as ACE.',\n      'The editor us wrapped into an IsolatedNode which makes it independent from the main word-processor interface.',\n    ].join(\" \")\n  })\n  body.show('intro')\n  tx.create({\n    id: 's1',\n    type: 'script',\n    language: 'javascript',\n    source: [\n      \"function hello_world() {\",\n      \"  alert('Hello World!');\",\n      \"}\"\n    ].join(\"\\n\")\n  });\n  body.show('s1')\n  tx.create({\n    id: 'the-end',\n    type: 'paragraph',\n    content: [\n      \"That's it.\"\n    ].join(\" \")\n  })\n  body.show('the-end')\n}\n\n/*\n  Application\n*/\nlet cfg = new ProseEditorConfigurator()\ncfg.import(ProseEditorPackage)\ncfg.import(ScriptPackage)\n\nwindow.onload = function() {\n  let doc = cfg.createArticle(fixture)\n  let editorSession = new EditorSession(doc, {\n    configurator: cfg\n  })\n  ProseEditor.mount({\n    editorSession: editorSession\n  }, document.body)\n}\n"],"names":["BlockNode","let","Component","InsertNodeCommand","Tool","ProseEditorConfigurator","ProseEditorPackage","EditorSession","ProseEditor"],"mappings":"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"}